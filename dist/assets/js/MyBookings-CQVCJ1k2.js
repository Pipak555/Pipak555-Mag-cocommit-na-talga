import{j as e,u as s,l as a,r as t}from"./react-vendor-BMVo5gto.js";import{C as i,a as l,d as r,u as n,B as c,b as o,i as d,e as m,j as h,l as x,y as u,z as p,h as g}from"./index-BbQqfVom.js";import{p as j}from"./paymentService-BxZoTOEB.js";import{q as f,w as b,c as N,k as w,f as v,e as y}from"./firebase-vendor-BtzXZj7S.js";import{B as k}from"./badge-0vFpitRp.js";import{T as C}from"./theme-toggle-DFp1ra6v.js";import{P as I}from"./PayPalButton-BsDK2NsU.js";import{S as z}from"./skeleton-DjLmobuM.js";import{A,a as D,b as S,c as B,d as P,e as T,f as L,g as F}from"./alert-dialog-Biqv9se3.js";import{D as $,a as H,b as O,c as U,d as V}from"./dialog-COz4G8V2.js";import{S as Y}from"./separator-DgEd-SMQ.js";import{A as E,j as M,l as G,H as R,X as q,$ as K,a0 as Q,a1 as X,U as J,u as W,m as Z,w as _,x as ee}from"./icons-vendor-D1YpcxsO.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";import"./dropdown-menu-DES5sCK6.js";const se=()=>e.jsxs(i,{className:"shadow-soft",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{className:"h-5 w-32"}),e.jsx(z,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-16 w-16 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(z,{className:"h-4 w-3/4"}),e.jsx(z,{className:"h-3 w-1/2"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"h-3 w-full"}),e.jsx(z,{className:"h-3 w-2/3"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx(z,{className:"h-4 w-24"}),e.jsx(z,{className:"h-4 w-20"})]})]})]}),ae=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:[...Array(s)].map((s,a)=>e.jsx(se,{},a))}),te=()=>{const z=s(),[se]=a(),{user:te}=n(),[ie,le]=t.useState([]),[re,ne]=t.useState(!0),[ce,oe]=t.useState(!1),[de,me]=t.useState(null),[he,xe]=t.useState(!1),[ue,pe]=t.useState(0),[ge,je]=t.useState(!1),[fe,be]=t.useState(null),[Ne,we]=t.useState(!1),[ve,ye]=t.useState(null),[ke,Ce]=t.useState(0),[Ie,ze]=t.useState(!1),[Ae,De]=t.useState(0),Se=se.get("filter");t.useEffect(()=>{if(!te)return;(async()=>{if(!te)return;const e=await v(y(h,"users",te.uid));e.exists()&&pe(e.data().walletBalance||0)})(),ne(!0);const e=f(N(h,"bookings"),b("guestId","==",te.uid)),s=w(e,e=>{const s=e.docs.map(e=>{const s=e.data();return{id:e.id,...s}});s.sort((e,s)=>{const a=new Date(e.createdAt||0).getTime();return new Date(s.createdAt||0).getTime()-a});let a=s;if("upcoming"===Se){const e=new Date;a=s.filter(s=>new Date(s.checkIn)>=e&&"confirmed"===s.status)}else if("past"===Se){const e=new Date;a=s.filter(s=>{const a=new Date(s.checkOut);return e>a||"completed"===s.status||"cancelled"===s.status})}le(a),ne(!1)},e=>{ne(!1),Be()});return()=>s()},[te,Se]);const Be=async()=>{if(te)try{const e=await g({guestId:te.uid});le(e)}catch(e){}finally{ne(!1)}},Pe=e=>{switch(e){case"confirmed":return"default";case"pending":default:return"secondary";case"cancelled":return"destructive";case"completed":return"outline"}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 shadow-soft",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-3 sm:py-4 flex justify-between items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>z("/guest/dashboard"),className:"h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",children:e.jsx(E,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"hidden sm:block p-2 rounded-lg bg-secondary/10",children:e.jsx(M,{className:"w-5 h-5 text-secondary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base sm:text-lg font-bold truncate",children:"upcoming"===Se?"Upcoming Trips":"past"===Se?"Past Bookings":"My Bookings"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"upcoming"===Se?"Your confirmed upcoming trips":"past"===Se?"Your completed and past trips":"View your trips"})]})]}),e.jsx(C,{})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-4 sm:p-6",children:re?e.jsx(ae,{count:5}):0===ie.length?e.jsx(i,{children:e.jsxs(r,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"upcoming"===Se?"No upcoming trips":"past"===Se?"No past bookings yet":"No bookings yet"}),"past"===Se&&e.jsx("p",{className:"text-xs mt-2",children:"Your past bookings will appear here once trips are completed."})]})}):e.jsx("div",{className:"space-y-4",children:ie.map(s=>{const a=("pending"===s.status||"confirmed"===s.status)&&new Date(s.checkIn)>=new Date;return e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{children:["Booking #",s.id.slice(0,8)]}),e.jsx(k,{variant:Pe(s.status),children:s.status})]})}),e.jsxs(r,{children:[e.jsxs("div",{className:"space-y-4",children:[s.hostId&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>(e=>{e.hostId?z("/guest/messages?userId="+e.hostId):m.error("Host information not available")})(s),className:"flex items-center justify-center gap-2 flex-1 h-11 sm:h-auto touch-manipulation",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Message Host"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(e.listingId){we(!0),je(!0),Ce(0);try{const a=await x(e.listingId);if(a)if(be(a),a.hostId)try{const e=await u(a.hostId);ye(e?{fullName:e.fullName||"N/A",email:e.email||"N/A"}:{fullName:"N/A",email:"N/A"})}catch(s){ye({fullName:"N/A",email:"N/A"})}else ye({fullName:"N/A",email:"N/A"});else m.error("Listing not found"),je(!1)}catch(s){m.error("Failed to load listing: "+(s.message||"Unknown error")),je(!1)}finally{we(!1)}}else m.error("Listing information not available")})(s),className:"flex items-center justify-center gap-2 flex-1 h-11 sm:h-auto touch-manipulation",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"View Listing"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkIn).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkOut).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Guests"}),e.jsx("p",{className:"font-medium",children:s.guests})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"font-medium",children:d(s.totalPrice||0)})]})]})]}),"pending"===s.status&&te&&ue<(s.totalPrice||0)&&e.jsx("div",{className:"pt-4 border-t space-y-2",children:e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Payment Required"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Your wallet balance (",d(ue),") is insufficient. Please pay via PayPal to complete your booking."]}),e.jsx(I,{amount:s.totalPrice||0,userId:te.uid,description:"Booking payment for booking #"+s.id.slice(0,8),bookingId:s.id,onSuccess:()=>{m.success("Payment successful! Your booking will be confirmed once the host approves."),v(y(h,"users",te.uid)).then(e=>{e.exists()&&pe(e.data().walletBalance||0)})},redirectUrl:window.location.origin+"/guest/bookings"})]})}),a&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?m.error("Cannot cancel bookings with check-in dates in the past"):(me(e),oe(!0)):m.error("This booking cannot be cancelled"):m.error("Cannot cancel completed bookings"):m.error("This booking is already cancelled"):m.error("Invalid booking")})(s),className:"w-full",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]})]},s.id)})})}),e.jsx(A,{open:ce,onOpenChange:oe,children:e.jsxs(D,{children:[e.jsxs(S,{children:[e.jsx(B,{children:"Cancel Booking"}),e.jsxs(P,{children:["Are you sure you want to cancel this booking?",de&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-medium capitalize",children:de.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(de.checkIn).toLocaleDateString()]})]}),de.totalPrice>0&&e.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",d(de.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),e.jsxs(T,{children:[e.jsx(L,{disabled:he,children:"Keep Booking"}),e.jsx(F,{onClick:async()=>{if(!de||!te)return void m.error("Invalid booking or user");if("cancelled"===de.status||"completed"===de.status)return m.error("This booking cannot be cancelled"),oe(!1),void me(null);const e=new Date(de.checkIn);if(new Date>e)return m.error("Cannot cancel bookings with check-in dates in the past"),oe(!1),void me(null);xe(!0);try{if(await p(de.id,{status:"cancelled"}),"confirmed"===de.status||"pending"===de.status)try{const e=await j(de,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?d(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";m.success("Booking cancelled successfully. "+s)}}catch(s){m.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else m.success("Booking cancelled successfully.");oe(!1),me(null)}catch(a){const e=a.message||"Unknown error occurred";m.error("Failed to cancel booking: "+e)}finally{xe(!1)}},disabled:he,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:he?"Cancelling...":"Cancel Booking"})]})]})}),e.jsx($,{open:ge,onOpenChange:je,children:e.jsxs(H,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(O,{children:[e.jsx(U,{className:"text-2xl",children:fe?.title||"Listing Details"}),e.jsx(V,{children:"View full listing information and host details"})]}),Ne?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading listing details..."}):fe?e.jsxs("div",{className:"space-y-6",children:[fe.images&&fe.images.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative w-full h-[400px] rounded-lg overflow-hidden group bg-muted cursor-pointer",onClick:()=>{De(ke),ze(!0)},children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out h-full",style:{transform:`translateX(-${100*ke}%)`},children:fe.images.map((s,a)=>e.jsx("div",{className:"min-w-full h-full flex-shrink-0 relative",children:e.jsx("img",{src:s||"/placeholder.svg",alt:`${fe.title} - Image ${a+1}`,className:"w-full h-full object-cover"})},a))}),fe.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"secondary",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-10 w-10",onClick:e=>{e.stopPropagation(),Ce(e=>0===e?fe.images.length-1:e-1)},"aria-label":"Previous image",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsx(c,{variant:"secondary",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-10 w-10",onClick:e=>{e.stopPropagation(),Ce(e=>e===fe.images.length-1?0:e+1)},"aria-label":"Next image",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{className:"absolute top-4 right-4 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs font-medium backdrop-blur-sm z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(X,{className:"h-3 w-3 inline mr-1"}),"Click to zoom"]}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-1.5 rounded-full text-sm font-medium backdrop-blur-sm z-10",children:[ke+1," / ",fe.images.length]})]})]}),fe.images.length>1&&e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2 snap-x snap-mandatory",children:fe.images.map((s,a)=>e.jsx("button",{onClick:()=>Ce(a),className:"relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all snap-start "+(ke===a?"border-primary ring-2 ring-primary/50 scale-105":"border-transparent hover:border-border opacity-70 hover:opacity-100"),children:e.jsx("img",{src:s,alt:"Thumbnail "+(a+1),className:"w-full h-full object-cover"})},a))})})]}),ve&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Host Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("span",{children:ve.fullName||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("a",{href:"mailto:"+(ve.email||""),className:"text-primary hover:underline",children:ve.email||"N/A"})]}),fe.hostId&&e.jsx("div",{className:"pt-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{je(!1),z("/guest/messages?userId="+fe.hostId)},className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Message Host"]})})]})]}),e.jsx(Y,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Location"]}),e.jsx("p",{className:"text-muted-foreground",children:fe.location})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:fe.description})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price"}),e.jsxs("p",{className:"font-semibold",children:[d(fe.price),"/night"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Max Guests"}),e.jsx("p",{className:"font-semibold",children:fe.maxGuests})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:fe.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:void 0!==fe.bathrooms?fe.bathrooms:"N/A"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Category"}),e.jsx(k,{variant:"secondary",children:fe.category})]})]}),fe.amenities&&fe.amenities.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.amenities.map((s,a)=>e.jsx(k,{variant:"outline",children:s},a))})]})]})]}):e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Listing not found"})]})}),e.jsx($,{open:Ie,onOpenChange:ze,children:e.jsxs(H,{className:"max-w-[98vw] max-h-[98vh] w-auto h-auto p-0 bg-black/95 border-none m-1",children:[e.jsx(U,{className:"sr-only",children:"View Full Size Image"}),e.jsxs(V,{className:"sr-only",children:["Viewing image ",Ae+1," of ",fe?.images?.length||0," for ",fe?.title]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center min-h-[400px]",children:fe?.images&&fe.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-10 sm:w-10",onClick:()=>ze(!1),children:e.jsx(q,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium backdrop-blur-sm z-50",children:[Ae+1," / ",fe.images.length]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 sm:p-4 pt-12 pb-20 sm:pb-24",children:e.jsx("img",{src:fe.images[Ae]||"/placeholder.svg",alt:`${fe.title} - Image ${Ae+1}`,className:"max-w-full max-h-[calc(98vh-160px)] object-contain"})}),fe.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>De(e=>0===e?fe.images.length-1:e-1),children:e.jsx(K,{className:"h-4 w-4 sm:h-6 sm:w-6"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>De(e=>e===fe.images.length-1?0:e+1),children:e.jsx(Q,{className:"h-4 w-4 sm:h-6 sm:w-6"})})]}),fe.images.length>1&&e.jsx("div",{className:"absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm rounded-lg p-2 sm:p-3 z-50 max-w-[calc(98vw-32px)]",children:e.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto scrollbar-hide px-1",children:fe.images.map((s,a)=>e.jsx("button",{onClick:()=>De(a),className:"relative flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 rounded transition-all "+(Ae===a?"scale-110 shadow-lg shadow-primary/50":"opacity-70 hover:opacity-100"),children:e.jsx("div",{className:"absolute inset-0 rounded overflow-hidden border-2 "+(Ae===a?"border-primary ring-2 ring-primary/50 ring-offset-2 ring-offset-black/70":"border-transparent hover:border-white/50"),children:e.jsx("img",{src:s,alt:"Thumbnail "+(a+1),className:"w-full h-full object-cover transition-opacity "+(Ae===a?"opacity-100":"opacity-70")})})},a))})})]})})]})})]})};export{te as default};
