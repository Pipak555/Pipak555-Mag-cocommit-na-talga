import{j as e,r as t,u as r,i as a}from"./react-vendor-DAkY0NgE.js";import{C as s,d as l,g as n,j as i,e as c,i as o,B as d,a as u,b as m,u as h,p as f,k as p,t as g,r as v}from"./index-BbvEjZj9.js";import{q as x,c as j,w,d as y,f as b,e as N}from"./firebase-vendor-CvoiOdvz.js";import{L as C}from"./ListingCard-YDL4intN.js";import{S}from"./skeleton-COgBj1uS.js";import{E as k}from"./empty-state-R01VkqBd.js";import{I as E}from"./input-C1fDyqub.js";import{u as R,f as I,g as A,h as P,O as L,i as F,j as M}from"./ui-vendor-CZx_xpmK.js";import{C as D}from"./calendar-D55um_cb.js";import{y as O,h as q,X as _,z as V,i as G,A as K}from"./icons-vendor-3zhgXMYa.js";import{P as T,a as B,b as z}from"./popover-BLRuYxtE.js";import{L as U}from"./label-kBNwlYyC.js";import{S as $,a as H,b as J,c as W,d as X}from"./select-B0HuvfWd.js";import{o as Q}from"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./badge-Bdu_tSqo.js";const Y=()=>e.jsxs(s,{className:"overflow-hidden border-0 shadow-sm",children:[e.jsx(S,{className:"h-56 w-full"}),e.jsxs(l,{className:"p-5 space-y-3",children:[e.jsx(S,{className:"h-5 w-3/4"}),e.jsx(S,{className:"h-4 w-1/2"}),e.jsx(S,{className:"h-4 w-full"}),e.jsx(S,{className:"h-4 w-2/3"}),e.jsx("div",{className:"flex items-center justify-between pt-3 border-t",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(S,{className:"h-4 w-12"}),e.jsx(S,{className:"h-4 w-16"})]})})]})]});var Z=.999,ee=/[\\\/_+.#"@\[\(\{&]/,te=/[\\\/_+.#"@\[\(\{&]/g,re=/[\s-]/,ae=/[\s-]/g;function se(e,t,r,a,s,l,n){if(l===t.length)return s===e.length?1:.99;var i=`${s},${l}`;if(void 0!==n[i])return n[i];for(var c,o,d,u,m=a.charAt(l),h=r.indexOf(m,s),f=0;h>=0;)(c=se(e,t,r,a,h+1,l+1,n))>f&&(h===s?c*=1:ee.test(e.charAt(h-1))?(c*=.8,(d=e.slice(s,h-1).match(te))&&s>0&&(c*=Math.pow(Z,d.length))):re.test(e.charAt(h-1))?(c*=.9,(u=e.slice(s,h-1).match(ae))&&s>0&&(c*=Math.pow(Z,u.length))):(c*=.17,s>0&&(c*=Math.pow(Z,h-s))),e.charAt(h)!==t.charAt(l)&&(c*=.9999)),(.1>c&&r.charAt(h-1)===a.charAt(l+1)||a.charAt(l+1)===a.charAt(l)&&r.charAt(h-1)!==a.charAt(l))&&.1*(o=se(e,t,r,a,h+1,l+2,n))>c&&(c=.1*o),c>f&&(f=c),h=r.indexOf(m,h+1);return n[i]=f,f}function le(e){return e.toLowerCase().replace(ae," ")}function ne(e,t,r){return se(e=r&&r.length>0?e+" "+r.join(" "):e,t,le(e),le(t),0,0,{})}var ie='[cmdk-group=""]',ce='[cmdk-group-items=""]',oe='[cmdk-item=""]',de=oe+':not([aria-disabled="true"])',ue="cmdk-item-select",me="data-value",he=(e,t,r)=>ne(e,t,r),fe=t.createContext(void 0),pe=()=>t.useContext(fe),ge=t.createContext(void 0),ve=()=>t.useContext(ge),xe=t.createContext(void 0),je=t.forwardRef((e,r)=>{let a=Fe(()=>{var t,r;return{search:"",value:null!=(r=null!=(t=e.value)?t:e.defaultValue)?r:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),s=Fe(()=>new Set),l=Fe(()=>new Map),n=Fe(()=>new Map),i=Fe(()=>new Set),c=Pe(e),{label:o,children:d,value:u,onValueChange:m,filter:h,shouldFilter:f,loop:p,disablePointerSelection:g=!1,vimBindings:v=!0,...x}=e,j=R(),w=R(),y=R(),b=t.useRef(null),N=Oe();Le(()=>{if(void 0!==u){let e=u.trim();a.current.value=e,C.emit()}},[u]),Le(()=>{N(6,L)},[]);let C=t.useMemo(()=>({subscribe:e=>(i.current.add(e),()=>i.current.delete(e)),snapshot:()=>a.current,setState:(e,t,r)=>{var s,l,n,i;if(!Object.is(a.current[e],t)){if(a.current[e]=t,"search"===e)P(),E(),N(1,A);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(y);e?e.focus():null==(s=document.getElementById(j))||s.focus()}if(N(7,()=>{var e;a.current.selectedItemId=null==(e=F())?void 0:e.id,C.emit()}),r||N(5,L),void 0!==(null==(l=c.current)?void 0:l.value)){let e=null!=t?t:"";return void(null==(i=(n=c.current).onValueChange)||i.call(n,e))}}C.emit()}},emit:()=>{i.current.forEach(e=>e())}}),[]),S=t.useMemo(()=>({value:(e,t,r)=>{var s;t!==(null==(s=n.current.get(e))?void 0:s.value)&&(n.current.set(e,{value:t,keywords:r}),a.current.filtered.items.set(e,k(t,r)),N(2,()=>{E(),C.emit()}))},item:(e,t)=>(s.current.add(e),t&&(l.current.has(t)?l.current.get(t).add(e):l.current.set(t,new Set([e]))),N(3,()=>{P(),E(),a.current.value||A(),C.emit()}),()=>{n.current.delete(e),s.current.delete(e),a.current.filtered.items.delete(e);let t=F();N(4,()=>{P(),(null==t?void 0:t.getAttribute("id"))===e&&A(),C.emit()})}),group:e=>(l.current.has(e)||l.current.set(e,new Set),()=>{n.current.delete(e),l.current.delete(e)}),filter:()=>c.current.shouldFilter,label:o||e["aria-label"],getDisablePointerSelection:()=>c.current.disablePointerSelection,listId:j,inputId:y,labelId:w,listInnerRef:b}),[]);function k(e,t){var r,s;let l=null!=(s=null==(r=c.current)?void 0:r.filter)?s:he;return e?l(e,a.current.search,t):0}function E(){if(!a.current.search||!1===c.current.shouldFilter)return;let e=a.current.filtered.items,t=[];a.current.filtered.groups.forEach(r=>{let a=l.current.get(r),s=0;a.forEach(t=>{let r=e.get(t);s=Math.max(r,s)}),t.push([r,s])});let r=b.current;M().sort((t,r)=>{var a,s;let l=t.getAttribute("id"),n=r.getAttribute("id");return(null!=(a=e.get(n))?a:0)-(null!=(s=e.get(l))?s:0)}).forEach(e=>{let t=e.closest(ce);t?t.appendChild(e.parentElement===t?e:e.closest(ce+" > *")):r.appendChild(e.parentElement===r?e:e.closest(ce+" > *"))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let r=null==(t=b.current)?void 0:t.querySelector(`${ie}[${me}="${encodeURIComponent(e[0])}"]`);null==r||r.parentElement.appendChild(r)})}function A(){let e=M().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(me);C.setState("value",t||void 0)}function P(){var e,t,r,i;if(!a.current.search||!1===c.current.shouldFilter)return void(a.current.filtered.count=s.current.size);a.current.filtered.groups=new Set;let o=0;for(let l of s.current){let s=k(null!=(t=null==(e=n.current.get(l))?void 0:e.value)?t:"",null!=(i=null==(r=n.current.get(l))?void 0:r.keywords)?i:[]);a.current.filtered.items.set(l,s),s>0&&o++}for(let[s,n]of l.current)for(let e of n)if(a.current.filtered.items.get(e)>0){a.current.filtered.groups.add(s);break}a.current.filtered.count=o}function L(){var e,t,r;let a=F();a&&((null==(e=a.parentElement)?void 0:e.firstChild)===a&&(null==(r=null==(t=a.closest(ie))?void 0:t.querySelector('[cmdk-group-heading=""]'))||r.scrollIntoView({block:"nearest"})),a.scrollIntoView({block:"nearest"}))}function F(){var e;return null==(e=b.current)?void 0:e.querySelector(oe+'[aria-selected="true"]')}function M(){var e;return Array.from((null==(e=b.current)?void 0:e.querySelectorAll(de))||[])}function D(e){let t=M()[e];t&&C.setState("value",t.getAttribute(me))}function O(e){var t;let r=F(),a=M(),s=a.findIndex(e=>e===r),l=a[s+e];null!=(t=c.current)&&t.loop&&(l=0>s+e?a[a.length-1]:s+e===a.length?a[0]:a[s+e]),l&&C.setState("value",l.getAttribute(me))}function q(e){let t,r=F(),a=null==r?void 0:r.closest(ie);for(;a&&!t;)a=e>0?Ie(a,ie):Ae(a,ie),t=null==a?void 0:a.querySelector(de);t?C.setState("value",t.getAttribute(me)):O(e)}let _=()=>D(M().length-1),V=e=>{e.preventDefault(),e.metaKey?_():e.altKey?q(1):O(1)},G=e=>{e.preventDefault(),e.metaKey?D(0):e.altKey?q(-1):O(-1)};return t.createElement(I.div,{ref:r,tabIndex:-1,...x,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=x.onKeyDown)||t.call(x,e);let r=e.nativeEvent.isComposing||229===e.keyCode;if(!e.defaultPrevented&&!r)switch(e.key){case"n":case"j":v&&e.ctrlKey&&V(e);break;case"ArrowDown":V(e);break;case"p":case"k":v&&e.ctrlKey&&G(e);break;case"ArrowUp":G(e);break;case"Home":e.preventDefault(),D(0);break;case"End":e.preventDefault(),_();break;case"Enter":{e.preventDefault();let t=F();if(t){let e=new Event(ue);t.dispatchEvent(e)}}}}},t.createElement("label",{"cmdk-label":"",htmlFor:S.inputId,id:S.labelId,style:_e},o),qe(e,e=>t.createElement(ge.Provider,{value:C},t.createElement(fe.Provider,{value:S},e))))}),we=t.forwardRef((e,r)=>{var a,s;let l=R(),n=t.useRef(null),i=t.useContext(xe),c=pe(),o=Pe(e),d=null!=(s=null==(a=o.current)?void 0:a.forceMount)?s:null==i?void 0:i.forceMount;Le(()=>{if(!d)return c.item(l,null==i?void 0:i.id)},[d]);let u=De(l,n,[e.value,e.children,n],e.keywords),m=ve(),h=Me(e=>e.value&&e.value===u.current),f=Me(e=>!(!d&&!1!==c.filter())||!e.search||e.filtered.items.get(l)>0);function p(){var e,t;g(),null==(t=(e=o.current).onSelect)||t.call(e,u.current)}function g(){m.setState("value",u.current,!0)}if(t.useEffect(()=>{let t=n.current;if(t&&!e.disabled)return t.addEventListener(ue,p),()=>t.removeEventListener(ue,p)},[f,e.onSelect,e.disabled]),!f)return null;let{disabled:v,value:x,onSelect:j,forceMount:w,keywords:y,...b}=e;return t.createElement(I.div,{ref:M(n,r),...b,id:l,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!h,"data-disabled":!!v,"data-selected":!!h,onPointerMove:v||c.getDisablePointerSelection()?void 0:g,onClick:v?void 0:p},e.children)}),ye=t.forwardRef((e,r)=>{let{heading:a,children:s,forceMount:l,...n}=e,i=R(),c=t.useRef(null),o=t.useRef(null),d=R(),u=pe(),m=Me(e=>!(!l&&!1!==u.filter())||!e.search||e.filtered.groups.has(i));Le(()=>u.group(i),[]),De(i,c,[e.value,e.heading,o]);let h=t.useMemo(()=>({id:i,forceMount:l}),[l]);return t.createElement(I.div,{ref:M(c,r),...n,"cmdk-group":"",role:"presentation",hidden:!m||void 0},a&&t.createElement("div",{ref:o,"cmdk-group-heading":"","aria-hidden":!0,id:d},a),qe(e,e=>t.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?d:void 0},t.createElement(xe.Provider,{value:h},e))))}),be=t.forwardRef((e,r)=>{let{alwaysRender:a,...s}=e,l=t.useRef(null),n=Me(e=>!e.search);return a||n?t.createElement(I.div,{ref:M(l,r),...s,"cmdk-separator":"",role:"separator"}):null}),Ne=t.forwardRef((e,r)=>{let{onValueChange:a,...s}=e,l=null!=e.value,n=ve(),i=Me(e=>e.search),c=Me(e=>e.selectedItemId),o=pe();return t.useEffect(()=>{null!=e.value&&n.setState("search",e.value)},[e.value]),t.createElement(I.input,{ref:r,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":o.listId,"aria-labelledby":o.labelId,"aria-activedescendant":c,id:o.inputId,type:"text",value:l?e.value:i,onChange:e=>{l||n.setState("search",e.target.value),null==a||a(e.target.value)}})}),Ce=t.forwardRef((e,r)=>{let{children:a,label:s="Suggestions",...l}=e,n=t.useRef(null),i=t.useRef(null),c=Me(e=>e.selectedItemId),o=pe();return t.useEffect(()=>{if(i.current&&n.current){let e,t=i.current,r=n.current,a=new ResizeObserver(()=>{e=requestAnimationFrame(()=>{let e=t.offsetHeight;r.style.setProperty("--cmdk-list-height",e.toFixed(1)+"px")})});return a.observe(t),()=>{cancelAnimationFrame(e),a.unobserve(t)}}},[]),t.createElement(I.div,{ref:M(n,r),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":c,"aria-label":s,id:o.listId},qe(e,e=>t.createElement("div",{ref:M(i,o.listInnerRef),"cmdk-list-sizer":""},e)))}),Se=t.forwardRef((e,r)=>{let{open:a,onOpenChange:s,overlayClassName:l,contentClassName:n,container:i,...c}=e;return t.createElement(A,{open:a,onOpenChange:s},t.createElement(P,{container:i},t.createElement(L,{"cmdk-overlay":"",className:l}),t.createElement(F,{"aria-label":e.label,"cmdk-dialog":"",className:n},t.createElement(je,{ref:r,...c}))))}),ke=t.forwardRef((e,r)=>Me(e=>0===e.filtered.count)?t.createElement(I.div,{ref:r,...e,"cmdk-empty":"",role:"presentation"}):null),Ee=t.forwardRef((e,r)=>{let{progress:a,children:s,label:l="Loading...",...n}=e;return t.createElement(I.div,{ref:r,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},qe(e,e=>t.createElement("div",{"aria-hidden":!0},e)))}),Re=Object.assign(je,{List:Ce,Item:we,Input:Ne,Group:ye,Separator:be,Dialog:Se,Empty:ke,Loading:Ee});function Ie(e,t){let r=e.nextElementSibling;for(;r;){if(r.matches(t))return r;r=r.nextElementSibling}}function Ae(e,t){let r=e.previousElementSibling;for(;r;){if(r.matches(t))return r;r=r.previousElementSibling}}function Pe(e){let r=t.useRef(e);return Le(()=>{r.current=e}),r}var Le="undefined"==typeof window?t.useEffect:t.useLayoutEffect;function Fe(e){let r=t.useRef();return void 0===r.current&&(r.current=e()),r}function Me(e){let r=ve(),a=()=>e(r.snapshot());return t.useSyncExternalStore(r.subscribe,a,a)}function De(e,r,a,s=[]){let l=t.useRef(),n=pe();return Le(()=>{var t;let i=(()=>{var e;for(let t of a){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():l.current}})(),c=s.map(e=>e.trim());n.value(e,i,c),null==(t=r.current)||t.setAttribute(me,i),l.current=i}),l}var Oe=()=>{let[e,r]=t.useState(),a=Fe(()=>new Map);return Le(()=>{a.current.forEach(e=>e()),a.current=new Map},[e]),(e,t)=>{a.current.set(e,t),r({})}};function qe({asChild:e,children:r},a){return e&&t.isValidElement(r)?t.cloneElement(function(e){let t=e.type;return"function"==typeof t?t(e.props):"render"in t?t.render(e.props):e}(r),{ref:r.ref},a(r.props.children)):a(r)}var _e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ve=t.forwardRef(({className:t,...r},a)=>e.jsx(Re,{ref:a,className:n("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...r}));Ve.displayName=Re.displayName;const Ge=t.forwardRef(({className:t,...r},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(O,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Re.Input,{ref:a,className:n("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...r})]}));Ge.displayName=Re.Input.displayName;const Ke=t.forwardRef(({className:t,...r},a)=>e.jsx(Re.List,{ref:a,className:n("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...r}));Ke.displayName=Re.List.displayName;const Te=t.forwardRef((t,r)=>e.jsx(Re.Empty,{ref:r,className:"py-6 text-center text-sm",...t}));Te.displayName=Re.Empty.displayName;const Be=t.forwardRef(({className:t,...r},a)=>e.jsx(Re.Group,{ref:a,className:n("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...r}));Be.displayName=Re.Group.displayName,t.forwardRef(({className:t,...r},a)=>e.jsx(Re.Separator,{ref:a,className:n("-mx-1 h-px bg-border",t),...r})).displayName=Re.Separator.displayName;const ze=t.forwardRef(({className:t,...r},a)=>e.jsx(Re.Item,{ref:a,className:n("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...r}));ze.displayName=Re.Item.displayName;const Ue="recent_searches",$e=({onSearch:a,placeholder:s="Search destinations, experiences, services...",className:l=""})=>{const[n,u]=t.useState(""),[m,h]=t.useState([]),[f,p]=t.useState([]),[g,v]=t.useState(!1),[b,N]=t.useState(!1),C=r(),S=t.useRef(null);t.useEffect(()=>{k()},[]),t.useEffect(()=>{n.trim().length>2?I(n):h([])},[n]);const k=()=>{try{const e=localStorage.getItem(Ue);e&&p(JSON.parse(e))}catch(e){}},R=e=>{if(e.trim())try{const t=[...f],r=t.indexOf(e);r>-1&&t.splice(r,1),t.unshift(e);const a=t.slice(0,5);p(a),localStorage.setItem(Ue,JSON.stringify(a))}catch(t){}},I=(()=>{let e;return t=>{clearTimeout(e),e=setTimeout(async()=>{await A(t)},300)}})(),A=async e=>{if(e.trim()){N(!0);try{const t=await(async(e={})=>{try{let t=x(j(i,"listing"));t=e.status?x(t,w("status","==",e.status)):x(t,w("status","==","approved")),e.category&&"all"!==e.category&&(t=x(t,w("category","==",e.category)));let r=(await y(t)).docs.map(e=>({id:e.id,...e.data()}));if(e.location){const t=e.location.toLowerCase();r=r.filter(e=>e.location.toLowerCase().includes(t))}if(void 0!==e.minPrice&&(r=r.filter(t=>t.price>=e.minPrice)),void 0!==e.maxPrice&&(r=r.filter(t=>t.price<=e.maxPrice)),void 0!==e.maxGuests&&(r=r.filter(t=>t.maxGuests>=e.maxGuests)),void 0!==e.minRating&&(r=r.filter(t=>(t.averageRating||0)>=e.minRating)),e.query){const t=e.query.toLowerCase();r=r.filter(e=>{const r=e.title.toLowerCase().includes(t),a=e.location.toLowerCase().includes(t),s=e.description.toLowerCase().includes(t),l=e.category.toLowerCase().includes(t);return r||a||s||l}),r.sort((e,r)=>{const a=(e.title.toLowerCase().includes(t)?3:0)+(e.location.toLowerCase().includes(t)?2:0)+(e.description.toLowerCase().includes(t)?1:0);return(r.title.toLowerCase().includes(t)?3:0)+(r.location.toLowerCase().includes(t)?2:0)+(r.description.toLowerCase().includes(t)?1:0)-a})}else switch(e.sortBy){case"price_asc":r.sort((e,t)=>e.price-t.price);break;case"price_desc":r.sort((e,t)=>t.price-e.price);break;case"rating_desc":r.sort((e,t)=>{const r=e.averageRating||0;return(t.averageRating||0)-r});break;case"oldest":r.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());break;default:r.sort((e,t)=>{const r=new Date(e.createdAt).getTime();return new Date(t.createdAt).getTime()-r})}const a=r.length,s=e.limit||50,l=a>s;return{listings:r.slice(0,s),total:a,hasMore:l}}catch(t){throw t}})({query:e,status:"approved",limit:5});h(t.listings)}catch(t){c.error("Failed to load suggestions")}finally{N(!1)}}else h([])},P=e=>{e.preventDefault(),n.trim()&&(R(n),a&&a(n),C("/guest/browse"),v(!1))};return e.jsxs("form",{onSubmit:P,className:"relative flex gap-2 "+l,children:[e.jsxs(T,{open:g,onOpenChange:v,children:[e.jsx(B,{asChild:!0,children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none z-10"}),e.jsx(E,{ref:S,type:"search",placeholder:s,value:n,onChange:e=>u(e.target.value),onFocus:()=>v(!0),className:"pl-10 h-12 w-full",autoComplete:"off"})]})}),e.jsx(z,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(Ve,{shouldFilter:!1,children:[e.jsx(Ge,{placeholder:"Search...",value:n,onValueChange:u}),e.jsxs(Ke,{children:[b&&e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Searching..."}),!b&&0===m.length&&n.trim().length>2&&e.jsx(Te,{children:"No results found."}),!b&&m.length>0&&e.jsx(Be,{heading:"Suggestions",children:m.map(t=>e.jsx(ze,{value:t.id,onSelect:()=>(e=>{R(n),C("/guest/listing/"+e.id),v(!1),u("")})(t),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx("img",{src:t.images?.[0]||"/placeholder.svg",alt:t.title,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.location}),e.jsxs("p",{className:"text-xs font-semibold text-primary mt-1",children:[o(t.price),"/night"]})]})]})},t.id))}),!b&&f.length>0&&0===n.trim().length&&e.jsxs(Be,{heading:"Recent Searches",children:[f.map((t,r)=>e.jsx(ze,{value:t,onSelect:()=>{return u(e=t),R(e),a&&a(e),C("/guest/browse"),void v(!1);var e},className:"cursor-pointer group",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:t})]}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation(),(e=>{const t=f.filter(t=>t!==e);p(t),localStorage.setItem(Ue,JSON.stringify(t))})(t)},children:e.jsx(_,{className:"h-3 w-3"})})]})},r)),e.jsx(ze,{value:"clear-all",onSelect:()=>{p([]),localStorage.removeItem(Ue),c.success("Recent searches cleared")},className:"cursor-pointer text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(_,{className:"h-3 w-3"}),"Clear all recent searches"]})})]}),!b&&n.trim().length>0&&e.jsx(Be,{children:e.jsx(ze,{value:"search-all",onSelect:P,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs("span",{children:['Search for "',n,'"']})]})})})]})]})})]}),e.jsxs(d,{type:"submit",className:"h-12 px-6",children:[e.jsx(O,{className:"h-4 w-4 mr-2 sm:mr-0 sm:inline"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]})]})},He=({onFilterChange:r,initialFilters:a})=>{const[n,i]=t.useState(a||{location:"",guests:1,category:"all"}),[c,o]=t.useState(!1);return t.useEffect(()=>{a&&i(a)},[a]),e.jsxs(s,{children:[e.jsx(u,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Search Filters"]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"location",children:"Where"}),e.jsx(E,{id:"location",placeholder:"Location",value:n.location,onChange:e=>i({...n,location:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Check-in"}),e.jsxs(T,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-full justify-start",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),n.checkIn?Q(n.checkIn,"PP"):"Select date"]})}),e.jsx(z,{className:"w-auto p-0",children:e.jsx(D,{mode:"single",selected:n.checkIn,onSelect:e=>i({...n,checkIn:e}),disabled:e=>new Date>e})})]})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Check-out"}),e.jsxs(T,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-full justify-start",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),n.checkOut?Q(n.checkOut,"PP"):"Select date"]})}),e.jsx(z,{className:"w-auto p-0",children:e.jsx(D,{mode:"single",selected:n.checkOut,onSelect:e=>i({...n,checkOut:e}),disabled:e=>e<(n.checkIn||new Date)})})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"guests",children:"Guests"}),e.jsx(E,{id:"guests",type:"number",min:"1",value:n.guests,onChange:e=>i({...n,guests:+e.target.value})})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"category",children:"Category"}),e.jsxs($,{value:n.category,onValueChange:e=>i({...n,category:e}),children:[e.jsx(H,{children:e.jsx(J,{})}),e.jsxs(W,{children:[e.jsx(X,{value:"all",children:"All Categories"}),e.jsx(X,{value:"home",children:"Homes"}),e.jsx(X,{value:"experience",children:"Experiences"}),e.jsx(X,{value:"service",children:"Services"})]})]})]})]}),e.jsxs(d,{variant:"ghost",onClick:()=>o(!c),className:"w-full",children:[c?"Hide":"Show"," Advanced Filters"]}),c&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"minPrice",children:"Min Price (₱)"}),e.jsx(E,{id:"minPrice",type:"number",min:"0",value:n.minPrice||"",onChange:e=>i({...n,minPrice:+e.target.value}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"maxPrice",children:"Max Price (₱)"}),e.jsx(E,{id:"maxPrice",type:"number",min:"0",value:n.maxPrice||"",onChange:e=>i({...n,maxPrice:+e.target.value}),placeholder:"No limit"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:()=>{r(n)},className:"flex-1",children:"Apply Filters"}),e.jsx(d,{onClick:()=>{const e={location:"",guests:1,category:"all"};i(e),r(e)},variant:"outline",children:"Reset"})]})]})]})},Je=()=>{const n=r(),o=a(),{user:u}=h(),[m,x]=t.useState([]),[j,w]=t.useState([]),[y,S]=t.useState([]),[E,R]=t.useState(!0),[I,A]=t.useState(""),[P,L]=t.useState({location:"",guests:1,category:(()=>{const e=new URLSearchParams(o.search).get("category");return e&&["home","experience","service"].includes(e)?e:"all"})()});t.useEffect(()=>{F(),u&&(M(),D())},[u,P.category]),t.useEffect(()=>{const e=new URLSearchParams(o.search),t=e.get("q"),r=e.get("category");if(t&&A(t),r&&["home","experience","service"].includes(r)){const e=r;L(t=>t.category!==e?{...t,category:e}:t)}else r||L(e=>"all"!==e.category?{...e,category:"all"}:e)},[o.search]);const F=async()=>{try{const e="all"!==P.category?{category:P.category,status:"approved"}:{status:"approved"},t=await f(e);if(t.length>0){const e=t.map(e=>e.id),r=await p(e),a=t.map(e=>{const t=r.get(e.id);return{...e,averageRating:t?.averageRating||0,reviewCount:t?.reviewCount||0}});x(a)}else x(t)}catch(e){c.error("Failed to load listings")}finally{R(!1)}},M=async()=>{if(!u)return;const e=await b(N(i,"users",u.uid));e.exists()&&w(e.data().favorites||[])},D=async()=>{if(!u)return;const e=await b(N(i,"users",u.uid));e.exists()&&S(e.data().wishlist||[])},q=t.useCallback(async e=>{if(!u)return void c.error("Please login to add favorites");const t=j.includes(e)?j.filter(t=>t!==e):[...j,e];w(t);try{const t=await g(u.uid,e,j);w(t),c.success(t.includes(e)?"Added to favorites":"Removed from favorites")}catch(r){w(j),c.error("Failed to update favorites")}},[u,j]),_=t.useCallback(async e=>{if(!u)return void c.error("Please login to add to wishlist");const t=y.includes(e)?y.filter(t=>t!==e):[...y,e];S(t);try{const t=await v(u.uid,e,y);S(t),c.success(t.includes(e)?"Added to wishlist":"Removed from wishlist")}catch(r){S(y),c.error("Failed to update wishlist")}},[u,y]),V=t.useMemo(()=>m.filter(e=>{if(I.trim()){const t=I.toLowerCase(),r=e.title.toLowerCase().includes(t),a=e.location.toLowerCase().includes(t),s=e.description.toLowerCase().includes(t),l=e.category.toLowerCase().includes(t);if(!(r||a||s||l))return!1}return!(P.location&&!e.location.toLowerCase().includes(P.location.toLowerCase())||P.guests>e.maxGuests||P.minPrice&&e.price<P.minPrice||P.maxPrice&&e.price>P.maxPrice)}),[m,I,P]);return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8",children:[e.jsxs(d,{variant:"ghost",onClick:()=>n("/guest/dashboard"),className:"mb-6",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-6",children:"Browse Listings"}),e.jsx(s,{className:"mb-6 shadow-md",children:e.jsx(l,{className:"pt-6",children:e.jsx($e,{onSearch:e=>{A(e),n("/guest/browse?q="+encodeURIComponent(e))},placeholder:"Search destinations, experiences, services..."})})}),e.jsx("div",{className:"mb-6 flex flex-wrap gap-2",children:["all","home","experience","service"].map(t=>e.jsx("button",{className:"px-4 py-2 rounded-full text-sm font-medium border-2 transition-all "+(P.category===t?"bg-primary text-primary-foreground border-primary shadow-md":"bg-background border-border text-foreground hover:bg-muted hover:border-primary/50"),onClick:()=>L({...P,category:t}),children:"all"===t?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsx("div",{className:"mb-8",children:e.jsx(He,{onFilterChange:e=>{L(e)},initialFilters:P})}),E?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...[,,,,,,,,]].map((t,r)=>e.jsx(Y,{},r))}):0===V.length?e.jsx(k,{icon:e.jsx(O,{className:"h-10 w-10"}),title:"No listings found",description:"Try adjusting your filters or browse a different category to find what you're looking for.",action:e.jsx(d,{onClick:()=>L({...P,category:"all",location:"",guests:1}),children:"Clear Filters"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 items-stretch",children:V.map(t=>e.jsx(C,{listing:t,onView:()=>n("/guest/listing/"+t.id),onFavorite:()=>q(t.id),onWishlist:()=>_(t.id),isFavorite:j.includes(t.id),isInWishlist:y.includes(t.id)},t.id))})]})})};export{Je as default};
