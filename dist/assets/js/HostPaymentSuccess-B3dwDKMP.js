import{u as e,l as s,r as t,j as a}from"./react-vendor-BMVo5gto.js";import{u as i,e as n,C as r,d as o,B as c}from"./index-Bl4WVUm9.js";import{getPlanById as l,getUserSubscription as d}from"./billingService-iurdcjpD.js";import{f as m,ab as u,H as x}from"./icons-vendor-BQMxNFbQ.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";import"./firebase-vendor-BtzXZj7S.js";const p=()=>{const p=e(),[h]=s(),{user:f}=i(),[g,j]=t.useState(null),[b,v]=t.useState(!0),[y,N]=t.useState("unknown"),w=h.get("planId")||"active-host-monthly";return t.useEffect(()=>{if(!f)return;const e=setTimeout(()=>{const e=h.get("userId");if(e&&e!==f.uid)return n.error("Payment verification failed. Please contact support if you completed payment."),void p("/host/dashboard");const s=l(w);if(!s)return n.error("Invalid plan selected"),void p("/host/register");j(s)},500);return()=>clearTimeout(e)},[w,f,p,h]),t.useEffect(()=>{if(!f||!g)return;const e=async(s=0)=>{try{0===s&&await new Promise(e=>setTimeout(e,1e3));const t=await d(f.uid);t&&"active"===t.status?(N("active"),v(!1)):3>s?setTimeout(()=>e(s+1),2e3):(N("pending"),v(!1),setTimeout(()=>{n.warning("Payment received but subscription activation is pending. Please wait a moment or refresh the page.")},500))}catch(t){2>s?setTimeout(()=>e(s+1),2e3):(N("unknown"),v(!1))}};e()},[f,g]),b||!g?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-4 text-muted-foreground",children:"Verifying payment..."})]})}):a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsx(r,{className:"max-w-2xl w-full",children:a.jsx(o,{className:"p-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(m,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),a.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Payment Successful!"}),a.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"active"===y?`Your subscription to ${g.name} has been activated.`:"pending"===y?`Payment received! Your subscription to ${g.name} is being activated...`:`Payment received! Processing your subscription to ${g.name}...`}),a.jsxs("div",{className:"bg-muted rounded-lg p-6 mb-8 text-left",children:[a.jsx("h2",{className:"font-semibold mb-4",children:"Subscription Details"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),a.jsx("span",{className:"font-medium",children:g.name})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Billing Cycle:"}),a.jsx("span",{className:"font-medium capitalize",children:g.billingCycle})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Status:"}),a.jsx("span",{className:"font-medium "+("active"===y?"text-green-600 dark:text-green-400":"pending"===y?"text-yellow-600 dark:text-yellow-400":"text-muted-foreground"),children:"active"===y?"Active":"pending"===y?"Activating...":"Processing..."})]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsxs(c,{onClick:()=>p("/host/dashboard"),className:"min-w-[200px]",children:["Go to Dashboard",a.jsx(u,{className:"h-4 w-4 ml-2"})]}),a.jsxs(c,{variant:"outline",onClick:()=>p("/host/dashboard"),children:[a.jsx(x,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})]}),a.jsx("p",{className:"text-sm text-muted-foreground mt-8",children:"active"===y?"You can now start creating listings and managing your properties.":"pending"===y?"Your subscription is being activated. This may take a few moments.":"Processing your subscription activation..."}),"pending"===y&&a.jsx("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:a.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[a.jsx("strong",{children:"Note:"})," Payment received but subscription activation is pending. Please wait a moment or refresh the page. If the issue persists, contact support."]})})]})})})})};export{p as default};
