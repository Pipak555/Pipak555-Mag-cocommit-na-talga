import{u as e,r as s,j as a}from"./react-vendor-Ve3SFwKO.js";import{u as t,a as r,j as l,F as i,i as n,C as o,b as c,c as m,d,e as p,B as x}from"./index-BnushFQy.js";import{h as u,f as y,u as h}from"./firebase-vendor-BC71bXmb.js";import{I as j}from"./input-C6C1u0Er.js";import{L as b}from"./label-DdT-oWKe.js";import{B as f}from"./BackButton-DohCcac0.js";import{C as g}from"./CouponManager-pfYFfol6.js";import{P as w}from"./PayPalButton-oQiuhPwA.js";import{P as N}from"./PayPalIdentity-Dv_4VZNc.js";import{h as P,r as v,C as k,t as S,a8 as E}from"./icons-vendor-DD8ZfUKZ.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";import"./badge-CYghlWc2.js";const C=()=>{e();const{user:C}=t(),[I,A]=s.useState(0),[B,L]=s.useState([]),[V,$]=s.useState([]),[F,_]=s.useState(""),[D,T]=s.useState(!1),[U,R]=s.useState(""),[W,z]=s.useState(!1),[H,J]=s.useState(!1);s.useEffect(()=>{if(C){O(),Z();const e=new URLSearchParams(window.location.search),s=e.get("token"),a=e.get("PayerID");s&&a&&M()}},[C]);const M=async(e,s)=>{const a=sessionStorage.getItem("paypal_pending_order");if(a){JSON.parse(a);try{r.success("Payment successful! Processing..."),await G(),sessionStorage.removeItem("paypal_pending_order"),window.history.replaceState({},"",window.location.pathname)}catch(t){r.error("Payment verification failed. Please contact support.")}}else r.error("Payment session expired. Please try again.")},O=async()=>{if(!C)return;const e=await u(y(l,"users",C.uid));if(e.exists()){const s=e.data();A(s.walletBalance||0),L(s.coupons||[]),R(s.paypalEmail||""),z(!!s.paypalEmail),J(!!s.paypalEmailVerified)}},Z=async()=>{if(!C)return;const e=await i(C.uid);$(e)},q=s.useCallback(e=>{R(e),z(!0),J(!0),O()},[C]),G=async()=>{if(!C)return;await new Promise(e=>setTimeout(e,500)),await O(),await Z();const e=F;_(""),r.success(`Successfully deposited ${n(+e)} to your wallet!`);const s=await u(y(l,"users",C.uid));s.exists()&&s.data().paypalEmailVerified&&!H&&J(!0)};return a.jsx("div",{className:"min-h-screen bg-background p-4 sm:p-6",children:a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsx(f,{to:"/guest/dashboard",className:"mb-4 sm:mb-6"}),a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6",children:"E-Wallet"}),a.jsxs(o,{className:"mb-4 sm:mb-6 border-2",children:[a.jsxs(c,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:[a.jsxs(m,{className:"flex items-center gap-2 text-base sm:text-lg",children:[a.jsx(P,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"PayPal Account Verification"]}),a.jsx(d,{className:"text-xs sm:text-sm",children:"Link your PayPal account by logging in with your PayPal credentials. This verifies you have a real PayPal account."})]}),a.jsxs(p,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:[C?a.jsx(N,{userId:C.uid,onVerified:q,paypalEmail:U,paypalVerified:H}):a.jsx("div",{className:"p-4 bg-muted rounded-lg",children:a.jsx("p",{className:"text-sm text-muted-foreground",children:"Please sign in to verify your PayPal account"})}),H&&U&&a.jsx("div",{className:"mt-4",children:a.jsx(x,{variant:"outline",size:"sm",onClick:async()=>{if(C)try{await h(y(l,"users",C.uid),{paypalEmail:null,paypalEmailVerified:!1,paypalLinkedAt:null}),z(!1),R(""),r.success("PayPal account unlinked")}catch(e){r.error("Failed to unlink PayPal account")}},className:"w-full",children:"Unlink PayPal Account"})})]})]}),a.jsxs(o,{className:"mb-4 sm:mb-6",children:[a.jsx(c,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:a.jsxs(m,{className:"flex items-center gap-2 text-base sm:text-lg",children:[a.jsx(v,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Current Balance"]})}),a.jsxs(p,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("p",{className:"text-3xl sm:text-4xl font-bold text-primary",children:n(I)}),a.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Available balance"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(b,{htmlFor:"deposit-amount",className:"text-sm font-medium mb-2 block",children:"Deposit Amount"}),a.jsx(j,{id:"deposit-amount",type:"number",placeholder:"Enter amount",value:F,onChange:e=>_(e.target.value),min:"1",step:"0.01",disabled:!H,className:"h-12 text-base sm:text-sm"})]}),H?C&&F&&+F>0?a.jsxs("div",{className:"space-y-3",children:[a.jsx(w,{amount:+F,userId:C.uid,description:"Wallet deposit: "+n(+F),onSuccess:G,redirectUrl:window.location.origin+"/guest/wallet",useRedirectFlow:!0}),a.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Secure payment powered by PayPal"})]}):a.jsx(x,{onClick:async()=>{C&&F&&+F>0?U?r.info("Please use PayPal to add funds to your wallet"):r.error("Please link your PayPal account first to make deposits"):r.error("Enter a valid amount")},disabled:!F||0>=+F,className:"w-full h-12",variant:"outline",children:"Enter amount to deposit"}):a.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(k,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),a.jsx("p",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:"Link and verify your PayPal account above to make deposits"})]})})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6",children:[a.jsx(g,{coupons:B,onApplyCoupon:e=>{const s=B.find(s=>s.code===e&&!s.used);s?r.success(`Coupon ${e} applied! ${n(s.discount)} discount`):r.error("Invalid or already used coupon")}}),a.jsxs(o,{children:[a.jsx(c,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:a.jsx(m,{className:"text-base sm:text-lg",children:"Transaction History"})}),a.jsx(p,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:0===V.length?a.jsx("p",{className:"text-center text-muted-foreground py-6 sm:py-8 text-sm sm:text-base",children:"No transactions yet"}):a.jsx("div",{className:"space-y-2 sm:space-y-3",children:V.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-2.5 sm:p-3 border rounded touch-manipulation",children:[a.jsxs("div",{className:"flex items-center gap-3",children:["deposit"===e.type||"reward"===e.type?a.jsx(S,{className:"h-5 w-5 text-green-500"}):a.jsx(E,{className:"h-5 w-5 text-red-500"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:e.description}),a.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()})]})]}),a.jsx("p",{className:"font-semibold "+("deposit"===e.type||"reward"===e.type?"text-green-500":"text-red-500"),children:"reward"===e.type?`+${e.amount} points`:`${"deposit"===e.type?"+":"-"}${n(e.amount)}`})]},e.id))})})]})]})]})})};export{C as default};
