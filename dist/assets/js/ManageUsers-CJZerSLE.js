import{u as e,r as s,j as a}from"./react-vendor-BMVo5gto.js";import{u as r,j as t,e as l,B as n,C as i,d,i as c,E as m}from"./index-Bl4WVUm9.js";import{d as o,c as x}from"./firebase-vendor-BtzXZj7S.js";import{T as h,a as j,b as u,c as g,d as p,e as N}from"./table-D4LWTJSW.js";import{B as f}from"./badge-_91-i8yA.js";import{D as b,a as v,b as y,c as w,d as S,e as k}from"./dialog-DVuhSEXh.js";import{T as C}from"./textarea-BOgKdTrJ.js";import{L as F}from"./label-CNgDwY3J.js";import{A,L as M,C as B,l as P,a6 as D}from"./icons-vendor-BQMxNFbQ.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";const L=()=>{const L=e(),{user:R,userRole:T}=r(),[E,I]=s.useState([]),[U,q]=s.useState(!0),[z,J]=s.useState(null),[O,W]=s.useState(!1),[Z,G]=s.useState(null),[H,K]=s.useState(""),[Q,V]=s.useState(!1);s.useEffect(()=>{R&&"admin"===T?X():L("/admin/login")},[R,T,L]);const X=async()=>{q(!0),J(null);try{const e=(await o(x(t,"users"))).docs.map(e=>({id:e.id,...e.data()}));I(e),0===e.length&&J("No users found in the database.")}catch(e){const s="permission-denied"===e.code?"Permission denied. Please check that your admin role is set correctly in Firestore.":e.message||"Failed to load users. Please check the console for details.";J(s),l.error(s)}finally{q(!1)}};return a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs(n,{variant:"ghost",onClick:()=>L("/admin/dashboard"),className:"mb-6",children:[a.jsx(A,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),a.jsx("h1",{className:"text-3xl font-bold mb-6",children:"User Management"}),U?a.jsx(i,{children:a.jsxs(d,{className:"py-12 text-center",children:[a.jsx(M,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),a.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})]})}):z?a.jsx(i,{children:a.jsxs(d,{className:"py-12 text-center",children:[a.jsx(B,{className:"h-12 w-12 mx-auto mb-4 text-destructive"}),a.jsx("p",{className:"text-destructive font-medium mb-2",children:z}),a.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Make sure your admin user has the role field set to "admin" in Firestore.'}),a.jsx(n,{onClick:X,variant:"outline",children:"Retry"})]})}):0===E.length?a.jsx(i,{children:a.jsx(d,{className:"py-12 text-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No users found in the database."})})}):a.jsx(i,{children:a.jsxs(h,{children:[a.jsx(j,{children:a.jsxs(u,{children:[a.jsx(g,{children:"Full Name"}),a.jsx(g,{children:"Email"}),a.jsx(g,{children:"Role"}),a.jsx(g,{children:"Points"}),a.jsx(g,{children:"Wallet Balance"}),a.jsx(g,{children:"Joined"}),a.jsx(g,{className:"text-right",children:"Actions"})]})}),a.jsx(p,{children:E.map(e=>a.jsxs(u,{children:[a.jsx(N,{className:"font-medium",children:e.fullName||"N/A"}),a.jsx(N,{children:e.email}),a.jsx(N,{children:a.jsx(f,{variant:"admin"===e.role?"default":"secondary",children:e.role})}),a.jsx(N,{children:e.points||0}),a.jsx(N,{children:c(e.walletBalance||0)}),a.jsx(N,{children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}),a.jsx(N,{className:"text-right",children:a.jsxs(n,{variant:"outline",size:"sm",onClick:()=>(G(e),K(""),void W(!0)),className:"gap-2",children:[a.jsx(P,{className:"h-4 w-4"}),"Message"]})})]},e.id))})]})}),a.jsx(b,{open:O,onOpenChange:W,children:a.jsxs(v,{className:"max-w-2xl",children:[a.jsxs(y,{children:[a.jsxs(w,{className:"flex items-center gap-2",children:[a.jsx(P,{className:"h-5 w-5"}),"Send Message"]}),a.jsxs(S,{children:["Send a message to ",Z?.fullName||Z?.email||"this user"]})]}),Z&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Recipient:"}),a.jsx("p",{className:"font-semibold",children:Z.fullName||"N/A"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:Z.email}),a.jsx(f,{variant:"secondary",className:"mt-2",children:Z.role})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(F,{htmlFor:"message-content",className:"text-base font-semibold",children:["Message ",a.jsx("span",{className:"text-destructive",children:"*"})]}),a.jsx(C,{id:"message-content",placeholder:"Type your message here...",value:H,onChange:e=>K(e.target.value),className:"min-h-[150px]",required:!0}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"This message will be sent through the messaging system and the user will receive a notification."})]})]}),a.jsxs(k,{children:[a.jsx(n,{variant:"outline",onClick:()=>{W(!1),K(""),G(null)},disabled:Q,children:"Cancel"}),a.jsx(n,{onClick:async()=>{if(R&&Z&&H.trim()){V(!0);try{await m({senderId:R.uid,receiverId:Z.id,content:H.trim(),read:!1}),l.success("Message sent to "+(Z.fullName||Z.email)),W(!1),K(""),G(null)}catch(e){l.error("Failed to send message: "+(e.message||"Unknown error"))}finally{V(!1)}}else l.error("Please enter a message")},disabled:Q||!H.trim(),className:"gap-2",children:Q?a.jsxs(a.Fragment,{children:[a.jsx(M,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):a.jsxs(a.Fragment,{children:[a.jsx(D,{className:"h-4 w-4"}),"Send Message"]})})]})]})})]})})};export{L as default};
