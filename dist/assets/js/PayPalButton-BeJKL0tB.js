const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/billingService-iurdcjpD.js","assets/js/firebase-vendor-BtzXZj7S.js","assets/js/index-Bl4WVUm9.js","assets/js/react-vendor-BMVo5gto.js","assets/js/utils-vendor-yBsXXcRr.js","assets/js/maps-vendor-CYGXCXz5.js","assets/maps-vendor-Dgihpmma.css","assets/js/ui-vendor-Dbp4DHG_.js","assets/js/icons-vendor-BQMxNFbQ.js","assets/index-D7xL4X8S.css"])))=>i.map(i=>d[i]);
import{G as e,B as t,i as n,e as a,_ as r,H as o}from"./index-Bl4WVUm9.js";import{r as s,R as i,j as c}from"./react-vendor-BMVo5gto.js";import{m as u}from"./icons-vendor-BQMxNFbQ.js";var l,d,p,m,f,y;(d=l||(l={})).INITIAL="initial",d.PENDING="pending",d.REJECTED="rejected",d.RESOLVED="resolved",(m=p||(p={})).LOADING_STATUS="setLoadingStatus",m.RESET_OPTIONS="resetOptions",m.SET_BRAINTREE_INSTANCE="braintreeInstance",(y=f||(f={})).NUMBER="number",y.CVV="cvv",y.EXPIRATION_DATE="expirationDate",y.EXPIRATION_MONTH="expirationMonth",y.EXPIRATION_YEAR="expirationYear",y.POSTAL_CODE="postalCode";var h=function(){return h=Object.assign||function(e){for(var t,n=1,a=arguments.length;a>n;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},h.apply(this,arguments)};function b(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}function v(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;o>r;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var w="data-react-paypal-script-id",E="react-paypal-js",P="dataSdkIntegrationSource",g="paypal";function S(e){var t=e,n=w;t[n];var a=b(t,[n+""]);return"react-paypal-js-".concat(function(e){for(var t="",n=0;n<e.length;n++){var a=e[n].charCodeAt(0)*n;e[n+1]&&(a+=e[n+1].charCodeAt(0)*(n-1)),t+=String.fromCharCode(97+Math.abs(a)%26)}return t}(JSON.stringify(a)))}function x(e,t){var n,a,r,o;switch(t.type){case p.LOADING_STATUS:return"object"==typeof t.value?h(h({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):h(h({},e),{loadingStatus:t.value});case p.RESET_OPTIONS:return r=e.options[w],(null==(o=self.document.querySelector("script[".concat(w,'="').concat(r,'"]')))?void 0:o.parentNode)&&o.parentNode.removeChild(o),h(h({},e),{loadingStatus:l.PENDING,options:h(h((n={},n[P]=E,n),t.value),(a={},a[w]="".concat(S(t.value)),a))});case p.SET_BRAINTREE_INSTANCE:return h(h({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var I=s.createContext(null);function N(){var e=function(e){if("function"==typeof(null==e?void 0:e.dispatch)&&0!==e.dispatch.length)return e;throw Error("usePayPalScriptReducer must be used within a PayPalScriptProvider")}(s.useContext(I));return[h(h({},e),{isInitial:e.loadingStatus===l.INITIAL,isPending:e.loadingStatus===l.PENDING,isResolved:e.loadingStatus===l.RESOLVED,isRejected:e.loadingStatus===l.REJECTED}),e.dispatch]}s.createContext({});var _=function(e){var t,n,a,r=e.className,o=void 0===r?"":r,c=e.disabled,u=void 0!==c&&c,l=e.children,d=e.forceReRender,p=void 0===d?[]:d,m=b(e,["className","disabled","children","forceReRender"]),f=u?{opacity:.38}:{},y="".concat(o," ").concat(u?"paypal-buttons-disabled":"").trim(),w=s.useRef(null),E=s.useRef(null),P=(n=m,a=s.useRef(new Proxy({},{get:function(e,t,n){return"function"==typeof e[t]?function(){for(var n=[],a=0;arguments.length>a;a++)n[a]=arguments[a];return e[t].apply(e,n)}:Reflect.get(e,t,n)}})),a.current=Object.assign(a.current,n),a.current),S=N()[0],x=S.isResolved,I=S.options,O=s.useState(null),j=O[0],T=O[1],A=s.useState(!0),D=A[0],C=A[1],R=s.useState(null)[1];function L(){null!==E.current&&E.current.close().catch(function(){})}return(null===(t=E.current)||void 0===t?void 0:t.updateProps)&&E.current.updateProps({message:m.message}),s.useEffect(function(){if(!1===x)return L;var e,t=(void 0===(e=I.dataNamespace)&&(e=g),window[e]);if(void 0===t||void 0===t.Buttons)return R(function(){throw Error(function(e){var t=e.reactComponentName,n=e.sdkComponentKey,a=e.sdkRequestedComponents,r=void 0===a?"":a,o=e.sdkDataNamespace,s=void 0===o?g:o,i=n.charAt(0).toUpperCase().concat(n.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(s,".").concat(i," is undefined."),u="string"==typeof r?r:r.join(",");if(!u.includes(n)){var l=[u,n].filter(Boolean).join();c+="\nTo fix the issue, add '".concat(n,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(l,"'}}>`.")}return c}({reactComponentName:_.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:I.components,sdkDataNamespace:I.dataNamespace}))}),L;try{E.current=t.Buttons(h(h({},P),{onInit:function(e,t){T(t),"function"==typeof m.onInit&&m.onInit(e,t)}}))}catch(n){return R(function(){throw Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(n))})}return!1===E.current.isEligible()?(C(!1),L):w.current?(E.current.render(w.current).catch(function(e){null!==w.current&&0!==w.current.children.length&&R(function(){throw Error("Failed to render <PayPalButtons /> component. ".concat(e))})}),L):L},v(v([x],p,!0),[m.fundingSource],!1)),s.useEffect(function(){null!==j&&(!0===u?j.disable().catch(function(){}):j.enable().catch(function(){}))},[u,j]),i.createElement(i.Fragment,null,D?i.createElement("div",{ref:w,style:f,className:y}):l)};function O(e,t){void 0===t&&(t={});var n=document.createElement("script");return n.src=e,Object.keys(t).forEach(function(e){n.setAttribute(e,t[e]),"data-csp-nonce"===e&&n.setAttribute("nonce",t["data-csp-nonce"])}),n}function j(e,t){if(void 0===t&&(t=Promise),A(e,t),"undefined"==typeof document)return t.resolve(null);var n=function(e){var t,n,a=e.sdkBaseUrl,r=e.environment,o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}(e,["sdkBaseUrl","environment"]),s=a||function(e){return"sandbox"===e?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}(r),i=o,c=Object.keys(i).filter(function(e){return void 0!==i[e]&&null!==i[e]&&""!==i[e]}).reduce(function(e,t){var n,a=i[t].toString();return n=function(e,t){return(t?"-":"")+e.toLowerCase()},"data"===(t=t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,n)).substring(0,4)||"crossorigin"===t?e.attributes[t]=a:e.queryParams[t]=a,e},{queryParams:{},attributes:{}}),u=c.queryParams,l=c.attributes;return u["merchant-id"]&&-1!==u["merchant-id"].indexOf(",")&&(l["data-merchant-id"]=u["merchant-id"],u["merchant-id"]="*"),{url:"".concat(s,"?").concat((t=u,n="",Object.keys(t).forEach(function(e){0!==n.length&&(n+="&"),n+=e+"="+t[e]}),n)),attributes:l}}(e),a=n.url,r=n.attributes,o=r["data-namespace"]||"paypal",s=T(o);return r["data-js-sdk-library"]||(r["data-js-sdk-library"]="paypal-js"),function(e,t){var n=document.querySelector('script[src="'.concat(e,'"]'));if(null===n)return null;var a=O(e,t),r=n.cloneNode();if(delete r.dataset.uidAuto,Object.keys(r.dataset).length!==Object.keys(a.dataset).length)return null;var o=!0;return Object.keys(r.dataset).forEach(function(e){r.dataset[e]!==a.dataset[e]&&(o=!1)}),o?n:null}(a,r)&&s?t.resolve(s):function(e,t){void 0===t&&(t=Promise),A(e,t);var n=e.url,a=e.attributes;if("string"!=typeof n||0===n.length)throw Error("Invalid url.");if(void 0!==a&&"object"!=typeof a)throw Error("Expected attributes to be an object.");return new t(function(e,t){if("undefined"==typeof document)return e();!function(e){var t=e.onSuccess,n=e.onError,a=O(e.url,e.attributes);a.onerror=n,a.onload=t,document.head.insertBefore(a,document.head.firstElementChild)}({url:n,attributes:a,onSuccess:function(){return e()},onError:function(){return t(Error('The script "'.concat(n,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.')))}})})}({url:a,attributes:r},t).then(function(){var e=T(o);if(e)return e;throw Error("The window.".concat(o," global variable is not available."))})}function T(e){return window[e]}function A(e,t){if("object"!=typeof e||null===e)throw Error("Expected an options object.");var n=e.environment;if(n&&"production"!==n&&"sandbox"!==n)throw Error('The `environment` option must be either "production" or "sandbox".');if(void 0!==t&&"function"!=typeof t)throw Error("Expected PromisePonyfill to be a function.")}_.displayName="PayPalButtons","function"==typeof SuppressedError&&SuppressedError;var D=function(e){var t,n=e.options,a=void 0===n?{clientId:"test"}:n,r=e.children,o=e.deferLoading,c=void 0!==o&&o,u=s.useReducer(x,{options:h(h({},a),(t={},t.dataJsSdkLibrary=E,t[P]=E,t[w]="".concat(S(a)),t)),loadingStatus:c?l.INITIAL:l.PENDING}),d=u[0],m=u[1];return s.useEffect(function(){if(!1===c&&d.loadingStatus===l.INITIAL)return m({type:p.LOADING_STATUS,value:l.PENDING});if(d.loadingStatus===l.PENDING){var e=!0;return j(d.options).then(function(){e&&m({type:p.LOADING_STATUS,value:l.RESOLVED})}).catch(function(t){e&&m({type:p.LOADING_STATUS,value:{state:l.REJECTED,message:t+""}})}),function(){e=!1}}},[d.options,c,d.loadingStatus]),i.createElement(I.Provider,{value:h(h({},d),{dispatch:m})},r)};function C(){}s.createContext({cardFieldsForm:null,fields:{},registerField:C,unregisterField:C});const R=({amount:n,userId:i,description:u,onSuccess:l,bookingId:d,redirectUrl:p,useRedirectFlow:m=!1})=>{const[{isPending:f,isResolved:y,isRejected:h}]=N(),[b,v]=s.useState(!1),[w,E]=s.useState(!1);s.useEffect(()=>{const e=setTimeout(()=>{!y||"undefined"!=typeof window&&window.paypal?.Buttons||v(!0)},2e3),t=new MutationObserver(()=>{const e=document.querySelectorAll('iframe[src*="paypal.com"]'),t=document.querySelectorAll('[id*="paypal"], [class*="paypal"]');e.forEach(e=>{e.src&&e.src.includes("checkoutnow")&&(e.parentElement&&(e.parentElement.style.cssText="\n              position: fixed !important;\n              top: 50% !important;\n              left: 50% !important;\n              transform: translate(-50%, -50%) !important;\n              z-index: 99999 !important;\n            "),e.style.cssText="\n            border-radius: 0.75rem !important;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;\n          ")}),t.forEach(e=>{e.id&&e.id.includes("container")&&(e.id.includes("paypal")||e.className?.includes("paypal"))&&(e.style.cssText="\n            position: fixed !important;\n            top: 50% !important;\n            left: 50% !important;\n            transform: translate(-50%, -50%) !important;\n            z-index: 99999 !important;\n          ")})});return t.observe(document.body,{childList:!0,subtree:!0}),()=>{clearTimeout(e),t.disconnect()}},[y]);return f&&!b?c.jsx("div",{className:"w-full h-10 bg-muted animate-pulse rounded"}):h||b||y&&("undefined"==typeof window||!window.paypal?.Buttons)?c.jsxs("div",{className:"space-y-2",children:[c.jsx(k,{amount:n,userId:i,description:u,onSuccess:l}),c.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 text-center",children:"⚠️ PayPal SDK not loaded - using simulation mode. Check console for details."})]}):y?m?c.jsxs("div",{className:"w-full",children:[c.jsx(t,{onClick:async()=>{if(y&&window.paypal){E(!0);try{const t=window.paypal,a=document.createElement("div");return a.style.display="none",document.body.appendChild(a),new Promise((r,o)=>{t.Buttons({createOrder:(t,a)=>a.order.create({purchase_units:[{amount:{value:n.toFixed(2),currency_code:e},description:u}],application_context:{return_url:p||window.location.origin+"/payment/success",cancel_url:window.location.origin+"/payment/cancel",brand_name:"Mojo Dojo Casa House",locale:"en-PH",shipping_preference:"NO_SHIPPING"}}),onApprove:async(e,t)=>{},onError:e=>{document.body.removeChild(a),o(e)}}).render(a).then(e=>{const t=a.querySelector("button");t?(t.click(),setTimeout(()=>{document.body.removeChild(a),E(!1)},1e3)):(document.body.removeChild(a),o(Error("Could not create PayPal button")))}).catch(e=>{document.body.removeChild(a),o(e)})})}catch(t){a.error("Failed to initiate payment. Please try again."),E(!1)}}else a.error("PayPal SDK not ready. Please try again.")},disabled:w||!y,className:"w-full h-12 bg-[#FFC439] hover:bg-[#FFB300] text-[#003087] font-semibold",children:w?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#003087] mr-2"}),"Processing..."]}):c.jsxs(c.Fragment,{children:[c.jsx("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.174 1.351 1.05 3.3.93 4.855v.006c-.015.115-.03.23-.043.344-.107.947-.212 1.84-.174 2.63.053 1.1.534 1.895 1.424 2.31.896.42 2.077.512 3.513.512h1.42c.96 0 1.72.64 1.982 1.577l.04.15c.12.47.18.96.18 1.45 0 2.85-2.33 5.17-5.2 5.17h-2.13c-1.05 0-1.95-.74-2.16-1.77l-.02-.1-.04-.2-.05-.25c-.1-.5-.2-1.05-.35-1.53-.15-.48-.35-.9-.6-1.25-.25-.35-.55-.6-.9-.75-.35-.15-.75-.2-1.2-.2h-2.1c-.5 0-.95.15-1.35.45-.4.3-.7.7-.9 1.2l-1.45 4.1c-.15.5-.5.9-1 1.15-.5.25-1.05.3-1.6.2z"})}),"Pay with PayPal"]})}),c.jsx("p",{className:"text-xs text-muted-foreground text-center mt-2",children:"You will be redirected to PayPal's secure checkout"})]}):c.jsx("div",{className:"w-full",children:c.jsx("div",{className:"paypal-button-wrapper",children:c.jsx(_,{createOrder:(t,a)=>a.order.create({purchase_units:[{amount:{value:n.toFixed(2),currency_code:e},description:u}],application_context:{return_url:p||window.location.origin+"/payment/success",cancel_url:window.location.origin+"/payment/cancel",brand_name:"Mojo Dojo Casa House",locale:"en-PH",shipping_preference:"NO_SHIPPING"}}),onApprove:async(e,t)=>{try{const e=await t.order.capture();if(!e||"COMPLETED"!==e.status)throw Error("Payment was not completed successfully");const p=u.toLowerCase().includes("wallet deposit"),m=u.toLowerCase().includes("host subscription")||u.toLowerCase().includes("subscription"),f=p?"deposit":"payment";if(m)try{const{processSubscriptionPayment:t}=await r(async()=>{const{processSubscriptionPayment:e}=await import("./billingService-iurdcjpD.js");return{processSubscriptionPayment:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),n=u.match(/planId=([^\s]+)/),o=n?n[1]:"active-host-monthly";return await t(i,o,e.id,e.id),a.success("Payment successful! Your subscription is now active."),void l()}catch(s){a.error("Payment received but subscription activation failed. Please contact support.")}const y={userId:i,type:f,amount:n,description:`PayPal ${f}: ${u}`,status:"completed",paymentMethod:"paypal",paymentId:e.id};if(d&&(y.bookingId=d),await o(y),p)try{const{doc:e,updateDoc:t,getDoc:a}=await r(async()=>{const{doc:e,updateDoc:t,getDoc:n}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,updateDoc:t,getDoc:n}},[]),{db:o}=await r(async()=>{const{db:e}=await import("./index-Bl4WVUm9.js").then(e=>e.S);return{db:e}},__vite__mapDeps([2,3,4,5,6,7,8,1,9])),s=await a(e(o,"users",i));if(!s.exists())throw Error("User document not found");{const a={walletBalance:(s.data().walletBalance||0)+n};s.data().paypalEmailVerified||(a.paypalEmailVerified=!0,a.paypalVerifiedAt=(new Date).toISOString()),await t(e(o,"users",i),a)}}catch(c){a.error("Payment successful but failed to update wallet. Please contact support.")}else{const{doc:e,updateDoc:t,getDoc:n}=await r(async()=>{const{doc:e,updateDoc:t,getDoc:n}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,updateDoc:t,getDoc:n}},[]),{db:a}=await r(async()=>{const{db:e}=await import("./index-Bl4WVUm9.js").then(e=>e.S);return{db:e}},__vite__mapDeps([2,3,4,5,6,7,8,1,9])),o=await n(e(a,"users",i));o.exists()&&!o.data().paypalEmailVerified&&await t(e(a,"users",i),{paypalEmailVerified:!0,paypalVerifiedAt:(new Date).toISOString()})}a.success("Payment successful!"),l()}catch(p){a.error("Payment failed");const e={userId:i,type:"payment",amount:n,description:"PayPal payment (failed): "+u,status:"failed",paymentMethod:"paypal"};d&&(e.bookingId=d),await o(e)}},onError:e=>{a.error("Payment error occurred")},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal",height:50}})})}):c.jsx("div",{className:"w-full h-10 bg-muted animate-pulse rounded"})},L=t=>c.jsx(D,{options:{clientId:"EBY2ts8baThwt97plOoNWxeryVxWHXEe-ANWAexRZ7zq1sfq-qIa90XNhC5JExAaFGTvrF_TT2hqwzj0",currency:e,intent:"capture",components:"buttons","data-sdk-integration-source":"button-factory",locale:"en_PH"},deferLoading:!1,children:c.jsx(R,{...t})}),k=({amount:e,userId:i,description:l,onSuccess:d,bookingId:p})=>{const[m,f]=s.useState(!1);return c.jsxs("div",{className:"space-y-2",children:[c.jsxs(t,{onClick:async()=>{f(!0);try{await new Promise(e=>setTimeout(e,2e3));const n=l.toLowerCase().includes("wallet deposit"),s=l.toLowerCase().includes("host subscription")||l.toLowerCase().includes("subscription"),c=n?"deposit":"payment";if(s)try{const{processSubscriptionPayment:e}=await r(async()=>{const{processSubscriptionPayment:e}=await import("./billingService-iurdcjpD.js");return{processSubscriptionPayment:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),t=l.match(/planId=([^\s]+)/),n=t?t[1]:"active-host-monthly",o=`sim_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return await e(i,n,o,o),a.success("Payment successful! (SIMULATION - NO REAL MONEY) Your subscription is now active."),void d()}catch(t){a.error("Simulated payment received but subscription activation failed. Please contact support.")}const u={userId:i,type:c,amount:e,description:`PayPal ${c} (SIMULATED - NO REAL MONEY): ${l}`,status:"completed",paymentMethod:"paypal"};if(p&&(u.bookingId=p),await o(u),n){const{doc:t,updateDoc:n,getDoc:a}=await r(async()=>{const{doc:e,updateDoc:t,getDoc:n}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,updateDoc:t,getDoc:n}},[]),{db:o}=await r(async()=>{const{db:e}=await import("./index-Bl4WVUm9.js").then(e=>e.S);return{db:e}},__vite__mapDeps([2,3,4,5,6,7,8,1,9])),s=await a(t(o,"users",i));if(s.exists()){const a=(s.data().walletBalance||0)+e;await n(t(o,"users",i),{walletBalance:a})}}a.success("Payment successful! (SIMULATION - NO REAL MONEY)"),d()}catch(n){a.error("Payment failed")}finally{f(!1)}},disabled:m,className:"w-full bg-[#0070ba] hover:bg-[#003087]",children:[c.jsx(u,{className:"h-4 w-4 mr-2"}),m?"Processing...":`Pay ${n(e)} with PayPal (SIMULATION)`]}),c.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"⚠️ Simulation Mode - No real money will be charged"})]})};export{L as P};
