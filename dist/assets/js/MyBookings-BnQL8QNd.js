import{j as e,u as s,l as t,r as a}from"./react-vendor-DAkY0NgE.js";import{C as n,a as c,d as r,u as i,B as o,b as l,i as d,e as m,A as u,h as x,j as h}from"./index-BbvEjZj9.js";import{p}from"./paymentService-HK3toL-K.js";import{q as j,w as f,c as g,k as N}from"./firebase-vendor-CvoiOdvz.js";import{B as b}from"./badge-Bdu_tSqo.js";import{T as w}from"./theme-toggle-C3pYvPx7.js";import{S as k}from"./skeleton-COgBj1uS.js";import{A as v,a as y,b as D,c as C,d as B,e as I,f as A,g as S}from"./alert-dialog-D9Kc0D1X.js";import{A as T,i as P,X as z}from"./icons-vendor-3zhgXMYa.js";import"./maps-vendor-CYGXCXz5.js";import"./utils-vendor-yBsXXcRr.js";import"./ui-vendor-CZx_xpmK.js";import"./dropdown-menu-BRbzCJvi.js";const E=()=>e.jsxs(n,{className:"shadow-soft",children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"h-5 w-32"}),e.jsx(k,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"h-16 w-16 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(k,{className:"h-4 w-3/4"}),e.jsx(k,{className:"h-3 w-1/2"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"h-3 w-full"}),e.jsx(k,{className:"h-3 w-2/3"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx(k,{className:"h-4 w-24"}),e.jsx(k,{className:"h-4 w-20"})]})]})]}),L=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:[...Array(s)].map((s,t)=>e.jsx(E,{},t))}),O=()=>{const k=s(),[E]=t(),{user:O}=i(),[R,Y]=a.useState([]),[G,U]=a.useState(!0),[q,F]=a.useState(!1),[K,M]=a.useState(null),[Q,V]=a.useState(!1),_=E.get("filter");a.useEffect(()=>{if(!O)return;U(!0);const e=j(g(h,"bookings"),f("guestId","==",O.uid)),s=N(e,e=>{const s=e.docs.map(e=>{const s=e.data();return{id:e.id,...s}});s.sort((e,s)=>{const t=new Date(e.createdAt||0).getTime();return new Date(s.createdAt||0).getTime()-t});let t=s;if("upcoming"===_){const e=new Date;t=s.filter(s=>new Date(s.checkIn)>=e&&"confirmed"===s.status)}else if("past"===_){const e=new Date;t=s.filter(s=>{const t=new Date(s.checkOut);return e>t||"completed"===s.status||"cancelled"===s.status})}Y(t),U(!1)},e=>{U(!1),H()});return()=>s()},[O,_]);const H=async()=>{if(O)try{const e=await x({guestId:O.uid});Y(e)}catch(e){}finally{U(!1)}},J=e=>{switch(e){case"confirmed":return"default";case"pending":default:return"secondary";case"cancelled":return"destructive";case"completed":return"outline"}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 shadow-soft",children:e.jsxs("div",{className:"container mx-auto px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>k("/guest/dashboard"),children:e.jsx(T,{className:"h-5 w-5"})}),e.jsx("div",{className:"p-2 rounded-lg bg-secondary/10",children:e.jsx(P,{className:"w-5 h-5 text-secondary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"upcoming"===_?"Upcoming Trips":"past"===_?"Past Bookings":"My Bookings"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"upcoming"===_?"Your confirmed upcoming trips":"past"===_?"Your completed and past trips":"View your trips"})]})]}),e.jsx(w,{})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:G?e.jsx(L,{count:5}):0===R.length?e.jsx(n,{children:e.jsxs(r,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"upcoming"===_?"No upcoming trips":"past"===_?"No past bookings yet":"No bookings yet"}),"past"===_&&e.jsx("p",{className:"text-xs mt-2",children:"Your past bookings will appear here once trips are completed."})]})}):e.jsx("div",{className:"space-y-4",children:R.map(s=>{const t=("pending"===s.status||"confirmed"===s.status)&&new Date(s.checkIn)>=new Date;return e.jsxs(n,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{children:["Booking #",s.id.slice(0,8)]}),e.jsx(b,{variant:J(s.status),children:s.status})]})}),e.jsxs(r,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkIn).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkOut).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Guests"}),e.jsx("p",{className:"font-medium",children:s.guests})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"font-medium",children:d(s.totalPrice||0)})]})]}),t&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(o,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?m.error("Cannot cancel bookings with check-in dates in the past"):(M(e),F(!0)):m.error("This booking cannot be cancelled"):m.error("Cannot cancel completed bookings"):m.error("This booking is already cancelled"):m.error("Invalid booking")})(s),className:"w-full",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]})]},s.id)})})}),e.jsx(v,{open:q,onOpenChange:F,children:e.jsxs(y,{children:[e.jsxs(D,{children:[e.jsx(C,{children:"Cancel Booking"}),e.jsxs(B,{children:["Are you sure you want to cancel this booking?",K&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-medium capitalize",children:K.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(K.checkIn).toLocaleDateString()]})]}),K.totalPrice>0&&e.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",d(K.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),e.jsxs(I,{children:[e.jsx(A,{disabled:Q,children:"Keep Booking"}),e.jsx(S,{onClick:async()=>{if(!K||!O)return void m.error("Invalid booking or user");if("cancelled"===K.status||"completed"===K.status)return m.error("This booking cannot be cancelled"),F(!1),void M(null);const e=new Date(K.checkIn);if(new Date>e)return m.error("Cannot cancel bookings with check-in dates in the past"),F(!1),void M(null);V(!0);try{if(await u(K.id,{status:"cancelled"}),"confirmed"===K.status||"pending"===K.status)try{const e=await p(K,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?d(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";m.success("Booking cancelled successfully. "+s)}}catch(s){m.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else m.success("Booking cancelled successfully.");F(!1),M(null)}catch(t){const e=t.message||"Unknown error occurred";m.error("Failed to cancel booking: "+e)}finally{V(!1)}},disabled:Q,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:Q?"Cancelling...":"Cancel Booking"})]})]})})]})};export{O as default};
