import{u as e,l as s,r as i,j as a}from"./react-vendor-BMVo5gto.js";import{u as n,j as t,h as l,v as c,B as o,C as r,a as d,b as m,c as x,d as h,i as u,e as f,z as j}from"./index-BbQqfVom.js";import{f as p,e as g,u as b}from"./firebase-vendor-BtzXZj7S.js";import{I as v}from"./input-B93J7yYR.js";import{T as y,a as N,b as k,c as w}from"./tabs-CPhJH8Ta.js";import{L as C}from"./label-CE6eI_XB.js";import{B as S}from"./badge-0vFpitRp.js";import{S as A}from"./switch-D-T8Tgnl.js";import{E as B}from"./empty-state-Fqt3Rb73.js";import{p as F}from"./paymentService-BxZoTOEB.js";import{A as R,a as D,b as P,c as I,d as M,e as U,f as O,g as E}from"./alert-dialog-Biqv9se3.js";import{A as L,o as z,j as T,a8 as G,S as V,X as Y,M as K,a9 as W}from"./icons-vendor-D1YpcxsO.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";const q=()=>{const q=e(),[H]=s(),{user:J,userRole:Q,refreshUserProfile:X,signOut:Z,hasRole:$}=n(),[_,ee]=i.useState(null),[se,ie]=i.useState(!1),[ae,ne]=i.useState([]),[te,le]=i.useState(H.get("tab")||"profile"),[ce,oe]=i.useState(!1),[re,de]=i.useState(!1),[me,xe]=i.useState(null),[he,ue]=i.useState(!1),[fe,je]=i.useState({email:{bookingConfirmations:!0,bookingCancellations:!0,bookingReminders:!0,newMessages:!0,paymentUpdates:!0,promotionalOffers:!0},inApp:{bookingUpdates:!0,newMessages:!0,paymentNotifications:!0,systemAlerts:!0}});i.useEffect(()=>{!J||$("guest")?J&&pe():q("/guest/login")},[J,Q,q]),i.useEffect(()=>{const e=H.get("tab");e&&le(e)},[H]),i.useEffect(()=>{J&&_&&"guest"===Q&&(ge(),_.notifications&&je(_.notifications))},[J,_,Q]);const pe=async()=>{if(J)try{const e=await p(g(t,"users",J.uid));if(e.exists()){const s=e.data();ee(s)}}catch(e){}},ge=async()=>{if(J)try{const e=await l({guestId:J.uid});ne(e)}catch(e){}};return _?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8 max-w-4xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs(o,{variant:"ghost",onClick:()=>{q("/guest/dashboard")},children:[a.jsx(L,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),a.jsx(o,{variant:"outline",onClick:()=>oe(!0),children:"Sign Out"})]}),a.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Account Settings"}),a.jsxs(y,{value:te,onValueChange:le,className:"space-y-6",children:[a.jsxs(N,{className:"grid w-full grid-cols-4 relative",children:[a.jsxs(k,{value:"profile",children:[a.jsx(z,{className:"h-4 w-4 mr-2"}),"Profile"]}),a.jsxs(k,{value:"bookings",children:[a.jsx(T,{className:"h-4 w-4 mr-2"}),"Bookings"]}),a.jsxs(k,{value:"notifications",children:[a.jsx(G,{className:"h-4 w-4 mr-2"}),"Notifications"]}),a.jsxs(k,{value:"security",children:[a.jsx(V,{className:"h-4 w-4 mr-2"}),"Security"]})]}),a.jsxs("div",{className:"h-[600px] relative",children:[a.jsx(w,{value:"profile",className:"mt-0 absolute inset-0 w-full overflow-y-auto",children:a.jsxs(r,{className:"h-full flex flex-col",children:[a.jsxs(d,{children:[a.jsx(m,{children:"Profile Information"}),a.jsx(x,{children:"Update your account details"})]}),a.jsxs(h,{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"fullName",children:"Full Name"}),a.jsx(v,{id:"fullName",type:"text",value:_.fullName,onChange:e=>ee({..._,fullName:e.target.value}),placeholder:"Enter your full name"})]}),a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email",children:"Email"}),a.jsx(v,{id:"email",type:"email",value:_.email,disabled:!0})]}),a.jsxs("div",{children:[a.jsx(C,{htmlFor:"role",children:"Role"}),a.jsx(v,{id:"role",value:_.role,disabled:!0})]}),a.jsxs("div",{children:[a.jsx(C,{htmlFor:"points",children:"Reward Points"}),a.jsx(v,{id:"points",value:_.points,disabled:!0})]}),a.jsxs("div",{children:[a.jsx(C,{htmlFor:"balance",children:"Wallet Balance"}),a.jsx(v,{id:"balance",value:u(_.walletBalance),disabled:!0})]}),a.jsx(o,{onClick:async()=>{if(J&&_){ie(!0);try{await b(g(t,"users",J.uid),{fullName:_.fullName}),await pe(),await X(),f.success("Profile updated successfully!")}catch(e){f.error("Failed to update profile")}finally{ie(!1)}}},disabled:se,children:se?"Saving...":"Save Changes"})]})]})}),a.jsx(w,{value:"bookings",className:"mt-0 absolute inset-0 w-full overflow-y-auto",children:a.jsxs(r,{className:"h-full flex flex-col",children:[a.jsxs(d,{children:[a.jsx(m,{children:"My Bookings"}),a.jsx(x,{children:"View your booking history"})]}),a.jsx(h,{children:0===ae.length?a.jsx(B,{icon:a.jsx(T,{className:"h-10 w-10"}),title:"No bookings yet",description:"Start exploring amazing places to stay!",action:a.jsx(o,{onClick:()=>q("/guest/browse"),children:"Browse Listings"})}):a.jsx("div",{className:"space-y-4",children:ae.map(e=>{const s=("pending"===e.status||"confirmed"===e.status)&&new Date(e.checkIn)>=new Date;return a.jsxs("div",{className:"p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium",children:["Booking #",e.id.slice(0,8)]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(e.checkIn).toLocaleDateString()," - ",new Date(e.checkOut).toLocaleDateString()]})]}),a.jsx(S,{children:e.status})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.guests," guest",e.guests>1?"s":""]}),a.jsx("p",{className:"font-semibold",children:u(e.totalPrice||0)})]}),s&&a.jsx("div",{className:"pt-4 mt-4 border-t",children:a.jsxs(o,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?f.error("Cannot cancel bookings with check-in dates in the past"):(xe(e),de(!0)):f.error("This booking cannot be cancelled"):f.error("Cannot cancel completed bookings"):f.error("This booking is already cancelled"):f.error("Invalid booking")})(e),className:"w-full",children:[a.jsx(Y,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]},e.id)})})})]})}),a.jsx(w,{value:"notifications",className:"mt-0 absolute inset-0 w-full overflow-y-auto",children:a.jsxs(r,{className:"h-full flex flex-col",children:[a.jsxs(d,{children:[a.jsx(m,{children:"Notification Preferences"}),a.jsx(x,{children:"Manage how you receive updates"})]}),a.jsxs(h,{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[a.jsx(K,{className:"h-5 w-5 text-primary"}),a.jsx("h3",{className:"text-lg font-semibold",children:"Email Notifications"})]}),a.jsxs("div",{className:"space-y-3 pl-7",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email-booking-confirmations",children:"Booking Confirmations"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails when bookings are confirmed"})]}),a.jsx(A,{id:"email-booking-confirmations",checked:fe.email.bookingConfirmations,onCheckedChange:e=>je(s=>({...s,email:{...s.email,bookingConfirmations:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email-booking-cancellations",children:"Booking Cancellations"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails when bookings are cancelled"})]}),a.jsx(A,{id:"email-booking-cancellations",checked:fe.email.bookingCancellations,onCheckedChange:e=>je(s=>({...s,email:{...s.email,bookingCancellations:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email-booking-reminders",children:"Booking Reminders"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive reminders about upcoming bookings"})]}),a.jsx(A,{id:"email-booking-reminders",checked:fe.email.bookingReminders,onCheckedChange:e=>je(s=>({...s,email:{...s.email,bookingReminders:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email-new-messages",children:"New Messages"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails for new messages"})]}),a.jsx(A,{id:"email-new-messages",checked:fe.email.newMessages,onCheckedChange:e=>je(s=>({...s,email:{...s.email,newMessages:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email-payment-updates",children:"Payment Updates"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails about payment transactions"})]}),a.jsx(A,{id:"email-payment-updates",checked:fe.email.paymentUpdates,onCheckedChange:e=>je(s=>({...s,email:{...s.email,paymentUpdates:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"email-promotional-offers",children:"Promotional Offers"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive promotional emails and special offers"})]}),a.jsx(A,{id:"email-promotional-offers",checked:fe.email.promotionalOffers,onCheckedChange:e=>je(s=>({...s,email:{...s.email,promotionalOffers:e}}))})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[a.jsx(W,{className:"h-5 w-5 text-secondary"}),a.jsx("h3",{className:"text-lg font-semibold",children:"In-App Notifications"})]}),a.jsxs("div",{className:"space-y-3 pl-7",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"inapp-booking-updates",children:"Booking Updates"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about booking status changes"})]}),a.jsx(A,{id:"inapp-booking-updates",checked:fe.inApp.bookingUpdates,onCheckedChange:e=>je(s=>({...s,inApp:{...s.inApp,bookingUpdates:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"inapp-new-messages",children:"New Messages"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about new messages"})]}),a.jsx(A,{id:"inapp-new-messages",checked:fe.inApp.newMessages,onCheckedChange:e=>je(s=>({...s,inApp:{...s.inApp,newMessages:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"inapp-payment-notifications",children:"Payment Notifications"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about payment activities"})]}),a.jsx(A,{id:"inapp-payment-notifications",checked:fe.inApp.paymentNotifications,onCheckedChange:e=>je(s=>({...s,inApp:{...s.inApp,paymentNotifications:e}}))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(C,{htmlFor:"inapp-system-alerts",children:"System Alerts"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive important system notifications"})]}),a.jsx(A,{id:"inapp-system-alerts",checked:fe.inApp.systemAlerts,onCheckedChange:e=>je(s=>({...s,inApp:{...s.inApp,systemAlerts:e}}))})]})]})]}),a.jsx("div",{className:"pt-4 border-t",children:a.jsx(o,{onClick:async()=>{if(J){ie(!0);try{await b(g(t,"users",J.uid),{notifications:fe}),await X(),f.success("Notification preferences saved!")}catch(e){f.error("Failed to save notification preferences")}finally{ie(!1)}}},disabled:se,children:se?"Saving...":"Save Preferences"})})]})]})}),a.jsx(w,{value:"security",className:"mt-0 absolute inset-0 w-full overflow-y-auto",children:a.jsxs(r,{className:"h-full flex flex-col",children:[a.jsxs(d,{children:[a.jsx(m,{children:"Security Settings"}),a.jsx(x,{children:"Manage your account security"})]}),a.jsx(h,{children:a.jsx("p",{className:"text-muted-foreground",children:"Security settings coming soon"})})]})})]})]})]}),a.jsx(R,{open:re,onOpenChange:de,children:a.jsxs(D,{children:[a.jsxs(P,{children:[a.jsx(I,{children:"Cancel Booking"}),a.jsxs(M,{children:["Are you sure you want to cancel this booking?",me&&a.jsxs("div",{className:"mt-3 space-y-2",children:[a.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[a.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",a.jsx("span",{className:"font-medium capitalize",children:me.status})]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(me.checkIn).toLocaleDateString()]})]}),me.totalPrice>0&&a.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[a.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",u(me.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),a.jsxs(U,{children:[a.jsx(O,{disabled:he,children:"Keep Booking"}),a.jsx(E,{onClick:async()=>{if(!me||!J)return void f.error("Invalid booking or user");if("cancelled"===me.status||"completed"===me.status)return f.error("This booking cannot be cancelled"),de(!1),void xe(null);const e=new Date(me.checkIn);if(new Date>e)return f.error("Cannot cancel bookings with check-in dates in the past"),de(!1),void xe(null);ue(!0);try{if(await j(me.id,{status:"cancelled"}),"confirmed"===me.status||"pending"===me.status)try{const e=await F(me,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?u(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";f.success("Booking cancelled successfully. "+s)}}catch(s){f.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else f.success("Booking cancelled successfully.");de(!1),xe(null),ge()}catch(i){const e=i.message||"Unknown error occurred";f.error("Failed to cancel booking: "+e)}finally{ue(!1)}},disabled:he,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:he?"Cancelling...":"Cancel Booking"})]})]})}),a.jsx(R,{open:ce,onOpenChange:oe,children:a.jsxs(D,{children:[a.jsxs(P,{children:[a.jsx(I,{children:"Sign Out"}),a.jsx(M,{children:"Are you sure you want to sign out? You'll need to sign in again to access your account."})]}),a.jsxs(U,{children:[a.jsx(O,{children:"Cancel"}),a.jsx(E,{onClick:async()=>{await Z(),q("/")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sign Out"})]})]})})]}):a.jsx(c,{})};export{q as default};
