import{r as e,j as s,M as t,T as a,m as r,n as i,k as n,u as o}from"./react-vendor-DcULH_Au.js";import{B as l,g as c,e as d,u as m,j as u,C as h,a as x,b as g,d as j,i as p,l as f,_ as v}from"./index-F95ZJi6y.js";import{t as b}from"./form-vendor-B9GYGFCT.js";import{I as y}from"./input-CGAn_-_v.js";import{T as w}from"./textarea-DN3EhNVV.js";import{S as N,a as S,b as D,c as C,d as k}from"./select-CpU4hhzn.js";import{D as P,a as F,b as L,c as A,d as R}from"./dialog-1q5CFjjn.js";import{A as U,a as I,b as E,c as O,d as $,e as G,f as T,g as V}from"./alert-dialog-Ce5W9-KF.js";import{F as _,a as B,b as M,c as z,d as H,f as q,e as W,g as K}from"./validation-5uF669uT.js";import{P as Y}from"./PayPalButton-CrZR6r-x.js";import{C as J}from"./calendar-BinlYO1C.js";import{P as X,a as Q,b as Z}from"./popover-DggOD1QV.js";import{i as ee,t as se,X as te,u as ae,L as re,N as ie,f as ne,C as oe,v as le,A as ce}from"./icons-vendor-D18eSOBA.js";import{o as de}from"./utils-vendor-yBsXXcRr.js";import{P as me}from"./progress-BSEdlnMd.js";import{L as ue}from"./maps-vendor-CYGXCXz5.js";import{f as he,e as xe,v as ge,A as je,h as pe}from"./firebase-vendor-BtzXZj7S.js";import"./ui-vendor-C9dhA_ey.js";import"./label-BX6RxrV3.js";function fe({value:t,onChange:a,placeholder:r="Pick a date range",className:i,disabled:n,error:o}){const[d,m]=e.useState(!1),u=new Date;u.setHours(0,0,0,0);const h=n||(e=>{const s=new Date(e);return s.setHours(0,0,0,0),u>s});return s.jsxs(X,{open:d,onOpenChange:m,children:[s.jsx(Q,{asChild:!0,children:s.jsxs(l,{variant:"outline",type:"button",className:c("w-full justify-start text-left font-normal",!t?.from&&"text-muted-foreground",o&&"border-destructive",i),children:[s.jsx(ee,{className:"mr-2 h-4 w-4"}),t?.from?t.to?s.jsxs(s.Fragment,{children:[de(t.from,"LLL dd, y")," -"," ",de(t.to,"LLL dd, y")]}):de(t.from,"LLL dd, y"):s.jsx("span",{children:r})]})}),s.jsx(Z,{className:"w-auto p-0",align:"start",children:s.jsx(J,{mode:"range",defaultMonth:t?.from||u,selected:t,onSelect:e=>{e&&(a?.(e),e.from&&e.to&&m(!1))},numberOfMonths:2,disabled:h})})]})}const ve=({images:e,onRemove:t,uploadProgress:a=0,isUploading:r=!1})=>0===e.length?s.jsx("div",{className:"flex items-center justify-center w-full h-32 border-2 border-dashed rounded-lg border-muted-foreground/25",children:s.jsxs("div",{className:"text-center",children:[s.jsx(se,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"No images selected"})]})}):s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.map((e,a)=>{const i=URL.createObjectURL(e);return s.jsxs("div",{className:"relative group",children:[s.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border-2 border-border",children:s.jsx("img",{src:i,alt:"Preview "+(a+1),className:"w-full h-full object-cover"})}),!r&&s.jsx(l,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>t(a),children:s.jsx(te,{className:"h-4 w-4"})}),s.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:e.name}),s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[(e.size/1024/1024).toFixed(2)," MB"]})]},a)})}),r&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Uploading images..."}),s.jsxs("span",{className:"text-muted-foreground",children:[a,"%"]})]}),s.jsx(me,{value:a})]})]});function be({onLocationSelect:e}){return i({click:s=>{const{lat:t,lng:a}=s.latlng;e(t,a)}}),null}delete ue.Icon.Default.prototype._getIconUrl,ue.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const ye=({value:i,onChange:n})=>{const[o,c]=e.useState([14.5995,120.9842]),[m,u]=e.useState(null),[h,x]=e.useState(!1),[g,j]=e.useState(!1),p=e.useRef(null),f=e.useRef(null),v=async(e,s)=>{try{j(!0);const t=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${s}&zoom=18&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!t.ok)throw Error("Failed to fetch address");const a=await t.json();if(a.error)throw Error(a.error);const r=a.address,i=[];return(r.road||r.street)&&i.push(r.road||r.street),(r.suburb||r.neighbourhood||r.city_district)&&i.push(r.suburb||r.neighbourhood||r.city_district),(r.city||r.town||r.village)&&i.push(r.city||r.town||r.village),(r.state||r.province)&&i.push(r.state||r.province),r.country&&i.push(r.country),i.length>0?i.join(", "):`${e.toFixed(6)}, ${s.toFixed(6)}`}catch(t){return`${e.toFixed(6)}, ${s.toFixed(6)}`}finally{j(!1)}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(y,{ref:f,placeholder:"Search address or click on map...",value:i,onChange:e=>{n(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),i.trim()&&(async e=>{if(e&&e.trim().length>=3){x(!0);try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!s.ok)throw Error("Failed to search address");const t=await s.json();if(t.length>0){const e=t[0],s=parseFloat(e.lat),a=parseFloat(e.lon);c([s,a]),u([s,a]),p.current&&p.current.setView([s,a],15);const r=[],i=e.address;(i.road||i.street)&&r.push(i.road||i.street),(i.suburb||i.neighbourhood||i.city_district)&&r.push(i.suburb||i.neighbourhood||i.city_district),(i.city||i.town||i.village)&&r.push(i.city||i.town||i.village),(i.state||i.province)&&r.push(i.state||i.province),i.country&&r.push(i.country);const o=r.length>0?r.join(", "):e.display_name;n(o),d.success("Location found")}else d.error("Location not found. Please try a different address.")}catch(s){d.error("Failed to search location")}finally{x(!1)}}})(i))},className:"pl-10"}),(h||g)&&s.jsx(re,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),s.jsx(l,{type:"button",variant:"outline",onClick:()=>{navigator.geolocation?(x(!0),navigator.geolocation.getCurrentPosition(async e=>{const{latitude:s,longitude:t}=e.coords;c([s,t]),u([s,t]),p.current&&p.current.setView([s,t],15);try{const e=await v(s,t);n(e),d.success("Current location set")}catch(a){d.error("Failed to get address. Using coordinates."),n(`${s.toFixed(6)}, ${t.toFixed(6)}`)}finally{x(!1)}},e=>{d.error("Failed to get your location. Please allow location access."),x(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):d.error("Geolocation is not supported by your browser")},disabled:h,title:"Use current location",children:s.jsx(ie,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"border rounded-lg overflow-hidden",style:{height:"400px"},children:s.jsxs(t,{center:o,zoom:13,style:{height:"100%",width:"100%"},whenCreated:e=>{p.current=e},children:[s.jsx(a,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),s.jsx(be,{onLocationSelect:async(e,s)=>{u([e,s]),x(!0);try{const t=await v(e,s);n(t),d.success("Location selected")}catch(t){d.error("Failed to get address. Using coordinates."),n(`${e.toFixed(6)}, ${s.toFixed(6)}`)}finally{x(!1)}}}),m&&s.jsx(r,{position:m})]})}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Click on the map to select a location, search for an address, or use your current location."})]})},we=["image/jpeg","image/jpg","image/png","image/webp"],Ne=({onSuccess:t})=>{const{user:a}=m(),[r,i]=e.useState(!1),[o,c]=e.useState([]),[J,X]=e.useState(0),[Q,Z]=e.useState(!1),[ee,te]=e.useState("idle"),[ae,ie]=e.useState([]),[ce,de]=e.useState([]),[ue,be]=e.useState(!1),[Ne,Se]=e.useState(!1),[De,Ce]=e.useState(!1),[ke,Pe]=e.useState(null),[Fe,Le]=e.useState(!1),[Ae,Re]=e.useState(!1),Ue=500,Ie=e.useRef(null),Ee=e.useRef(!1),Oe=n({resolver:b(K),defaultValues:{title:"",description:"",category:"home",price:"",discount:"",promo:"",location:"",maxGuests:"",bedrooms:"",bathrooms:"",amenities:"",dateRange:{from:void 0,to:void 0},images:[]},mode:"onChange"}),$e=Oe.watch(),Ge=Oe.formState.errors,Te=e.useCallback(()=>a?a.uid+"_draft":null,[a]),Ve=e.useCallback(()=>{const e=[$e.title,$e.description,$e.price,$e.location,$e.maxGuests,$e.dateRange?.from&&$e.dateRange?.to,o.length>0],s=e.filter(Boolean).length;return Math.round(s/e.length*100)},[$e,o.length])(),_e=(e,s)=>{const t=[],a=new Date(e);for(;s>=a;)t.push(a.toISOString().split("T")[0]),a.setDate(a.getDate()+1);return t},Be=e=>{const s={};return Object.keys(e).forEach(t=>{void 0!==e[t]&&(s[t]=e[t])}),s},Me=e=>{const s=Array.from(e.target.files||[]),t=[],a=[];s.forEach(e=>{const s=(e=>we.includes(e.type)?e.size>5242880?"File size exceeds 5MB limit":null:"Invalid file type. Allowed types: "+we.join(", "))(e);s?a.push(`${e.name}: ${s}`):t.push(e)}),a.length>0&&d.error(a.join(", "));const r=[...o,...t].slice(0,10);c(r),Oe.setValue("images",r,{shouldValidate:!0}),r.length>10&&d.warning("Maximum 10 images allowed. Only the first 10 were added.")},ze=e=>{const s=o.filter((s,t)=>t!==e);c(s),Oe.setValue("images",s,{shouldValidate:!0})},He=e.useCallback(async e=>{if(!a)return;const s=Te();if(!s)return;const t=Oe.getValues(),r=t.dateRange?.from&&t.dateRange?.to?_e(t.dateRange.from,t.dateRange.to):ae;let i=null;try{const e=await he(xe(u,"listing",s));e.exists()&&(i=e.data().createdAt)}catch(l){}const n={hostId:a.uid,title:t.title||"",description:t.description||"",category:t.category||"home",price:t.price?+t.price:void 0,discount:t.discount&&t.discount.trim()?+t.discount:void 0,promo:t.promo||void 0,location:t.location||"",maxGuests:t.maxGuests?+t.maxGuests:void 0,bedrooms:t.bedrooms&&t.bedrooms.trim()?+t.bedrooms:void 0,bathrooms:t.bathrooms&&t.bathrooms.trim()?+t.bathrooms:void 0,amenities:t.amenities?t.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:r,blockedDates:ce,images:[],status:"draft",createdAt:i||(new Date).toISOString(),updatedAt:je()},o=Be(n);try{te("saving"),await ge(xe(u,"listing",s),o,{merge:!0}),Pe(s),te("saved"),e?.manual&&(d.success("Draft saved successfully"),setTimeout(()=>te("idle"),2e3))}catch(l){te("error");const s="permission-denied"===l.code?"Permission denied. Please check your permissions.":"unavailable"===l.code?"Network error. Please check your connection.":"Failed to save draft";e?.manual?d.error(s):d.error("Auto-save failed. Please save manually.",{duration:3e3}),setTimeout(()=>te("idle"),3e3)}},[a,Te,Oe,ae,ce]);return e.useEffect(()=>{if(Ee.current){if(a)return Ie.current&&window.clearTimeout(Ie.current),Ie.current=window.setTimeout(()=>{Oe.formState.isDirty&&He()},2e3),()=>{Ie.current&&window.clearTimeout(Ie.current)}}else Ee.current=!0},[$e,o,a,Oe.formState.isDirty,He]),e.useEffect(()=>{const e=()=>{a&&Oe.formState.isDirty&&He()};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[He,a,Oe.formState.isDirty]),e.useEffect(()=>{(async()=>{if(!a)return;const e=Te();if(e)try{const s=await he(xe(u,"listing",e));s.exists()&&"draft"===s.data().status&&(Se(!0),Ce(!0),Pe(e))}catch(s){s.code}})()},[a,Te]),s.jsxs(s.Fragment,{children:[s.jsx(P,{open:De,onOpenChange:Ce,children:s.jsxs(F,{children:[s.jsxs(L,{children:[s.jsx(A,{children:"Unsaved Draft Found"}),s.jsx(R,{children:"We found a saved draft for this account. Would you like to continue editing it or discard it and start fresh?"})]}),s.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[s.jsx(l,{variant:"outline",onClick:()=>{Ce(!1),Le(!0)},children:"Discard Draft"}),s.jsx(l,{onClick:async()=>{if(ke)try{const e=await he(xe(u,"listing",ke));if(!e.exists())return;const s=e.data();Oe.reset({title:s.title||"",description:s.description||"",category:s.category||"home",price:s.price?s.price+"":"",discount:s.discount?s.discount+"":"",promo:s.promo||"",location:s.location||"",maxGuests:s.maxGuests?s.maxGuests+"":"",bedrooms:s.bedrooms?s.bedrooms+"":"",bathrooms:s.bathrooms?s.bathrooms+"":"",amenities:Array.isArray(s.amenities)?s.amenities.join(", "):s.amenities||"",dateRange:s.availableDates&&s.availableDates.length>0?{from:new Date(s.availableDates[0]),to:new Date(s.availableDates[s.availableDates.length-1])}:{from:void 0,to:void 0},images:[]}),s.availableDates&&Array.isArray(s.availableDates)&&ie(s.availableDates),s.blockedDates&&Array.isArray(s.blockedDates)&&de(s.blockedDates),Ce(!1),d.success("Draft loaded successfully")}catch(e){const s="permission-denied"===e.code?"Permission denied. Unable to load draft.":"Failed to load draft";d.error(s)}},children:"Continue Draft"})]})]})}),s.jsxs(h,{children:[s.jsxs(x,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(g,{children:"Create New Listing"}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["saving"===ee&&s.jsxs(s.Fragment,{children:[s.jsx(re,{className:"h-4 w-4 animate-spin"}),s.jsx("span",{children:"Saving..."})]}),"saved"===ee&&s.jsxs(s.Fragment,{children:[s.jsx(ne,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Saved"})]}),"error"===ee&&s.jsxs(s.Fragment,{children:[s.jsx(oe,{className:"h-4 w-4 text-destructive"}),s.jsx("span",{children:"Save failed"})]})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Form completion"}),s.jsxs("span",{className:"font-medium",children:[Ve,"%"]})]}),s.jsx(me,{value:Ve,className:"h-2"})]})]}),s.jsx(j,{children:s.jsx(_,{...Oe,children:s.jsxs("form",{onSubmit:Oe.handleSubmit(async()=>{const e=await Oe.trigger(),s=Oe.getValues("dateRange");if(e)return s?.from&&s?.to?0===o.length?(d.error("Please upload at least one image."),void Oe.setError("images",{message:"At least one image is required"})):void Re(!0):(d.error("Please select an availability date range."),void Oe.setError("dateRange.to",{message:"Date range is required"}));d.error("Please fix the errors in the form before proceeding.")}),className:"space-y-6",children:[s.jsx(B,{control:Oe.control,name:"title",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Title ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsx(y,{placeholder:"Enter a descriptive title for your listing",...e,value:e.value||""})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(q,{children:[e.value?.length||0,"/100 characters"]}),s.jsx(W,{})]})]})}),s.jsx(B,{control:Oe.control,name:"description",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Description ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsx(w,{placeholder:"Describe your listing in detail. Include amenities, nearby attractions, and what makes it special.",className:"min-h-[120px]",...e,value:e.value||""})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(q,{children:[e.value?.length||0,"/2000 characters (minimum 50)"]}),s.jsx(W,{})]})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(B,{control:Oe.control,name:"category",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Category ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(N,{onValueChange:e.onChange,defaultValue:e.value,children:[s.jsx(H,{children:s.jsx(S,{children:s.jsx(D,{placeholder:"Select category"})})}),s.jsxs(C,{children:[s.jsx(k,{value:"home",children:"Home"}),s.jsx(k,{value:"experience",children:"Experience"}),s.jsx(k,{value:"service",children:"Service"})]})]}),s.jsx(W,{})]})}),s.jsx(B,{control:Oe.control,name:"price",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Price per Night (₱) ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsx(y,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(W,{})]})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(B,{control:Oe.control,name:"discount",render:({field:e})=>s.jsxs(M,{children:[s.jsx(z,{children:"Discount (%)"}),s.jsx(H,{children:s.jsx(y,{type:"number",min:"0",max:"100",placeholder:"0",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(q,{children:"Optional discount percentage (0-100)"}),s.jsx(W,{})]})}),s.jsx(B,{control:Oe.control,name:"promo",render:({field:e})=>s.jsxs(M,{children:[s.jsx(z,{children:"Promo Description"}),s.jsx(H,{children:s.jsx(y,{placeholder:"e.g., 'Summer Special'",maxLength:100,...e,value:e.value||""})}),s.jsx(q,{children:"Optional promotional message"}),s.jsx(W,{})]})})]}),s.jsx(B,{control:Oe.control,name:"location",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Location ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsx(ye,{value:e.value||"",onChange:s=>{e.onChange(s)}})}),s.jsx(W,{})]})}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsx(B,{control:Oe.control,name:"maxGuests",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Max Guests ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsx(y,{type:"number",min:"1",placeholder:"1",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(W,{})]})}),s.jsx(B,{control:Oe.control,name:"bedrooms",render:({field:e})=>s.jsxs(M,{children:[s.jsx(z,{children:"Bedrooms"}),s.jsx(H,{children:s.jsx(y,{type:"number",min:"0",placeholder:"0",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(W,{})]})}),s.jsx(B,{control:Oe.control,name:"bathrooms",render:({field:e})=>s.jsxs(M,{children:[s.jsx(z,{children:"Bathrooms"}),s.jsx(H,{children:s.jsx(y,{type:"number",min:"0",step:"0.5",placeholder:"0",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(q,{children:"Can be 0.5, 1, 1.5, etc."}),s.jsx(W,{})]})})]}),s.jsx(B,{control:Oe.control,name:"amenities",render:({field:e})=>s.jsxs(M,{children:[s.jsx(z,{children:"Amenities"}),s.jsx(H,{children:s.jsx(y,{placeholder:"WiFi, Pool, Kitchen, Parking (comma separated)",...e,value:e.value||""})}),s.jsx(q,{children:"Separate multiple amenities with commas"}),s.jsx(W,{})]})}),s.jsx(B,{control:Oe.control,name:"dateRange",render:({field:e})=>s.jsxs(M,{children:[s.jsxs(z,{children:["Availability Date Range ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsx(fe,{value:e.value,onChange:e.onChange,placeholder:"Select your listing availability period",className:"mt-2",error:!!Ge.dateRange})}),e.value?.from&&e.value?.to&&s.jsxs(q,{children:["Available from ",e.value.from.toLocaleDateString()," to ",e.value.to.toLocaleDateString()]}),s.jsx(W,{})]})}),s.jsx(B,{control:Oe.control,name:"images",render:()=>s.jsxs(M,{children:[s.jsxs(z,{children:["Images ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(H,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{id:"images",type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:Me,className:"hidden"}),s.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("images")?.click(),disabled:o.length>=10,children:[s.jsx(se,{className:"h-4 w-4 mr-2"}),"Upload Images (",o.length,"/",10,")"]})]}),s.jsx(ve,{images:o,onRemove:ze,uploadProgress:J,isUploading:Q})]})}),s.jsxs(q,{children:["Upload at least 1 image (max ",10,"). Accepted formats: JPG, PNG, WebP. Max size: 5MB per image."]}),s.jsx(W,{})]})}),s.jsxs("div",{className:"flex gap-2 pt-4",children:[s.jsx(l,{type:"submit",disabled:r||Q,className:"flex-1",children:r?s.jsxs(s.Fragment,{children:[s.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):`Pay & Publish (${p(Ue)})`}),s.jsxs(l,{type:"button",variant:"outline",disabled:r||Q,className:"flex-1",onClick:async()=>{await He({manual:!0})},children:[s.jsx(le,{className:"h-4 w-4 mr-2"}),"Save as Draft"]})]})]})})})]}),s.jsx(P,{open:ue,onOpenChange:be,children:s.jsxs(F,{children:[s.jsxs(L,{children:[s.jsx(A,{children:"Complete Subscription to Publish"}),s.jsxs(R,{children:["Pay a one-time subscription fee of ",p(Ue)," to submit your listing for review."]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"rounded-lg border p-4",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Listing Details"}),s.jsx("div",{className:"font-medium mt-1",children:$e.title||"Untitled Listing"}),s.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Category: ",$e.category]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Location: ",$e.location||"-"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:$e.dateRange?.from&&$e.dateRange?.to?`Availability: ${$e.dateRange.from.toLocaleDateString()} - ${$e.dateRange.to.toLocaleDateString()}`:"Availability: Not set"})]}),s.jsxs("div",{className:"rounded-lg bg-muted p-4",children:[s.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[s.jsx("span",{children:"Subscription Fee:"}),s.jsx("span",{className:"font-medium",children:p(Ue)})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"This fee covers listing review and processing. Your listing will be reviewed by our team before going live."})]}),a&&s.jsx(Y,{amount:Ue,userId:a.uid,description:"Host subscription for listing: "+($e.title||"Untitled"),onSuccess:async()=>{if(a){i(!0);try{const e=await(async()=>{if(!a)throw Error("No user");const e=Oe.getValues(),s=e.dateRange?.from&&e.dateRange?.to?_e(e.dateRange.from,e.dateRange.to):ae,t={hostId:a.uid,title:e.title,description:e.description,category:e.category||"home",price:+e.price,discount:e.discount&&e.discount.trim()?+e.discount:void 0,promo:e.promo||void 0,location:e.location,maxGuests:+e.maxGuests,bedrooms:e.bedrooms&&e.bedrooms.trim()?+e.bedrooms:void 0,bathrooms:e.bathrooms&&e.bathrooms.trim()?+e.bathrooms:void 0,amenities:e.amenities?e.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:s,blockedDates:ce,images:[],status:"pending",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},r=Be(t);{const e=await f(r);if(ke)try{await pe(xe(u,"listing",ke))}catch(i){}return Pe(null),Se(!1),e}})();if(o.length>0){const s=await(async(e,s)=>{Z(!0),X(0);try{const{uploadListingImages:t}=await v(async()=>{const{uploadListingImages:e}=await import("./cloudinary-BHmE7xG7.js");return{uploadListingImages:e}},[]),a=t(e,s,e=>{X(e)}),r=await a;return X(100),r}finally{Z(!1),setTimeout(()=>X(0),1e3)}})(o,e);await ge(xe(u,"listing",e),{images:s,updatedAt:je()},{merge:!0})}Pe(null),Se(!1),d.success("Payment received. Listing submitted for review!"),t()}catch(e){const s="permission-denied"===e.code?"Permission denied. Please check your permissions.":"unavailable"===e.code?"Network error. Please check your connection and try again.":e.message||"Failed to create listing after payment";d.error(s)}finally{i(!1),be(!1)}}}})]})]})}),s.jsx(U,{open:Fe,onOpenChange:Le,children:s.jsxs(I,{children:[s.jsxs(E,{children:[s.jsx(O,{children:"Discard Draft?"}),s.jsx($,{children:"Are you sure you want to discard this draft? All unsaved changes will be permanently lost."})]}),s.jsxs(G,{children:[s.jsx(T,{children:"Cancel"}),s.jsx(V,{onClick:async()=>{if(!ke)return Ce(!1),Se(!1),Le(!1),void Oe.reset();try{await pe(xe(u,"listing",ke)),Pe(null),Ce(!1),Se(!1),Le(!1),Oe.reset(),ie([]),de([]),c([]),d.success("Draft discarded")}catch(e){const s="permission-denied"===e.code?"Permission denied. Unable to discard draft.":"Failed to discard draft";d.error(s)}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Discard Draft"})]})]})}),s.jsx(U,{open:Ae,onOpenChange:Re,children:s.jsxs(I,{children:[s.jsxs(E,{children:[s.jsx(O,{children:"Proceed to Payment?"}),s.jsxs($,{children:["You're about to pay a one-time subscription fee of ",p(Ue)," to publish this listing. After payment, your listing will be submitted for admin review."]})]}),s.jsxs(G,{children:[s.jsx(T,{children:"Cancel"}),s.jsx(V,{onClick:()=>{Re(!1),be(!0)},children:"Proceed to Payment"})]})]})})]})},Se=()=>{const e=o();return s.jsx("div",{className:"min-h-screen bg-background p-6",children:s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsxs(l,{variant:"ghost",onClick:()=>e("/host/dashboard"),className:"mb-4",children:[s.jsx(ce,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),s.jsx(Ne,{onSuccess:()=>e("/host/listings")})]})})};export{Se as default};
