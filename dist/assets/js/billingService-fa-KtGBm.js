import{q as t,d as n,w as e,e as a,h as i,f as l,u as s,k as r}from"./firebase-vendor-BC71bXmb.js";import{j as o,z as d}from"./index-DaMaslBo.js";import"./react-vendor-Ve3SFwKO.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";import"./icons-vendor-Dhca6XHc.js";const c=[{id:"active-host-monthly",name:"Active Host",description:"Full access to host properties and manage listings",price:699,billingCycle:"monthly",features:["Unlimited listings","Priority support","Advanced analytics","Marketing tools","Booking management"],isActive:!0},{id:"active-host-yearly",name:"Active Host",description:"Full access to host properties and manage listings (Yearly)",price:6990,billingCycle:"yearly",features:["Unlimited listings","Priority support","Advanced analytics","Marketing tools","Booking management","Save 2 months (17% discount)"],isActive:!0}],p=()=>c.filter(t=>t.isActive),u=t=>c.find(n=>n.id===t)||null,g=async(i,d,c,p)=>{try{const g=u(d);if(!g)throw Error("Invalid plan selected");const m=new Date,y=new Date;"monthly"===g.billingCycle?y.setMonth(y.getMonth()+1):y.setFullYear(y.getFullYear()+1);const w=new Date(y),D=t(n(o,"subscriptions"),e("userId","==",i)),I=await a(D);let S;const h=new Date;let b=null,v=new Date(0);if(I.docs.forEach(t=>{const n={id:t.id,...t.data()},e=n.endDate?new Date(n.endDate):null;e&&e>h&&e>v&&(v=e,b=n)}),b&&v>h){S=b.id;const t=new Date(v),n=new Date(v);"monthly"===g.billingCycle?n.setMonth(n.getMonth()+1):n.setFullYear(n.getFullYear()+1),await s(l(o,"subscriptions",S),{pendingPlanId:g.id,pendingPlanName:g.name,pendingAmount:g.price,pendingBillingCycle:g.billingCycle,pendingStartDate:t.toISOString(),pendingEndDate:n.toISOString(),pendingPaymentId:c,pendingTransactionId:p,updatedAt:(new Date).toISOString()})}else if(b)S=b.id,await s(l(o,"subscriptions",S),{planId:g.id,planName:g.name,amount:g.price,billingCycle:g.billingCycle,status:"active",startDate:m.toISOString(),endDate:y.toISOString(),nextBillingDate:w.toISOString(),paymentMethod:"paypal",paymentId:c,transactionId:p,pendingPlanId:null,pendingPlanName:null,pendingAmount:null,pendingBillingCycle:null,pendingStartDate:null,pendingEndDate:null,pendingPaymentId:null,pendingTransactionId:null,updatedAt:(new Date).toISOString()});else{const t={userId:i,planId:g.id,planName:g.name,amount:g.price,billingCycle:g.billingCycle,status:"active",startDate:m.toISOString(),endDate:y.toISOString(),nextBillingDate:w.toISOString(),paymentMethod:"paypal",paymentId:c,transactionId:p,createdAt:m.toISOString(),updatedAt:m.toISOString()};S=(await r(n(o,"subscriptions"),t)).id}return S}catch(g){throw Error(g.message||"Failed to create subscription")}},m=async i=>{try{const l=t(n(o,"subscriptions"),e("userId","==",i)),s=await a(l);if(s.empty)return null;const r=new Date;let d=null,c=new Date(0);return s.docs.forEach(t=>{const n={id:t.id,...t.data()},e=n.endDate?new Date(n.endDate):null;e&&e>r&&e>c&&(c=e,d=n)}),d}catch(l){return null}},y=async t=>{const n=await m(t);return!!n&&(n.endDate?new Date(n.endDate)>new Date:"active"===n.status)},w=async(t,n,e,a)=>{try{const i=u(n);if(!i)throw Error("Invalid plan selected");const l=await m(t),s=new Date,r=l&&l.endDate&&new Date(l.endDate)>s&&"cancelled"!==l.status,o=await d({userId:t,type:"payment",amount:i.price,description:r?`Host subscription: ${i.name} (${i.billingCycle}) - Scheduled to start when current plan expires`:`Host subscription: ${i.name} (${i.billingCycle})`,status:"completed",paymentMethod:"paypal",paymentId:a,payoutStatus:"pending"});return{subscriptionId:await g(t,n,e,o),transactionId:o,isScheduled:r||!1}}catch(i){throw Error(i.message||"Failed to process subscription payment")}},D=async t=>{try{const n=await i(l(o,"subscriptions",t));if(!n.exists())throw Error("Subscription not found");if("cancelled"===n.data().status)throw Error("Subscription is already cancelled");await s(l(o,"subscriptions",t),{status:"cancelled",cancelledAt:(new Date).toISOString(),pendingPlanId:null,pendingPlanName:null,pendingAmount:null,pendingBillingCycle:null,pendingStartDate:null,pendingEndDate:null,pendingPaymentId:null,pendingTransactionId:null,updatedAt:(new Date).toISOString()})}catch(n){throw Error(n.message||"Failed to cancel subscription")}};export{c as HOST_PLANS,D as cancelSubscription,g as createHostSubscription,p as getAvailablePlans,u as getPlanById,m as getUserSubscription,y as hasActiveSubscription,w as processSubscriptionPayment};
