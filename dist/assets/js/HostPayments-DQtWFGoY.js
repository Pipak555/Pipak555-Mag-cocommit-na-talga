import{u as e,r as s,j as t}from"./react-vendor-Ve3SFwKO.js";import{u as a,h as r,G as i,e as n,v as d,C as c,a as l,b as o,d as m,i as x,c as h,j as u}from"./index-DaMaslBo.js";import{h as j,f as g}from"./firebase-vendor-BC71bXmb.js";import{B as p}from"./badge-BSgvUoVt.js";import{D as f,a as N,b as y,c as b,d as v}from"./dialog-GBvfaobK.js";import{T as w,a as k,b as E,c as S,d as A,e as D}from"./table-D8ee0DX1.js";import{B as I}from"./BackButton-uEV41aeK.js";import{j as B,r as F,t as T,m as L,L as P,C}from"./icons-vendor-Dhca6XHc.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const M=()=>{const M=e(),{user:G,userRole:O}=a(),[U,Y]=s.useState(!0),[$,R]=s.useState({totalEarnings:0,pendingEarnings:0,completedEarnings:0,serviceFees:0}),[H,V]=s.useState([]),[_,q]=s.useState([]),[z,J]=s.useState(!1),[K,Q]=s.useState([]),[W,X]=s.useState(!1);s.useEffect(()=>{G&&"host"===O?Z():M("/host/login")},[G,O,M]);const Z=async()=>{if(G){Y(!0);try{const e=await r({hostId:G.uid});V(e);const s=e.filter(e=>"confirmed"===e.status||"completed"===e.status),t=e.filter(e=>"pending"===e.status),a=s.reduce((e,s)=>e+(s.totalPrice||0),0),n=t.reduce((e,s)=>e+(s.totalPrice||0),0),d=.1*a;R({totalEarnings:a,pendingEarnings:n,completedEarnings:a-d,serviceFees:d});const c=await i(G.uid);q(c)}catch(e){n.error("Failed to load payments: "+(e.message||"Unknown error"))}finally{Y(!1)}}};return U?t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsx(d,{})})}):t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(I,{to:"/host/dashboard",label:"Back to Dashboard"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Payments & Earnings"}),t.jsx("p",{className:"text-muted-foreground",children:"View your earnings and payment history"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsxs(c,{children:[t.jsx(l,{className:"pb-3",children:t.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Earnings"})}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold text-primary",children:x($.totalEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"From all confirmed bookings"})]})]}),t.jsxs(c,{children:[t.jsx(l,{className:"pb-3",children:t.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Your Earnings"})}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:x($.completedEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"After 10% service fee"})]})]}),t.jsxs(c,{children:[t.jsx(l,{className:"pb-3",children:t.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Pending Earnings"})}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x($.pendingEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting confirmation"})]})]}),t.jsxs(c,{className:"cursor-pointer hover:shadow-medium transition-shadow",onClick:async()=>{if(G){J(!0),X(!0);try{const e=(await r({hostId:G.uid})).filter(e=>"confirmed"===e.status||"completed"===e.status),s=await Promise.all(e.map(async e=>{const s=.1*(e.totalPrice||0),t={id:e.id,userId:G.uid,type:"payment",amount:s,description:"Service fee from booking #"+e.id.slice(0,8),status:"completed",paymentMethod:"service_fee",bookingId:e.id,createdAt:e.createdAt||(new Date).toISOString()};if(e.listingId)try{const s=await j(g(u,"listing",e.listingId));if(s.exists()){const e=s.data();t.listingTitle=e.title||"N/A"}}catch(a){}if(e.guestId)try{const s=await j(g(u,"users",e.guestId));if(s.exists()){const e=s.data();t.guestName=e.fullName||"N/A",t.guestEmail=e.email||"N/A"}}catch(a){}return t}));s.sort((e,s)=>{const t=new Date(e.createdAt||0).getTime();return new Date(s.createdAt||0).getTime()-t}),Q(s)}catch(e){n.error("Failed to load service fee breakdown: "+(e.message||"Unknown error"))}finally{X(!1)}}},children:[t.jsx(l,{className:"pb-3",children:t.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Service Fees"})}),t.jsxs(m,{children:[t.jsx("div",{className:"text-2xl font-bold text-accent",children:x($.serviceFees)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"10% commission â€¢ Click to view breakdown"})]})]})]}),t.jsxs(c,{className:"mb-8",children:[t.jsxs(l,{children:[t.jsx(o,{children:"Recent Bookings"}),t.jsx(h,{children:"Your recent booking payments"})]}),t.jsx(m,{children:0===H.length?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(B,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No bookings yet"})]}):t.jsx("div",{className:"space-y-4",children:H.slice(0,5).map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:t.jsx(B,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Booking #",e.id.slice(0,8)]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(e.checkIn).toLocaleDateString()," - ",new Date(e.checkOut).toLocaleDateString()]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.guests," guest",e.guests>1?"s":""]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-lg font-bold",children:x(e.totalPrice||0)}),t.jsx(p,{className:"confirmed"===e.status||"completed"===e.status?"bg-green-500":"pending"===e.status?"bg-yellow-500":"bg-red-500",children:e.status})]})]},e.id))})})]}),t.jsxs(c,{children:[t.jsxs(l,{children:[t.jsx(o,{children:"Transaction History"}),t.jsx(h,{children:"Your payment and withdrawal history"})]}),t.jsx(m,{children:0===_.length?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No transactions yet"})]}):t.jsx("div",{className:"space-y-4",children:_.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center "+("deposit"===e.type||"reward"===e.type?"bg-green-500/10":"bg-red-500/10"),children:"deposit"===e.type||"reward"===e.type?t.jsx(T,{className:"h-6 w-6 text-green-500"}):t.jsx(T,{className:"h-6 w-6 text-red-500 rotate-180"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.description}),t.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),e.paymentMethod&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Method: ",e.paymentMethod]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-lg font-bold "+("deposit"===e.type||"reward"===e.type?"text-green-500":"text-red-500"),children:"reward"===e.type?`+${e.amount} points`:`${"deposit"===e.type?"+":"-"}${x(e.amount)}`}),e.status&&t.jsx(p,{className:"completed"===e.status?"bg-green-500":"pending"===e.status?"bg-yellow-500":"failed"===e.status?"bg-red-500":"bg-gray-500",children:e.status})]})]},e.id))})})]}),t.jsx(f,{open:z,onOpenChange:J,children:t.jsxs(N,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(y,{children:[t.jsxs(b,{className:"flex items-center gap-2",children:[t.jsx(L,{className:"h-5 w-5"}),"Service Fee Breakdown"]}),t.jsx(v,{children:"Detailed breakdown of service fees deducted from your earnings (10% commission)"})]}),W?t.jsxs("div",{className:"flex items-center justify-center py-12",children:[t.jsx(P,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("p",{className:"ml-3 text-muted-foreground",children:"Loading breakdown..."})]}):0===K.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("p",{className:"text-muted-foreground",children:"No service fees yet"})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx(c,{children:t.jsx(m,{className:"pt-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Service Fees"}),t.jsx("p",{className:"text-2xl font-bold text-accent",children:x(K.reduce((e,s)=>e+(s.amount||0),0))})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bookings"}),t.jsx("p",{className:"text-2xl font-bold",children:K.length})]})]})})}),t.jsx("div",{className:"border rounded-lg",children:t.jsxs(w,{children:[t.jsx(k,{children:t.jsxs(E,{children:[t.jsx(S,{children:"Date"}),t.jsx(S,{children:"Booking ID"}),t.jsx(S,{children:"Listing"}),t.jsx(S,{children:"Guest Name"}),t.jsx(S,{children:"Guest Email"}),t.jsx(S,{className:"text-right",children:"Service Fee"})]})}),t.jsx(A,{children:K.map(e=>t.jsxs(E,{children:[t.jsx(D,{children:e.createdAt?new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}),t.jsx(D,{children:t.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:e.bookingId?.slice(0,8)||"N/A"})}),t.jsx(D,{className:"max-w-[200px] truncate",children:e.listingTitle||"N/A"}),t.jsx(D,{children:e.guestName||"N/A"}),t.jsx(D,{children:e.guestEmail?t.jsx("a",{href:"mailto:"+e.guestEmail,className:"text-primary hover:underline",children:e.guestEmail}):"N/A"}),t.jsx(D,{className:"text-right font-semibold text-accent",children:x(e.amount||0)})]},e.id))})]})})]})]})})]})})};export{M as default};
