import{u as e,r as s,j as a}from"./react-vendor-BMVo5gto.js";import{u as n,j as t,e as r,v as d,B as i,C as l,a as c,b as o,d as m,i as x,c as u}from"./index-Bl4WVUm9.js";import{c as h,q as j,o as f,d as p,f as g,e as N}from"./firebase-vendor-BtzXZj7S.js";import{B as v}from"./badge-_91-i8yA.js";import{L as b}from"./label-CNgDwY3J.js";import{T as y}from"./textarea-BOgKdTrJ.js";import{A as w,a as k,b as R,c as T,d as C,e as A,f as F,g as I}from"./alert-dialog-ChaDevpt.js";import{c as S,b as U}from"./paymentService-CmJK1VwK.js";import{A as D,m as E,C as P,aj as B,h as z,g as L}from"./icons-vendor-BQMxNFbQ.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";const M=()=>{const M=e(),{user:O,userRole:$}=n(),[q,Z]=s.useState(!0),[G,H]=s.useState([]),[J,K]=s.useState(null),[Q,V]=s.useState(!1),[W,X]=s.useState(null),[Y,_]=s.useState(""),[ee,se]=s.useState(!1);s.useEffect(()=>{O&&"admin"===$?ae():M("/admin/login")},[O,$,M]);const ae=async()=>{try{Z(!0);const e=h(t,"transactions"),s=j(e,f("createdAt","desc")),a=await p(s),n=await Promise.all(a.docs.map(async e=>{const s=e.data();let a="Unknown",n="Unknown";try{const e=await g(N(t,"users",s.userId));if(e.exists()){const s=e.data();a=s.email||"Unknown",n=s.fullName||"Unknown"}}catch(r){}return{id:e.id,...s,userEmail:a,userName:n}}));H(n)}catch(e){r.error("Failed to load transactions: "+(e.message||"Unknown error"))}finally{Z(!1)}},ne=(e,s)=>{K(e),X(s),_(""),V(!0)},te=e=>{switch(e){case"completed":return a.jsxs(v,{className:"bg-green-500",children:[a.jsx(L,{className:"h-3 w-3 mr-1"}),"Completed"]});case"pending":return a.jsxs(v,{className:"bg-yellow-500",children:[a.jsx(z,{className:"h-3 w-3 mr-1"}),"Pending"]});case"failed":return a.jsxs(v,{className:"bg-red-500",children:[a.jsx(B,{className:"h-3 w-3 mr-1"}),"Failed"]});case"refunded":return a.jsxs(v,{className:"bg-gray-500",children:[a.jsx(B,{className:"h-3 w-3 mr-1"}),"Refunded"]});default:return a.jsx(v,{children:e||"Unknown"})}},re=G.filter(e=>"pending"===e.status),de=G.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0);return q?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-7xl mx-auto",children:a.jsx(d,{})})}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsxs(i,{variant:"ghost",onClick:()=>M("/admin/dashboard"),children:[a.jsx(D,{className:"h-4 w-4 mr-2"}),"Back"]}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Payment Management"}),a.jsx("p",{className:"text-muted-foreground",children:"Review and manage all platform transactions"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})}),a.jsx(m,{children:a.jsx("div",{className:"text-2xl font-bold",children:x(de)})})]}),a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Pending Transactions"})}),a.jsx(m,{children:a.jsx("div",{className:"text-2xl font-bold",children:re.length})})]}),a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Transactions"})}),a.jsx(m,{children:a.jsx("div",{className:"text-2xl font-bold",children:G.length})})]})]}),a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsx(o,{children:"All Transactions"}),a.jsx(u,{children:"Review and manage payment transactions"})]}),a.jsx(m,{children:0===G.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(E,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No transactions found"})]}):a.jsx("div",{className:"space-y-4",children:G.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),te(e.status)]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," • ",new Date(e.createdAt).toLocaleDateString()]}),e.bookingId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Booking ID: ",e.bookingId.slice(0,8)]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Payment ID: ",e.paymentId]}),e.serviceFee&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Service Fee: ",x(e.serviceFee)]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold",children:x(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod||"N/A"})]}),"pending"===e.status&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx(i,{size:"sm",onClick:()=>ne(e,"confirm"),children:"Confirm"}),a.jsx(i,{size:"sm",variant:"destructive",onClick:()=>ne(e,"refund"),children:"Refund"})]}),"completed"===e.status&&"payment"===e.type&&a.jsx(i,{size:"sm",variant:"destructive",onClick:()=>ne(e,"refund"),children:"Refund"})]})]},e.id))})})]}),a.jsx(w,{open:Q,onOpenChange:V,children:a.jsxs(k,{children:[a.jsxs(R,{children:[a.jsx(T,{children:"confirm"===W?"Confirm Transaction?":"Refund Transaction?"}),a.jsx(C,{className:"space-y-4",children:"confirm"===W?a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Are you sure you want to confirm this transaction? This will process the payment and update wallet balances."}),J&&a.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium",children:"Transaction Details:"}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Amount: ",x(J.amount)]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Type: ",J.type]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["User: ",J.userName||J.userEmail]})]})]}):a.jsx(a.Fragment,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[a.jsx(P,{className:"h-4 w-4"}),a.jsx("p",{className:"font-medium",children:"This will refund the payment and reverse wallet balances."})]}),J&&a.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Refund Details:"}),a.jsxs("p",{className:"text-xs",children:["Refund Amount: ",a.jsx("span",{className:"font-semibold",children:x(J.amount)})]}),a.jsxs("p",{className:"text-xs",children:["Transaction Type: ",J.type]}),a.jsxs("p",{className:"text-xs",children:["User: ",J.userName||J.userEmail]}),J.bookingId&&a.jsxs("p",{className:"text-xs",children:["Booking ID: ",J.bookingId.slice(0,8)]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(b,{htmlFor:"refund-reason",children:"Refund Reason (Optional)"}),a.jsx(y,{id:"refund-reason",placeholder:"Enter reason for refund...",value:Y,onChange:e=>_(e.target.value),rows:3})]})]})})})]}),a.jsxs(A,{children:[a.jsx(F,{disabled:ee,children:"Cancel"}),a.jsx(I,{onClick:async()=>{if(J&&W){se(!0);try{if("confirm"===W)await S(J.id),r.success("Transaction confirmed successfully");else if("refund"===W){const e=await U(J.id,J,Y||void 0);if(!e.success)throw Error("Refund processing failed");r.success(`Refund processed successfully. ₱${e.refundAmount?.toFixed(2)} has been returned to user's wallet.`)}await ae(),K(null),X(null),_("")}catch(e){r.error(e.message||`Failed to ${W} transaction`)}finally{se(!1),V(!1)}}},disabled:ee,className:"refund"===W?"bg-destructive hover:bg-destructive/90":"",children:ee?"Processing...":"confirm"===W?"Confirm":"Refund"})]})]})})]})})};export{M as default};
