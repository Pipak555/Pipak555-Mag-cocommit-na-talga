import{r as e,j as s,M as t,T as a,m as r,n as i,l as n,k as o,u as l}from"./react-vendor-Ve3SFwKO.js";import{B as c,g as d,e as m,u,j as h,C as g,d as x,a as p,b as j,i as f,l as v,m as b,_ as y,n as w,c as N}from"./index-DaMaslBo.js";import{t as D}from"./form-vendor-Dd1peP4Z.js";import{I as S}from"./input-D5hloL4G.js";import{T as k}from"./textarea-bhWBiMTW.js";import{S as C,a as P,b as F,c as A,d as L}from"./select-CXm8ONYg.js";import{D as R,a as I,b as E,c as U,d as O}from"./dialog-GBvfaobK.js";import{A as G,a as B,b as $,c as T,d as V,e as _,f as q,g as M}from"./alert-dialog-DLw-Qa8s.js";import{F as z,a as Y,b as H,c as W,d as K,f as J,e as Z,g as Q}from"./validation-C6LOf81e.js";import{P as X}from"./PayPalButton-_BOQ6Z9Q.js";import{C as ee}from"./calendar-CVp7jgzT.js";import{P as se,a as te,b as ae}from"./popover-DfvVs6QC.js";import{j as re,v as ie,X as ne,w as oe,L as le,N as ce,e as de,C as me,x as ue,h as he}from"./icons-vendor-Dhca6XHc.js";import{o as ge}from"./utils-vendor-DzY7Ay74.js";import{P as xe}from"./progress-AQZ6OkZ3.js";import{L as pe}from"./maps-vendor-CYGXCXz5.js";import{h as je,f as fe,x as ve,B as be,j as ye,u as we}from"./firebase-vendor-BC71bXmb.js";import{hasActiveSubscription as Ne,getUserSubscription as De}from"./billingService-fa-KtGBm.js";import{B as Se}from"./BackButton-uEV41aeK.js";import"./ui-vendor-D9RGQy8n.js";import"./label-B2t2XnWQ.js";function ke({value:t,onChange:a,placeholder:r="Pick a date range",className:i,disabled:n,error:o}){const[l,m]=e.useState(!1),u=new Date;u.setHours(0,0,0,0);const h=n||(e=>{const s=new Date(e);return s.setHours(0,0,0,0),u>s});return s.jsxs(se,{open:l,onOpenChange:m,children:[s.jsx(te,{asChild:!0,children:s.jsxs(c,{variant:"outline",type:"button",className:d("w-full justify-start text-left font-normal",!t?.from&&"text-muted-foreground",o&&"border-destructive",i),children:[s.jsx(re,{className:"mr-2 h-4 w-4"}),t?.from?t.to?s.jsxs(s.Fragment,{children:[ge(t.from,"LLL dd, y")," -"," ",ge(t.to,"LLL dd, y")]}):ge(t.from,"LLL dd, y"):s.jsx("span",{children:r})]})}),s.jsx(ae,{className:"w-auto p-0",align:"start",children:s.jsx(ee,{mode:"range",defaultMonth:t?.from||u,selected:t,onSelect:e=>{e&&(a?.(e),e.from&&e.to&&m(!1))},numberOfMonths:2,disabled:h})})]})}const Ce=({images:e,onRemove:t,uploadProgress:a=0,isUploading:r=!1})=>0===e.length?s.jsx("div",{className:"flex items-center justify-center w-full h-32 border-2 border-dashed rounded-lg border-muted-foreground/25",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ie,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"No images selected"})]})}):s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.map((e,a)=>{const i=URL.createObjectURL(e);return s.jsxs("div",{className:"relative group",children:[s.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border-2 border-border",children:s.jsx("img",{src:i,alt:"Preview "+(a+1),className:"w-full h-full object-cover"})}),!r&&s.jsx(c,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>t(a),children:s.jsx(ne,{className:"h-4 w-4"})}),s.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:e.name}),s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[(e.size/1024/1024).toFixed(2)," MB"]})]},a)})}),r&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Uploading images..."}),s.jsxs("span",{className:"text-muted-foreground",children:[a,"%"]})]}),s.jsx(xe,{value:a})]})]});function Pe({onLocationSelect:e}){return i({click:s=>{const{lat:t,lng:a}=s.latlng;e(t,a)}}),null}delete pe.Icon.Default.prototype._getIconUrl,pe.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const Fe=({value:i,onChange:n})=>{const[o,l]=e.useState([14.5995,120.9842]),[d,u]=e.useState(null),[h,g]=e.useState(!1),[x,p]=e.useState(!1),j=e.useRef(null),f=e.useRef(null),v=async(e,s)=>{try{p(!0);const t=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${s}&zoom=18&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!t.ok)throw Error("Failed to fetch address");const a=await t.json();if(a.error)throw Error(a.error);const r=a.address,i=[];return(r.road||r.street)&&i.push(r.road||r.street),(r.suburb||r.neighbourhood||r.city_district)&&i.push(r.suburb||r.neighbourhood||r.city_district),(r.city||r.town||r.village)&&i.push(r.city||r.town||r.village),(r.state||r.province)&&i.push(r.state||r.province),r.country&&i.push(r.country),i.length>0?i.join(", "):`${e.toFixed(6)}, ${s.toFixed(6)}`}catch(t){return`${e.toFixed(6)}, ${s.toFixed(6)}`}finally{p(!1)}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(S,{ref:f,placeholder:"Search address or click on map...",value:i,onChange:e=>{n(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),i.trim()&&(async e=>{if(e&&e.trim().length>=3){g(!0);try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!s.ok)throw Error("Failed to search address");const t=await s.json();if(t.length>0){const e=t[0],s=parseFloat(e.lat),a=parseFloat(e.lon);l([s,a]),u([s,a]),j.current&&j.current.setView([s,a],15);const r=[],i=e.address;(i.road||i.street)&&r.push(i.road||i.street),(i.suburb||i.neighbourhood||i.city_district)&&r.push(i.suburb||i.neighbourhood||i.city_district),(i.city||i.town||i.village)&&r.push(i.city||i.town||i.village),(i.state||i.province)&&r.push(i.state||i.province),i.country&&r.push(i.country);const o=r.length>0?r.join(", "):e.display_name;n(o),m.success("Location found")}else m.error("Location not found. Please try a different address.")}catch(s){m.error("Failed to search location")}finally{g(!1)}}})(i))},className:"pl-10"}),(h||x)&&s.jsx(le,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),s.jsx(c,{type:"button",variant:"outline",onClick:()=>{navigator.geolocation?(g(!0),navigator.geolocation.getCurrentPosition(async e=>{const{latitude:s,longitude:t}=e.coords;l([s,t]),u([s,t]),j.current&&j.current.setView([s,t],15);try{const e=await v(s,t);n(e),m.success("Current location set")}catch(a){m.error("Failed to get address. Using coordinates."),n(`${s.toFixed(6)}, ${t.toFixed(6)}`)}finally{g(!1)}},e=>{m.error("Failed to get your location. Please allow location access."),g(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):m.error("Geolocation is not supported by your browser")},disabled:h,title:"Use current location",children:s.jsx(ce,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"border rounded-lg overflow-hidden",style:{height:"400px"},children:s.jsxs(t,{center:o,zoom:13,style:{height:"100%",width:"100%"},whenCreated:e=>{j.current=e},children:[s.jsx(a,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),s.jsx(Pe,{onLocationSelect:async(e,s)=>{u([e,s]),g(!0);try{const t=await v(e,s);n(t),m.success("Location selected")}catch(t){m.error("Failed to get address. Using coordinates."),n(`${e.toFixed(6)}, ${s.toFixed(6)}`)}finally{g(!1)}}}),d&&s.jsx(r,{position:d})]})}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Click on the map to select a location, search for an address, or use your current location."})]})},Ae=["image/jpeg","image/jpg","image/png","image/webp"],Le=({onSuccess:t})=>{const{user:a}=u(),[r]=n(),i=r.get("edit"),l=!!i,[d,N]=e.useState(!1),[ee,se]=e.useState(!1),[te,ae]=e.useState([]),[re,ne]=e.useState([]),[oe,ce]=e.useState(0),[he,ge]=e.useState(!1),[pe,Ne]=e.useState("idle"),[De,Se]=e.useState([]),[Pe,Le]=e.useState([]),[Re,Ie]=e.useState(!1),[Ee,Ue]=e.useState(!1),[Oe,Ge]=e.useState(!1),[Be,$e]=e.useState(null),[Te,Ve]=e.useState(!1),[_e,qe]=e.useState(!1),[Me,ze]=e.useState(!1),Ye=e.useRef(null),He=e.useRef(!1),We=o({resolver:D(Q),defaultValues:{title:"",description:"",category:"home",price:"",discount:"",promo:"",location:"",maxGuests:"",bedrooms:"",bathrooms:"",amenities:"",dateRange:{from:void 0,to:void 0},images:[]},mode:"onChange"}),Ke=We.watch(),Je=We.formState.errors,Ze=(()=>{const e=Ke.price;if(!e||""===e.trim())return 0;const s=+e;return isNaN(s)||0>=s?0:s})(),Qe=e.useCallback(()=>a?a.uid+"_draft":null,[a]),Xe=e.useCallback(()=>{const e=[Ke.title,Ke.description,Ke.price,Ke.location,Ke.maxGuests,Ke.dateRange?.from&&Ke.dateRange?.to,te.length>0],s=e.filter(Boolean).length;return Math.round(s/e.length*100)},[Ke,te.length])(),es=(e,s)=>{const t=[],a=new Date(e);for(;s>=a;)t.push(a.toISOString().split("T")[0]),a.setDate(a.getDate()+1);return t},ss=e=>{const s={};return Object.keys(e).forEach(t=>{void 0!==e[t]&&(s[t]=e[t])}),s},ts=e=>{const s=Array.from(e.target.files||[]),t=[],a=[];s.forEach(e=>{const s=(e=>Ae.includes(e.type)?e.size>5242880?"File size exceeds 5MB limit":null:"Invalid file type. Allowed types: "+Ae.join(", "))(e);s?a.push(`${e.name}: ${s}`):t.push(e)}),a.length>0&&m.error(a.join(", "));const r=10-(l?re.length:0),i=[...te,...t].slice(0,r);t.length>r&&m.warning(`Maximum 10 total images allowed. You can add ${r} more image(s).`),ae(i),We.setValue("images",i,{shouldValidate:!0}),e.target.value=""},as=e=>{const s=te.filter((s,t)=>t!==e);ae(s),We.setValue("images",s,{shouldValidate:!0})},rs=e.useCallback(async e=>{if(!a)return;if(Me)return;const s=Qe();if(!s)return;const t=We.getValues(),r=t.dateRange?.from&&t.dateRange?.to?es(t.dateRange.from,t.dateRange.to):De;let i=null,n=null;try{const e=await je(fe(h,"listing",s));if(e.exists()){const s=e.data();if(i=s.createdAt,n=s.status,n&&"draft"!==n)return}}catch(c){}const o={hostId:a.uid,title:t.title||"",description:t.description||"",category:t.category||"home",price:t.price?+t.price:void 0,discount:t.discount&&t.discount.trim()?+t.discount:void 0,promo:t.promo||void 0,location:t.location||"",maxGuests:t.maxGuests?+t.maxGuests:void 0,bedrooms:t.bedrooms&&t.bedrooms.trim()?+t.bedrooms:void 0,bathrooms:t.bathrooms&&t.bathrooms.trim()?+t.bathrooms:void 0,amenities:t.amenities?t.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:r,blockedDates:Pe,images:[],status:"draft",createdAt:i||(new Date).toISOString(),updatedAt:be()},l=ss(o);try{Ne("saving"),await ve(fe(h,"listing",s),l,{merge:!0}),$e(s),Ne("saved"),e?.manual&&(m.success("Draft saved successfully"),setTimeout(()=>Ne("idle"),2e3))}catch(c){Ne("error");const s="permission-denied"===c.code?"Permission denied. Please check your permissions.":"unavailable"===c.code?"Network error. Please check your connection.":"Failed to save draft";e?.manual?m.error(s):m.error("Auto-save failed. Please save manually.",{duration:3e3}),setTimeout(()=>Ne("idle"),3e3)}},[a,Qe,We,De,Pe,Me]);e.useEffect(()=>{if(He.current){if(a&&!(l||Re||d||Me))return Ye.current&&window.clearTimeout(Ye.current),Ye.current=window.setTimeout(()=>{We.formState.isDirty&&rs()},2e3),()=>{Ye.current&&window.clearTimeout(Ye.current)}}else He.current=!0},[Ke,te,a,We.formState.isDirty,rs,Re,d,Me,l]),e.useEffect(()=>{if(l)return;const e=()=>{a&&We.formState.isDirty&&!Me&&rs()};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[rs,a,We.formState.isDirty,Me,l]),e.useEffect(()=>{(async()=>{if(l&&i&&a){se(!0);try{const e=await v(i);if(!e)return void m.error("Listing not found");if(e.hostId!==a.uid)return void m.error("You don't have permission to edit this listing");We.reset({title:e.title||"",description:e.description||"",category:e.category||"home",price:e.price?e.price+"":"",discount:e.discount?e.discount+"":"",promo:e.promo||"",location:e.location||"",maxGuests:e.maxGuests?e.maxGuests+"":"",bedrooms:e.bedrooms?e.bedrooms+"":"",bathrooms:e.bathrooms?e.bathrooms+"":"",amenities:Array.isArray(e.amenities)?e.amenities.join(", "):"",dateRange:e.availableDates&&e.availableDates.length>0?{from:new Date(e.availableDates[0]),to:new Date(e.availableDates[e.availableDates.length-1])}:{from:void 0,to:void 0},images:[]}),e.images&&Array.isArray(e.images)&&ne(e.images),e.availableDates&&Array.isArray(e.availableDates)&&Se(e.availableDates),e.blockedDates&&Array.isArray(e.blockedDates)&&Le(e.blockedDates),ze(!0),m.success("Listing loaded successfully")}catch(e){m.error("Failed to load listing: "+(e.message||"Unknown error"))}finally{se(!1)}}})()},[l,i,a,We]),e.useEffect(()=>{l||(async()=>{if(!a)return;const e=Qe();if(e)try{const s=await je(fe(h,"listing",e));s.exists()&&"draft"===s.data().status&&(Ue(!0),Ge(!0),$e(e))}catch(s){s.code}})()},[a,Qe,l]);const is=async(e,s)=>{ge(!0),ce(0);try{const{uploadListingImages:t}=await y(async()=>{const{uploadListingImages:e}=await import("./cloudinary-BHmE7xG7.js");return{uploadListingImages:e}},[]),a=t(e,s,e=>{ce(e)}),r=await a;return ce(100),r}finally{ge(!1),setTimeout(()=>ce(0),1e3)}},ns=async()=>{if(l&&i&&a)if(await We.trigger()){N(!0),Ne("saving");try{const e=We.getValues(),s=e.dateRange?.from&&e.dateRange?.to?es(e.dateRange.from,e.dateRange.to):De,t={title:e.title,description:e.description,category:e.category||"home",price:+e.price,discount:e.discount&&e.discount.trim()?+e.discount:void 0,promo:e.promo||void 0,location:e.location,maxGuests:+e.maxGuests,bedrooms:e.bedrooms&&e.bedrooms.trim()?+e.bedrooms:void 0,bathrooms:e.bathrooms&&e.bathrooms.trim()?+e.bathrooms:void 0,amenities:e.amenities?e.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:s,blockedDates:Pe,updatedAt:(new Date).toISOString()},a=ss(t);let r=[...re];if(te.length>0){const e=await is(te,i);r=[...re,...e]}await b(i,{...a,images:r}),Ne("saved"),ne(r),ae([]),m.success("Listing updated successfully!"),We.reset(We.getValues(),{keepDirty:!1})}catch(e){Ne("error"),m.error("Failed to update listing: "+(e.message||"Unknown error"))}finally{N(!1),setTimeout(()=>Ne("idle"),2e3)}}else m.error("Please fix the errors in the form before saving.")};return s.jsxs(s.Fragment,{children:[s.jsx(R,{open:Oe,onOpenChange:Ge,children:s.jsxs(I,{children:[s.jsxs(E,{children:[s.jsx(U,{children:"Unsaved Draft Found"}),s.jsx(O,{children:"We found a saved draft for this account. Would you like to continue editing it or discard it and start fresh?"})]}),s.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[s.jsx(c,{variant:"outline",onClick:()=>{Ge(!1),Ve(!0)},children:"Discard Draft"}),s.jsx(c,{onClick:async()=>{if(Be)try{const e=await je(fe(h,"listing",Be));if(!e.exists())return;const s=e.data();We.reset({title:s.title||"",description:s.description||"",category:s.category||"home",price:s.price?s.price+"":"",discount:s.discount?s.discount+"":"",promo:s.promo||"",location:s.location||"",maxGuests:s.maxGuests?s.maxGuests+"":"",bedrooms:s.bedrooms?s.bedrooms+"":"",bathrooms:s.bathrooms?s.bathrooms+"":"",amenities:Array.isArray(s.amenities)?s.amenities.join(", "):s.amenities||"",dateRange:s.availableDates&&s.availableDates.length>0?{from:new Date(s.availableDates[0]),to:new Date(s.availableDates[s.availableDates.length-1])}:{from:void 0,to:void 0},images:[]}),s.availableDates&&Array.isArray(s.availableDates)&&Se(s.availableDates),s.blockedDates&&Array.isArray(s.blockedDates)&&Le(s.blockedDates),Ge(!1),m.success("Draft loaded successfully")}catch(e){const s="permission-denied"===e.code?"Permission denied. Unable to load draft.":"Failed to load draft";m.error(s)}},children:"Continue Draft"})]})]})}),ee?s.jsx(g,{children:s.jsx(x,{className:"py-12",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx(le,{className:"h-8 w-8 animate-spin text-primary"}),s.jsx("p",{className:"ml-3 text-muted-foreground",children:"Loading listing..."})]})})}):s.jsxs(g,{children:[s.jsxs(p,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(j,{children:l?"Edit Listing":"Create New Listing"}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["saving"===pe&&s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-4 w-4 animate-spin"}),s.jsx("span",{children:"Saving..."})]}),"saved"===pe&&s.jsxs(s.Fragment,{children:[s.jsx(de,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Saved"})]}),"error"===pe&&s.jsxs(s.Fragment,{children:[s.jsx(me,{className:"h-4 w-4 text-destructive"}),s.jsx("span",{children:"Save failed"})]})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Form completion"}),s.jsxs("span",{className:"font-medium",children:[Xe,"%"]})]}),s.jsx(xe,{value:Xe,className:"h-2"})]})]}),s.jsx(x,{children:s.jsx(z,{...We,children:s.jsxs("form",{onSubmit:l?e=>{e.preventDefault(),ns()}:We.handleSubmit(async()=>{const e=await We.trigger(),s=We.getValues("dateRange"),t=We.getValues("price");if(e)return t&&""!==t.trim()&&!isNaN(+t)&&+t>0?s?.from&&s?.to?0===te.length?(m.error("Please upload at least one image."),void We.setError("images",{message:"At least one image is required"})):void qe(!0):(m.error("Please select an availability date range."),void We.setError("dateRange.to",{message:"Date range is required"})):(m.error("Please set a valid listing price. The publish fee is 1 day of your listing price."),void We.setError("price",{message:"Price is required for publishing"}));m.error("Please fix the errors in the form before proceeding.")}),className:"space-y-6",children:[s.jsx(Y,{control:We.control,name:"title",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Title ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(S,{placeholder:"Enter a descriptive title for your listing",...e,value:e.value||""})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(J,{children:[e.value?.length||0,"/100 characters"]}),s.jsx(Z,{})]})]})}),s.jsx(Y,{control:We.control,name:"description",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Description ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(k,{placeholder:"Describe your listing in detail. Include amenities, nearby attractions, and what makes it special.",className:"min-h-[120px]",...e,value:e.value||""})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(J,{children:[e.value?.length||0,"/2000 characters (minimum 50)"]}),s.jsx(Z,{})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsx(Y,{control:We.control,name:"category",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Category ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(C,{onValueChange:e.onChange,defaultValue:e.value,children:[s.jsx(K,{children:s.jsx(P,{children:s.jsx(F,{placeholder:"Select category"})})}),s.jsxs(A,{children:[s.jsx(L,{value:"home",children:"Home"}),s.jsx(L,{value:"experience",children:"Experience"}),s.jsx(L,{value:"service",children:"Service"})]})]}),s.jsx(Z,{})]})}),s.jsx(Y,{control:We.control,name:"price",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Price per Night (₱) ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(S,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(Z,{})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[s.jsx(Y,{control:We.control,name:"discount",render:({field:e})=>s.jsxs(H,{children:[s.jsx(W,{children:"Discount (%)"}),s.jsx(K,{children:s.jsx(S,{type:"number",min:"0",max:"100",placeholder:"0",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(J,{children:"Optional discount percentage (0-100)"}),s.jsx(Z,{})]})}),s.jsx(Y,{control:We.control,name:"promo",render:({field:e})=>s.jsxs(H,{children:[s.jsx(W,{children:"Promo Description"}),s.jsx(K,{children:s.jsx(S,{placeholder:"e.g., 'Summer Special'",maxLength:100,...e,value:e.value||""})}),s.jsx(J,{children:"Optional promotional message"}),s.jsx(Z,{})]})})]}),s.jsx(Y,{control:We.control,name:"location",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Location ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(Fe,{value:e.value||"",onChange:s=>{e.onChange(s)}})}),s.jsx(Z,{})]})}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[s.jsx(Y,{control:We.control,name:"maxGuests",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Max Guests ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(S,{type:"number",min:"1",placeholder:"1",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(Z,{})]})}),s.jsx(Y,{control:We.control,name:"bedrooms",render:({field:e})=>s.jsxs(H,{children:[s.jsx(W,{children:"Bedrooms"}),s.jsx(K,{children:s.jsx(S,{type:"number",min:"0",placeholder:"0",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(Z,{})]})}),s.jsx(Y,{control:We.control,name:"bathrooms",render:({field:e})=>s.jsxs(H,{children:[s.jsx(W,{children:"Bathrooms"}),s.jsx(K,{children:s.jsx(S,{type:"number",min:"0",step:"0.5",placeholder:"0",...e,value:e.value||"",onChange:s=>e.onChange(s.target.value)})}),s.jsx(J,{children:"0.5 = half bath (toilet + sink), 1 = full bath (toilet + sink + shower)"}),s.jsx(Z,{})]})})]}),s.jsx(Y,{control:We.control,name:"amenities",render:({field:e})=>s.jsxs(H,{children:[s.jsx(W,{children:"Amenities"}),s.jsx(K,{children:s.jsx(S,{placeholder:"WiFi, Pool, Kitchen, Parking (comma separated)",...e,value:e.value||""})}),s.jsx(J,{children:"Separate multiple amenities with commas"}),s.jsx(Z,{})]})}),s.jsx(Y,{control:We.control,name:"dateRange",render:({field:e})=>s.jsxs(H,{children:[s.jsxs(W,{children:["Availability Date Range ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(ke,{value:e.value,onChange:e.onChange,placeholder:"Select your listing availability period",className:"mt-2",error:!!Je.dateRange})}),e.value?.from&&e.value?.to&&s.jsxs(J,{children:["Available from ",e.value.from.toLocaleDateString()," to ",e.value.to.toLocaleDateString()]}),s.jsx(Z,{})]})}),s.jsx(Y,{control:We.control,name:"images",render:()=>s.jsxs(H,{children:[s.jsxs(W,{children:["Images ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(S,{id:"images",type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:ts,className:"hidden"}),s.jsxs(c,{type:"button",variant:"outline",onClick:()=>document.getElementById("images")?.click(),disabled:(l?re.length:0)+te.length>=10,children:[s.jsx(ie,{className:"h-4 w-4 mr-2"}),"Upload Images (",(l?re.length:0)+te.length,"/",10,")"]})]}),l&&re.length>0&&s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Existing Images (",re.length,"):"]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3",children:re.map((e,t)=>s.jsxs("div",{className:"relative group aspect-square",children:[s.jsx("div",{className:"w-full h-full rounded-lg overflow-hidden border-2 border-border",children:s.jsx("img",{src:e,alt:"Existing image "+(t+1),className:"w-full h-full object-cover"})}),s.jsx(c,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-7 w-7 opacity-80 group-hover:opacity-100 transition-opacity shadow-lg",onClick:e=>{e.stopPropagation(),ne(re.filter((e,s)=>s!==t))},children:s.jsx("span",{className:"text-lg font-bold",children:"×"})})]},"existing-"+t))})]}),s.jsx(Ce,{images:te,onRemove:as,uploadProgress:oe,isUploading:he})]})}),s.jsxs(J,{children:["Upload at least 1 image (max ",10,"). Accepted formats: JPG, PNG, WebP. Max size: 5MB per image."]}),s.jsx(Z,{})]})}),s.jsx("div",{className:"flex gap-2 pt-4",children:l?s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"button",onClick:ns,disabled:d||he||"saving"===pe,className:"flex-1",children:"saving"===pe||d?s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"saved"===pe?s.jsxs(s.Fragment,{children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"Saved"]}):s.jsxs(s.Fragment,{children:[s.jsx(ue,{className:"h-4 w-4 mr-2"}),"Save Changes"]})}),s.jsx(c,{type:"button",variant:"outline",onClick:()=>t(),disabled:d||he,className:"flex-1",children:"Cancel"})]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"submit",disabled:d||he||0===Ze,className:"flex-1",children:d?s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):`Pay & Publish (${f(Ze)})`}),s.jsxs(c,{type:"button",variant:"outline",disabled:d||he,className:"flex-1",onClick:async()=>{await rs({manual:!0})},children:[s.jsx(ue,{className:"h-4 w-4 mr-2"}),"Save as Draft"]})]})})]})})})]}),s.jsx(R,{open:Re,onOpenChange:Ie,children:s.jsxs(I,{children:[s.jsxs(E,{children:[s.jsx(U,{children:"Complete Payment to Publish"}),s.jsxs(O,{children:["Pay a one-time publish fee of ",f(Ze)," (1 day of your listing price) to submit your listing for review."]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"rounded-lg border p-4",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Listing Details"}),s.jsx("div",{className:"font-medium mt-1",children:Ke.title||"Untitled Listing"}),s.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Category: ",Ke.category]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Location: ",Ke.location||"-"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:Ke.dateRange?.from&&Ke.dateRange?.to?`Availability: ${Ke.dateRange.from.toLocaleDateString()} - ${Ke.dateRange.to.toLocaleDateString()}`:"Availability: Not set"})]}),s.jsxs("div",{className:"rounded-lg bg-muted p-4",children:[s.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[s.jsx("span",{children:"Publish Fee:"}),s.jsx("span",{className:"font-medium",children:f(Ze)})]}),s.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:["This fee equals 1 day of your listing price (",f(+Ke.price||0),"/night)."]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"This fee covers listing review and processing. Your listing will be reviewed by our team before going live."})]}),a&&Ze>0&&s.jsx(X,{amount:Ze,userId:a.uid,description:"Host publish fee for listing: "+(Ke.title||"Untitled"),onSuccess:async()=>{if(a){N(!0);try{const e=await(async()=>{if(!a)throw Error("No user");const e=We.getValues(),s=e.dateRange?.from&&e.dateRange?.to?es(e.dateRange.from,e.dateRange.to):De,t={hostId:a.uid,title:e.title,description:e.description,category:e.category||"home",price:+e.price,discount:e.discount&&e.discount.trim()?+e.discount:void 0,promo:e.promo||void 0,location:e.location,maxGuests:+e.maxGuests,bedrooms:e.bedrooms&&e.bedrooms.trim()?+e.bedrooms:void 0,bathrooms:e.bathrooms&&e.bathrooms.trim()?+e.bathrooms:void 0,amenities:e.amenities?e.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:s,blockedDates:Pe,images:[],status:"pending",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};{const e={...ss(t),status:"pending"},s=await w(e),a=await je(fe(h,"listing",s));if(a.exists()&&"pending"!==a.data().status&&await we(fe(h,"listing",s),{status:"pending",updatedAt:(new Date).toISOString()}),Be)try{await ye(fe(h,"listing",Be))}catch(r){}return $e(null),Ue(!1),s}})(),s=await je(fe(h,"listing",e));if(s.exists()&&"pending"!==s.data().status&&await ve(fe(h,"listing",e),{status:"pending",updatedAt:(new Date).toISOString()},{merge:!0}),te.length>0){const s=await is(te,e);await ve(fe(h,"listing",e),{images:s,status:"pending",updatedAt:(new Date).toISOString()},{merge:!0})}$e(null),Ue(!1),ze(!0),m.success("Payment received. Listing submitted for review!"),t()}catch(e){const s="permission-denied"===e.code?"Permission denied. Please check your permissions.":"unavailable"===e.code?"Network error. Please check your connection and try again.":e.message||"Failed to create listing after payment";m.error(s)}finally{N(!1),Ie(!1)}}}}),0===Ze&&s.jsx("div",{className:"rounded-lg border border-yellow-500/50 bg-yellow-500/10 p-4 text-sm text-yellow-700 dark:text-yellow-400",children:"Please set a valid listing price before publishing. The publish fee is 1 day of your listing price."})]})]})}),s.jsx(G,{open:Te,onOpenChange:Ve,children:s.jsxs(B,{children:[s.jsxs($,{children:[s.jsx(T,{children:"Discard Draft?"}),s.jsx(V,{children:"Are you sure you want to discard this draft? All unsaved changes will be permanently lost."})]}),s.jsxs(_,{children:[s.jsx(q,{children:"Cancel"}),s.jsx(M,{onClick:async()=>{if(!Be)return Ge(!1),Ue(!1),Ve(!1),void We.reset();try{await ye(fe(h,"listing",Be)),$e(null),Ge(!1),Ue(!1),Ve(!1),We.reset(),Se([]),Le([]),ae([]),m.success("Draft discarded")}catch(e){const s="permission-denied"===e.code?"Permission denied. Unable to discard draft.":"Failed to discard draft";m.error(s)}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Discard Draft"})]})]})}),s.jsx(G,{open:_e,onOpenChange:qe,children:s.jsxs(B,{children:[s.jsxs($,{children:[s.jsx(T,{children:"Proceed to Payment?"}),s.jsxs(V,{children:["You're about to pay a one-time publish fee of ",f(Ze)," (1 day of your listing price) to publish this listing. After payment, your listing will be submitted for admin review."]})]}),s.jsxs(_,{children:[s.jsx(q,{children:"Cancel"}),s.jsx(M,{onClick:()=>{qe(!1),Ie(!0)},children:"Proceed to Payment"})]})]})})]})},Re=({children:t,showWarning:a=!1,required:r=!0})=>{const{user:i}=u(),n=l(),[o,d]=e.useState(null),[m,h]=e.useState(null),[f,v]=e.useState(!0);return e.useEffect(()=>{(async()=>{if(!i)return d(!1),void v(!1);try{const e=await Ne(i.uid);if(d(e),e){const e=await De(i.uid);h(e)}}catch(e){d(!1)}finally{v(!1)}})()},[i]),f?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),s.jsx("p",{className:"mt-4 text-muted-foreground",children:"Checking subscription..."})]})}):r&&!o?s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:s.jsxs(g,{className:"max-w-md w-full",children:[s.jsxs(p,{children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(me,{className:"h-6 w-6 text-destructive"}),s.jsx(j,{children:"Subscription Required"})]}),s.jsx(N,{children:"You need an active subscription to access this feature."})]}),s.jsxs(x,{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"To create listings and manage your properties, you need to subscribe to one of our hosting plans."}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(c,{className:"w-full",onClick:()=>n("/host/register"),children:[s.jsx(he,{className:"h-4 w-4 mr-2"}),"Subscribe Now"]}),s.jsx(c,{variant:"outline",className:"w-full",onClick:()=>n("/host/dashboard"),children:"Back to Dashboard"})]})]})]})}):a&&!o?s.jsxs(s.Fragment,{children:[s.jsx(g,{className:"mb-6 border-yellow-500/50 bg-yellow-500/10",children:s.jsx(x,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(me,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold mb-1",children:"Subscription Required"}),s.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"You need an active subscription to create and manage listings. Subscribe now to unlock all features."}),s.jsxs(c,{size:"sm",onClick:()=>n("/host/register"),children:[s.jsx(he,{className:"h-4 w-4 mr-2"}),"Subscribe Now"]})]})]})})}),t]}):s.jsx(s.Fragment,{children:t})},Ie=()=>{const e=l();return s.jsx(Re,{required:!0,children:s.jsx("div",{className:"min-h-screen bg-background p-6",children:s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsx(Se,{to:"/host/dashboard",label:"Back to Dashboard",className:"mb-4"}),s.jsx(Le,{onSuccess:()=>e("/host/listings")})]})})})};export{Ie as default};
