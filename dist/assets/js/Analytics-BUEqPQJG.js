import{u as e,r as t,j as s}from"./react-vendor-DcULH_Au.js";import{u as i,j as a,B as n,C as r,a as l,b as d,d as c,i as o,c as m}from"./index-F95ZJi6y.js";import{d as x,c as u}from"./firebase-vendor-BtzXZj7S.js";import{A as h,y as g,a2 as j,l as f,s as p}from"./icons-vendor-D18eSOBA.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-C9dhA_ey.js";const v=()=>{const v=e(),{user:N,userRole:w}=i(),[y,b]=t.useState(!0),[D,R]=t.useState({totalUsers:0,totalHosts:0,totalGuests:0,totalListings:0,totalBookings:0,totalRevenue:0,avgRating:0}),[T,k]=t.useState([]),[C,L]=t.useState([]),[A,S]=t.useState([]),[B,P]=t.useState(0),[F,H]=t.useState(0);t.useEffect(()=>{N&&"admin"===w?U():v("/admin/login")},[N,w,v]);const U=async()=>{b(!0);try{const[e,t,s,i]=await Promise.all([x(u(a,"users")),x(u(a,"listing")),x(u(a,"bookings")),x(u(a,"reviews"))]),n=e.docs.map(e=>e.data()),r=n.filter(e=>"host"===e.role).length,l=n.filter(e=>"guest"===e.role).length,d=t.docs.map(e=>({id:e.id,...e.data()})),c=s.docs.map(e=>({id:e.id,...e.data()})),o=i.docs.map(e=>({id:e.id,...e.data()})),m=c.filter(e=>"confirmed"===e.status||"completed"===e.status),h=.1*m.reduce((e,t)=>e+(t.totalPrice||0),0),g=o.length>0?o.reduce((e,t)=>e+t.rating,0)/o.length:0,j=new Map;o.forEach(e=>{const t=j.get(e.listingId)||{totalRating:0,count:0};j.set(e.listingId,{totalRating:t.totalRating+e.rating,count:t.count+1})});const f=Array.from(j.entries()).map(([e,t])=>{const s=d.find(t=>t.id===e);return s?{id:e,title:s.title,rating:t.totalRating/t.count,reviewCount:t.count,price:s.price}:null}).filter(e=>null!==e).sort((e,t)=>t.rating!==e.rating?t.rating-e.rating:t.reviewCount-e.reviewCount).slice(0,3);k(f);const p=Array.from(j.entries()).map(([e,t])=>{const s=d.find(t=>t.id===e);return s?{id:e,title:s.title,rating:t.totalRating/t.count,reviewCount:t.count,price:s.price}:null}).filter(e=>null!==e).sort((e,t)=>e.rating!==t.rating?e.rating-t.rating:t.reviewCount-e.reviewCount).slice(0,3);L(p);const v=new Date,N=new Date(v.getTime()-2592e6),w=[],y=Math.max(...m.map(e=>e.totalPrice||0),1);for(let a=0;4>a;a++){const e=new Date(N);e.setDate(e.getDate()+7*a);const t=new Date(e);t.setDate(t.getDate()+7);const s=m.filter(s=>{const i=new Date(s.createdAt);return i>=e&&t>i}).reduce((e,t)=>e+(t.totalPrice||0),0),i=.1*s,n=y>0?s/y*100:0;w.push({week:"Week "+(a+1),revenue:i,percentage:Math.min(n,100)})}S(w);const b=m.filter(e=>{const t=new Date(e.createdAt),s=(v.getTime()-t.getTime())/864e5;return 30>=s&&s>15}).length,D=m.filter(e=>{const t=new Date(e.createdAt);return 15>=(v.getTime()-t.getTime())/864e5}).length,T=b>0?(D-b)/b*100:0,C=d.filter(e=>{const t=new Date(e.createdAt),s=(v.getTime()-t.getTime())/864e5;return 30>=s&&s>15}).length,A=d.filter(e=>{const t=new Date(e.createdAt);return 15>=(v.getTime()-t.getTime())/864e5}).length,B=C>0?(A-C)/C*100:0;R({totalUsers:e.size,totalHosts:r,totalGuests:l,totalListings:t.size,totalBookings:s.size,totalRevenue:h,avgRating:g}),P(B),H(T)}catch(e){}finally{b(!1)}},z=e=>{const t=0>e?"":"+",i=0>e?"text-red-600":"text-green-600",a=0>e?j:p;return s.jsxs("div",{className:`flex items-center text-xs ${i} mt-1`,children:[s.jsx(a,{className:"h-3 w-3 mr-1"}),t,e.toFixed(1),"% from last period"]})};return y?s.jsx("div",{className:"min-h-screen bg-background p-6 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Loading analytics..."})]})}):s.jsx("div",{className:"min-h-screen bg-background p-6",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs(n,{variant:"ghost",onClick:()=>v("/admin/dashboard"),className:"mb-6",children:[s.jsx(h,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Platform Analytics"}),s.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[s.jsxs(r,{children:[s.jsx(l,{children:s.jsx(d,{className:"text-sm text-muted-foreground",children:"Total Users"})}),s.jsxs(c,{children:[s.jsx("div",{className:"text-3xl font-bold",children:D.totalUsers}),s.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[D.totalHosts," hosts, ",D.totalGuests," guests"]})]})]}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsx(d,{className:"text-sm text-muted-foreground",children:"Total Listings"})}),s.jsxs(c,{children:[s.jsx("div",{className:"text-3xl font-bold",children:D.totalListings}),z(B)]})]}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsx(d,{className:"text-sm text-muted-foreground",children:"Total Bookings"})}),s.jsxs(c,{children:[s.jsx("div",{className:"text-3xl font-bold",children:D.totalBookings}),z(F)]})]}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsx(d,{className:"text-sm text-muted-foreground",children:"Service Fees"})}),s.jsxs(c,{children:[s.jsx("div",{className:"text-3xl font-bold text-accent",children:o(D.totalRevenue)}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"10% commission"})]})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsxs(r,{children:[s.jsxs(l,{children:[s.jsx(d,{children:"Top Rated Listings"}),s.jsx(m,{children:"Highest performing listings"})]}),s.jsx(c,{children:0===T.length?s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(g,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"No reviews yet"})]}):s.jsx("div",{className:"space-y-4",children:T.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.title}),s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[s.jsx(g,{className:"h-3 w-3 fill-yellow-400 text-yellow-400 mr-1"}),e.rating.toFixed(1)," (",e.reviewCount," reviews)"]})]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[o(e.price),"/night"]})]},e.id))})})]}),s.jsxs(r,{children:[s.jsxs(l,{children:[s.jsx(d,{children:"Lowest Rated Listings"}),s.jsx(m,{children:"Listings needing attention"})]}),s.jsx(c,{children:0===C.length?s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(j,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"No reviews yet"})]}):s.jsx("div",{className:"space-y-4",children:C.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.title}),s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[s.jsx(g,{className:"h-3 w-3 fill-yellow-400 text-yellow-400 mr-1"}),e.rating.toFixed(1)," (",e.reviewCount," reviews)"]})]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[o(e.price),"/night"]})]},e.id))})})]}),s.jsxs(r,{children:[s.jsxs(l,{children:[s.jsx(d,{children:"Revenue Trends"}),s.jsx(m,{children:"Last 30 days performance"})]}),s.jsx(c,{children:0===A.length?s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(f,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"No revenue data yet"})]}):s.jsx("div",{className:"space-y-4",children:A.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm",children:e.week}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-32 bg-muted rounded-full h-2",children:s.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:e.percentage+"%"}})}),s.jsx("span",{className:"text-sm font-medium",children:o(e.revenue)})]})]},t))})})]})]})]})})};export{v as default};
