import{j as e,u as s,r as t}from"./react-vendor-DAkY0NgE.js";import{C as a,a as i,b as r,d as n,B as d,u as o,j as c,E as l,i as m,e as x,n as p}from"./index-BbvEjZj9.js";import{f as u,e as j,u as h}from"./firebase-vendor-CvoiOdvz.js";import{I as f}from"./input-C1fDyqub.js";import{u as N,a0 as g,A as w,q as v,r as y,a1 as b}from"./icons-vendor-3zhgXMYa.js";import{C as R}from"./CouponManager-CSpoLfS1.js";import"./maps-vendor-CYGXCXz5.js";import"./utils-vendor-yBsXXcRr.js";import"./ui-vendor-CZx_xpmK.js";import"./badge-Bdu_tSqo.js";const C=({points:s,onRedeem:t})=>e.jsxs(a,{children:[e.jsx(i,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-yellow-500"}),"Points & Rewards"]})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-primary/10 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:s}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Points"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Available Rewards:"}),[{points:100,reward:"$10 discount",discount:10},{points:250,reward:"$30 discount",discount:30},{points:500,reward:"$75 discount",discount:75},{points:1e3,reward:"$200 discount",discount:200}].map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:a.reward}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.points," points"]})]})]}),e.jsx(d,{size:"sm",disabled:s<a.points,onClick:()=>t?.(a.points),children:"Redeem"})]},a.points))]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"font-semibold mb-1",children:"How to earn points:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Complete a booking: +50 points"}),e.jsx("li",{children:"• Write a review: +20 points"}),e.jsx("li",{children:"• Refer a friend: +100 points"}),e.jsx("li",{children:"• Host a property: +30 points per booking"})]})]})]})]}),D=()=>{const N=s(),{user:g}=o(),[D,S]=t.useState(0),[$,k]=t.useState(0),[A,E]=t.useState([]),[B,W]=t.useState([]),[I,H]=t.useState(""),[P,T]=t.useState(!1);t.useEffect(()=>{g&&(q(),z())},[g]);const q=async()=>{if(!g)return;const e=await u(j(c,"users",g.uid));e.exists()&&(S(e.data().walletBalance||0),k(e.data().points||0),E(e.data().coupons||[]))},z=async()=>{if(!g)return;const e=await l(g.uid);W(e)};return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(d,{variant:"ghost",onClick:()=>N("/guest/dashboard"),className:"mb-6",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"E-Wallet & Rewards"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(a,{children:[e.jsx(i,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Current Balance"]})}),e.jsxs(n,{children:[e.jsx("p",{className:"text-4xl font-bold text-primary mb-6",children:m(D)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"number",placeholder:"Amount",value:I,onChange:e=>H(e.target.value)}),e.jsx(d,{onClick:async()=>{if(g&&I&&+I>0){T(!0);try{const e=D+ +I;await h(j(c,"users",g.uid),{walletBalance:e}),await p({userId:g.uid,type:"deposit",amount:+I,description:"Wallet deposit"}),S(e),H(""),z(),x.success("Deposit successful!")}catch(e){x.error("Deposit failed")}finally{T(!1)}}else x.error("Enter a valid amount")},disabled:P,children:"Deposit"})]})]})]}),e.jsx(C,{points:$,onRedeem:async e=>{if(g)if(e>$)x.error("Not enough points");else try{const s=100===e?10:250===e?30:500===e?75:200,t={id:"REWARD"+Date.now(),code:"REWARD"+Date.now(),discount:s/D*100,validUntil:new Date(Date.now()+2592e6).toISOString(),used:!1},a=$-e;await h(j(c,"users",g.uid),{points:a,coupons:[...A,t]}),k(a),E([...A,t]),x.success(`Redeemed ${e} points for ${m(s)} coupon!`)}catch(s){x.error("Failed to redeem points")}}})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsx(R,{coupons:A,onApplyCoupon:e=>{const s=A.find(s=>s.code===e&&!s.used);s?x.success(`Coupon ${e} applied! ${s.discount}% discount`):x.error("Invalid or already used coupon")}}),e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(r,{children:"Transaction History"})}),e.jsx(n,{children:0===B.length?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No transactions yet"}):e.jsx("div",{className:"space-y-3",children:B.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:["deposit"===s.type||"reward"===s.type?e.jsx(y,{className:"h-5 w-5 text-green-500"}):e.jsx(b,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.description}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]})]}),e.jsxs("p",{className:"font-semibold "+("deposit"===s.type||"reward"===s.type?"text-green-500":"text-red-500"),children:["deposit"===s.type||"reward"===s.type?"+":"-",m(s.amount)]})]},s.id))})})]})]})]})})};export{D as default};
