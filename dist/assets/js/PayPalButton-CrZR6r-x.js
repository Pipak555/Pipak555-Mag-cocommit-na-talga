const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-F95ZJi6y.js","assets/js/react-vendor-DcULH_Au.js","assets/js/utils-vendor-yBsXXcRr.js","assets/js/maps-vendor-CYGXCXz5.js","assets/maps-vendor-Dgihpmma.css","assets/js/ui-vendor-C9dhA_ey.js","assets/js/icons-vendor-D18eSOBA.js","assets/js/firebase-vendor-BtzXZj7S.js","assets/index-jZhKPZKM.css"])))=>i.map(i=>d[i]);
import{A as e,B as t,i as n,e as a,D as r,_ as o}from"./index-F95ZJi6y.js";import{r as i,R as s,j as c}from"./react-vendor-DcULH_Au.js";import{l as u}from"./icons-vendor-D18eSOBA.js";var d,l,p,f,y,m;(l=d||(d={})).INITIAL="initial",l.PENDING="pending",l.REJECTED="rejected",l.RESOLVED="resolved",(f=p||(p={})).LOADING_STATUS="setLoadingStatus",f.RESET_OPTIONS="resetOptions",f.SET_BRAINTREE_INSTANCE="braintreeInstance",(m=y||(y={})).NUMBER="number",m.CVV="cvv",m.EXPIRATION_DATE="expirationDate",m.EXPIRATION_MONTH="expirationMonth",m.EXPIRATION_YEAR="expirationYear",m.POSTAL_CODE="postalCode";var v=function(){return v=Object.assign||function(e){for(var t,n=1,a=arguments.length;a>n;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},v.apply(this,arguments)};function E(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}function h(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;o>r;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var b="data-react-paypal-script-id",w="react-paypal-js",g="dataSdkIntegrationSource",P="paypal";function S(e){var t=e,n=b;t[n];var a=E(t,[n+""]);return"react-paypal-js-".concat(function(e){for(var t="",n=0;n<e.length;n++){var a=e[n].charCodeAt(0)*n;e[n+1]&&(a+=e[n+1].charCodeAt(0)*(n-1)),t+=String.fromCharCode(97+Math.abs(a)%26)}return t}(JSON.stringify(a)))}function I(e,t){var n,a,r,o;switch(t.type){case p.LOADING_STATUS:return"object"==typeof t.value?v(v({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):v(v({},e),{loadingStatus:t.value});case p.RESET_OPTIONS:return r=e.options[b],(null==(o=self.document.querySelector("script[".concat(b,'="').concat(r,'"]')))?void 0:o.parentNode)&&o.parentNode.removeChild(o),v(v({},e),{loadingStatus:d.PENDING,options:v(v((n={},n[g]=w,n),t.value),(a={},a[b]="".concat(S(t.value)),a))});case p.SET_BRAINTREE_INSTANCE:return v(v({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var N=i.createContext(null);function O(){var e=function(e){if("function"==typeof(null==e?void 0:e.dispatch)&&0!==e.dispatch.length)return e;throw Error("usePayPalScriptReducer must be used within a PayPalScriptProvider")}(i.useContext(N));return[v(v({},e),{isInitial:e.loadingStatus===d.INITIAL,isPending:e.loadingStatus===d.PENDING,isResolved:e.loadingStatus===d.RESOLVED,isRejected:e.loadingStatus===d.REJECTED}),e.dispatch]}i.createContext({});var T=function(e){var t,n,a,r=e.className,o=void 0===r?"":r,c=e.disabled,u=void 0!==c&&c,d=e.children,l=e.forceReRender,p=void 0===l?[]:l,f=E(e,["className","disabled","children","forceReRender"]),y=u?{opacity:.38}:{},m="".concat(o," ").concat(u?"paypal-buttons-disabled":"").trim(),b=i.useRef(null),w=i.useRef(null),g=(n=f,a=i.useRef(new Proxy({},{get:function(e,t,n){return"function"==typeof e[t]?function(){for(var n=[],a=0;arguments.length>a;a++)n[a]=arguments[a];return e[t].apply(e,n)}:Reflect.get(e,t,n)}})),a.current=Object.assign(a.current,n),a.current),S=O()[0],I=S.isResolved,N=S.options,j=i.useState(null),_=j[0],A=j[1],D=i.useState(!0),x=D[0],R=D[1],C=i.useState(null)[1];function L(){null!==w.current&&w.current.close().catch(function(){})}return(null===(t=w.current)||void 0===t?void 0:t.updateProps)&&w.current.updateProps({message:f.message}),i.useEffect(function(){if(!1===I)return L;var e,t=(void 0===(e=N.dataNamespace)&&(e=P),window[e]);if(void 0===t||void 0===t.Buttons)return C(function(){throw Error(function(e){var t=e.reactComponentName,n=e.sdkComponentKey,a=e.sdkRequestedComponents,r=void 0===a?"":a,o=e.sdkDataNamespace,i=void 0===o?P:o,s=n.charAt(0).toUpperCase().concat(n.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(i,".").concat(s," is undefined."),u="string"==typeof r?r:r.join(",");if(!u.includes(n)){var d=[u,n].filter(Boolean).join();c+="\nTo fix the issue, add '".concat(n,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(d,"'}}>`.")}return c}({reactComponentName:T.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:N.components,sdkDataNamespace:N.dataNamespace}))}),L;try{w.current=t.Buttons(v(v({},g),{onInit:function(e,t){A(t),"function"==typeof f.onInit&&f.onInit(e,t)}}))}catch(n){return C(function(){throw Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(n))})}return!1===w.current.isEligible()?(R(!1),L):b.current?(w.current.render(b.current).catch(function(e){null!==b.current&&0!==b.current.children.length&&C(function(){throw Error("Failed to render <PayPalButtons /> component. ".concat(e))})}),L):L},h(h([I],p,!0),[f.fundingSource],!1)),i.useEffect(function(){null!==_&&(!0===u?_.disable().catch(function(){}):_.enable().catch(function(){}))},[u,_]),s.createElement(s.Fragment,null,x?s.createElement("div",{ref:b,style:y,className:m}):d)};function j(e,t){void 0===t&&(t={});var n=document.createElement("script");return n.src=e,Object.keys(t).forEach(function(e){n.setAttribute(e,t[e]),"data-csp-nonce"===e&&n.setAttribute("nonce",t["data-csp-nonce"])}),n}function _(e,t){if(void 0===t&&(t=Promise),D(e,t),"undefined"==typeof document)return t.resolve(null);var n=function(e){var t,n,a=e.sdkBaseUrl,r=e.environment,o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}(e,["sdkBaseUrl","environment"]),i=a||function(e){return"sandbox"===e?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}(r),s=o,c=Object.keys(s).filter(function(e){return void 0!==s[e]&&null!==s[e]&&""!==s[e]}).reduce(function(e,t){var n,a=s[t].toString();return n=function(e,t){return(t?"-":"")+e.toLowerCase()},"data"===(t=t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,n)).substring(0,4)||"crossorigin"===t?e.attributes[t]=a:e.queryParams[t]=a,e},{queryParams:{},attributes:{}}),u=c.queryParams,d=c.attributes;return u["merchant-id"]&&-1!==u["merchant-id"].indexOf(",")&&(d["data-merchant-id"]=u["merchant-id"],u["merchant-id"]="*"),{url:"".concat(i,"?").concat((t=u,n="",Object.keys(t).forEach(function(e){0!==n.length&&(n+="&"),n+=e+"="+t[e]}),n)),attributes:d}}(e),a=n.url,r=n.attributes,o=r["data-namespace"]||"paypal",i=A(o);return r["data-js-sdk-library"]||(r["data-js-sdk-library"]="paypal-js"),function(e,t){var n=document.querySelector('script[src="'.concat(e,'"]'));if(null===n)return null;var a=j(e,t),r=n.cloneNode();if(delete r.dataset.uidAuto,Object.keys(r.dataset).length!==Object.keys(a.dataset).length)return null;var o=!0;return Object.keys(r.dataset).forEach(function(e){r.dataset[e]!==a.dataset[e]&&(o=!1)}),o?n:null}(a,r)&&i?t.resolve(i):function(e,t){void 0===t&&(t=Promise),D(e,t);var n=e.url,a=e.attributes;if("string"!=typeof n||0===n.length)throw Error("Invalid url.");if(void 0!==a&&"object"!=typeof a)throw Error("Expected attributes to be an object.");return new t(function(e,t){if("undefined"==typeof document)return e();!function(e){var t=e.onSuccess,n=e.onError,a=j(e.url,e.attributes);a.onerror=n,a.onload=t,document.head.insertBefore(a,document.head.firstElementChild)}({url:n,attributes:a,onSuccess:function(){return e()},onError:function(){return t(Error('The script "'.concat(n,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.')))}})})}({url:a,attributes:r},t).then(function(){var e=A(o);if(e)return e;throw Error("The window.".concat(o," global variable is not available."))})}function A(e){return window[e]}function D(e,t){if("object"!=typeof e||null===e)throw Error("Expected an options object.");var n=e.environment;if(n&&"production"!==n&&"sandbox"!==n)throw Error('The `environment` option must be either "production" or "sandbox".');if(void 0!==t&&"function"!=typeof t)throw Error("Expected PromisePonyfill to be a function.")}T.displayName="PayPalButtons","function"==typeof SuppressedError&&SuppressedError;var x=function(e){var t,n=e.options,a=void 0===n?{clientId:"test"}:n,r=e.children,o=e.deferLoading,c=void 0!==o&&o,u=i.useReducer(I,{options:v(v({},a),(t={},t.dataJsSdkLibrary=w,t[g]=w,t[b]="".concat(S(a)),t)),loadingStatus:c?d.INITIAL:d.PENDING}),l=u[0],f=u[1];return i.useEffect(function(){if(!1===c&&l.loadingStatus===d.INITIAL)return f({type:p.LOADING_STATUS,value:d.PENDING});if(l.loadingStatus===d.PENDING){var e=!0;return _(l.options).then(function(){e&&f({type:p.LOADING_STATUS,value:d.RESOLVED})}).catch(function(t){e&&f({type:p.LOADING_STATUS,value:{state:d.REJECTED,message:t+""}})}),function(){e=!1}}},[l.options,c,l.loadingStatus]),s.createElement(N.Provider,{value:v(v({},l),{dispatch:f})},r)};function R(){}i.createContext({cardFieldsForm:null,fields:{},registerField:R,unregisterField:R});const C=({amount:t,userId:n,description:s,onSuccess:u,bookingId:d,redirectUrl:l})=>{const[{isPending:p,isResolved:f,isRejected:y}]=O(),[m,v]=i.useState(!1);return i.useEffect(()=>{const e=setTimeout(()=>{!f||"undefined"!=typeof window&&window.paypal?.Buttons||v(!0)},2e3);return()=>clearTimeout(e)},[f]),p&&!m?c.jsx("div",{className:"w-full h-10 bg-muted animate-pulse rounded"}):y||m||f&&("undefined"==typeof window||!window.paypal?.Buttons)?c.jsx(k,{amount:t,userId:n,description:s,onSuccess:u}):f?c.jsx(T,{createOrder:(n,a)=>a.order.create({purchase_units:[{amount:{value:t.toFixed(2),currency_code:e},description:s}],application_context:{return_url:l||window.location.origin+"/payment/success",cancel_url:l||window.location.origin+"/payment/cancel"}}),onApprove:async(e,i)=>{try{const e=await i.order.capture(),c=s.toLowerCase().includes("wallet deposit"),l=c?"deposit":"payment";if(await r({userId:n,type:l,amount:t,description:`PayPal ${l}: ${s}`,status:"completed",paymentMethod:"paypal",paymentId:e.id,bookingId:d}),c){const{doc:e,updateDoc:a,getDoc:r}=await o(async()=>{const{doc:e,updateDoc:t,getDoc:n}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,updateDoc:t,getDoc:n}},[]),{db:i}=await o(async()=>{const{db:e}=await import("./index-F95ZJi6y.js").then(e=>e.Q);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await r(e(i,"users",n));if(s.exists()){const r={walletBalance:(s.data().walletBalance||0)+t};s.data().paypalEmailVerified||(r.paypalEmailVerified=!0,r.paypalVerifiedAt=(new Date).toISOString()),await a(e(i,"users",n),r)}}else{const{doc:e,updateDoc:t,getDoc:a}=await o(async()=>{const{doc:e,updateDoc:t,getDoc:n}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,updateDoc:t,getDoc:n}},[]),{db:r}=await o(async()=>{const{db:e}=await import("./index-F95ZJi6y.js").then(e=>e.Q);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await a(e(r,"users",n));i.exists()&&!i.data().paypalEmailVerified&&await t(e(r,"users",n),{paypalEmailVerified:!0,paypalVerifiedAt:(new Date).toISOString()})}a.success("Payment successful!"),u()}catch(c){a.error("Payment failed"),await r({userId:n,type:"payment",amount:t,description:"PayPal payment (failed): "+s,status:"failed",paymentMethod:"paypal",bookingId:d})}},onError:e=>{a.error("Payment error occurred")},style:{layout:"vertical"}}):c.jsx("div",{className:"w-full h-10 bg-muted animate-pulse rounded"})},L=t=>c.jsx(x,{options:{clientId:"EBY2ts8baThwt97plOoNWxeryVxWHXEe-ANWAexRZ7zq1sfq-qIa90XNhC5JExAaFGTvrF_TT2hqwzj0",currency:e,intent:"capture",components:"buttons","data-sdk-integration-source":"button-factory","data-namespace":"paypal_sdk"},deferLoading:!1,children:c.jsx(C,{...t})}),k=({amount:e,userId:s,description:d,onSuccess:l})=>{const[p,f]=i.useState(!1);return c.jsxs("div",{className:"space-y-2",children:[c.jsxs(t,{onClick:async()=>{f(!0);try{await new Promise(e=>setTimeout(e,2e3));const t=d.toLowerCase().includes("wallet deposit"),n=t?"deposit":"payment";if(await r({userId:s,type:n,amount:e,description:`PayPal ${n} (SIMULATED - NO REAL MONEY): ${d}`,status:"completed",paymentMethod:"paypal"}),t){const{doc:t,updateDoc:n,getDoc:a}=await o(async()=>{const{doc:e,updateDoc:t,getDoc:n}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,updateDoc:t,getDoc:n}},[]),{db:r}=await o(async()=>{const{db:e}=await import("./index-F95ZJi6y.js").then(e=>e.Q);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await a(t(r,"users",s));if(i.exists()){const a=(i.data().walletBalance||0)+e;await n(t(r,"users",s),{walletBalance:a})}}a.success("Payment successful! (SIMULATION - NO REAL MONEY)"),l()}catch(t){a.error("Payment failed")}finally{f(!1)}},disabled:p,className:"w-full bg-[#0070ba] hover:bg-[#003087]",children:[c.jsx(u,{className:"h-4 w-4 mr-2"}),p?"Processing...":`Pay ${n(e)} with PayPal (SIMULATION)`]}),c.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"⚠️ Simulation Mode - No real money will be charged"})]})};export{L as P};
