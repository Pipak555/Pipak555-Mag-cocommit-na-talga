var e={};const t=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);128>r?t[n++]=r:2048>r?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++s)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,o=i?e[r+1]:0,a=r+2<e.length,c=a?e[r+2]:0,u=t>>2,h=(3&t)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),s.push(n[u],n[h],n[l],n[d])}return s.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const r=e[n++];if(128>r)t[s++]=String.fromCharCode(r);else if(r>191&&224>r){const i=e[n++];t[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&365>r){const i=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(i>>10)),t[s++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const a=i<e.length?n[e.charAt(i)]:64;++i;const c=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==a||null==c)throw new s;const u=t<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e<this.ENCODED_VALS_BASE.length||(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(e){return function(e){const s=t(e);return n.encodeByteArray(s,!0)}(e).replace(/\./g,"")},i=function(e){try{return n.decodeString(e,!0)}catch(t){}return null},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t=e.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(t){return}},a=e=>o()?.emulatorHosts?.[e],c=e=>{const t=a(e);if(!t)return;const n=t.lastIndexOf(":");if(0>=n||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]},u=()=>o()?.config,h=e=>o()?.["_"+e];class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function d(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function f(e){return(await fetch(e,{credentials:"include"})).ok}function p(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:"https://securetoken.google.com/"+n,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}const m={};let g=!1;function y(e,t){if("undefined"==typeof window||"undefined"==typeof document||!d(window.location.host)||m[e]===t||m[e]||g)return;function n(e){return"__firebase__banner__"+e}m[e]=t;const s="__firebase__banner",r=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(m))m[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(s),t=n("text"),i=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{g=!0,function(){const e=document.getElementById(s);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,i,a,n),document.body.appendChild(t)}r?(i.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class w extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(E,(e,n)=>{const s=t[n];return null!=s?s+"":`<${n}?>`})}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new w(s,o,n)}}const E=/\{\$([^}]+)}/g;function T(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const r of n){if(!s.includes(r))return!1;const n=e[r],i=t[r];if(I(n)&&I(i)){if(!T(n,i))return!1}else if(n!==i)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function I(e){return null!==e&&"object"==typeof e}function b(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function C(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,s]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}}),t}function S(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class k{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");s=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===s.next&&(s.next=A),void 0===s.error&&(s.error=A),void 0===s.complete&&(s.complete=A);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(e){}}),this.observers.push(s),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function A(){}function R(e){return e&&e._delegate?e._delegate:e}class N{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const D="[DEFAULT]";class O{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new l;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(n)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:D})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:s});n.resolve(e)}catch(t){}}}}clearInstance(e=D){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=D){return this.instances.has(e)}getOptions(e=D){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&e(r,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===D?void 0:s),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var s;return n||null}normalizeInstanceIdentifier(e=D){return this.component?this.component.multipleInstances?e:D:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class P{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new O(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var L,M;(M=L||(L={}))[M.DEBUG=0]="DEBUG",M[M.VERBOSE=1]="VERBOSE",M[M.INFO=2]="INFO",M[M.WARN=3]="WARN",M[M.ERROR=4]="ERROR",M[M.SILENT=5]="SILENT";const x={debug:L.DEBUG,verbose:L.VERBOSE,info:L.INFO,warn:L.WARN,error:L.ERROR,silent:L.SILENT},U=L.INFO,V={[L.DEBUG]:"log",[L.VERBOSE]:"log",[L.INFO]:"info",[L.WARN]:"warn",[L.ERROR]:"error"},F=(e,t,...n)=>{if(t>=e.logLevel&&((new Date).toISOString(),!V[t]))throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class j{constructor(e){this.name=e,this._logLevel=U,this._logHandler=F,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in L))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?x[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,L.DEBUG,...e),this._logHandler(this,L.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,L.VERBOSE,...e),this._logHandler(this,L.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,L.INFO,...e),this._logHandler(this,L.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,L.WARN,...e),this._logHandler(this,L.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,L.ERROR,...e),this._logHandler(this,L.ERROR,...e)}}let B,q;const z=new WeakMap,$=new WeakMap,H=new WeakMap,G=new WeakMap,K=new WeakMap;let W={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return $.get(e);if("objectStoreNames"===t)return e.objectStoreNames||H.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return X(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Q(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(q||(q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(J(this),e),X(z.get(this))}:function(...e){return X(t.apply(J(this),e))}:function(e,...n){const s=t.call(J(this),e,...n);return H.set(s,e.sort?e.sort():[e]),X(s)}:(e instanceof IDBTransaction&&function(e){if($.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)});$.set(e,t)}(e),n=e,(B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>n instanceof e)?new Proxy(e,W):e);var t,n}function X(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(X(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&z.set(t,e)}).catch(()=>{}),K.set(t,e),t}(e);if(G.has(e))return G.get(e);const t=Q(e);return t!==e&&(G.set(e,t),K.set(t,e)),t}const J=e=>K.get(e),Y=["get","getKey","getAll","getAllKeys","count"],Z=["put","add","delete","clear"],ee=new Map;function te(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ee.get(t))return ee.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=Z.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!Y.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&i.done]))[0]};return ee.set(t,i),i}var ne;ne=W,W={...ne,get:(e,t,n)=>te(e,t)||ne.get(e,t,n),has:(e,t)=>!!te(e,t)||ne.has(e,t)};class se{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const re="@firebase/app",ie="0.14.4",oe=new j("@firebase/app"),ae="@firebase/app-compat",ce="@firebase/analytics-compat",ue="@firebase/analytics",he="@firebase/app-check-compat",le="@firebase/app-check",de="@firebase/auth",fe="@firebase/auth-compat",pe="@firebase/database",me="@firebase/data-connect",ge="@firebase/database-compat",ye="@firebase/functions",ve="@firebase/functions-compat",we="@firebase/installations",_e="@firebase/installations-compat",Ee="@firebase/messaging",Te="@firebase/messaging-compat",Ie="@firebase/performance",be="@firebase/performance-compat",Ce="@firebase/remote-config",Se="@firebase/remote-config-compat",ke="@firebase/storage",Ae="@firebase/storage-compat",Re="@firebase/firestore",Ne="@firebase/ai",De="@firebase/firestore-compat",Oe="firebase",Pe="[DEFAULT]",Le={[re]:"fire-core",[ae]:"fire-core-compat",[ue]:"fire-analytics",[ce]:"fire-analytics-compat",[le]:"fire-app-check",[he]:"fire-app-check-compat",[de]:"fire-auth",[fe]:"fire-auth-compat",[pe]:"fire-rtdb",[me]:"fire-data-connect",[ge]:"fire-rtdb-compat",[ye]:"fire-fn",[ve]:"fire-fn-compat",[we]:"fire-iid",[_e]:"fire-iid-compat",[Ee]:"fire-fcm",[Te]:"fire-fcm-compat",[Ie]:"fire-perf",[be]:"fire-perf-compat",[Ce]:"fire-rc",[Se]:"fire-rc-compat",[ke]:"fire-gcs",[Ae]:"fire-gcs-compat",[Re]:"fire-fst",[De]:"fire-fst-compat",[Ne]:"fire-vertex","fire-js":"fire-js",[Oe]:"fire-js-all"},Me=new Map,xe=new Map,Ue=new Map;function Ve(e,t){try{e.container.addComponent(t)}catch(n){oe.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Fe(e){const t=e.name;if(Ue.has(t))return oe.debug(`There were multiple attempts to register component ${t}.`),!1;Ue.set(t,e);for(const n of Me.values())Ve(n,e);for(const n of xe.values())Ve(n,e);return!0}function je(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Be(e){return null!=e&&void 0!==e.settings}const qe=new _("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ze{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new N("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qe.create("app-deleted",{appName:this._name})}}const $e="12.4.0";function He(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s={name:Pe,automaticDataCollectionEnabled:!0,...t},r=s.name;if("string"!=typeof r||!r)throw qe.create("bad-app-name",{appName:r+""});if(n||(n=u()),!n)throw qe.create("no-options");const i=Me.get(r);if(i){if(T(n,i.options)&&T(s,i.config))return i;throw qe.create("duplicate-app",{appName:r})}const o=new P(r);for(const c of Ue.values())o.addComponent(c);const a=new ze(n,s,o);return Me.set(r,a),a}function Ge(e=Pe){const t=Me.get(e);if(!t&&e===Pe&&u())return He();if(!t)throw qe.create("no-app",{appName:e});return t}function Ke(e,t,n){let s=Le[e]??e;n&&(s+="-"+n);const r=s.match(/\s|\//),i=t.match(/\s|\//);if(r||i){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void oe.warn(e.join(" "))}Fe(new N(s+"-version",()=>({library:s,version:t}),"VERSION"))}const We="firebase-heartbeat-store";let Qe=null;function Xe(){return Qe||(Qe=function(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=X(o);return s&&o.addEventListener("upgradeneeded",e=>{s(X(o.result),e.oldVersion,e.newVersion,X(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(We)}catch(n){}}}).catch(e=>{throw qe.create("idb-open",{originalErrorMessage:e.message})})),Qe}async function Je(e,t){try{const n=(await Xe()).transaction(We,"readwrite"),s=n.objectStore(We);await s.put(t,Ye(e)),await n.done}catch(n){if(n instanceof w)oe.warn(n.message);else{const e=qe.create("idb-set",{originalErrorMessage:n?.message});oe.warn(e.message)}}}function Ye(e){return`${e.name}!${e.options.appId}`}class Ze{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=et();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let s=1;s<e.length;s++)e[s].date<n&&(n=e[s].date,t=s);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){oe.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=et(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let s=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),nt(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),nt(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=r(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return oe.warn(e),""}}}function et(){return(new Date).toISOString().substring(0,10)}class tt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Xe()).transaction(We),n=await t.objectStore(We).get(Ye(e));return await t.done,n}catch(t){if(t instanceof w)oe.warn(t.message);else{const e=qe.create("idb-get",{originalErrorMessage:t?.message});oe.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return Je(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return Je(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function nt(e){return r(JSON.stringify({version:2,heartbeats:e})).length}Fe(new N("platform-logger",e=>new se(e),"PRIVATE")),Fe(new N("heartbeat",e=>new Ze(e),"PRIVATE")),Ke(re,ie,""),Ke(re,ie,"esm2020"),Ke("fire-js","");const st=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},rt=new _("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),it=new j("@firebase/auth");function ot(e,...t){it.logLevel>L.ERROR||it.error(`Auth (${$e}): ${e}`,...t)}function at(e,...t){throw lt(e,...t)}function ct(e,...t){return lt(e,...t)}function ut(e,t,n){const s={...st(),[t]:n};return new _("auth","Firebase",s).create(t,{appName:e.name})}function ht(e){return ut(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function lt(e,...t){if("string"!=typeof e){const n=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(n,...s)}return rt.create(e,...t)}function dt(e,t,...n){if(!e)throw lt(t,...n)}function ft(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ot(t),Error(t)}function pt(e,t){e||ft(t)}function mt(){return"undefined"!=typeof self&&self.location?.href||""}function gt(){return"undefined"!=typeof self&&self.location?.protocol||null}class yt{constructor(e,t){this.shortDelay=e,this.longDelay=t,pt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===gt()||"https:"===gt()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function vt(e,t){pt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class wt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const _t={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Et=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Tt=new yt(3e4,6e4);function It(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function bt(e,t,n,s,r={}){return Ct(e,r,async()=>{let r={},i={};s&&("GET"===t?i=s:r={body:JSON.stringify(s)});const o=b({key:e.config.apiKey,...i}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c={method:t,headers:a,...r};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&d(e.emulatorConfig.host)&&(c.credentials="include"),wt.fetch()(await kt(e,e.config.apiHost,n,o),c)})}async function Ct(e,t,n){e._canInitEmulator=!1;const s={..._t,...t};try{const t=new Rt(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw Nt(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Nt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Nt(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Nt(e,"user-disabled",i);const a=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw ut(e,a,o);at(e,a)}}catch(r){if(r instanceof w)throw r;at(e,"network-request-failed",{message:r+""})}}async function St(e,t,n,s,r={}){const i=await bt(e,t,n,s,r);return"mfaPendingCredential"in i&&at(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function kt(e,t,n,s){const r=`${t}${n}?${s}`,i=e,o=i.config.emulator?vt(e.config,r):`${e.config.apiScheme}://${r}`;return Et.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(o).toString():o}function At(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Rt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(ct(this.auth,"network-request-failed")),Tt.get())})}}function Nt(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=ct(e,t,s);return r.customData._tokenResponse=n,r}function Dt(e){return void 0!==e&&void 0!==e.enterprise}class Ot{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return At(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Pt(e,t){return bt(e,"POST","/v1/accounts:lookup",t)}function Lt(e){if(e)try{const t=new Date(+e);if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Mt(e){return 1e3*+e}function xt(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return ot("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(n);return e?JSON.parse(e):(ot("Failed to decode base64 JWT payload"),null)}catch(r){return ot("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Ut(e){const t=xt(e);return dt(t,"internal-error"),dt(void 0!==t.exp,"internal-error"),dt(void 0!==t.iat,"internal-error"),+t.exp-+t.iat}async function Vt(e,t,n=!1){if(n)return t;try{return await t}catch(s){throw s instanceof w&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(s)&&e.auth.currentUser===e&&await e.auth.signOut(),s}}class Ft{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class jt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Lt(this.lastLoginAt),this.creationTime=Lt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Bt(e){const t=e.auth,n=await e.getIdToken(),s=await Vt(e,Pt(t,{idToken:n}));dt(s?.users.length,t,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const i=r.providerUserInfo?.length?qt(r.providerUserInfo):[],o=(a=e.providerData,c=i,[...a.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var a,c;const u=e.isAnonymous,h=!(e.email&&r.passwordHash||o?.length),l=!!u&&h,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new jt(r.createdAt,r.lastLoginAt),isAnonymous:l};Object.assign(e,d)}function qt(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}class zt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){dt(e.idToken,"internal-error"),dt(void 0!==e.idToken,"internal-error"),dt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?+e.expiresIn:Ut(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){dt(0!==e.length,"internal-error");const t=Ut(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(dt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:r}=await async function(e,t){const n=await Ct(e,{},async()=>{const n=b({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=e.config,i=await kt(e,s,"/v1/token","key="+r),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&d(e.emulatorConfig.host)&&(a.credentials="include"),wt.fetch()(i,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,+r)}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:r}=t,i=new zt;return n&&(dt("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),s&&(dt("string"==typeof s,"internal-error",{appName:e}),i.accessToken=s),r&&(dt("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zt,this.toJSON())}_performRefresh(){return ft("not implemented")}}function $t(e,t){dt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ht{constructor({uid:e,auth:t,stsTokenManager:n,...s}){this.providerId="firebase",this.proactiveRefresh=new Ft(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new jt(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Vt(this,this.stsTokenManager.getToken(this.auth,e));return dt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=R(e),s=await n.getIdToken(t),r=xt(s);dt(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i="object"==typeof r.firebase?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:Lt(Mt(r.auth_time)),issuedAtTime:Lt(Mt(r.iat)),expirationTime:Lt(Mt(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=R(e);await Bt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(dt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ht({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){dt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Bt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Be(this.auth.app))return Promise.reject(ht(this.auth));const e=await this.getIdToken();return await Vt(this,async function(e,t){return bt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,s=t.email??void 0,r=t.phoneNumber??void 0,i=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:l,isAnonymous:d,providerData:f,stsTokenManager:p}=t;dt(h&&p,e,"internal-error");const m=zt.fromJSON(this.name,p);dt("string"==typeof h,e,"internal-error"),$t(n,e.name),$t(s,e.name),dt("boolean"==typeof l,e,"internal-error"),dt("boolean"==typeof d,e,"internal-error"),$t(r,e.name),$t(i,e.name),$t(o,e.name),$t(a,e.name),$t(c,e.name),$t(u,e.name);const g=new Ht({uid:h,auth:e,email:s,emailVerified:l,displayName:n,isAnonymous:d,photoURL:i,phoneNumber:r,tenantId:o,stsTokenManager:m,createdAt:c,lastLoginAt:u});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const s=new zt;s.updateFromServerResponse(t);const r=new Ht({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await Bt(r),r}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];dt(void 0!==s.localId,"internal-error");const r=void 0!==s.providerUserInfo?qt(s.providerUserInfo):[],i=!(s.email&&s.passwordHash||r?.length),o=new zt;o.updateFromIdToken(n);const a=new Ht({uid:s.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new jt(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash||r?.length)};return Object.assign(a,c),a}}const Gt=new Map;function Kt(e){pt(e instanceof Function,"Expected a class definition");let t=Gt.get(e);return t?(pt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Gt.set(e,t),t)}class Wt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Wt.type="NONE";const Qt=Wt;function Xt(e,t,n){return`firebase:${e}:${t}:${n}`}class Jt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:r}=this.auth;this.fullUserKey=Xt(this.userKey,s.apiKey,r),this.fullPersistenceKey=Xt("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Pt(this.auth,{idToken:e}).catch(()=>{});return t?Ht._fromGetAccountInfoResponse(this.auth,t,e):null}return Ht._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Jt(Kt(Qt),e,n);const s=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=s[0]||Kt(Qt);const i=Xt(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(i);if(t){let n;if("string"==typeof t){const s=await Pt(e,{idToken:t}).catch(()=>{});if(!s)break;n=await Ht._fromGetAccountInfoResponse(e,s,t)}else n=Ht._fromJSON(e,t);c!==r&&(o=n),r=c;break}}catch{}const a=s.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(i)}catch{}})),new Jt(r,e,n)):new Jt(r,e,n)}}function Yt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(nn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Zt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(rn(t))return"Blackberry";if(on(t))return"Webos";if(en(t))return"Safari";if((t.includes("chrome/")||tn(t))&&!t.includes("edge/"))return"Chrome";if(sn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function Zt(e=v()){return/firefox\//i.test(e)}function en(e=v()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function tn(e=v()){return/crios\//i.test(e)}function nn(e=v()){return/iemobile/i.test(e)}function sn(e=v()){return/android/i.test(e)}function rn(e=v()){return/blackberry/i.test(e)}function on(e=v()){return/webos/i.test(e)}function an(e=v()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function cn(e=v()){return an(e)||sn(e)||on(e)||rn(e)||/windows phone/i.test(e)||nn(e)}function un(e,t=[]){let n;switch(e){case"Browser":n=Yt(v());break;case"Worker":n=`${Yt(v())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${$e}/${s}`}class hn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,s)=>{try{n(e(t))}catch(r){s(r)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(s){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}class ln{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&"z">=n,n>="A"&&"Z">=n,n>="0"&&"9">=n,this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class dn{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new pn(this),this.idTokenSubscription=new pn(this),this.beforeStateQueue=new hn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Kt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Jt.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Pt(this,{idToken:e}),n=await Ht._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Be(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,i=await this.tryRedirectSignIn(e);t&&t!==r||!i?.user||(n=i.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(r){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return dt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bt(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Be(this.app))return Promise.reject(ht(this));const t=e?R(e):null;return t&&dt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&dt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Be(this.app)?Promise.reject(ht(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Be(this.app)?Promise.reject(ht(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Kt(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return bt(e,"GET","/v2/passwordPolicy",It(e,t))}(this),t=new ln(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new _("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return bt(e,"POST","/v2/accounts:revokeToken",It(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Kt(e)||this._popupRedirectResolver;dt(t,this,"argument-error"),this.redirectPersistenceManager=await Jt.create(this,[Kt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(dt(o,this,"internal-error"),o.then(()=>{i||r(this.currentUser)}),"function"==typeof t){const r=e.addObserver(t,n,s);return()=>{i=!0,r()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return dt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=un(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Be(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){it.logLevel>L.WARN||it.warn(`Auth (${$e}): ${e}`,...t)}("Error while retrieving App Check token: "+e.error),e?.token}}function fn(e){return R(e)}class pn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new k(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return dt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let mn={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gn(e){return mn.loadJS(e)}class yn{constructor(){this.enterprise=new vn}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class vn{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const wn="NO_RECAPTCHA";class _n{constructor(e){this.type="recaptcha-enterprise",this.auth=fn(e)}async verify(e="verify",t=!1){function n(t,n,s){const r=window.grecaptcha;Dt(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(wn)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new yn).execute("siteKey",{action:"verify"}):new Promise((e,s)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{(async function(e){return bt(e,"GET","/v2/recaptchaConfig",It(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}))})(e).then(s=>{if(void 0!==s.recaptchaKey){const n=new Ot(s);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(r=>{if(!t&&Dt(window.grecaptcha))n(r,e,s);else{if("undefined"==typeof window)return void s(Error("RecaptchaVerifier is only supported in browser"));let t=mn.recaptchaEnterpriseScript;0!==t.length&&(t+=r),gn(t).then(()=>{n(r,e,s)}).catch(e=>{s(e)})}}).catch(e=>{s(e)})})}}async function En(e,t,n,s=!1,r=!1){const i=new _n(e);let o;if(r)o=wn;else try{o=await i.verify(n)}catch(c){o=await i.verify(n,!0)}const a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return Object.assign(a,s?{captchaResp:o}:{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Tn(e,t,n,s,r){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await En(e,t,n,"getOobCode"===n);return s(e,r)}return s(e,t).catch(async r=>{if("auth/missing-recaptcha-token"===r.code){const r=await En(e,t,n,"getOobCode"===n);return s(e,r)}return Promise.reject(r)})}function In(e){const t=e.indexOf(":");return 0>t?"":e.substr(0,t+1)}function bn(e){if(!e)return null;const t=+e;return isNaN(t)?null:t}class Cn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ft("not implemented")}_getIdTokenResponse(e){return ft("not implemented")}_linkToIdToken(e,t){return ft("not implemented")}_getReauthenticationResolver(e){return ft("not implemented")}}async function Sn(e,t){return bt(e,"POST","/v1/accounts:signUp",t)}async function kn(e,t){return St(e,"POST","/v1/accounts:signInWithPassword",It(e,t))}async function An(e,t){return bt(e,"POST","/v1/accounts:sendOobCode",It(e,t))}async function Rn(e,t){return An(e,t)}class Nn extends Cn{constructor(e,t,n,s=null){super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Nn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Nn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Tn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",kn);case"emailLink":return async function(e,t){return St(e,"POST","/v1/accounts:signInWithEmailLink",It(e,t))}(e,{email:this._email,oobCode:this._password});default:at(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Tn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Sn);case"emailLink":return async function(e,t){return St(e,"POST","/v1/accounts:signInWithEmailLink",It(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:at(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Dn(e,t){return St(e,"POST","/v1/accounts:signInWithIdp",It(e,t))}class On extends Cn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new On(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):at("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s,...r}=t;if(!n||!s)return null;const i=new On(n,s);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return Dn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Dn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Dn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=b(t)}return e}}class Pn{constructor(e){const t=C(S(e)),n=t.apiKey??null,s=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);dt(n&&s&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=C(S(e)).link,n=t?C(S(t)).deep_link_id:null,s=C(S(e)).deep_link_id;return(s?C(S(s)).link:null)||s||n||t||e}(e);try{return new Pn(t)}catch{return null}}}class Ln{constructor(){this.providerId=Ln.PROVIDER_ID}static credential(e,t){return Nn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Pn.parseLink(t);return dt(n,"argument-error"),Nn._fromEmailAndCode(e,n.code,n.tenantId)}}Ln.PROVIDER_ID="password",Ln.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ln.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Mn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class xn extends Mn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Un extends xn{constructor(){super("facebook.com")}static credential(e){return On._fromParams({providerId:Un.PROVIDER_ID,signInMethod:Un.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Un.credentialFromTaggedObject(e)}static credentialFromError(e){return Un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Un.credential(e.oauthAccessToken)}catch{return null}}}Un.FACEBOOK_SIGN_IN_METHOD="facebook.com",Un.PROVIDER_ID="facebook.com";class Vn extends xn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return On._fromParams({providerId:Vn.PROVIDER_ID,signInMethod:Vn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Vn.credentialFromTaggedObject(e)}static credentialFromError(e){return Vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Vn.credential(t,n)}catch{return null}}}Vn.GOOGLE_SIGN_IN_METHOD="google.com",Vn.PROVIDER_ID="google.com";class Fn extends xn{constructor(){super("github.com")}static credential(e){return On._fromParams({providerId:Fn.PROVIDER_ID,signInMethod:Fn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fn.credentialFromTaggedObject(e)}static credentialFromError(e){return Fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Fn.credential(e.oauthAccessToken)}catch{return null}}}Fn.GITHUB_SIGN_IN_METHOD="github.com",Fn.PROVIDER_ID="github.com";class jn extends xn{constructor(){super("twitter.com")}static credential(e,t){return On._fromParams({providerId:jn.PROVIDER_ID,signInMethod:jn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return jn.credentialFromTaggedObject(e)}static credentialFromError(e){return jn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return jn.credential(t,n)}catch{return null}}}async function Bn(e,t){return St(e,"POST","/v1/accounts:signUp",It(e,t))}jn.TWITTER_SIGN_IN_METHOD="twitter.com",jn.PROVIDER_ID="twitter.com";class qn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,s=!1){const r=await Ht._fromIdTokenResponse(e,n,s),i=zn(n);return new qn({user:r,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=zn(n);return new qn({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function zn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class $n extends w{constructor(e,t,n,s){super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,$n.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new $n(e,t,n,s)}}function Hn(e,t,n,s){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw $n._fromErrorAndOperation(e,n,t,s);throw n})}async function Gn(e,t,n=!1){if(Be(e.app))return Promise.reject(ht(e));const s="signIn",r=await Hn(e,s,t),i=await qn._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(i.user),i}async function Kn(e){const t=fn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Wn(e,t,n){const s=fn(e),r={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&function(e,t,n){dt(n.url?.length>0,e,"invalid-continue-uri"),dt(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),dt(void 0===n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(dt(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(dt(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}(s,r,n),await Tn(s,r,"getOobCode",Rn)}async function Qn(e,t,n){await async function(e,t){return bt(e,"POST","/v1/accounts:resetPassword",It(e,t))}(R(e),{oobCode:t,newPassword:n}).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Kn(e),t})}async function Xn(e,t){await async function(e,t){return bt(e,"POST","/v1/accounts:update",It(e,t))}(R(e),{oobCode:t})}async function Jn(e,t,n){if(Be(e.app))return Promise.reject(ht(e));const s=fn(e),r=Tn(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Bn),i=await r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Kn(e),t}),o=await qn._fromIdTokenResponse(s,"signIn",i);return await s._updateCurrentUser(o.user),o}function Yn(e,t,n){return Be(e.app)?Promise.reject(ht(e)):async function(e,t){return Gn(fn(e),t)}(R(e),Ln.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Kn(e),t})}async function Zn(e,t){const n=R(e),s={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()},{email:r}=await async function(e,t){return An(e,t)}(n.auth,s);r!==e.email&&await e.reload()}function es(e,t,n,s){return R(e).onAuthStateChanged(t,n,s)}function ts(e){return R(e).signOut()}const ns="__sak";class ss{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ns,"1"),this.storage.removeItem(ns),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rs extends ss{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=cn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);!function(){const e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||r===e.newValue||e.newValue===e.oldValue?s():setTimeout(s,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rs.type="LOCAL";const is=rs;class os extends ss{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}os.type="SESSION";const as=os;class cs{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new cs(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:r}=t.data,i=this.handlersMap[s];if(!i?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const o=Array.from(i).map(async e=>e(t.origin,r)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function us(e="",t=10){let n="";for(let s=0;t>s;s++)n+=Math.floor(10*Math.random());return e+n}cs.receivers=[];class hs{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");let r,i;return new Promise((o,a)=>{const c=us("",20);s.port1.start();const u=setTimeout(()=>{a(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(u),clearTimeout(r),a(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function ls(){return window}function ds(){return void 0!==ls().WorkerGlobalScope&&"function"==typeof ls().importScripts}const fs="firebaseLocalStorageDb",ps="firebaseLocalStorage",ms="fbase_key";class gs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ys(e,t){return e.transaction([ps],t?"readwrite":"readonly").objectStore(ps)}function vs(){const e=indexedDB.open(fs,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ps,{keyPath:ms})}catch(s){n(s)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ps)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(fs);return new gs(e).toPromise()}(),t(await vs()))})})}async function ws(e,t,n){const s=ys(e,!0).put({[ms]:t,value:n});return new gs(s).toPromise()}function _s(e,t){const n=ys(e,!0).delete(t);return new gs(n).toPromise()}class Es{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await vs()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ds()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=cs._getInstance(ds()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new hs(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await vs();return await ws(e,ns,"1"),await _s(e,ns),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ws(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=ys(e,!1).get(t),s=await new gs(n).toPromise();return void 0===s?null:s.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>_s(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=ys(e,!1).getAll();return new gs(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:s,value:r}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Es.type="LOCAL";const Ts=Es;function Is(e,t){return t?Kt(t):(dt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}new yt(3e4,6e4);class bs extends Cn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Dn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Dn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Dn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Cs(e){return Gn(e.auth,new bs(e),e.bypassAuthState)}function Ss(e){const{auth:t,user:n}=e;return dt(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if(Be(s.app))return Promise.reject(ht(s));const r="reauthenticate";try{const i=await Vt(e,Hn(s,r,t,e),n);dt(i.idToken,s,"internal-error");const o=xt(i.idToken);dt(o,s,"internal-error");const{sub:a}=o;return dt(e.uid===a,s,"user-mismatch"),qn._forOperation(e,r,i)}catch(i){throw"auth/user-not-found"===i?.code&&at(s,"user-mismatch"),i}}(n,new bs(e),e.bypassAuthState)}async function ks(e){const{auth:t,user:n}=e;return dt(n,t,"internal-error"),async function(e,t,n=!1){const s=await Vt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return qn._forOperation(e,"link",s)}(n,new bs(e),e.bypassAuthState)}class As{constructor(e,t,n,s,r=!1){this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:r,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Cs;case"linkViaPopup":case"linkViaRedirect":return ks;case"reauthViaPopup":case"reauthViaRedirect":return Ss;default:at(this.auth,"internal-error")}}resolve(e){pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Rs=new yt(2e3,1e4);async function Ns(e,t,n){if(Be(e.app))return Promise.reject(ct(e,"operation-not-supported-in-this-environment"));const s=fn(e);!function(e,t){if(!(t instanceof Mn))throw Mn.name!==t.constructor.name&&at(e,"argument-error"),ut(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t);const r=Is(s,n);return new Ds(s,"signInViaPopup",t,r).executeNotNull()}class Ds extends As{constructor(e,t,n,s,r){super(e,t,s,r),this.provider=n,this.authWindow=null,this.pollId=null,Ds.currentPopupAction&&Ds.currentPopupAction.cancel(),Ds.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return dt(e,this.auth,"internal-error"),e}async onExecution(){pt(1===this.filter.length,"Popup operations only handle one event");const e=us();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ct(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ct(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ds.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ct(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Rs.get())};e()}}Ds.currentPopupAction=null;const Os=new Map;class Ps extends As{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Os.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Xt("pendingRedirect",e.config.apiKey,e.name)}(t),s=function(e){return Kt(e._redirectPersistence)}(e);if(!(await s._isAvailable()))return!1;const r="true"===await s._get(n);return await s._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Os.set(this.auth._key(),e)}return this.bypassAuthState||Os.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ls(e,t){Os.set(e._key(),t)}async function Ms(e,t,n=!1){if(Be(e.app))return Promise.reject(ht(e));const s=fn(e),r=Is(s,t),i=new Ps(s,r,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,t)),o}class xs{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Vs(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ct(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5>Date.now()-this.lastProcessedEventTime||this.cachedEventUids.clear(),this.cachedEventUids.has(Us(e))}saveEventToCache(e){this.cachedEventUids.add(Us(e)),this.lastProcessedEventTime=Date.now()}}function Us(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Vs({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}const Fs=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,js=/^https?/;function Bs(e){const t=mt(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===s?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===s}if(!js.test(n))return!1;if(Fs.test(e))return s===e;const r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const qs=new yt(3e4,6e4);function zs(){const e=ls().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let $s=null;const Hs=new yt(5e3,15e3),Gs={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ks=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ws(e){const t=e.config;dt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?vt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:$e},r=Ks.get(e.config.apiHost);r&&(s.eid=r);const i=e._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${b(s).slice(1)}`}async function Qs(e){const t=await function(e){return $s=$s||function(e){return new Promise((t,n)=>{function s(){zs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{zs(),n(ct(e,"network-request-failed"))},timeout:qs.get()})}if(ls().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!ls().gapi?.load){const t="__iframefcb"+Math.floor(1e6*Math.random());return ls()[t]=()=>{gapi.load?s():n(ct(e,"network-request-failed"))},gn(`${mn.gapiScript}?onload=${t}`).catch(e=>n(e))}s()}}).catch(e=>{throw $s=null,e})}(e),$s}(e),n=ls().gapi;return dt(n,e,"internal-error"),t.open({where:document.body,url:Ws(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Gs,dontclear:!0},t=>new Promise(async(n,s)=>{await t.restyle({setHideOnLeave:!1});const r=ct(e,"network-request-failed"),i=ls().setTimeout(()=>{s(r)},Hs.get());function o(){ls().clearTimeout(i),n(t)}t.ping(o).then(o,()=>{s(r)})}))}const Xs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Js{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Ys=encodeURIComponent("fac");async function Zs(e,t,n,s,r,i){dt(e.config.authDomain,e,"auth-domain-config-required"),dt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:$e,eventId:r};if(t instanceof Mn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof xn){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const h of Object.keys(a))void 0===a[h]&&delete a[h];const c=await e._getAppCheckToken(),u=c?`#${Ys}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?vt(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${b(a).slice(1)}${u}`}const er="webStorageSupport",tr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=as,this._completeRedirectFn=Ms,this._overrideRedirectResult=Ls}async _openPopup(e,t,n,s){return pt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()"),function(e,t,n,s=500,r=600){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const c={...Xs,width:s.toString(),height:r.toString(),top:i,left:o},u=v().toLowerCase();n&&(a=tn(u)?"_blank":n),Zt(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=v()){return an(e)&&!!window.navigator?.standalone}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}(t||"",a),new Js(null);const l=window.open(t||"",a,h);dt(l,e,"popup-blocked");try{l.focus()}catch(d){}return new Js(l)}(e,await Zs(e,t,n,mt(),s),us())}async _openRedirect(e,t,n,s){return await this._originValidation(e),r=await Zs(e,t,n,mt(),s),ls().location.href=r,new Promise(()=>{});var r}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(pt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Qs(e),n=new xs(e);return t.register("authEvent",t=>(dt(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(er,{type:er},n=>{const s=n?.[0]?.[er];void 0!==s&&t(!!s),at(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return bt(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(Bs(n))return}catch{}at(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return cn()||en()||an()}};var nr="@firebase/auth",sr="1.11.0";class rr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){dt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ir=h("authIdTokenMaxAge")||300;let or=null;function ar(e=Ge()){const t=je(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=je(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(T(n.getOptions(),t??{}))return e;at(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:tr,persistence:[Ts,is,as]}),s=h("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>ir)return;const s=t?.token;or!==s&&(or=s,await fetch(r,{method:s?"POST":"DELETE",headers:s?{Authorization:"Bearer "+s}:{}}))});!function(e,t,n){R(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e){R(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(n)}}var r;const i=a("auth");return i&&function(e,t){const n=fn(e);dt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const s=In(t),{host:r,port:i}=function(e){const t=In(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const e=r[1];return{host:e,port:bn(s.substr(e.length+1))}}{const[e,t]=s.split(":");return{host:e,port:bn(t)}}}(t),o=null===i?"":":"+i,a={url:`${s}//${r}${o}/`},c=Object.freeze({host:r,port:i,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator)return dt(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void dt(T(a,n.config.emulator)&&T(c,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=a,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,d(r)?(f(`${s}//${r}${o}`),y("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,"http://"+i),n}var cr;mn={loadJS:e=>new Promise((t,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{const t=ct("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},cr="Browser",Fe(new N("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;dt(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:i,authDomain:o,clientPlatform:cr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:un(cr)},c=new dn(n,s,r,a);return function(e,t){const n=t?.persistence||[],s=(Array.isArray(n)?n:[n]).map(Kt);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Fe(new N("auth-internal",e=>{const t=fn(e.getProvider("auth").getImmediate());return new rr(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ke(nr,sr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(cr)),Ke(nr,sr,"esm2020");var ur,hr,lr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const s=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)s[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];let i,o=e.g[3];i=t+(o^n&(r^o))+s[0]+3614090360&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[1]+3905402710&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[2]+606105819&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[3]+3250441966&4294967295,i=t+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[4]+4118548399&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[5]+1200080426&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[6]+2821735955&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[7]+4249261313&4294967295,i=t+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[8]+1770035416&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[9]+2336552879&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[10]+4294925233&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[11]+2304563134&4294967295,i=t+(o^(n=r+(i<<22&4294967295|i>>>10))&(r^o))+s[12]+1804603682&4294967295,i=o+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[13]+4254626195&4294967295,o=t+(i<<12&4294967295|i>>>20),i=r+(n^o&(t^n))+s[14]+2792965006&4294967295,i=n+(t^(r=o+(i<<17&4294967295|i>>>15))&(o^t))+s[15]+1236535329&4294967295,i=t+(r^o&((n=r+(i<<22&4294967295|i>>>10))^r))+s[1]+4129170786&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[6]+3225465664&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[11]+643717713&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[0]+3921069994&4294967295,i=t+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[5]+3593408605&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[10]+38016083&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[15]+3634488961&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[4]+3889429448&4294967295,i=t+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[9]+568446438&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[14]+3275163606&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[3]+4107603335&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[8]+1163531501&4294967295,i=t+(r^o&((n=r+(i<<20&4294967295|i>>>12))^r))+s[13]+2850285829&4294967295,i=o+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[2]+4243563512&4294967295,o=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(o^t))+s[7]+1735328473&4294967295,i=n+(o^t&((r=o+(i<<14&4294967295|i>>>18))^o))+s[12]+2368359562&4294967295,i=t+((n=r+(i<<20&4294967295|i>>>12))^r^o)+s[5]+4294588738&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[8]+2272392833&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[11]+1839030562&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[14]+4259657740&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[1]+2763975236&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[4]+1272893353&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[7]+4139469664&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[10]+3200236656&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[13]+681279174&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[0]+3936430074&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[3]+3572445317&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[6]+76029189&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^o)+s[9]+3654602809&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[12]+3873151461&4294967295,o=t+(i<<11&4294967295|i>>>21),i=r+(o^t^n)+s[15]+530742520&4294967295,i=n+((r=o+(i<<16&4294967295|i>>>16))^o^t)+s[2]+3299628645&4294967295,i=t+(r^((n=r+(i<<23&4294967295|i>>>9))|~o))+s[0]+4096336452&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[7]+1126891415&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[14]+2878612391&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[5]+4237533241&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[12]+1700485571&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[3]+2399980690&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[10]+4293915773&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[1]+2240044497&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[8]+1873313359&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[15]+4264355552&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[6]+2734768916&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[13]+1309151649&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~o))+s[4]+4149444226&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[11]+3174756917&4294967295,o=t+(i<<10&4294967295|i>>>22),i=r+(t^(o|~n))+s[2]+718787259&4294967295,i=n+(o^((r=o+(i<<15&4294967295|i>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+o&4294967295}function s(e,t){this.h=t;const n=[];let s=!0;for(let r=e.length-1;r>=0;r--){const i=0|e[r];s&&i==t||(n[r]=i,s=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,s){for(var r=Array(arguments.length-2),i=2;arguments.length>i;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const s=t-this.blockSize,r=this.C;let i=this.h,o=0;for(;t>o;){if(0==i)for(;s>=o;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;t>o;)if(r[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,r),i=0;break}}else for(;t>o;)if(r[i++]=e[o++],i==this.blockSize){n(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;4>n;++n)for(let s=0;32>s;s+=8)e[t++]=this.g[n]>>>s&255;return e};var r={};function i(e){return e>=-128&&128>e?function(e){var t=r;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new s([0|e],0>e?-1:0)}(e)}(e):new s([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));const t=[];let n=1;for(let s=0;e>=n;s++)t[s]=e/n|0,n*=4294967296;return new s(t,0)}var a=i(0),c=i(1),u=i(16777216);function h(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function l(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let s=0;t>s;s++)n[s]=~e.g[s];return new s(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(h(t))throw Error("division by zero");if(h(e))return new m(a,a);if(l(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(l(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(e.g.length>30){if(l(e)||l(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,s=t;0>=s.l(e);)n=y(n),s=y(s);var r=v(n,1),i=v(s,1);for(s=v(s,2),n=v(n,2);!h(s);){var u=i.add(s);0>=u.l(e)&&(r=r.add(n),i=u),s=v(s,1),n=v(n,1)}return t=f(e,r.j(t)),new m(r,t)}for(r=a;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),s=(s=Math.ceil(Math.log(n)/Math.LN2))>48?Math.pow(2,s-48):1,u=(i=o(n)).j(t);l(u)||u.l(e)>0;)u=(i=o(n-=s)).j(t);h(i)&&(i=c),r=r.add(i),e=f(e,u)}return new m(r,e)}function y(e){const t=e.g.length+1,n=[];for(let s=0;t>s;s++)n[s]=e.i(s)<<1|e.i(s-1)>>>31;return new s(n,e.h)}function v(e,t){const n=t>>5;t%=32;const r=e.g.length-n,i=[];for(let s=0;r>s;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(l(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const s=this.i(n);e+=(0>s?4294967296+s:s)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||e>36)throw Error("radix out of range: "+e);if(h(this))return"0";if(l(this))return"-"+d(this).toString(e);const t=o(Math.pow(e,6));var n=this;let s="";for(;;){const r=g(n,t).g;let i=(((n=f(n,r.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(h(n=r))return i+s;for(;6>i.length;)i="0"+i;s=i+s}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return l(e=f(this,e))?-1:h(e)?0:1},e.abs=function(){return l(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let r=0;for(let s=0;t>=s;s++){let t=r+(65535&this.i(s))+(65535&e.i(s)),i=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=i>>>16,t&=65535,i&=65535,n[s]=i<<16|t}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(h(this)||h(e))return a;if(l(this))return l(e)?d(this).j(d(e)):d(d(this).j(e));if(l(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return o(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var r=0;2*t>r;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){const s=this.i(r)>>>16,i=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=i*a,p(n,2*r+2*t),n[2*r+2*t+1]+=s*a,p(n,2*r+2*t+1),n[2*r+2*t+1]+=i*o,p(n,2*r+2*t+1),n[2*r+2*t+2]+=s*o,p(n,2*r+2*t+2)}for(e=0;t>e;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;2*t>e;e++)n[e]=0;return new s(n,0)},e.B=function(e){return g(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;t>s;s++)n[s]=this.i(s)&e.i(s);return new s(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;t>s;s++)n[s]=this.i(s)|e.i(s);return new s(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;t>s;s++)n[s]=this.i(s)^e.i(s);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,hr=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=o,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const s=o(Math.pow(n,8));let r=a;for(let a=0;a<t.length;a+=8){var i=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+i),n);8>i?(i=o(Math.pow(n,i)),r=r.j(i).add(o(e))):(r=r.j(s),r=r.add(o(e)))}return r},ur=s}).apply(void 0!==lr?lr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var dr,fr,pr,mr,gr,yr,vr,wr,_r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof _r&&_r];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(e,s){if(s)e:{var r=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in r))break e;r=r[o]}(s=s(i=r[e=e[e.length-1]]))!=i&&null!=s&&t(r,e,{configurable:!0,writable:!0,value:s})}}s("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var r=r||{},i=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,s){for(var r=Array(arguments.length-2),i=2;arguments.length>i;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}var l="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let s=0;t>s;s++)n[s]=e[s];return n}return[]}function f(e,t){for(let s=1;arguments.length>s;s++){const t=arguments[s];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const s=t.length||0;e.length=n+s;for(let r=0;s>r;r++)e[n+r]=t[r]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function m(){var e=_;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,w=!1,_=new class{constructor(){this.h=this.g=null}add(e,t){const n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},E=()=>{const e=Promise.resolve(void 0);v=()=>{e.then(T)}};function T(){for(var e;e=m();){try{e.h.call(e.g)}catch(n){p(n)}var t=g;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}w=!1}function I(){this.u=this.u,this.C=this.C}function b(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},b.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function S(e){return/^[\s\xa0]*$/.test(e)}function k(e,t){b.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}h(k,b),k.prototype.init=function(e,t){const n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&k.Z.h.call(this)},k.prototype.h=function(){k.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var A="closure_listenable_"+(1e6*Math.random()|0),R=0;function N(e,t,n,s,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.ha=r,this.key=++R,this.da=this.fa=!1}function D(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function O(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function P(e){const t={};for(const n in e)t[n]=e[n];return t}const L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(e,t){let n,s;for(let r=1;arguments.length>r;r++){for(n in s=arguments[r],s)e[n]=s[n];for(let t=0;t<L.length;t++)n=L[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function x(e){this.src=e,this.g={},this.h=0}function U(e,t){const n=t.type;if(n in e.g){var s,r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0);(s=i>=0)&&Array.prototype.splice.call(r,i,1),s&&(D(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function V(e,t,n,s){for(let r=0;r<e.length;++r){const i=e[r];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==s)return r}return-1}x.prototype.add=function(e,t,n,s,r){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const o=V(e,t,s,r);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new N(t,this.src,i,!!s,r)).fa=n,e.push(t)),t};var F="closure_lm_"+(1e6*Math.random()|0),j={};function B(e,t,n,s,r){if(Array.isArray(t)){for(let i=0;i<t.length;i++)B(e,t[i],n,s,r);return null}return n=W(n),e&&e[A]?e.J(t,n,!!o(s)&&!!s.capture,r):function(e,t,n,s,r,i){if(!t)throw Error("Invalid event type");const a=o(r)?!!r.capture:!!r;let c=G(e);if(c||(e[F]=c=new x(e)),(n=c.add(t,n,s,a,i)).proxy)return n;if(s=function(){const e=H;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)C||(r=a),void 0===r&&(r=!1),e.addEventListener(t.toString(),s,r);else if(e.attachEvent)e.attachEvent($(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}(e,t,n,!1,s,r)}function q(e,t,n,s,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)q(e,t[i],n,s,r);else s=o(s)?!!s.capture:!!s,n=W(n),e&&e[A]?(i=t+"")in(e=e.i).g&&(n=V(t=e.g[i],n,s,r))>-1&&(D(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--)):e&&(e=G(e))&&(t=e.g[t.toString()],e=-1,t&&(e=V(t,n,s,r)),(n=e>-1?t[e]:null)&&z(n))}function z(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[A])U(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent($(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=G(t))?(U(n,e),0==n.h&&(n.src=null,t[F]=null)):D(e)}}}function $(e){return e in j?j[e]:j[e]="on"+e}function H(e,t){if(e.da)e=!0;else{t=new k(t,this);const n=e.listener,s=e.ha||e.src;e.fa&&z(e),e=n.call(s,t)}return e}function G(e){return(e=e[F])instanceof x?e:null}var K="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[K]||(e[K]=function(t){return e.handleEvent(t)}),e[K])}function Q(){I.call(this),this.i=new x(this),this.M=this,this.G=null}function X(e,t){var n,s=e.G;if(s)for(n=[];s;s=s.G)n.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new b(t,e);else if(t instanceof b)t.target=t.target||e;else{var r=t;M(t=new b(s,e),r)}let i,o;if(r=!0,n)for(o=n.length-1;o>=0;o--)i=t.g=n[o],r=J(i,s,!0,t)&&r;if(i=t.g=e,r=J(i,s,!0,t)&&r,r=J(i,s,!1,t)&&r,n)for(o=0;o<n.length;o++)i=t.g=n[o],r=J(i,s,!1,t)&&r}function J(e,t,n,s){if(!(t=e.i.g[t+""]))return!0;t=t.concat();let r=!0;for(let i=0;i<t.length;++i){const o=t[i];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&U(e.i,o),r=!1!==t.call(n,s)&&r}}return r&&!s.defaultPrevented}function Y(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return+t>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,Y(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(Q,I),Q.prototype[A]=!0,Q.prototype.removeEventListener=function(e,t,n,s){q(this,e,t,n,s)},Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)D(n[e]);delete e.g[t],e.h--}}this.G=null},Q.prototype.J=function(e,t,n,s){return this.i.add(e+"",t,!1,n,s)},Q.prototype.K=function(e,t,n,s){return this.i.add(e+"",t,!0,n,s)};class Z extends I{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:Y(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){I.call(this),this.h=e,this.g={}}h(ee,I);var te=[];function ne(e){O(e.g,function(e,t){this.g.hasOwnProperty(t)&&z(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),ne(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var se=i.JSON.stringify,re=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function oe(){}function ae(){}var ce={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ue(){b.call(this,"d")}function he(){b.call(this,"c")}h(ue,b),h(he,b);var le={},de=null;function fe(){return de=de||new Q}function pe(e){b.call(this,le.Ia,e)}function me(e){const t=fe();X(t,new pe(t))}function ge(e,t){b.call(this,le.STAT_EVENT,e),this.stat=t}function ye(e){const t=fe();X(t,new ge(t,e))}function ve(e,t){b.call(this,le.Ja,e),this.size=t}function we(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function _e(){this.g=!0}function Ee(e,t,n,s){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(n.length>=2){var s=n[1];if(Array.isArray(s)&&s.length>=1){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let e=1;e<s.length;e++)s[e]=""}}}return se(i)}catch(i){return t}}(e,n)+(s?" "+s:"")})}le.Ia="serverreachability",h(pe,b),le.STAT_EVENT="statevent",h(ge,b),le.Ja="timingevent",h(ve,b),_e.prototype.ua=function(){this.g=!1},_e.prototype.info=function(){};var Te,Ie={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},be={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ce(){}function Se(e){return encodeURIComponent(e+"")}function ke(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ae(e,t,n,s){this.j=e,this.i=t,this.l=n,this.S=s||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}h(Ce,oe),Ce.prototype.g=function(){return new XMLHttpRequest},Te=new Ce;var Ne={},De={};function Oe(e,t,n){e.M=1,e.A=st(Ye(t)),e.u=n,e.R=!0,Pe(e,null)}function Pe(e,t){e.F=Date.now(),xe(e),e.B=Ye(e.A);var n=e.B,s=e.S;Array.isArray(s)||(s=[s+""]),yt(n.i,"t",s),e.C=0,n=e.j.L,e.h=new Re,e.g=sn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new Z(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,s=e.ba;var r="readystatechange";Array.isArray(r)||(r&&(te[0]=r.toString()),r=te);for(let i=0;i<r.length;i++){const e=B(n,r[i],s||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?P(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),me(),function(e,t,n,s,r,i){e.info(function(){if(e.g)if(i){var o="",a=i.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=2>t.length||"type"!=t[1]?o+(e+"=redacted&"):o+(e+"=")+c+"&"}}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Le(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Me(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?De:(n=+t.substring(n,s),isNaN(n)?Ne:(s+=1)+n>t.length?De:(t=t.slice(s,s+n),e.C=s+n,t))}function xe(e){e.T=Date.now()+e.H,Ue(e,e.H)}function Ue(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=we(c(e.aa,e),t)}function Ve(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Fe(e){0==e.j.I||e.K||Yt(e.j,e)}function je(e){Ve(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ne(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Be(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Ge(n.h,e)))if(!e.L&&Ge(n.h,e)&&3==n.I){try{var s=n.Ba.g.parse(t)}catch(h){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!n.v){if(n.g){if(n.g.F+3e3>=e.F)break e;Jt(n),Bt(n)}Wt(n),ye(18)}}else n.xa=r[1],n.xa-n.K>0&&37500>r[2]&&n.F&&0==n.A&&!n.C&&(n.C=we(c(n.Va,n),6e3));1>=He(n.h)&&n.ta&&(n.ta=void 0)}else en(n,11)}else if((e.L||n.g==e)&&Jt(n),!S(t))for(r=n.Ba.g.parse(t),t=0;t<r.length;t++){let c=r[t];const h=c[0];if(h>n.K)if(n.K=h,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const r=c[4];null!=r&&(n.za=r,n.j.info("SVER="+n.za));const h=c[5];null!=h&&"number"==typeof h&&h>0&&(s=1.5*h,n.O=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=s.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ke(i,i.h),i.h=null))}if(s.G){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.wa=e,nt(s.J,s.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((s=n).na=nn(s,s.L?s.ba:null,s.W),o.L){We(s.h,o);var a=o,u=s.O;u&&(a.H=u),a.D&&(Ve(a),xe(a)),s.g=o}else Kt(s);n.i.length>0&&zt(n)}else"stop"!=c[0]&&"close"!=c[0]||en(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?en(n,7):jt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}me()}catch(h){}}Ae.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==xt(e)?t.j():this.Y(e)},Ae.prototype.Y=function(e){try{if(e==this.g)e:{const c=xt(this.g),u=this.g.ya();if(this.g.ca(),c>=3&&(3!=c||this.g&&(this.h.h||this.g.la()||Ut(this.g)))){this.K||4!=c||7==u||me(),Ve(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Le(e))return e.g.la();const t=Ut(e.g);if(""===t)return"";let n="";const s=t.length,r=4==xt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return je(e),Fe(e),"";e.h.i=new i.TextDecoder}for(let i=0;s>i;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(r&&i==s-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,s,r,i,o){e.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var s,r=this.g;if((s=r.g?r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(s)){var o=s;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,ye(12),je(this),Fe(this);break e}Ee(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Be(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Me(this,n),t==De){4==c&&(this.m=4,ye(14),e=!1),Ee(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ne){this.m=4,ye(15),Ee(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Ee(this.i,this.l,t,null),Be(this,t)}if(Le(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,ye(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qt(a),a.P=!0,ye(11))}}else Ee(this.i,this.l,n,"[Invalid Chunked Response]"),je(this),Fe(this)}else Ee(this.i,this.l,n,null),Be(this,n);4==c&&je(this),this.o&&!this.K&&(4==c?Yt(this.j,this):(this.o=!1,xe(this)))}else(function(e){const t={};e=(e.g&&xt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(S(e[s]))continue;var n=ke(e[s]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[r]||[];t[r]=i,i.push(n)}!function(e,t){for(const n in e)t(e[n])}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,ye(12)):(this.m=0,ye(13)),je(this),Fe(this)}}}catch(c){}},Ae.prototype.cancel=function(){this.K=!0,je(this)},Ae.prototype.aa=function(){this.D=null;const e=Date.now();0>e-this.T?Ue(this,this.T-e):(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(me(),ye(17)),je(this),this.m=2,Fe(this))};var qe=class{constructor(e,t){this.g=e,this.map=t}};function ze(e){this.l=e||10,e=i.PerformanceNavigationTiming?(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $e(e){return!!e.h||!!e.g&&e.g.size>=e.j}function He(e){return e.h?1:e.g?e.g.size:0}function Ge(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ke(e,t){e.g?e.g.add(t):e.h=t}function We(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Qe(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}ze.prototype.cancel=function(){if(this.i=Qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Xe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Je(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Je?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,vt(e.i)),this.m=e.m):e&&(t=(e+"").match(Xe))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=rt(t[2]||""),this.g=rt(t[3]||"",!0),et(this,t[4]),this.h=rt(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=rt(t[7]||"")):(this.l=!1,this.i=new dt(null,this.l))}function Ye(e){return new Je(e)}function Ze(e,t,n){e.j=n?rt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(isNaN(t=+t)||0>t)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,n){t instanceof dt?(e.i=t,function(e,t){t&&!e.j&&(ft(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(pt(this,t),yt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=it(t,ht)),e.i=new dt(t,e.l))}function nt(e,t,n){e.i.set(t,n)}function st(e){return nt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function rt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ot),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ot(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Je.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,at,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,at,!0),"@"),e.push(Se(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",n+"")),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(it(n,"/"==n.charAt(0)?ut:ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",it(n,lt)),e.join("")},Je.prototype.resolve=function(e){const t=Ye(this);let n=!!e.j;n?Ze(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var s=e.h;if(n)et(t,e.u);else if(n=!!e.h){if("/"!=s.charAt(0))if(this.g&&!this.h)s="/"+s;else{var r=t.h.lastIndexOf("/");-1!=r&&(s=t.h.slice(0,r+1)+s)}if(".."==(r=s)||"."==r)s="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){s=0==r.lastIndexOf("/",0),r=r.split("/");const e=[];for(let t=0;t<r.length;){const n=r[t++];"."==n?s&&t==r.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),s&&t==r.length&&e.push("")):(e.push(n),s=!0)}s=e.join("/")}else s=r}return n?t.h=s:n=""!==e.i.toString(),n?tt(t,vt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var at=/[#\/\?@]/g,ct=/[#\?:]/g,ut=/[#\?]/g,ht=/[#\?@]/g,lt=/#/g;function dt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ft(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const s=e[n].indexOf("=");let r,i=null;0>s?r=e[n]:(r=e[n].substring(0,s),i=e[n].substring(s+1)),t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function pt(e,t){ft(e),t=wt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function mt(e,t){return ft(e),t=wt(e,t),e.g.has(t)}function gt(e,t){ft(e);let n=[];if("string"==typeof t)mt(e,t)&&(n=n.concat(e.g.get(wt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function yt(e,t,n){pt(e,t),n.length>0&&(e.i=null,e.g.set(wt(e,t),d(n)),e.h+=n.length)}function vt(e){const t=new dt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function wt(e,t){return t+="",e.j&&(t=t.toLowerCase()),t}function _t(e,t,n,s,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),s(n)}catch(i){}}function Et(){this.g=new ie}function Tt(e){this.i=e.Sb||null,this.h=e.ab||!1}function It(e,t){Q.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function bt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Ct(e){e.readyState=4,e.l=null,e.j=null,e.B=null,St(e)}function St(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function kt(e){let t="";return O(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function At(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=kt(n),"string"==typeof e?null!=n&&Se(n):nt(e,t,n))}function Rt(e){Q.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=dt.prototype).add=function(e,t){ft(this),this.i=null,e=wt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){ft(this),this.g.forEach(function(n,s){n.forEach(function(n){e.call(t,n,s,this)},this)},this)},e.set=function(e,t){return ft(this),this.i=null,mt(this,e=wt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=gt(this,e)).length>0?e[0]+"":t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let s=0;s<t.length;s++){var n=t[s];const r=Se(n);n=gt(this,n);for(let t=0;t<n.length;t++){let s=r;""!==n[t]&&(s+="="+Se(n[t])),e.push(s)}}return this.i=e.join("&")},h(Tt,oe),Tt.prototype.g=function(){return new It(this.i,this.h)},h(It,Q),(e=It.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,St(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ct(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,St(this)),this.g&&(this.readyState=3,St(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;bt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ct(this):St(this),3==this.readyState&&bt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Ct(this))},e.Na=function(e){this.g&&(this.response=e,Ct(this))},e.ga=function(){this.g&&Ct(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(It.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Rt,Q);var Nt=/^https?$/i,Dt=["POST","PUT"];function Ot(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Pt(e),Mt(e)}function Pt(e){e.A||(e.A=!0,X(e,"complete"),X(e,"error"))}function Lt(e){if(e.h&&void 0!==r)if(e.v&&4==xt(e))setTimeout(e.Ca.bind(e),0);else if(X(e,"readystatechange"),4==xt(e)){e.h=!1;try{const r=e.ca();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){let t=(e.D+"").match(Xe)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),s=!Nt.test(t?t.toLowerCase():"")}n=s}if(n)X(e,"complete"),X(e,"success");else{e.o=6;try{var o=xt(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Pt(e)}}finally{Mt(e)}}}function Mt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const s=e.g;e.g=null,t||X(e,"ready");try{s.onreadystatechange=null}catch(n){}}}function xt(e){return e.g?e.g.readyState:0}function Ut(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Vt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ft(e){this.za=0,this.i=[],this.j=new _e,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Vt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Vt("baseRetryDelayMs",5e3,e),this.Za=Vt("retryDelaySeedMs",1e4,e),this.Ta=Vt("forwardChannelMaxRetries",2,e),this.va=Vt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new ze(e&&e.concurrentRequestLimit),this.Ba=new Et,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function jt(e){if(qt(e),3==e.I){var t=e.V++,n=Ye(e.J);if(nt(n,"SID",e.M),nt(n,"RID",t),nt(n,"TYPE","terminate"),Ht(e,n),(t=new Ae(e,e.j,t)).M=2,t.A=st(Ye(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(s){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=sn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),xe(t)}tn(e)}function Bt(e){e.g&&(Qt(e),e.g.cancel(),e.g=null)}function qt(e){Bt(e),e.v&&(i.clearTimeout(e.v),e.v=null),Jt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function zt(e){if(!$e(e.h)&&!e.m){e.m=!0;var t=e.Ea;v||E(),w||(v(),w=!0),_.add(t,e),e.D=0}}function $t(e,t){var n;n=t?t.l:e.V++;const s=Ye(e.J);nt(s,"SID",e.M),nt(s,"RID",n),nt(s,"AID",e.K),Ht(e,s),e.u&&e.o&&At(s,e.u,e.o),n=new Ae(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Gt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ke(e.h,n),Oe(n,s,t)}function Ht(e,t){e.H&&O(e.H,function(e,n){nt(t,n,e)}),e.l&&O({},function(e,n){nt(t,n,e)})}function Gt(e,t,n){n=Math.min(e.i.length,n);const s=e.l?c(e.l.Ka,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let h=0;n>h;h++){var i=r[h].g;const n=r[h].map;if(0>(i-=t))t=Math.max(0,r[h].g-100),c=!1;else try{i="req"+i+"_"||"";try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let s=n;o(n)&&(s=se(n)),e.push(i+t+"="+encodeURIComponent(s))}}catch(u){throw e.push(i+"type="+encodeURIComponent("_badmap")),u}}catch(u){s&&s(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function Kt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;v||E(),w||(v(),w=!0),_.add(t,e),e.A=0}}function Wt(e){return!e.g&&!e.v&&3>e.A&&(e.Y++,e.v=we(c(e.Da,e),Zt(e,e.A)),e.A++,!0)}function Qt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Xt(e){e.g=new Ae(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Ye(e.na);nt(t,"RID","rpc"),nt(t,"SID",e.M),nt(t,"AID",e.K),nt(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&nt(t,"TO",e.ia),nt(t,"TYPE","xmlhttp"),Ht(e,t),e.u&&e.o&&At(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=st(Ye(t)),n.u=null,n.R=!0,Pe(n,e)}function Jt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Yt(e,t){var n=null;if(e.g==t){Jt(e),Qt(e),e.g=null;var s=2}else{if(!Ge(e.h,t))return;n=t.G,We(e.h,t),s=1}if(0!=e.I)if(t.o)if(1==s){n=t.u?t.u.length:0,t=Date.now()-t.F;var r=e.D;X(s=fe(),new ve(s,n)),zt(e)}else Kt(e);else if(3==(r=t.m)||0==r&&t.X>0||!(1==s&&function(e,t){return He(e.h)<e.h.j-(e.m?1:0)&&(e.m?(e.i=t.G.concat(e.i),!0):1!=e.I&&2!=e.I&&e.D<(e.Sa?0:e.Ta)&&(e.m=we(c(e.Ea,e,t),Zt(e,e.D)),e.D++,!0))}(e,t)||2==s&&Wt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),r){case 1:en(e,5);break;case 4:en(e,10);break;case 3:en(e,6);break;default:en(e,2)}}function Zt(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function en(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),s=e.Ua;const t=!s;s=new Je(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(s,"https"),st(s),t?function(e,t){const n=new _e;if(i.Image){const s=new Image;s.onload=u(_t,n,"TestLoadImage: loaded",!0,t,s),s.onerror=u(_t,n,"TestLoadImage: error",!1,t,s),s.onabort=u(_t,n,"TestLoadImage: abort",!1,t,s),s.ontimeout=u(_t,n,"TestLoadImage: timeout",!1,t,s),i.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=e}else t(!1)}(s.toString(),n):function(e,t){new _e;const n=new AbortController,s=setTimeout(()=>{n.abort(),_t(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(s),e.ok?_t(0,0,!0,t):_t(0,0,!1,t)}).catch(()=>{clearTimeout(s),_t(0,0,!1,t)})}(s.toString(),n)}else ye(2);e.I=0,e.l&&e.l.pa(t),tn(e),qt(e)}function tn(e){if(e.I=0,e.ja=[],e.l){const t=Qe(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function nn(e,t,n){var s=n instanceof Je?Ye(n):new Je(n);if(""!=s.g)t&&(s.g=t+"."+s.g),et(s,s.u);else{var r=i.location;s=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;const e=new Je(null);s&&Ze(e,s),t&&(e.g=t),r&&et(e,r),n&&(e.h=n),s=e}return n=e.G,t=e.wa,n&&t&&nt(s,n,t),nt(s,"VER",e.ka),Ht(e,s),s}function sn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Rt(new Tt({ab:n})):new Rt(e.ma)).Fa(e.L),t}function rn(){}function on(){}function an(e,t){Q.call(this),this.g=new Ft(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!S(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new hn(this)}function cn(e){ue.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function un(){he.call(this),this.status=1}function hn(e){this.g=e}(e=Rt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Te.g(),this.g.onreadystatechange=l(c(this.Ca,this));try{this.B=!0,this.g.open(t,e+"",!0),this.B=!1}catch(o){return void Ot(this,o)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+s);for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=i.FormData&&e instanceof i.FormData,0>Array.prototype.indexOf.call(Dt,t,void 0)||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){Ot(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,X(this,"complete"),X(this,"abort"),Mt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mt(this,!0)),Rt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Lt(this):this.Xa())},e.Xa=function(){Lt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return xt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),re(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:this.l+""},(e=Ft.prototype).ka=8,e.I=1,e.connect=function(e,t,n,s){ye(0),this.W=e,this.H=t||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.J=nn(this,null,this.W),zt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const r=new Ae(this,this.j,e);let i=this.o;if(this.U&&(i?(i=P(i),M(i,this.U)):i=this.U),null!==this.u||this.R||(r.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if((t+=s)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Gt(this,r,t),nt(n=Ye(this.J),"RID",e),nt(n,"CVER",22),this.G&&nt(n,"X-HTTP-Session-Id",this.G),Ht(this,n),i&&(this.R?t="headers="+Se(kt(i))+"&"+t:this.u&&At(n,this.u,i)),Ke(this.h,r),this.Ra&&nt(n,"TYPE","init"),this.S?(nt(n,"$req",t),nt(n,"SID","null"),r.U=!0,Oe(r,n,null)):Oe(r,n,t),this.I=2}}else 3==this.I&&(e?$t(this,e):0==this.i.length||$e(this.h)||$t(this))},e.Da=function(){if(this.v=null,Xt(this),this.aa&&!this.P&&null!=this.g&&this.T>0){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=we(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ye(10),Bt(this),Xt(this))},e.Va=function(){null!=this.C&&(this.C=null,Bt(this),Wt(this),ye(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),ye(2)):(this.j.info("Failed to ping google.com"),ye(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=rn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},on.prototype.g=function(e,t){return new an(e,t)},h(an,Q),an.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},an.prototype.close=function(){jt(this.g)},an.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=se(e),e=n);t.i.push(new qe(t.Ya++,e)),3==t.I&&zt(t)},an.prototype.N=function(){this.g.l=null,delete this.j,jt(this.g),delete this.g,an.Z.N.call(this)},h(cn,ue),h(un,he),h(hn,rn),hn.prototype.ra=function(){X(this.g,"a")},hn.prototype.qa=function(e){X(this.g,new cn(e))},hn.prototype.pa=function(e){X(this.g,new un)},hn.prototype.oa=function(){X(this.g,"b")},on.prototype.createWebChannel=on.prototype.g,an.prototype.send=an.prototype.o,an.prototype.open=an.prototype.m,an.prototype.close=an.prototype.close,wr=function(){return new on},vr=function(){return fe()},yr=le,gr={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ie.NO_ERROR=0,Ie.TIMEOUT=8,Ie.HTTP_ERROR=6,mr=Ie,be.COMPLETE="complete",pr=be,ae.EventType=ce,ce.OPEN="a",ce.CLOSE="b",ce.ERROR="c",ce.MESSAGE="d",Q.prototype.listen=Q.prototype.J,fr=ae,Rt.prototype.listenOnce=Rt.prototype.K,Rt.prototype.getLastError=Rt.prototype.Ha,Rt.prototype.getLastErrorCode=Rt.prototype.ya,Rt.prototype.getStatus=Rt.prototype.ca,Rt.prototype.getResponseJson=Rt.prototype.La,Rt.prototype.getResponseText=Rt.prototype.la,Rt.prototype.send=Rt.prototype.ea,Rt.prototype.setWithCredentials=Rt.prototype.Fa,dr=Rt}).apply(void 0!==_r?_r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Er="@firebase/firestore",Tr="4.9.2";class Ir{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ir.UNAUTHENTICATED=new Ir(null),Ir.GOOGLE_CREDENTIALS=new Ir("google-credentials-uid"),Ir.FIRST_PARTY=new Ir("first-party-uid"),Ir.MOCK_USER=new Ir("mock-user");let br="12.3.0";const Cr=new j("@firebase/firestore");function Sr(){return Cr.logLevel}function kr(e,...t){if(Cr.logLevel<=L.DEBUG){const n=t.map(Nr);Cr.debug(`Firestore (${br}): ${e}`,...n)}}function Ar(e,...t){if(Cr.logLevel<=L.ERROR){const n=t.map(Nr);Cr.error(`Firestore (${br}): ${e}`,...n)}}function Rr(e,...t){if(Cr.logLevel<=L.WARN){const n=t.map(Nr);Cr.warn(`Firestore (${br}): ${e}`,...n)}}function Nr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Dr(e,t,n){let s="Unexpected state";"string"==typeof t?s=t:n=t,Or(e,s,n)}function Or(e,t,n){let s=`FIRESTORE (${br}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{s+=" CONTEXT: "+JSON.stringify(n)}catch(r){s+=" CONTEXT: "+n}throw Ar(s),Error(s)}function Pr(e,t,n,s){let r="Unexpected state";"string"==typeof n?r=n:s=n,e||Or(t,r,s)}function Lr(e,t){return e}const Mr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xr extends w{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ur{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Vr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class Fr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ir.UNAUTHENTICATED))}shutdown(){}}class jr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Br{constructor(e){this.t=e,this.currentUser=Ir.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Pr(void 0===this.o,42304);let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new Ur;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Ur,e.enqueueRetryable(()=>s(this.currentUser))};const i=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await s(this.currentUser)})},o=e=>{kr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(kr("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Ur)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(kr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Pr("string"==typeof t.accessToken,31837,{l:t}),new Vr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Pr(null===e||"string"==typeof e,2055,{h:e}),new Ir(e)}}class qr{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Ir.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class zr{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new qr(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ir.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class $r{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Hr{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Be(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Pr(void 0===this.o,3512);const n=e=>{null!=e.error&&kr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);const n=e.token!==this.m;return this.m=e.token,kr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const s=e=>{kr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>s(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?s(e):kr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new $r(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Pr("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new $r(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Gr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let s=0;e>s;s++)n[s]=Math.floor(256*Math.random());return n}class Kr{static newId(){let e="";for(;20>e.length;){const t=Gr(40);for(let n=0;n<t.length;++n)20>e.length&&248>t[n]&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(t[n]%62))}return e}}function Wr(e,t){return t>e?-1:e>t?1:0}function Qr(e,t){const n=Math.min(e.length,t.length);for(let s=0;n>s;s++){const n=e.charAt(s),r=t.charAt(s);if(n!==r)return Yr(n)===Yr(r)?Wr(n,r):Yr(n)?1:-1}return Wr(e.length,t.length)}const Xr=55296,Jr=57343;function Yr(e){const t=e.charCodeAt(0);return t>=Xr&&Jr>=t}function Zr(e,t,n){return e.length===t.length&&e.every((e,s)=>n(e,t[s]))}const ei="__name__";class ti{constructor(e,t,n){void 0===t?t=0:t>e.length&&Dr(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&Dr(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ti.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ti?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();n>t;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;n>s;s++){const n=ti.compareSegments(e.get(s),t.get(s));if(0!==n)return n}return Wr(e.length,t.length)}static compareSegments(e,t){const n=ti.isNumericId(e),s=ti.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?ti.extractNumericId(e).compare(ti.extractNumericId(t)):Qr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ur.fromString(e.substring(4,e.length-2))}}class ni extends ti{construct(e,t,n){return new ni(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new xr(Mr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new ni(t)}static emptyPath(){return new ni([])}}const si=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ri extends ti{construct(e,t,n){return new ri(e,t,n)}static isValidIdentifier(e){return si.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ri.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ei}static keyField(){return new ri([ei])}static fromServerFormat(e){const t=[];let n="",s=0;const r=()=>{if(0===n.length)throw new xr(Mr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new xr(Mr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new xr(Mr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(i=!i,s++):"."!==t||i?(n+=t,s++):(r(),s++)}if(r(),i)throw new xr(Mr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ri(t)}static emptyPath(){return new ri([])}}class ii{constructor(e){this.path=e}static fromPath(e){return new ii(ni.fromString(e))}static fromName(e){return new ii(ni.fromString(e).popFirst(5))}static empty(){return new ii(ni.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ni.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ni.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ii(new ni(e.slice()))}}function oi(e,t,n){if(!n)throw new xr(Mr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ai(e,t,n,s){if(!0===t&&!0===s)throw new xr(Mr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function ci(e){if(!ii.isDocumentKey(e))throw new xr(Mr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ui(e){if(ii.isDocumentKey(e))throw new xr(Mr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hi(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function li(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":Dr(12329,{type:typeof e})}function di(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new xr(Mr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=li(e);throw new xr(Mr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function fi(e,t){const n={typeString:e};return t&&(n.value=t),n}function pi(e,t){if(!hi(e))throw new xr(Mr.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in t)if(t[s]){const r=t[s].typeString,i="value"in t[s]?{value:t[s].value}:void 0;if(!(s in e)){n=`JSON missing required field: '${s}'`;break}const o=e[s];if(r&&typeof o!==r){n=`JSON field '${s}' must be a ${r}.`;break}if(void 0!==i&&o!==i.value){n=`Expected '${s}' field to equal '${i.value}'`;break}}if(n)throw new xr(Mr.INVALID_ARGUMENT,n);return!0}const mi=-62135596800,gi=1e6;class yi{static now(){return yi.fromMillis(Date.now())}static fromDate(e){return yi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3);return new yi(t,Math.floor((e-1e3*t)*gi))}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,0>t)throw new xr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xr(Mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(mi>e)throw new xr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xr(Mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/gi}_compareTo(e){return this.seconds===e.seconds?Wr(this.nanoseconds,e.nanoseconds):Wr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:yi._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(pi(e,yi._jsonSchema))return new yi(e.seconds,e.nanoseconds)}valueOf(){return(this.seconds-mi+"").padStart(12,"0")+"."+(this.nanoseconds+"").padStart(9,"0")}}yi._jsonSchemaVersion="firestore/timestamp/1.0",yi._jsonSchema={type:fi("string",yi._jsonSchemaVersion),seconds:fi("number"),nanoseconds:fi("number")};class vi{static fromTimestamp(e){return new vi(e)}static min(){return new vi(new yi(0,0))}static max(){return new vi(new yi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function wi(e){return new _i(e.readTime,e.key,-1)}class _i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new _i(vi.min(),ii.empty(),-1)}static max(){return new _i(vi.max(),ii.empty(),-1)}}function Ei(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ii.comparator(e.documentKey,t.documentKey),0!==n?n:Wr(e.largestBatchId,t.largestBatchId))}class Ti{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Ii(e){if(e.code!==Mr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;kr("LocalStore","Unexpectedly lost primary lease")}class bi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Dr(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new bi((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof bi?t:bi.resolve(t)}catch(t){return bi.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):bi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):bi.reject(t)}static resolve(e){return new bi((t,n)=>{t(e)})}static reject(e){return new bi((t,n)=>{n(e)})}static waitFor(e){return new bi((t,n)=>{let s=0,r=0,i=!1;e.forEach(e=>{++s,e.next(()=>{++r,i&&r===s&&t()},e=>n(e))}),i=!0,r===s&&t()})}static or(e){let t=bi.resolve(!1);for(const n of e)t=t.next(e=>e?bi.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,s)=>{n.push(t.call(this,e,s))}),this.waitFor(n)}static mapArray(e,t){return new bi((n,s)=>{const r=e.length,i=Array(r);let o=0;for(let a=0;r>a;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===r&&n(i)},e=>s(e))}})}static doWhile(e,t){return new bi((n,s)=>{const r=()=>{!0===e()?t().next(()=>{r()},s):n()};r()})}}function Ci(e){return"IndexedDbTransactionError"===e.name}class Si{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}function ki(e){return null==e}function Ai(e){return 0===e&&1/e==-1/0}function Ri(e,t){let n=t;const s=e.length;for(let r=0;s>r;r++){const t=e.charAt(r);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function Ni(e){return e+""}function Di(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Oi(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Pi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}Si.ce=-1;class Li{constructor(e,t){this.comparator=e,this.root=t||xi.EMPTY}insert(e,t){return new Li(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xi.BLACK,null,null))}remove(e){return new Li(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;0>n?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;0>s?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Mi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Mi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Mi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Mi(this.root,e,this.comparator,!0)}}class Mi{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),0>r)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xi{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=null!=n?n:xi.RED,this.left=null!=s?s:xi.EMPTY,this.right=null!=r?r:xi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new xi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const r=n(e,s.key);return s=0>r?s.copy(null,null,null,s.left.insert(e,t,n),null):0===r?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return xi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(0>t(e,s.key))s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return xi.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Dr(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Dr(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Dr(27949);return e+(this.isRed()?0:1)}}xi.EMPTY=null,xi.RED=!0,xi.BLACK=!1,xi.EMPTY=new class{constructor(){this.size=0}get key(){throw Dr(57766)}get value(){throw Dr(16141)}get color(){throw Dr(16727)}get left(){throw Dr(29726)}get right(){throw Dr(36894)}copy(e,t,n,s,r){return this}insert(e,t,n){return new xi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ui{constructor(e){this.comparator=e,this.data=new Li(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vi(this.data.getIterator())}getIteratorFrom(e){return new Vi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ui))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ui(this.comparator);return t.data=e,t}}class Vi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fi{constructor(e){this.fields=e,e.sort(ri.comparator)}static empty(){return new Fi([])}unionWith(e){let t=new Ui(ri.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Fi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Zr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ji extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Bi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new ji("Invalid base64 string: "+t):t}}(e);return new Bi(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Bi(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Wr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Bi.EMPTY_BYTE_STRING=new Bi("");const qi=RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zi(e){if(Pr(!!e,39018),"string"==typeof e){let t=0;const n=qi.exec(e);if(Pr(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=+e}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:$i(e.seconds),nanos:$i(e.nanos)}}function $i(e){return"number"==typeof e?e:"string"==typeof e?+e:0}function Hi(e){return"string"==typeof e?Bi.fromBase64String(e):Bi.fromUint8Array(e)}const Gi="server_timestamp",Ki="__type__",Wi="__previous_value__",Qi="__local_write_time__";function Xi(e){const t=(e?.mapValue?.fields||{})[Ki]?.stringValue;return t===Gi}function Ji(e){const t=e.mapValue.fields[Wi];return Xi(t)?Ji(t):t}function Yi(e){const t=zi(e.mapValue.fields[Qi].timestampValue);return new yi(t.seconds,t.nanos)}class Zi{constructor(e,t,n,s,r,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const eo="(default)";class to{constructor(e,t){this.projectId=e,this.database=t||eo}static empty(){return new to("","")}get isDefaultDatabase(){return this.database===eo}isEqual(e){return e instanceof to&&e.projectId===this.projectId&&e.database===this.database}}const no="__type__",so={},ro="__vector__",io="value";function oo(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Xi(e)?4:function(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}(e)?9007199254740991:function(e){const t=(e?.mapValue?.fields||{})[no]?.stringValue;return t===ro}(e)?10:11:Dr(28295,{value:e})}function ao(e,t){if(e===t)return!0;const n=oo(e);if(n!==oo(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Yi(e).isEqual(Yi(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=zi(e.timestampValue),s=zi(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return s=t,Hi(e.bytesValue).isEqual(Hi(s.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return $i(e.geoPointValue.latitude)===$i(t.geoPointValue.latitude)&&$i(e.geoPointValue.longitude)===$i(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return $i(e.integerValue)===$i(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=$i(e.doubleValue),s=$i(t.doubleValue);return n===s?Ai(n)===Ai(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return Zr(e.arrayValue.values||[],t.arrayValue.values||[],ao);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(Di(n)!==Di(s))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===s[r]||!ao(n[r],s[r])))return!1;return!0}(e,t);default:return Dr(52216,{left:e})}var s}function co(e,t){return void 0!==(e.values||[]).find(e=>ao(e,t))}function uo(e,t){if(e===t)return 0;const n=oo(e),s=oo(t);if(n!==s)return Wr(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Wr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=$i(e.integerValue||e.doubleValue),s=$i(t.integerValue||t.doubleValue);return s>n?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return ho(e.timestampValue,t.timestampValue);case 4:return ho(Yi(e),Yi(t));case 5:return Qr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Hi(e),s=Hi(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let r=0;r<n.length&&r<s.length;r++){const e=Wr(n[r],s[r]);if(0!==e)return e}return Wr(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Wr($i(e.latitude),$i(t.latitude));return 0!==n?n:Wr($i(e.longitude),$i(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return lo(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},s=t.fields||{},r=n[io]?.arrayValue,i=s[io]?.arrayValue,o=Wr(r?.values?.length||0,i?.values?.length||0);return 0!==o?o:lo(r,i)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===so&&t===so)return 0;if(e===so)return 1;if(t===so)return-1;const n=e.fields||{},s=Object.keys(n),r=t.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let o=0;o<s.length&&o<i.length;++o){const e=Qr(s[o],i[o]);if(0!==e)return e;const t=uo(n[s[o]],r[i[o]]);if(0!==t)return t}return Wr(s.length,i.length)}(e.mapValue,t.mapValue);default:throw Dr(23264,{he:n})}}function ho(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Wr(e,t);const n=zi(e),s=zi(t),r=Wr(n.seconds,s.seconds);return 0!==r?r:Wr(n.nanos,s.nanos)}function lo(e,t){const n=e.values||[],s=t.values||[];for(let r=0;r<n.length&&r<s.length;++r){const e=uo(n[r],s[r]);if(e)return e}return Wr(n.length,s.length)}function fo(e){return po(e)}function po(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=zi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Hi(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ii.fromName(t).toString()):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=po(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const r of t)s?s=!1:n+=",",n+=`${r}:${po(e.fields[r])}`;return n+"}"}(e.mapValue):Dr(61005,{value:e});var t}function mo(e){switch(oo(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Ji(e);return t?16+mo(t):16;case 5:return 2*e.stringValue.length;case 6:return Hi(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+mo(t),0);case 10:case 11:return function(e){let t=0;return Oi(e.fields,(e,n)=>{t+=e.length+mo(n)}),t}(e.mapValue);default:throw Dr(13486,{value:e})}}function go(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function yo(e){return!!e&&"integerValue"in e}function vo(e){return!!e&&"arrayValue"in e}function wo(e){return!!e&&"nullValue"in e}function _o(e){return!!e&&"doubleValue"in e&&isNaN(+e.doubleValue)}function Eo(e){return!!e&&"mapValue"in e}function To(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return Oi(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=To(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=To(e.arrayValue.values[n]);return t}return{...e}}class Io{constructor(e){this.value=e}static empty(){return new Io({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Eo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=To(t)}setAll(e){let t=ri.emptyPath(),n={},s=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=r.popLast()}e?n[r.lastSegment()]=To(e):s.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){const t=this.field(e.popLast());Eo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ao(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Eo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Oi(t,(t,n)=>e[t]=n);for(const s of n)delete e[s]}clone(){return new Io(To(this.value))}}function bo(e){const t=[];return Oi(e.fields,(e,n)=>{const s=new ri([e]);if(Eo(n)){const e=bo(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)}),new Fi(t)}class Co{constructor(e,t,n,s,r,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Co(e,0,vi.min(),vi.min(),vi.min(),Io.empty(),0)}static newFoundDocument(e,t,n,s){return new Co(e,1,t,vi.min(),n,s,0)}static newNoDocument(e,t){return new Co(e,2,t,vi.min(),vi.min(),Io.empty(),0)}static newUnknownDocument(e,t){return new Co(e,3,t,vi.min(),vi.min(),Io.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(vi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Io.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Io.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=vi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Co&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Co(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class So{constructor(e,t){this.position=e,this.inclusive=t}}function ko(e,t,n){let s=0;for(let r=0;r<e.position.length;r++){const i=t[r],o=e.position[r];if(s=i.field.isKeyField()?ii.comparator(ii.fromName(o.referenceValue),n.key):uo(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function Ao(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ao(e.position[n],t.position[n]))return!1;return!0}class Ro{constructor(e,t="asc"){this.field=e,this.dir=t}}function No(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Do{}class Oo extends Do{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Fo(e,t,n):"array-contains"===t?new zo(e,n):"in"===t?new $o(e,n):"not-in"===t?new Ho(e,n):"array-contains-any"===t?new Go(e,n):new Oo(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new jo(e,n):new Bo(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(uo(t,this.value)):null!==t&&oo(this.value)===oo(t)&&this.matchesComparison(uo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return 0>e;case"<=":return 0>=e;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Dr(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Po extends Do{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Po(e,t)}matches(e){return Lo(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Lo(e){return"and"===e.op}function Mo(e){return function(e){for(const t of e.filters)if(t instanceof Po)return!1;return!0}(e)&&Lo(e)}function xo(e){if(e instanceof Oo)return e.field.canonicalString()+e.op.toString()+fo(e.value);if(Mo(e))return e.filters.map(e=>xo(e)).join(",");{const t=e.filters.map(e=>xo(e)).join(",");return`${e.op}(${t})`}}function Uo(e,t){return e instanceof Oo?(n=e,(s=t)instanceof Oo&&n.op===s.op&&n.field.isEqual(s.field)&&ao(n.value,s.value)):e instanceof Po?function(e,t){return t instanceof Po&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,s)=>e&&Uo(n,t.filters[s]),!0)}(e,t):void Dr(19439);var n,s}function Vo(e){return e instanceof Oo?`${(t=e).field.canonicalString()} ${t.op} ${fo(t.value)}`:e instanceof Po?function(e){return e.op.toString()+" {"+e.getFilters().map(Vo).join(" ,")+"}"}(e):"Filter";var t}class Fo extends Oo{constructor(e,t,n){super(e,t,n),this.key=ii.fromName(n.referenceValue)}matches(e){const t=ii.comparator(e.key,this.key);return this.matchesComparison(t)}}class jo extends Oo{constructor(e,t){super(e,"in",t),this.keys=qo(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Bo extends Oo{constructor(e,t){super(e,"not-in",t),this.keys=qo(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function qo(e,t){return(t.arrayValue?.values||[]).map(e=>ii.fromName(e.referenceValue))}class zo extends Oo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return vo(t)&&co(t.arrayValue,this.value)}}class $o extends Oo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&co(this.value.arrayValue,t)}}class Ho extends Oo{constructor(e,t){super(e,"not-in",t)}matches(e){if(co(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!co(this.value.arrayValue,t)}}class Go extends Oo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!vo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>co(this.value.arrayValue,e))}}class Ko{constructor(e,t=null,n=[],s=[],r=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.Te=null}}function Wo(e,t=null,n=[],s=[],r=null,i=null,o=null){return new Ko(e,t,n,s,r,i,o)}function Qo(e){const t=Lr(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>xo(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),ki(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>fo(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>fo(e)).join(",")),t.Te=e}return t.Te}function Xo(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!No(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Uo(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ao(e.startAt,t.startAt)&&Ao(e.endAt,t.endAt)}function Jo(e){return ii.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Yo{constructor(e,t=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Zo(e){return new Yo(e)}function ea(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ta(e){return null!==e.collectionGroup}function na(e){const t=Lr(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Ui(ri.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.Ie.push(new Ro(s,n))}),e.has(ri.keyField().canonicalString())||t.Ie.push(new Ro(ri.keyField(),n))}return t.Ie}function sa(e){const t=Lr(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return Wo(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Ro(e.field,t)});const n=e.endAt?new So(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new So(e.startAt.position,e.startAt.inclusive):null;return Wo(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}(t,na(e))),t.Ee}function ra(e,t){const n=e.filters.concat([t]);return new Yo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function ia(e,t,n){return new Yo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function oa(e,t){return Xo(sa(e),sa(t))&&e.limitType===t.limitType}function aa(e){return`${Qo(sa(e))}|lt:${e.limitType}`}function ca(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Vo(e)).join(", ")}]`),ki(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>fo(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>fo(e)).join(",")),`Target(${t})`}(sa(e))}; limitType=${e.limitType})`}function ua(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ii.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of na(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(s=t,!((n=e).startAt&&!function(e,t,n){const s=ko(e,t,n);return e.inclusive?0>=s:0>s}(n.startAt,na(n),s)||n.endAt&&!function(e,t,n){const s=ko(e,t,n);return e.inclusive?s>=0:s>0}(n.endAt,na(n),s)));var n,s}function ha(e){return(t,n)=>{let s=!1;for(const r of na(e)){const e=la(r,t,n);if(0!==e)return e;s=s||r.field.isKeyField()}return 0}}function la(e,t,n){const s=e.field.isKeyField()?ii.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),r=n.data.field(e);return null!==s&&null!==r?uo(s,r):Dr(42886)}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return Dr(19790,{direction:e.dir})}}class da{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,r]of n)if(this.equalsFn(s,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Oi(this.inner,(t,n)=>{for(const[s,r]of n)e(s,r)})}isEmpty(){return Pi(this.inner)}size(){return this.innerSize}}const fa=new Li(ii.comparator);function pa(){return fa}const ma=new Li(ii.comparator);function ga(...e){let t=ma;for(const n of e)t=t.insert(n.key,n);return t}function ya(e){let t=ma;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function va(){return _a()}function wa(){return _a()}function _a(){return new da(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ea=new Li(ii.comparator),Ta=new Ui(ii.comparator);function Ia(...e){let t=Ta;for(const n of e)t=t.add(n);return t}const ba=new Ui(Wr);function Ca(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ai(t)?"-0":t}}function Sa(e){return{integerValue:""+e}}class ka{constructor(){this._=void 0}}function Aa(e,t,n){return e instanceof Da?function(e,t){const n={fields:{[Ki]:{stringValue:Gi},[Qi]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Xi(t)&&(t=Ji(t)),t&&(n.fields[Wi]=t),{mapValue:n}}(n,t):e instanceof Oa?Pa(e,t):e instanceof La?Ma(e,t):function(e,t){const n=Na(e,t),s=Ua(n)+Ua(e.Ae);return yo(n)&&yo(e.Ae)?Sa(s):Ca(e.serializer,s)}(e,t)}function Ra(e,t,n){return e instanceof Oa?Pa(e,t):e instanceof La?Ma(e,t):n}function Na(e,t){return e instanceof xa?yo(n=t)||(s=n)&&"doubleValue"in s?t:{integerValue:0}:null;var n,s}class Da extends ka{}class Oa extends ka{constructor(e){super(),this.elements=e}}function Pa(e,t){const n=Va(t);for(const s of e.elements)n.some(e=>ao(e,s))||n.push(s);return{arrayValue:{values:n}}}class La extends ka{constructor(e){super(),this.elements=e}}function Ma(e,t){let n=Va(t);for(const s of e.elements)n=n.filter(e=>!ao(e,s));return{arrayValue:{values:n}}}class xa extends ka{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ua(e){return $i(e.integerValue||e.doubleValue)}function Va(e){return vo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Fa{constructor(e,t){this.field=e,this.transform=t}}class ja{constructor(e,t){this.version=e,this.transformResults=t}}class Ba{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ba}static exists(e){return new Ba(void 0,e)}static updateTime(e){return new Ba(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function qa(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class za{}function $a(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ec(e.key,Ba.none()):new Qa(e.key,e.data,Ba.none());{const n=e.data,s=Io.empty();let r=new Ui(ri.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),r=r.add(e)}return new Xa(e.key,s,new Fi(r.toArray()),Ba.none())}}function Ha(e,t,n){var s;e instanceof Qa?function(e,t,n){const s=e.value.clone(),r=Ya(e.fieldTransforms,t,n.transformResults);s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Xa?function(e,t,n){if(!qa(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=Ya(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Ja(e)),r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):(s=n,t.convertToNoDocument(s.version).setHasCommittedMutations())}function Ga(e,t,n,s){return e instanceof Qa?function(e,t,n,s){if(!qa(e.precondition,t))return n;const r=e.value.clone(),i=Za(e.fieldTransforms,s,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,s):e instanceof Xa?function(e,t,n,s){if(!qa(e.precondition,t))return n;const r=Za(e.fieldTransforms,s,t),i=t.data;return i.setAll(Ja(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,s):(r=t,i=n,qa(e.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):i);var r,i}function Ka(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),r=Na(s.transform,e||null);null!=r&&(null===n&&(n=Io.empty()),n.set(s.field,r))}return n||null}function Wa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,s=t.fieldTransforms,!!(void 0===n&&void 0===s||n&&s&&Zr(n,s,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,s=t.transform,n instanceof Oa&&s instanceof Oa||n instanceof La&&s instanceof La?Zr(n.elements,s.elements,ao):n instanceof xa&&s instanceof xa?ao(n.Ae,s.Ae):n instanceof Da&&s instanceof Da);var n,s}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,s}class Qa extends za{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Xa extends za{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Ja(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}}),t}function Ya(e,t,n){const s=new Map;Pr(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let r=0;r<n.length;r++){const i=e[r],o=i.transform,a=t.data.field(i.field);s.set(i.field,Ra(o,a,n[r]))}return s}function Za(e,t,n){const s=new Map;for(const r of e){const e=r.transform,i=n.data.field(r.field);s.set(r.field,Aa(e,i,t))}return s}class ec extends za{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class tc extends za{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class nc{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const t=this.mutations[s];t.key.isEqual(e.key)&&Ha(t,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ga(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ga(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=wa();return this.mutations.forEach(s=>{const r=e.get(s.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=t.has(s.key)?null:o;const a=$a(i,o);null!==a&&n.set(s.key,a),i.isValidDocument()||i.convertToNoDocument(vi.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ia())}isEqual(e){return this.batchId===e.batchId&&Zr(this.mutations,e.mutations,(e,t)=>Wa(e,t))&&Zr(this.baseMutations,e.baseMutations,(e,t)=>Wa(e,t))}}class sc{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){Pr(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=function(){return Ea}();const r=e.mutations;for(let i=0;i<r.length;i++)s=s.insert(r[i].key,n[i].version);return new sc(e,t,n,s)}}class rc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ic{constructor(e,t){this.count=e,this.unchangedNames=t}}var oc,ac;function cc(e){if(void 0===e)return Ar("GRPC error has no .code"),Mr.UNKNOWN;switch(e){case oc.OK:return Mr.OK;case oc.CANCELLED:return Mr.CANCELLED;case oc.UNKNOWN:return Mr.UNKNOWN;case oc.DEADLINE_EXCEEDED:return Mr.DEADLINE_EXCEEDED;case oc.RESOURCE_EXHAUSTED:return Mr.RESOURCE_EXHAUSTED;case oc.INTERNAL:return Mr.INTERNAL;case oc.UNAVAILABLE:return Mr.UNAVAILABLE;case oc.UNAUTHENTICATED:return Mr.UNAUTHENTICATED;case oc.INVALID_ARGUMENT:return Mr.INVALID_ARGUMENT;case oc.NOT_FOUND:return Mr.NOT_FOUND;case oc.ALREADY_EXISTS:return Mr.ALREADY_EXISTS;case oc.PERMISSION_DENIED:return Mr.PERMISSION_DENIED;case oc.FAILED_PRECONDITION:return Mr.FAILED_PRECONDITION;case oc.ABORTED:return Mr.ABORTED;case oc.OUT_OF_RANGE:return Mr.OUT_OF_RANGE;case oc.UNIMPLEMENTED:return Mr.UNIMPLEMENTED;case oc.DATA_LOSS:return Mr.DATA_LOSS;default:return Dr(39323,{code:e})}}(ac=oc||(oc={}))[ac.OK=0]="OK",ac[ac.CANCELLED=1]="CANCELLED",ac[ac.UNKNOWN=2]="UNKNOWN",ac[ac.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ac[ac.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ac[ac.NOT_FOUND=5]="NOT_FOUND",ac[ac.ALREADY_EXISTS=6]="ALREADY_EXISTS",ac[ac.PERMISSION_DENIED=7]="PERMISSION_DENIED",ac[ac.UNAUTHENTICATED=16]="UNAUTHENTICATED",ac[ac.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ac[ac.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ac[ac.ABORTED=10]="ABORTED",ac[ac.OUT_OF_RANGE=11]="OUT_OF_RANGE",ac[ac.UNIMPLEMENTED=12]="UNIMPLEMENTED",ac[ac.INTERNAL=13]="INTERNAL",ac[ac.UNAVAILABLE=14]="UNAVAILABLE",ac[ac.DATA_LOSS=15]="DATA_LOSS";const uc=new ur([4294967295,4294967295],0);function hc(e){const t=(new TextEncoder).encode(e),n=new hr;return n.update(t),new Uint8Array(n.digest())}function lc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new ur([n,s],0),new ur([r,i],0)]}class dc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,0>t||t>=8)throw new fc("Invalid padding: "+t);if(0>n)throw new fc("Invalid hash count: "+n);if(e.length>0&&0===this.hashCount)throw new fc("Invalid hash count: "+n);if(0===e.length&&0!==t)throw new fc("Invalid padding when bitmap length is 0: "+t);this.ge=8*e.length-t,this.pe=ur.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(ur.fromNumber(n)));return 1===s.compare(uc)&&(s=new ur([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=hc(e),[n,s]=lc(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,s,r);if(!this.we(e))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new dc(r,s,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=hc(e),[n,s]=lc(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,s,r);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class fc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class pc{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,mc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new pc(vi.min(),s,new Li(Wr),pa(),Ia())}}class mc{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new mc(n,t,Ia(),Ia(),Ia())}}class gc{constructor(e,t,n,s){this.be=e,this.removedTargetIds=t,this.key=n,this.De=s}}class yc{constructor(e,t){this.targetId=e,this.Ce=t}}class vc{constructor(e,t,n=Bi.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class wc{constructor(){this.ve=0,this.Fe=Tc(),this.Me=Bi.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ia(),t=Ia(),n=Ia();return this.Fe.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:Dr(38017,{changeType:r})}}),new mc(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=Tc()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Pr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class _c{constructor(e){this.Ge=e,this.ze=new Map,this.je=pa(),this.Je=Ec(),this.He=Ec(),this.Ye=new Li(Wr)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Dr(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,s=this.ot(t);if(s){const r=s.target;if(Jo(r))if(0===n){const e=new ii(r.path);this.et(t,e,Co.newNoDocument(e,vi.min()))}else Pr(1===n,20013,{expectedCount:n});else{const s=this._t(t);if(s!==n){const n=this.ut(e),r=n?this.ct(n,e,s):1;if(0!==r){this.it(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t;let i,o;try{i=Hi(n).toUint8Array()}catch(a){if(a instanceof ji)return Rr("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new dc(i,s,r)}catch(a){return Rr(a instanceof fc?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let s=0;return n.forEach(n=>{const r=this.Ge.ht(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.et(t,n,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((n,s)=>{const r=this.ot(s);if(r){if(n.current&&Jo(r.target)){const t=new ii(r.target.path);this.It(t).has(s)||this.Et(s,t)||this.et(s,t,Co.newNoDocument(t,e))}n.Be&&(t.set(s,n.ke()),n.qe())}});let n=Ia();this.He.forEach((e,t)=>{let s=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)}),s&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const s=new pc(e,t,this.Ye,this.je,n);return this.je=pa(),this.Je=Ec(),this.He=Ec(),this.Ye=new Li(Wr),s}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new wc,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ui(Wr),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ui(Wr),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||kr("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new wc),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ec(){return new Li(ii.comparator)}function Tc(){return new Li(ii.comparator)}const Ic=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),bc=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),Cc=(()=>({and:"AND",or:"OR"}))();class Sc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function kc(e,t){return e.useProto3Json||ki(t)?t:{value:t}}function Ac(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Rc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Nc(e,t){return Ac(e,t.toTimestamp())}function Dc(e){return Pr(!!e,49232),vi.fromTimestamp(function(e){const t=zi(e);return new yi(t.seconds,t.nanos)}(e))}function Oc(e,t){return Pc(e,t).canonicalString()}function Pc(e,t){const n=(s=e,new ni(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===t?n:n.child(t)}function Lc(e){const t=ni.fromString(e);return Pr(Yc(t),10190,{key:t.toString()}),t}function Mc(e,t){return Oc(e.databaseId,t.path)}function xc(e,t){const n=Lc(t);if(n.get(1)!==e.databaseId.projectId)throw new xr(Mr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new xr(Mr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ii(Fc(n))}function Uc(e,t){return Oc(e.databaseId,t)}function Vc(e){return new ni(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Fc(e){return Pr(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function jc(e,t,n){return{name:Mc(e,t),fields:n.value.mapValue.fields}}function Bc(e,t){return{documents:[Uc(e,t.path)]}}function qc(e,t){const n={structuredQuery:{}},s=t.path;let r;null!==t.collectionGroup?(r=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=Uc(e,r);const i=function(e){if(0!==e.length)return Xc(Po.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>{return{field:Wc((t=e).field),direction:Hc(t.dir)};var t})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=kc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:r};var c}function zc(e){let t=function(e){const t=Lc(e);return 4===t.length?ni.emptyPath():Fc(t)}(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){Pr(1===s,65062);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=$c(e);return t instanceof Po&&Mo(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new Ro(Qc((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,ki(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new So(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new So(n,t)}(n.endAt)),function(e,t,n,s,r,i,o,a){return new Yo(e,t,n,s,r,"F",o,a)}(t,r,o,i,a,0,c,u)}function $c(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Qc(e.unaryFilter.field);return Oo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Qc(e.unaryFilter.field);return Oo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Qc(e.unaryFilter.field);return Oo.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Qc(e.unaryFilter.field);return Oo.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Dr(61313);default:return Dr(60726)}}(e):void 0!==e.fieldFilter?(t=e,Oo.create(Qc(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Dr(58110);default:return Dr(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Po.create(e.compositeFilter.filters.map(e=>$c(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Dr(1026)}}(e.compositeFilter.op))}(e):Dr(30097,{filter:e});var t}function Hc(e){return Ic[e]}function Gc(e){return bc[e]}function Kc(e){return Cc[e]}function Wc(e){return{fieldPath:e.canonicalString()}}function Qc(e){return ri.fromServerFormat(e.fieldPath)}function Xc(e){return e instanceof Oo?function(e){if("=="===e.op){if(_o(e.value))return{unaryFilter:{field:Wc(e.field),op:"IS_NAN"}};if(wo(e.value))return{unaryFilter:{field:Wc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(_o(e.value))return{unaryFilter:{field:Wc(e.field),op:"IS_NOT_NAN"}};if(wo(e.value))return{unaryFilter:{field:Wc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wc(e.field),op:Gc(e.op),value:e.value}}}(e):e instanceof Po?function(e){const t=e.getFilters().map(e=>Xc(e));return 1===t.length?t[0]:{compositeFilter:{op:Kc(e.op),filters:t}}}(e):Dr(54877,{filter:e})}function Jc(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Yc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Zc{constructor(e,t,n,s,r=vi.min(),i=vi.min(),o=Bi.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Zc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Zc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Zc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Zc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class eu{constructor(e){this.yt=e}}function tu(e){const t=zc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ia(t,t.limit,"L"):t}class nu{constructor(){this.Cn=new su}addToCollectionParentIndex(e,t){return this.Cn.add(t),bi.resolve()}getCollectionParents(e,t){return bi.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return bi.resolve()}deleteFieldIndex(e,t){return bi.resolve()}deleteAllFieldIndexes(e){return bi.resolve()}createTargetIndexes(e,t){return bi.resolve()}getDocumentsMatchingTarget(e,t){return bi.resolve(null)}getIndexType(e,t){return bi.resolve(0)}getFieldIndexes(e,t){return bi.resolve([])}getNextCollectionGroupToUpdate(e){return bi.resolve(null)}getMinOffset(e,t){return bi.resolve(_i.min())}getMinOffsetFromCollectionGroup(e,t){return bi.resolve(_i.min())}updateCollectionGroup(e,t,n){return bi.resolve()}updateIndexEntries(e,t){return bi.resolve()}}class su{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Ui(ni.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Ui(ni.comparator)).toArray()}}const ru={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},iu=41943040;class ou{static withCacheSize(e){return new ou(e,ou.DEFAULT_COLLECTION_PERCENTILE,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}ou.DEFAULT_COLLECTION_PERCENTILE=10,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ou.DEFAULT=new ou(iu,ou.DEFAULT_COLLECTION_PERCENTILE,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ou.DISABLED=new ou(-1,0,0);class au{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new au(0)}static cr(){return new au(-1)}}const cu="LruGarbageCollector";function uu([e,t],[n,s]){const r=Wr(e,n);return 0===r?Wr(t,s):r}class hu{constructor(e){this.Ir=e,this.buffer=new Ui(uu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();0>uu(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class lu{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){kr(cu,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ci(e)?kr(cu,"Ignoring IndexedDB error during garbage collection: ",e):await Ii(e)}await this.Vr(3e5)})}}class du{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return bi.resolve(Si.ce);const n=new hu(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(kr("LruGarbageCollector","Garbage collection skipped; disabled"),bi.resolve(ru)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(kr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ru):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,s,r,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(kr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),s=this.params.maximumSequenceNumbersToCollect):s=t,i=Date.now(),this.nthSequenceNumber(e,s))).next(s=>(n=s,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),Sr()>L.DEBUG||kr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${s} in `+(o-i)+`ms\n\tRemoved ${r} targets in `+(a-o)+`ms\n\tRemoved ${e} documents in `+(c-a)+`ms\nTotal Duration: ${c-u}ms`),bi.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:e})))}}class fu{constructor(){this.changes=new da(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Co.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?bi.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class pu{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mu{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Ga(n.mutation,e,Fi.empty(),yi.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Ia()).next(()=>t))}getLocalViewOfDocuments(e,t,n=Ia()){const s=va();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(e=>{let t=ga();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=va();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ia()))}populateOverlays(e,t,n){const s=[];return n.forEach(e=>{t.has(e)||s.push(e)}),this.documentOverlayCache.getOverlays(e,s).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,s){let r=pa();const i=_a(),o=_a();return t.forEach((e,t)=>{const o=n.get(t.key);s.has(t.key)&&(void 0===o||o.mutation instanceof Xa)?r=r.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Ga(o.mutation,t,o.mutation.getFieldMask(),yi.now())):i.set(t.key,Fi.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>o.set(e,new pu(t,i.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){const n=_a();let s=new Li((e,t)=>e-t),r=Ia();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Fi.empty();o=r.applyToLocalView(i,o),n.set(e,o);const a=(s.get(r.batchId)||Ia()).add(e);s=s.insert(r.batchId,a)})}).next(()=>{const i=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,u=wa();c.forEach(e=>{if(!r.has(e)){const s=$a(t.get(e),n.get(e));null!==s&&u.set(e,s),r=r.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return bi.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,s){return r=t,ii.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ta(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var r}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):bi.resolve(va());let o=-1,a=r;return i.next(t=>bi.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?bi.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,Ia())).next(e=>({batchId:o,changes:ya(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ii(t)).next(e=>{let t=ga();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const r=t.collectionGroup;let i=ga();return this.indexManager.getCollectionParents(e,r).next(o=>bi.forEach(o,o=>{const a=(c=t,u=o.child(r),new Yo(u,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,u;return this.getDocumentsMatchingCollectionQuery(e,a,n,s).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(e=>{r.forEach((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,Co.newInvalidDocument(s)))});let n=ga();return e.forEach((e,s)=>{const i=r.get(e);void 0!==i&&Ga(i.mutation,s,Fi.empty(),yi.now()),ua(t,s)&&(n=n.insert(e,s))}),n})}}class gu{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return bi.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(n=t).id,version:n.version,createTime:Dc(n.createTime)}),bi.resolve();var n}getNamedQuery(e,t){return bi.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(n=t).name,query:tu(n.bundledQuery),readTime:Dc(n.readTime)}),bi.resolve();var n}}class yu{constructor(){this.overlays=new Li(ii.comparator),this.qr=new Map}getOverlay(e,t){return bi.resolve(this.overlays.get(t))}getOverlays(e,t){const n=va();return bi.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,s)=>{this.St(e,t,s)}),bi.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.qr.get(n);return void 0!==s&&(s.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),bi.resolve()}getOverlaysForCollection(e,t,n){const s=va(),r=t.length+1,i=new ii(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>n&&s.set(e.getKey(),e)}return bi.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new Li((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=va(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=va(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),o.size()<s););return bi.resolve(o)}St(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new rc(t,n));let r=this.qr.get(t);void 0===r&&(r=Ia(),this.qr.set(t,r)),this.qr.set(t,r.add(n.key))}}class vu{constructor(){this.sessionToken=Bi.EMPTY_BYTE_STRING}getSessionToken(e){return bi.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,bi.resolve()}}class wu{constructor(){this.Qr=new Ui(_u.$r),this.Ur=new Ui(_u.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new _u(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new _u(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new ii(new ni([])),n=new _u(t,e),s=new _u(t,e+1),r=[];return this.Ur.forEachInRange([n,s],e=>{this.Gr(e),r.push(e.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ii(new ni([])),n=new _u(t,e),s=new _u(t,e+1);let r=Ia();return this.Ur.forEachInRange([n,s],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new _u(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class _u{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ii.comparator(e.key,t.key)||Wr(e.Yr,t.Yr)}static Kr(e,t){return Wr(e.Yr,t.Yr)||ii.comparator(e.key,t.key)}}class Eu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ui(_u.$r)}checkEmpty(e){return bi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new nc(r,t,n,s);this.mutationQueue.push(i);for(const o of s)this.Zr=this.Zr.add(new _u(o.key,r)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return bi.resolve(i)}lookupMutationBatch(e,t){return bi.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.ei(n),r=0>s?0:s;return bi.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return bi.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return bi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new _u(t,0),s=new _u(t,1/0),r=[];return this.Zr.forEachInRange([n,s],e=>{const t=this.Xr(e.Yr);r.push(t)}),bi.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ui(Wr);return t.forEach(e=>{const t=new _u(e,0),s=new _u(e,1/0);this.Zr.forEachInRange([t,s],e=>{n=n.add(e.Yr)})}),bi.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let r=n;ii.isDocumentKey(r)||(r=r.child(""));const i=new _u(new ii(r),0);let o=new Ui(Wr);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(o=o.add(e.Yr)),!0)},i),bi.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Pr(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return bi.forEach(t.mutations,s=>{const r=new _u(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new _u(t,0),s=this.Zr.firstAfterOrEqual(n);return bi.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,bi.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return 0>t||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Tu{constructor(e){this.ri=e,this.docs=new Li(ii.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),r=s?s.size:0,i=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return bi.resolve(n?n.document.mutableCopy():Co.newInvalidDocument(t))}getEntries(e,t){let n=pa();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Co.newInvalidDocument(e))}),bi.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=pa();const i=t.path,o=new ii(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||0>=Ei(wi(o),n)||(s.has(o.key)||ua(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return bi.resolve(r)}getAllFromCollectionGroup(e,t,n,s){Dr(9500)}ii(e,t){return bi.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Iu(this)}getSize(e){return bi.resolve(this.size)}}class Iu extends fu{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(n)}),bi.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class bu{constructor(e){this.persistence=e,this.si=new da(e=>Qo(e),Xo),this.lastRemoteSnapshotVersion=vi.min(),this.highestTargetId=0,this.oi=0,this._i=new wu,this.targetCount=0,this.ai=au.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),bi.resolve()}getLastRemoteSnapshotVersion(e){return bi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return bi.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),bi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),bi.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new au(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,bi.resolve()}updateTargetData(e,t){return this.Pr(t),bi.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,bi.resolve()}removeTargets(e,t,n){let s=0;const r=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(i),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)}),bi.waitFor(r).next(()=>s)}getTargetCount(e){return bi.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return bi.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),bi.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(t=>{r.push(s.markPotentiallyOrphaned(e,t))}),bi.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),bi.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return bi.resolve(n)}containsKey(e,t){return bi.resolve(this._i.containsKey(t))}}class Cu{constructor(e,t){this.ui={},this.overlays={},this.ci=new Si(0),this.li=!1,this.li=!0,this.hi=new vu,this.referenceDelegate=e(this),this.Pi=new bu(this),this.indexManager=new nu,this.remoteDocumentCache=new Tu(e=>this.referenceDelegate.Ti(e)),this.serializer=new eu(t),this.Ii=new gu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Eu(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){kr("MemoryPersistence","Starting transaction:",e);const s=new Su(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(e=>this.referenceDelegate.di(s).next(()=>e)).toPromise().then(e=>(s.raiseOnCommittedEvent(),e))}Ai(e,t){return bi.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class Su extends Ti{constructor(e){super(),this.currentSequenceNumber=e}}class ku{constructor(e){this.persistence=e,this.Ri=new wu,this.Vi=null}static mi(e){return new ku(e)}get fi(){if(this.Vi)return this.Vi;throw Dr(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),bi.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),bi.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),bi.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return bi.forEach(this.fi,n=>{const s=ii.fromPath(n);return this.gi(e,s).next(e=>{e||t.removeEntry(s,vi.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return bi.or([()=>bi.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Au{constructor(e,t){this.persistence=e,this.pi=new da(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ni(t)),t=Ri(e.get(n),t);return Ni(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new du(e,t)}(this,t)}static mi(e,t){return new Au(e,t)}Ei(){}di(e){return bi.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return bi.forEach(this.pi,(n,s)=>this.br(e,n,s).next(e=>e?bi.resolve():t(s)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ii(e,s=>this.br(e,s,t).next(e=>{e||(n++,r.removeEntry(s,vi.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),bi.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),bi.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),bi.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),bi.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=mo(e.data.value)),t}br(e,t,n){return bi.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return bi.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ru{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=s}static As(e,t){let n=Ia(),s=Ia();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Ru(e,t.fromCache,n,s)}}class Nu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Du{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=!function(){const e=o()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(){const e=v().match(/Android ([\d.]+)/i);return+(e?e[1].split(".").slice(0,2).join("."):"-1")}()>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,s){const r={result:null};return this.ys(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.ws(e,t,s,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const n=new Nu;return this.Ss(e,t,n).next(s=>{if(r.result=s,this.Vs)return this.bs(e,t,n,s.size)})}).next(()=>r.result)}bs(e,t,n,s){return n.documentReadCount<this.fs?(Sr()<=L.DEBUG&&kr("QueryEngine","SDK will not create cache indexes for query:",ca(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),bi.resolve()):(Sr()<=L.DEBUG&&kr("QueryEngine","Query:",ca(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Sr()<=L.DEBUG&&kr("QueryEngine","The SDK decides to create cache indexes for query:",ca(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,sa(t))):bi.resolve())}ys(e,t){if(ea(t))return bi.resolve(null);let n=sa(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=ia(t,null,"F"),n=sa(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const r=Ia(...s);return this.ps.getDocuments(e,r).next(s=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.Ds(t,s);return this.Cs(t,i,r,n.readTime)?this.ys(e,ia(t,null,"F")):this.vs(e,i,t,n)}))})))}ws(e,t,n,s){return ea(t)||s.isEqual(vi.min())?bi.resolve(null):this.ps.getDocuments(e,n).next(r=>{const i=this.Ds(t,r);return this.Cs(t,i,n,s)?bi.resolve(null):(Sr()<=L.DEBUG&&kr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ca(t)),this.vs(e,i,t,function(e){const t=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,s=vi.fromTimestamp(1e9===n?new yi(t+1,0):new yi(t,n));return new _i(s,ii.empty(),-1)}(s)).next(e=>e))})}Ds(e,t){let n=new Ui(ha(e));return t.forEach((t,s)=>{ua(e,s)&&(n=n.add(s))}),n}Cs(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ss(e,t,n){return Sr()<=L.DEBUG&&kr("QueryEngine","Using full collection scan to execute query:",ca(t)),this.ps.getDocumentsMatchingQuery(e,t,_i.min(),n)}vs(e,t,n,s){return this.ps.getDocumentsMatchingQuery(e,n,s).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const Ou="LocalStore";class Pu{constructor(e,t,n,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Li(Wr),this.xs=new da(e=>Qo(e),Xo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mu(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function Lu(e,t){const n=Lr(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next(r=>(s=r,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],i=[];let o=Ia();for(const e of s){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:r,addedBatchIds:i}))})})}function Mu(e){const t=Lr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function xu(e,t){const n=Lr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function Uu(e,t,n){const s=Lr(e),r=s.Ms.get(t),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,e=>s.persistence.referenceDelegate.removeTarget(e,r))}catch(o){if(!Ci(o))throw o;kr(Ou,`Failed to update sequence numbers for target ${t}: ${o}`)}s.Ms=s.Ms.remove(t),s.xs.delete(r.target)}function Vu(e,t,n){const s=Lr(e);let r=vi.min(),i=Ia();return s.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const s=Lr(e),r=s.xs.get(n);return void 0!==r?bi.resolve(s.Ms.get(r)):s.Pi.getTargetData(t,n)}(s,e,sa(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>s.Fs.getDocumentsMatchingQuery(e,t,n?r:vi.min(),n?i:Ia())).next(e=>(function(e,t,n){let s=e.Os.get(t)||vi.min();n.forEach((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)}),e.Os.set(t,s)}(s,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class Fu{constructor(){this.activeTargetIds=ba}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ju{constructor(){this.Mo=new Fu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Fu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Bu{Oo(e){}shutdown(){}}const qu="ConnectivityMonitor";class zu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){kr(qu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){kr(qu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let $u=null;function Hu(){return null===$u?$u=268435456+Math.round(2147483648*Math.random()):$u++,"0x"+$u.toString(16)}const Gu="RestConnection",Ku={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Wu{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===eo?"project_id="+n:`project_id=${n}&database_id=${s}`}Go(e,t,n,s,r){const i=Hu(),o=this.zo(e,t.toUriEncodedString());kr(Gu,`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,s,r);const{host:c}=new URL(o),u=d(c);return this.Jo(e,o,a,n,u).then(t=>(kr(Gu,`Received RPC '${e}' ${i}: `,t),t),t=>{throw Rr(Gu,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,s,r,i){return this.Go(e,t,n,s,r)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+br,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=Ku[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class Qu{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Xu="WebChannelConnection";class Ju extends Wu{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,s,r){const i=Hu();return new Promise((r,o)=>{const a=new dr;a.setWithCredentials(!0),a.listenOnce(pr.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case mr.NO_ERROR:const t=a.getResponseJson();kr(Xu,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case mr.TIMEOUT:kr(Xu,`RPC '${e}' ${i} timed out`),o(new xr(Mr.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:const n=a.getStatus();if(kr(Xu,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return 0>Object.values(Mr).indexOf(t)?Mr.UNKNOWN:t}(t.status);o(new xr(e,t.message))}else o(new xr(Mr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new xr(Mr.UNAVAILABLE,"Connection failed."));break;default:Dr(9055,{l_:e,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{kr(Xu,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);kr(Xu,`RPC '${e}' ${i} sending request:`,s),a.send(t,"POST",c,n,15)})}T_(e,t,n){const s=Hu(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=wr(),o=vr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=r.join("");kr(Xu,`Creating RPC '${e}' stream ${s}: ${u}`,a);const h=i.createWebChannel(u,a);this.I_(h);let l=!1,d=!1;const f=new Qu({Yo:t=>{d?kr(Xu,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(l||(kr(Xu,`Opening RPC '${e}' stream ${s} transport.`),h.open(),l=!0),kr(Xu,`RPC '${e}' stream ${s} sending:`,t),h.send(t))},Zo:()=>h.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(h,fr.EventType.OPEN,()=>{d||(kr(Xu,`RPC '${e}' stream ${s} transport opened.`),f.o_())}),p(h,fr.EventType.CLOSE,()=>{d||(d=!0,kr(Xu,`RPC '${e}' stream ${s} transport closed`),f.a_(),this.E_(h))}),p(h,fr.EventType.ERROR,t=>{d||(d=!0,Rr(Xu,`RPC '${e}' stream ${s} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new xr(Mr.UNAVAILABLE,"The operation could not be completed")))}),p(h,fr.EventType.MESSAGE,t=>{if(!d){const n=t.data[0];Pr(!!n,16349);const r=n,i=r?.error||r[0]?.error;if(i){kr(Xu,`RPC '${e}' stream ${s} received error:`,i);const t=i.status;let n=function(e){const t=oc[e];if(void 0!==t)return cc(t)}(t),r=i.message;void 0===n&&(n=Mr.INTERNAL,r="Unknown error status: "+t+" with message "+i.message),d=!0,f.a_(new xr(n,r)),h.close()}else kr(Xu,`RPC '${e}' stream ${s} received:`,n),f.u_(n)}}),p(o,yr.STAT_EVENT,t=>{t.stat===gr.PROXY?kr(Xu,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===gr.NOPROXY&&kr(Xu,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Yu(){return"undefined"!=typeof document?document:null}function Zu(e){return new Sc(e,!0)}class eh{constructor(e,t,n=1e3,s=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=s,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-n);s>0&&kr("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const th="PersistentStream";class nh{constructor(e,t,n,s,r,i,o,a){this.Mi=e,this.S_=n,this.b_=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new eh(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===Mr.RESOURCE_EXHAUSTED?(Ar(t.toString()),Ar("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Mr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new xr(Mr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return kr(th,"close with error: "+e),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(kr(th,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sh extends nh{constructor(e,t,n,s,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:Dr(39313,{state:s}),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(Pr(void 0===t||"string"==typeof t,58123),Bi.fromBase64String(t||"")):(Pr(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Bi.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(e){const t=void 0===e.code?Mr.UNKNOWN:cc(e.code);return new xr(t,e.message||"")}(a);n=new vc(r,i,o,c||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const r=xc(e,s.document.name),i=Dc(s.document.updateTime),o=s.document.createTime?Dc(s.document.createTime):vi.min(),a=new Io({mapValue:{fields:s.document.fields}}),c=Co.newFoundDocument(r,i,o,a),u=s.targetIds||[],h=s.removedTargetIds||[];n=new gc(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const r=xc(e,s.document),i=s.readTime?Dc(s.readTime):vi.min(),o=Co.newNoDocument(r,i),a=s.removedTargetIds||[];n=new gc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const r=xc(e,s.document),i=s.removedTargetIds||[];n=new gc([],i,r,null)}else{if(!("filter"in t))return Dr(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:r}=e,i=new ic(s,r),o=e.targetId;n=new yc(o,i)}}var s;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return vi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?vi.min():t.readTime?Dc(t.readTime):vi.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Vc(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=Jo(s)?{documents:Bc(e,s)}:{query:qc(e,s).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Rc(e,t.resumeToken);const s=kc(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(vi.min())>0){n.readTime=Ac(e,t.snapshotVersion.toTimestamp());const s=kc(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Dr(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Vc(this.serializer),t.removeTarget=e,this.q_(t)}}class rh extends nh{constructor(e,t,n,s,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Pr(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Pr(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){Pr(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(Pr(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Dc(e.updateTime):Dc(t);return n.isEqual(vi.min())&&(n=Dc(t)),new ja(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Dc(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Vc(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof Qa)n={update:jc(e,t.key,t.value)};else if(t instanceof ec)n={delete:Mc(e,t.key)};else if(t instanceof Xa)n={update:jc(e,t.key,t.data),updateMask:Jc(t.fieldMask)};else{if(!(t instanceof tc))return Dr(16599,{Vt:t.type});n={verify:Mc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Da)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Oa)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof La)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xa)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw Dr(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=(s=e,void 0!==(r=t.precondition).updateTime?{updateTime:Nc(s,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:Dr(27497))),n;var s,r}(this.serializer,e))};this.q_(t)}}class ih{}class oh extends ih{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new xr(Mr.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Go(e,Pc(t,n),s,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Mr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xr(Mr.UNKNOWN,e.toString())})}Ho(e,t,n,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Ho(e,Pc(t,n),s,i,o,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Mr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xr(Mr.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class ah{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: "+e.toString()),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ar(t),this.aa=!1):kr("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const ch="RemoteStore";class uh{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{vh(this)&&(kr(ch,"Restarting streams for network reachability change."),await async function(e){const t=Lr(e);t.Ea.add(4),await lh(t),t.Ra.set("Unknown"),t.Ea.delete(4),await hh(t)}(this))})}),this.Ra=new ah(n,s)}}async function hh(e){if(vh(e))for(const t of e.da)await t(!0)}async function lh(e){for(const t of e.da)await t(!1)}function dh(e,t){const n=Lr(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),yh(n)?gh(n):xh(n).O_()&&ph(n,t))}function fh(e,t){const n=Lr(e),s=xh(n);n.Ia.delete(t),s.O_()&&mh(n,t),0===n.Ia.size&&(s.O_()?s.L_():vh(n)&&n.Ra.set("Unknown"))}function ph(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(vi.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}xh(e).Y_(t)}function mh(e,t){e.Va.Ue(t),xh(e).Z_(t)}function gh(e){e.Va=new _c({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),xh(e).start(),e.Ra.ua()}function yh(e){return vh(e)&&!xh(e).x_()&&e.Ia.size>0}function vh(e){return 0===Lr(e).Ea.size}function wh(e){e.Va=void 0}async function _h(e){e.Ra.set("Online")}async function Eh(e){e.Ia.forEach((t,n)=>{ph(e,t)})}async function Th(e,t){wh(e),yh(e)?(e.Ra.ha(t),gh(e)):e.Ra.set("Unknown")}async function Ih(e,t,n){if(e.Ra.set("Online"),t instanceof vc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.Ia.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.Ia.delete(s),e.Va.removeTarget(s))}(e,t)}catch(s){kr(ch,"Failed to remove targets %s: %s ",t.targetIds.join(","),s),await bh(e,s)}else if(t instanceof gc?e.Va.Ze(t):t instanceof yc?e.Va.st(t):e.Va.tt(t),!n.isEqual(vi.min()))try{const t=await Mu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Ia.get(s);r&&e.Ia.set(s,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const s=e.Ia.get(t);if(!s)return;e.Ia.set(t,s.withResumeToken(Bi.EMPTY_BYTE_STRING,s.snapshotVersion)),mh(e,t);const r=new Zc(s.target,t,n,s.sequenceNumber);ph(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(r){kr(ch,"Failed to raise snapshot:",r),await bh(e,r)}}async function bh(e,t,n){if(!Ci(t))throw t;e.Ea.add(1),await lh(e),e.Ra.set("Offline"),n||(n=()=>Mu(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{kr(ch,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await hh(e)})}function Ch(e,t){return t().catch(n=>bh(e,n,t))}async function Sh(e){const t=Lr(e),n=Uh(t);let s=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;kh(t);)try{const e=await xu(t.localStore,s);if(null===e){0===t.Ta.length&&n.L_();break}s=e.batchId,Ah(t,e)}catch(r){await bh(t,r)}Rh(t)&&Nh(t)}function kh(e){return vh(e)&&10>e.Ta.length}function Ah(e,t){e.Ta.push(t);const n=Uh(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Rh(e){return vh(e)&&!Uh(e).x_()&&e.Ta.length>0}function Nh(e){Uh(e).start()}async function Dh(e){Uh(e).ra()}async function Oh(e){const t=Uh(e);for(const n of e.Ta)t.ea(n.mutations)}async function Ph(e,t,n){const s=e.Ta.shift(),r=sc.from(s,t,n);await Ch(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await Sh(e)}async function Lh(e,t){t&&Uh(e).X_&&await async function(e,t){if(function(e){switch(e){case Mr.OK:return Dr(64938);case Mr.CANCELLED:case Mr.UNKNOWN:case Mr.DEADLINE_EXCEEDED:case Mr.RESOURCE_EXHAUSTED:case Mr.INTERNAL:case Mr.UNAVAILABLE:case Mr.UNAUTHENTICATED:return!1;case Mr.INVALID_ARGUMENT:case Mr.NOT_FOUND:case Mr.ALREADY_EXISTS:case Mr.PERMISSION_DENIED:case Mr.FAILED_PRECONDITION:case Mr.ABORTED:case Mr.OUT_OF_RANGE:case Mr.UNIMPLEMENTED:case Mr.DATA_LOSS:return!0;default:return Dr(15467,{code:e})}}(n=t.code)&&n!==Mr.ABORTED){const n=e.Ta.shift();Uh(e).B_(),await Ch(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Sh(e)}var n}(e,t),Rh(e)&&Nh(e)}async function Mh(e,t){const n=Lr(e);n.asyncQueue.verifyOperationInProgress(),kr(ch,"RemoteStore received new credentials");const s=vh(n);n.Ea.add(3),await lh(n),s&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await hh(n)}function xh(e){return e.ma||(e.ma=function(e,t,n){const s=Lr(e);return s.sa(),new sh(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Xo:_h.bind(null,e),t_:Eh.bind(null,e),r_:Th.bind(null,e),H_:Ih.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),yh(e)?gh(e):e.Ra.set("Unknown")):(await e.ma.stop(),wh(e))})),e.ma}function Uh(e){return e.fa||(e.fa=function(e,t,n){const s=Lr(e);return s.sa(),new rh(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Dh.bind(null,e),r_:Lh.bind(null,e),ta:Oh.bind(null,e),na:Ph.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await Sh(e)):(await e.fa.stop(),e.Ta.length>0&&(kr(ch,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class Vh{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new Ur,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){const i=Date.now()+n,o=new Vh(e,t,i,s,r);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xr(Mr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fh(e,t){if(Ar("AsyncQueue",`${t}: ${e}`),Ci(e))return new xr(Mr.UNAVAILABLE,`${t}: ${e}`);throw e}class jh{static emptySet(e){return new jh(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ii.comparator(t.key,n.key):(e,t)=>ii.comparator(e.key,t.key),this.keyedMap=ga(),this.sortedSet=new Li(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof jh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new jh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Bh{constructor(){this.ga=new Li(ii.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Dr(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class qh{constructor(e,t,n,s,r,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new qh(e,t,jh.emptySet(t),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class zh{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class $h{constructor(){this.queries=Hh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=Lr(e),s=n.queries;n.queries=Hh(),s.forEach((e,n)=>{for(const s of n.Sa)s.onError(t)})}(this,new xr(Mr.ABORTED,"Firestore shutting down"))}}function Hh(){return new da(e=>aa(e),oa)}async function Gh(e,t){const n=Lr(e);let s=3;const r=t.query;let i=n.queries.get(r);i?!i.ba()&&t.Da()&&(s=2):(i=new zh,s=t.Da()?0:1);try{switch(s){case 0:i.wa=await n.onListen(r,!0);break;case 1:i.wa=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(o){const e=Fh(o,`Initialization of query '${ca(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,i),i.Sa.push(t),t.va(n.onlineState),i.wa&&t.Fa(i.wa)&&Xh(n)}async function Kh(e,t){const n=Lr(e),s=t.query;let r=3;const i=n.queries.get(s);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=t.Da()?0:1:!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function Wh(e,t){const n=Lr(e);let s=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(r)&&(s=!0);t.wa=r}}s&&Xh(n)}function Qh(e,t,n){const s=Lr(e),r=s.queries.get(t);if(r)for(const i of r.Sa)i.onError(n);s.queries.delete(t)}function Xh(e){e.Ca.forEach(e=>{e.next()})}var Jh,Yh;(Yh=Jh||(Jh={})).Ma="default",Yh.Cache="cache";class Zh{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new qh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=qh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Jh.Cache}}class el{constructor(e){this.key=e}}class tl{constructor(e){this.key=e}}class nl{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ia(),this.mutatedKeys=Ia(),this.eu=ha(e),this.tu=new jh(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Bh,s=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((e,t)=>{const u=s.get(e),h=ua(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.eu(h,a)>0||c&&0>this.eu(h,c))&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),r=d?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{tu:i,iu:n,Cs:o,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Dr(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),s=s??!1;const o=t&&!s?this._u():[],a=0===this.Xa.size&&this.current&&!s?1:0,c=a!==this.Za;return this.Za=a,0!==i.length||c?{snapshot:new qh(this.query,e.tu,r,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Bh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ia(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new tl(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new el(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=Ia();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return qh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const sl="SyncEngine";class rl{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class il{constructor(e){this.key=e,this.hu=!1}}class ol{constructor(e,t,n,s,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new da(e=>aa(e),oa),this.Iu=new Map,this.Eu=new Set,this.du=new Li(ii.comparator),this.Au=new Map,this.Ru=new wu,this.Vu={},this.mu=new Map,this.fu=au.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function al(e,t,n=!0){const s=Al(e);let r;const i=s.Tu.get(t);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await ul(s,t,n,!0),r}async function cl(e,t){const n=Al(e);await ul(n,t,!0,!1)}async function ul(e,t,n,s){const r=await function(e,t){const n=Lr(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let s;return n.Pi.getTargetData(e,t).next(r=>r?(s=r,bi.resolve(s)):n.Pi.allocateTargetId(e).next(r=>(s=new Zc(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,s).next(()=>s))))}).then(e=>{const s=n.Ms.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,sa(t)),i=r.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let a;return s&&(a=await async function(e,t,n,s,r){e.pu=(t,n,s)=>async function(e,t,n,s){let r=t.view.ru(n);r.Cs&&(r=await Vu(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,r)));const i=s&&s.targetChanges.get(t.targetId),o=s&&null!=s.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,i,o);return Tl(e,t.targetId,a.au),a.snapshot}(e,t,n,s);const i=await Vu(e.localStore,t,!0),o=new nl(t,i.Qs),a=o.ru(i.documents),c=mc.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,r),u=o.applyChanges(a,e.isPrimaryClient,c);Tl(e,n,u.au);const h=new rl(t,n,o);return e.Tu.set(t,h),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}(e,t,i,"current"===o,r.resumeToken)),e.isPrimaryClient&&n&&dh(e.remoteStore,r),a}async function hl(e,t,n){const s=Lr(e),r=s.Tu.get(t),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(e=>!oa(e,t))),void s.Tu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Uu(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),n&&fh(s.remoteStore,r.targetId),_l(s,r.targetId)}).catch(Ii)):(_l(s,r.targetId),await Uu(s.localStore,r.targetId,!0))}async function ll(e,t){const n=Lr(e),s=n.Tu.get(t),r=n.Iu.get(s.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),fh(n.remoteStore,s.targetId))}async function dl(e,t,n){const s=function(e){const t=Lr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=gl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=yl.bind(null,t),t}(e);try{const e=await function(e,t){const n=Lr(e),s=yi.now(),r=t.reduce((e,t)=>e.add(t.key),Ia());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=pa(),c=Ia();return n.Ns.getEntries(e,r).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(r=>{i=r;const o=[];for(const e of t){const t=Ka(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new Xa(e.key,t,bo(t.value.mapValue),Ba.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,o,t)}).next(t=>{o=t;const s=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:o.batchId,changes:ya(i)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.Vu[e.currentUser.toKey()];s||(s=new Li(Wr)),s=s.insert(t,n),e.Vu[e.currentUser.toKey()]=s}(s,e.batchId,n),await Cl(s,e.changes),await Sh(s.remoteStore)}catch(r){const e=Fh(r,"Failed to persist write");n.reject(e)}}async function fl(e,t){const n=Lr(e);try{const e=await function(e,t){const n=Lr(e),s=t.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;const o=[];t.targetChanges.forEach((i,a)=>{const c=r.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,i.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);var h,l,d;null!==t.targetMismatches.get(a)?u=u.withResumeToken(Bi.EMPTY_BYTE_STRING,vi.min()).withLastLimboFreeSnapshotVersion(vi.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,s)),r=r.insert(a,u),l=u,d=i,(0===(h=c).resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-h.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.Pi.updateTargetData(e,u))});let a=pa(),c=Ia();if(t.documentUpdates.forEach(s=>{t.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))}),o.push(function(e,t,n){let s=Ia(),r=Ia();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=pa();return n.forEach((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(vi.min())?(t.removeEntry(n,i.readTime),s=s.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),s=s.insert(n,i)):kr(Ou,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)}),{ks:s,qs:r}})}(e,i,t.documentUpdates).next(e=>{a=e.ks,c=e.qs})),!s.isEqual(vi.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,s));o.push(t)}return bi.waitFor(o).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.Ms=r,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const s=n.Au.get(t);s&&(Pr(1>=e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size,22616),e.addedDocuments.size>0?s.hu=!0:e.modifiedDocuments.size>0?Pr(s.hu,14607):e.removedDocuments.size>0&&(Pr(s.hu,42227),s.hu=!1))}),await Cl(n,e,t)}catch(s){await Ii(s)}}function pl(e,t,n){const s=Lr(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.Tu.forEach((n,s)=>{const r=s.view.va(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=Lr(e);n.onlineState=t;let s=!1;n.queries.forEach((e,n)=>{for(const r of n.Sa)r.va(t)&&(s=!0)}),s&&Xh(n)}(s.eventManager,t),e.length&&s.Pu.H_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function ml(e,t,n){const s=Lr(e);s.sharedClientState.updateQueryState(t,"rejected",n);const r=s.Au.get(t),i=r&&r.key;if(i){let e=new Li(ii.comparator);e=e.insert(i,Co.newNoDocument(i,vi.min()));const n=Ia().add(i),r=new pc(vi.min(),new Map,new Li(Wr),e,n);await fl(s,r),s.du=s.du.remove(i),s.Au.delete(t),bl(s)}else await Uu(s.localStore,t,!1).then(()=>_l(s,t,n)).catch(Ii)}async function gl(e,t){const n=Lr(e),s=t.batch.batchId;try{const e=await function(e,t){const n=Lr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const s=t.batch.keys(),r=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const r=n.batch,i=r.keys();let o=bi.resolve();return i.forEach(e=>{o=o.next(()=>s.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);Pr(null!==i,48541),0>t.version.compareTo(i)&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ia();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,s))})}(n.localStore,t);wl(n,s,null),vl(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Cl(n,e)}catch(r){await Ii(r)}}async function yl(e,t,n){const s=Lr(e);try{const e=await function(e,t){const n=Lr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(Pr(null!==t,37113),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s)).next(()=>n.localDocuments.getDocuments(e,s))})}(s.localStore,t);wl(s,t,n),vl(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await Cl(s,e)}catch(r){await Ii(r)}}function vl(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function wl(e,t,n){const s=Lr(e);let r=s.Vu[s.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),s.Vu[s.currentUser.toKey()]=r}}function _l(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Iu.get(t))e.Tu.delete(s),n&&e.Pu.yu(s,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||El(e,t)})}function El(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(fh(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),bl(e))}function Tl(e,t,n){for(const s of n)s instanceof el?(e.Ru.addReference(s.key,t),Il(e,s)):s instanceof tl?(kr(sl,"Document no longer in limbo: "+s.key),e.Ru.removeReference(s.key,t),e.Ru.containsKey(s.key)||El(e,s.key)):Dr(19791,{wu:s})}function Il(e,t){const n=t.key,s=n.path.canonicalString();e.du.get(n)||e.Eu.has(s)||(kr(sl,"New document in limbo: "+n),e.Eu.add(s),bl(e))}function bl(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new ii(ni.fromString(t)),s=e.fu.next();e.Au.set(s,new il(n)),e.du=e.du.insert(n,s),dh(e.remoteStore,new Zc(sa(Zo(n.path)),s,"TargetPurposeLimboResolution",Si.ce))}}async function Cl(e,t,n){const s=Lr(e),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((e,a)=>{o.push(s.pu(a,t,n).then(e=>{if((e||n)&&s.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(a.targetId)?.current;s.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){r.push(e);const t=Ru.As(a.targetId,e);i.push(t)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(e,t){const n=Lr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>bi.forEach(t,t=>bi.forEach(t.Es,s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s)).next(()=>bi.forEach(t.ds,s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))}catch(s){if(!Ci(s))throw s;kr(Ou,"Failed to update sequence numbers: "+s)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ms.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ms=n.Ms.insert(e,r)}}}(s.localStore,i))}async function Sl(e,t){const n=Lr(e);if(!n.currentUser.isEqual(t)){kr(sl,"User change. New user:",t.toKey());const e=await Lu(n.localStore,t);n.currentUser=t,(s=n).mu.forEach(e=>{e.forEach(e=>{e.reject(new xr(Mr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.mu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Cl(n,e.Ls)}var s}function kl(e,t){const n=Lr(e),s=n.Au.get(t);if(s&&s.hu)return Ia().add(s.key);{let e=Ia();const s=n.Iu.get(t);if(!s)return e;for(const t of s){const s=n.Tu.get(t);e=e.unionWith(s.view.nu)}return e}}function Al(e){const t=Lr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=fl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=kl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=ml.bind(null,t),t.Pu.H_=Wh.bind(null,t.eventManager),t.Pu.yu=Qh.bind(null,t.eventManager),t}class Rl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Zu(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,s){return new Pu(e,t,n,s)}(this.persistence,new Du,e.initialUser,this.serializer)}Cu(e){return new Cu(ku.mi,this.serializer)}Du(e){return new ju}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rl.provider={build:()=>new Rl};class Nl extends Rl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Pr(this.persistence.referenceDelegate instanceof Au,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new lu(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?ou.withCacheSize(this.cacheSizeBytes):ou.DEFAULT;return new Cu(e=>Au.mi(e,t),this.serializer)}}class Dl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>pl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Sl.bind(null,this.syncEngine),await async function(e,t){const n=Lr(e);t?(n.Ea.delete(2),await hh(n)):t||(n.Ea.add(2),await lh(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new $h}createDatastore(e){const t=Zu(e.databaseInfo.databaseId),n=(s=e.databaseInfo,new Ju(s));var s;return function(e,t,n,s){return new oh(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,s=e.asyncQueue,r=e=>pl(this.syncEngine,e,0),i=zu.v()?new zu:new Bu,new uh(t,n,s,r,i);var t,n,s,r,i}createSyncEngine(e,t){return function(e,t,n,s,r,i,o){const a=new ol(e,t,n,s,r,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=Lr(e);kr(ch,"RemoteStore shutting down."),t.Ea.add(5),await lh(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Dl.provider={build:()=>new Dl};class Ol{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ar("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Pl="FirestoreClient";class Ll{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Ir.UNAUTHENTICATED,this.clientId=Kr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{kr(Pl,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(kr(Pl,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ur;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Fh(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Ml(e,t){e.asyncQueue.verifyOperationInProgress(),kr(Pl,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener(async e=>{s.isEqual(e)||(await Lu(t.localStore,e),s=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function xl(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){kr(Pl,"Using user provided OfflineComponentProvider");try{await Ml(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!("FirebaseError"===(n=r).name?n.code===Mr.FAILED_PRECONDITION||n.code===Mr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;Rr("Error using user provided cache. Falling back to memory cache: "+r),await Ml(e,new Rl)}}else kr(Pl,"Using default OfflineComponentProvider"),await Ml(e,new Nl(void 0));var n;return e._offlineComponents}(e);kr(Pl,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>Mh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Mh(t.remoteStore,n)),e._onlineComponents=t}async function Ul(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(kr(Pl,"Using user provided OnlineComponentProvider"),await xl(e,e._uninitializedComponentsProvider._online)):(kr(Pl,"Using default OnlineComponentProvider"),await xl(e,new Dl))),e._onlineComponents}async function Vl(e){const t=await Ul(e),n=t.eventManager;return n.onListen=al.bind(null,t.syncEngine),n.onUnlisten=hl.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=cl.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=ll.bind(null,t.syncEngine),n}function Fl(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const jl=new Map,Bl="firestore.googleapis.com",ql=!0;class zl{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new xr(Mr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Bl,this.ssl=ql}else this.host=e.host,this.ssl=e.ssl??ql;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=iu;else{if(-1!==e.cacheSizeBytes&&1048576>e.cacheSizeBytes)throw new xr(Mr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ai("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fl(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new xr(Mr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(5>e.timeoutSeconds)throw new xr(Mr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new xr(Mr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class $l{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new xr(Mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new xr(Mr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Fr;switch(e.type){case"firstParty":return new zr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new xr(Mr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=jl.get(e);t&&(kr("ComponentProvider","Removing Datastore"),jl.delete(e),t.terminate())}(this),Promise.resolve()}}function Hl(e,t,n,s={}){e=di(e,$l);const r=d(t),i=e._getSettings(),o={...i,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;r&&(f("https://"+a),y("Firestore",!0)),i.host!==Bl&&i.host!==a&&Rr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:a,ssl:r,emulatorOptions:s};if(!T(c,o)&&(e._setSettings(c),s.mockUserToken)){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=Ir.MOCK_USER;else{t=p(s.mockUserToken,e._app?.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new xr(Mr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ir(r)}e._authCredentials=new jr(new Vr(t,n))}}class Gl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Gl(this.firestore,e,this._query)}}class Kl{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Kl(this.firestore,e,this._key)}toJSON(){return{type:Kl._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(pi(t,Kl._jsonSchema))return new Kl(e,n||null,new ii(ni.fromString(t.referencePath)))}}Kl._jsonSchemaVersion="firestore/documentReference/1.0",Kl._jsonSchema={type:fi("string",Kl._jsonSchemaVersion),referencePath:fi("string")};class Wl extends Gl{constructor(e,t,n){super(e,t,Zo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Kl(this.firestore,null,new ii(e))}withConverter(e){return new Wl(this.firestore,e,this._path)}}function Ql(e,t,...n){if(e=R(e),oi("collection","path",t),e instanceof $l){const s=ni.fromString(t,...n);return ui(s),new Wl(e,null,s)}{if(!(e instanceof Kl||e instanceof Wl))throw new xr(Mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(ni.fromString(t,...n));return ui(s),new Wl(e.firestore,null,s)}}function Xl(e,t,...n){if(e=R(e),1===arguments.length&&(t=Kr.newId()),oi("doc","path",t),e instanceof $l){const s=ni.fromString(t,...n);return ci(s),new Kl(e,null,new ii(s))}{if(!(e instanceof Kl||e instanceof Wl))throw new xr(Mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(ni.fromString(t,...n));return ci(s),new Kl(e.firestore,e instanceof Wl?e.converter:null,new ii(s))}}const Jl="AsyncQueue";class Yl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new eh(this,"async_queue_retry"),this._c=()=>{const e=Yu();e&&kr(Jl,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Yu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Yu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Ur;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ci(e))throw e;kr(Jl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,Ar("INTERNAL UNHANDLED ERROR: ",Zl(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Vh.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(s),s}uc(){this.nc&&Dr(47125,{Pc:Zl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Zl(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ed(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return!0;return!1}(e)}class td extends $l{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Yl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Yl(e),this._firestoreClient=void 0,await e}}}function nd(e,t){const n="object"==typeof e?e:Ge(),s="string"==typeof e?e:eo,r=je(n,"firestore").getImmediate({identifier:s});if(!r._initialized){const e=c("firestore");e&&Hl(r,...e)}return r}function sd(e){if(e._terminated)throw new xr(Mr.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){const t=e._freezeSettings(),n=(s=e._databaseId,r=e._app?.options.appId||"",i=e._persistenceKey,new Zi(s,r,i,(o=t).host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,Fl(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator));var s,r,i,o;e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new Ll(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class rd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new rd(Bi.fromBase64String(e))}catch(t){throw new xr(Mr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new rd(Bi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:rd._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(pi(e,rd._jsonSchema))return rd.fromBase64String(e.bytes)}}rd._jsonSchemaVersion="firestore/bytes/1.0",rd._jsonSchema={type:fi("string",rd._jsonSchemaVersion),bytes:fi("string")};class id{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new xr(Mr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ri(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class od{constructor(e){this._methodName=e}}class ad{constructor(e,t){if(!isFinite(e)||-90>e||e>90)throw new xr(Mr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||-180>t||t>180)throw new xr(Mr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Wr(this._lat,e._lat)||Wr(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ad._jsonSchemaVersion}}static fromJSON(e){if(pi(e,ad._jsonSchema))return new ad(e.latitude,e.longitude)}}ad._jsonSchemaVersion="firestore/geoPoint/1.0",ad._jsonSchema={type:fi("string",ad._jsonSchemaVersion),latitude:fi("number"),longitude:fi("number")};class cd{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:cd._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(pi(e,cd._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new cd(e.vectorValues);throw new xr(Mr.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}cd._jsonSchemaVersion="firestore/vectorValue/1.0",cd._jsonSchema={type:fi("string",cd._jsonSchemaVersion),vectorValues:fi("object")};const ud=/^__.*__$/;class hd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Xa(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qa(e,this.data,t,this.fieldTransforms)}}class ld{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Xa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Dr(40011,{Ac:e})}}class fd{constructor(e,t,n,s,r,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new fd({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Sd(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(dd(this.Ac)&&ud.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class pd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Zu(e)}Cc(e,t,n,s=!1){return new fd({Ac:e,methodName:t,Dc:n,path:ri.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function md(e){const t=e._freezeSettings(),n=Zu(e._databaseId);return new pd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function gd(e,t,n,s,r,i={}){const o=e.Cc(i.merge||i.mergeFields?2:0,t,n,r);Td("Data must be an object, but it was:",o,s);const a=_d(s,o);let c,u;if(i.merge)c=new Fi(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const s of i.mergeFields){const r=Id(t,s,n);if(!o.contains(r))throw new xr(Mr.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);kd(e,r)||e.push(r)}c=new Fi(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new hd(new Io(a),c,u)}class yd extends od{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(this._methodName+"() can only appear at the top level of your update data"):e.Sc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yd}}class vd extends od{_toFieldTransform(e){return new Fa(e.path,new Da)}isEqual(e){return e instanceof vd}}function wd(e,t){if(Ed(e=R(e)))return Td("Unsupported field value:",t,e),_d(e,t);if(e instanceof od)return function(e,t){if(!dd(t.Ac))throw t.Sc(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.Sc(e._methodName+"() is not currently supported inside arrays");const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const r of e){let e=wd(r,t.wc(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=R(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ai(e)&&Number.MAX_SAFE_INTEGER>=e&&e>=Number.MIN_SAFE_INTEGER}(t)?Sa(t):Ca(e,t)}(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=yi.fromDate(e);return{timestampValue:Ac(t.serializer,n)}}if(e instanceof yi){const n=new yi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ac(t.serializer,n)}}if(e instanceof ad)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof rd)return{bytesValue:Rc(t.serializer,e._byteString)};if(e instanceof Kl){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.Sc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Oc(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof cd)return n=e,s=t,{mapValue:{fields:{[no]:{stringValue:ro},[io]:{arrayValue:{values:n.toArray().map(e=>{if("number"!=typeof e)throw s.Sc("VectorValues must only contain numeric values.");return Ca(s.serializer,e)})}}}}};var n,s;throw t.Sc("Unsupported field value: "+li(e))}(e,t)}function _d(e,t){const n={};return Pi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Oi(e,(e,s)=>{const r=wd(s,t.mc(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function Ed(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof yi||e instanceof ad||e instanceof rd||e instanceof Kl||e instanceof od||e instanceof cd)}function Td(e,t,n){if(!Ed(n)||!hi(n)){const s=li(n);throw"an object"===s?t.Sc(e+" a custom object"):t.Sc(e+" "+s)}}function Id(e,t,n){if((t=R(t))instanceof id)return t._internalPath;if("string"==typeof t)return Cd(e,t);throw Sd("Field path arguments must be of type string or ",e,!1,void 0,n)}const bd=RegExp("[~\\*/\\[\\]]");function Cd(e,t,n){if(t.search(bd)>=0)throw Sd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new id(...t.split("."))._internalPath}catch(s){throw Sd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Sd(e,t,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=" in field "+s),o&&(c+=" in document "+r),c+=")"),new xr(Mr.INVALID_ARGUMENT,a+e+c)}function kd(e,t){return e.some(e=>e.isEqual(t))}class Ad{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Kl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Rd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Nd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Rd extends Ad{data(){return super.data()}}function Nd(e,t){return"string"==typeof t?Cd(e,t):t instanceof id?t._internalPath:t._delegate._internalPath}function Dd(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new xr(Mr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Od{}class Pd extends Od{}function Ld(e,t,...n){let s=[];t instanceof Od&&s.push(t),s=s.concat(n),function(e){const t=e.filter(e=>e instanceof Ud).length,n=e.filter(e=>e instanceof Md).length;if(t>1||t>0&&n>0)throw new xr(Mr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)e=r._apply(e);return e}class Md extends Pd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Md(e,t,n)}_apply(e){const t=this._parse(e);return $d(e._query,t),new Gl(e.firestore,e.converter,ra(e._query,t))}_parse(e){const t=md(e.firestore),n=function(e,t,n,s,r,i,o){let a;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new xr(Mr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){zd(o,i);const t=[];for(const n of o)t.push(qd(s,e,n));a={arrayValue:{values:t}}}else a=qd(s,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||zd(o,i),a=function(e,t,n,s=!1){return wd(n,e.Cc(s?4:3,t))}(n,"where",o,"in"===i||"not-in"===i);return Oo.create(r,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function xd(e,t,n){const s=t,r=Nd("where",e);return Md._create(r,s,n)}class Ud extends Od{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ud(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Po.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const r of s)$d(n,r),n=ra(n,r)}(e._query,t),new Gl(e.firestore,e.converter,ra(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Vd extends Pd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Vd(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new xr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new xr(Mr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ro(t,n)}(e._query,this._field,this._direction);return new Gl(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Yo(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Fd(e,t="asc"){const n=t,s=Nd("orderBy",e);return Vd._create(s,n)}class jd extends Pd{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new jd(e,t,n)}_apply(e){return new Gl(e.firestore,e.converter,ia(e._query,this._limit,this._limitType))}}function Bd(e){return function(e,t){if(0>=t)throw new xr(Mr.INVALID_ARGUMENT,`Function limit() requires a positive number, but it was: ${t}.`)}(0,e),jd._create("limit",e,"F")}function qd(e,t,n){if("string"==typeof(n=R(n))){if(""===n)throw new xr(Mr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ta(t)&&-1!==n.indexOf("/"))throw new xr(Mr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child(ni.fromString(n));if(!ii.isDocumentKey(s))throw new xr(Mr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return go(e,new ii(s))}if(n instanceof Kl)return go(e,n._key);throw new xr(Mr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${li(n)}.`)}function zd(e,t){if(!Array.isArray(e)||0===e.length)throw new xr(Mr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function $d(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new xr(Mr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new xr(Mr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Hd{convertValue(e,t="none"){switch(oo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $i(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Dr(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Oi(e,(e,s)=>{n[e]=this.convertValue(s,t)}),n}convertVectorValue(e){const t=e.fields?.[io].arrayValue?.values?.map(e=>$i(e.doubleValue));return new cd(t)}convertGeoPoint(e){return new ad($i(e.latitude),$i(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ji(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Yi(e));default:return null}}convertTimestamp(e){const t=zi(e);return new yi(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ni.fromString(e);Pr(Yc(n),9688,{name:e});const s=new to(n.get(1),n.get(3)),r=new ii(n.popFirst(5));return s.isEqual(t)||Ar(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function Gd(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class Kd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Wd extends Ad{constructor(e,t,n,s,r,i){super(e,t,n,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Qd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Nd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new xr(Mr.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Wd._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Wd._jsonSchemaVersion="firestore/documentSnapshot/1.0",Wd._jsonSchema={type:fi("string",Wd._jsonSchemaVersion),bundleSource:fi("string","DocumentSnapshot"),bundleName:fi("string"),bundle:fi("string")};class Qd extends Wd{data(e={}){return super.data(e)}}class Xd{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Kd(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Qd(this._firestore,this._userDataWriter,n.key,n,new Kd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xr(Mr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const s=new Qd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Kd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const s=new Qd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Kd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Jd(t.type),doc:s,oldIndex:r,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new xr(Mr.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Xd._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Kr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],s=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),s.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Jd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Dr(61501,{type:e})}}function Yd(e){e=di(e,Kl);const t=di(e.firestore,td);return function(e,t,n={}){const s=new Ur;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,r){const i=new Ol({next:a=>{i.Nu(),t.enqueueAndForget(()=>Kh(e,o));const c=a.docs.has(n);!c&&a.fromCache?r.reject(new xr(Mr.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&s&&"server"===s.source?r.reject(new xr(Mr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:e=>r.reject(e)}),o=new Zh(Zo(n.path),i,{includeMetadataChanges:!0,qa:!0});return Gh(e,o)}(await Vl(e),e.asyncQueue,t,n,s)),s.promise}(sd(t),e._key).then(n=>cf(t,e,n))}Xd._jsonSchemaVersion="firestore/querySnapshot/1.0",Xd._jsonSchema={type:fi("string",Xd._jsonSchemaVersion),bundleSource:fi("string","QuerySnapshot"),bundleName:fi("string"),bundle:fi("string")};class Zd extends Hd{constructor(e){super(),this.firestore=e}convertBytes(e){return new rd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Kl(this.firestore,null,t)}}function ef(e){e=di(e,Gl);const t=di(e.firestore,td),n=sd(t),s=new Zd(t);return Dd(e._query),function(e,t,n={}){const s=new Ur;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,s,r){const i=new Ol({next:n=>{i.Nu(),t.enqueueAndForget(()=>Kh(e,o)),n.fromCache&&"server"===s.source?r.reject(new xr(Mr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new Zh(n,i,{includeMetadataChanges:!0,qa:!0});return Gh(e,o)}(await Vl(e),e.asyncQueue,t,n,s)),s.promise}(n,e._query).then(n=>new Xd(t,s,e,n))}function tf(e,t,n){e=di(e,Kl);const s=di(e.firestore,td),r=Gd(e.converter,t,n);return af(s,[gd(md(s),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Ba.none())])}function nf(e,t,n,...s){e=di(e,Kl);const r=di(e.firestore,td),i=md(r);let o;return o="string"==typeof(t=R(t))||t instanceof id?function(e,t,n,s,r,i){const o=e.Cc(1,t,n),a=[Id(t,s,n)],c=[r];if(i.length%2!=0)throw new xr(Mr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(Id(t,i[d])),c.push(i[d+1]);const u=[],h=Io.empty();for(let d=a.length-1;d>=0;--d)if(!kd(u,a[d])){const e=a[d];let t=c[d];t=R(t);const n=o.yc(e);if(t instanceof yd)u.push(e);else{const s=wd(t,n);null!=s&&(u.push(e),h.set(e,s))}}const l=new Fi(u);return new ld(h,l,o.fieldTransforms)}(i,"updateDoc",e._key,t,n,s):function(e,t,n,s){const r=e.Cc(1,t,n);Td("Data must be an object, but it was:",r,s);const i=[],o=Io.empty();Oi(s,(e,s)=>{const a=Cd(t,e,n);s=R(s);const c=r.yc(a);if(s instanceof yd)i.push(a);else{const e=wd(s,c);null!=e&&(i.push(a),o.set(a,e))}});const a=new Fi(i);return new ld(o,a,r.fieldTransforms)}(i,"updateDoc",e._key,t),af(r,[o.toMutation(e._key,Ba.exists(!0))])}function sf(e){return af(di(e.firestore,td),[new ec(e._key,Ba.none())])}function rf(e,t){const n=di(e.firestore,td),s=Xl(e),r=Gd(e.converter,t);return af(n,[gd(md(e.firestore),"addDoc",s._key,r,null!==e.converter,{}).toMutation(s._key,Ba.exists(!1))]).then(()=>s)}function of(e,...t){e=R(e);let n={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof t[s]||ed(t[s])||(n=t[s++]);const r={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(ed(t[s])){const e=t[s];t[s]=e.next?.bind(e),t[s+1]=e.error?.bind(e),t[s+2]=e.complete?.bind(e)}let i,o,a;if(e instanceof Kl)o=di(e.firestore,td),a=Zo(e._key.path),i={next:n=>{t[s]&&t[s](cf(o,e,n))},error:t[s+1],complete:t[s+2]};else{const n=di(e,Gl);o=di(n.firestore,td),a=n._query;const r=new Zd(o);i={next:e=>{t[s]&&t[s](new Xd(o,r,n,e))},error:t[s+1],complete:t[s+2]},Dd(e._query)}return function(e,t,n,s){const r=new Ol(s),i=new Zh(t,r,n);return e.asyncQueue.enqueueAndForget(async()=>Gh(await Vl(e),i)),()=>{r.Nu(),e.asyncQueue.enqueueAndForget(async()=>Kh(await Vl(e),i))}}(sd(o),a,r,i)}function af(e,t){return function(e,t){const n=new Ur;return e.asyncQueue.enqueueAndForget(async()=>dl(await function(e){return Ul(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(sd(e),t)}function cf(e,t,n){const s=n.docs.get(t._key),r=new Zd(e);return new Wd(e,r,t._key,s,new Kd(n.hasPendingWrites,n.fromCache),t.converter)}function uf(){return new vd("serverTimestamp")}!function(e,t=!0){br=$e,Fe(new N("firestore",(e,{instanceIdentifier:n,options:s})=>{const r=e.getProvider("app").getImmediate(),i=new td(new Br(e.getProvider("auth-internal")),new Hr(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.call(e.options,"projectId"))throw new xr(Mr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new to(e.options.projectId,t)}(r,n),r);return s={useFetchStreams:t,...s},i._setSettings(s),i},"PUBLIC").setMultipleInstances(!0)),Ke(Er,Tr,e),Ke(Er,Tr,"esm2020")}();const hf=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Hd,Bytes:rd,CollectionReference:Wl,DocumentReference:Kl,DocumentSnapshot:Wd,FieldPath:id,FieldValue:od,Firestore:td,FirestoreError:xr,GeoPoint:ad,Query:Gl,QueryCompositeFilterConstraint:Ud,QueryConstraint:Pd,QueryDocumentSnapshot:Qd,QueryFieldFilterConstraint:Md,QueryLimitConstraint:jd,QueryOrderByConstraint:Vd,QuerySnapshot:Xd,SnapshotMetadata:Kd,Timestamp:yi,VectorValue:cd,_AutoId:Kr,_ByteString:Bi,_DatabaseId:to,_DocumentKey:ii,_EmptyAuthCredentialsProvider:Fr,_FieldPath:ri,_cast:di,_logWarn:Rr,_validateIsNotUsedTogether:ai,addDoc:rf,collection:Ql,connectFirestoreEmulator:Hl,deleteDoc:sf,doc:Xl,ensureFirestoreConfigured:sd,executeWrite:af,getDoc:Yd,getDocs:ef,getFirestore:nd,limit:Bd,onSnapshot:of,orderBy:Fd,query:Ld,serverTimestamp:uf,setDoc:tf,updateDoc:nf,where:xd},Symbol.toStringTag,{value:"Module"}));Ke("firebase","12.4.0","app");const lf="firebasestorage.googleapis.com";class df extends w{constructor(e,t,n=0){super(yf(e),`Firebase Storage: ${t} (${yf(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,df.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return yf(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var ff,pf,mf,gf;function yf(e){return"storage/"+e}function vf(e){return new df(ff.INVALID_ARGUMENT,e)}function wf(){return new df(ff.APP_DELETED,"The Firebase app was deleted.")}(pf=ff||(ff={})).UNKNOWN="unknown",pf.OBJECT_NOT_FOUND="object-not-found",pf.BUCKET_NOT_FOUND="bucket-not-found",pf.PROJECT_NOT_FOUND="project-not-found",pf.QUOTA_EXCEEDED="quota-exceeded",pf.UNAUTHENTICATED="unauthenticated",pf.UNAUTHORIZED="unauthorized",pf.UNAUTHORIZED_APP="unauthorized-app",pf.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",pf.INVALID_CHECKSUM="invalid-checksum",pf.CANCELED="canceled",pf.INVALID_EVENT_NAME="invalid-event-name",pf.INVALID_URL="invalid-url",pf.INVALID_DEFAULT_BUCKET="invalid-default-bucket",pf.NO_DEFAULT_BUCKET="no-default-bucket",pf.CANNOT_SLICE_BLOB="cannot-slice-blob",pf.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",pf.NO_DOWNLOAD_URL="no-download-url",pf.INVALID_ARGUMENT="invalid-argument",pf.INVALID_ARGUMENT_COUNT="invalid-argument-count",pf.APP_DELETED="app-deleted",pf.INVALID_ROOT_OPERATION="invalid-root-operation",pf.INVALID_FORMAT="invalid-format",pf.INTERNAL_ERROR="internal-error",pf.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class _f{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=_f.makeFromUrl(e,t)}catch(r){return new _f(e,"")}if(""===n.path)return n;throw s=e,new df(ff.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.");var s}static makeFromUrl(e,t){let n=null;const s="([A-Za-z0-9.\\-_]+)",r=RegExp("^gs://"+s+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${s}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:RegExp(`^https?://${t===lf?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${s}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let c=0;a.length>c;c++){const t=a[c],s=t.regex.exec(e);if(s){const e=s[t.indices.bucket];let r=s[t.indices.path];r||(r=""),n=new _f(e,r),t.postModify(n);break}}if(null==n)throw function(e){return new df(ff.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Ef{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Tf(e,t,n,s){if(t>s)throw vf(`Invalid value for '${e}'. Expected ${t} or greater.`);if(s>n)throw vf(`Invalid value for '${e}'. Expected ${n} or less.`)}(gf=mf||(mf={}))[gf.NO_ERROR=0]="NO_ERROR",gf[gf.NETWORK_ERROR=1]="NETWORK_ERROR",gf[gf.ABORT=2]="ABORT";class If{constructor(e,t,n,s,r,i,o,a,c,u,h,l=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=l,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{const n=this.resolve_,s=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0===e?n():n(e)}catch(i){s(i)}else if(null!==r){const e=new df(ff.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=r.getErrorText(),this.errorCallback_?s(this.errorCallback_(r,e)):s(e)}else t.canceled?s(this.appDelete_?wf():new df(ff.CANCELED,"User canceled the upload/download.")):s(new df(ff.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new bf(!1,null,!0)):this.backoffId_=function(e,t,n){let s=1,r=null,i=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){r=setTimeout(()=>{r=null,e(f,c())},t)}function d(){i&&clearTimeout(i)}function f(e,...t){if(u)return void d();if(e)return d(),void h(e,...t);if(c()||o)return d(),void h(e,...t);let n;64>s&&(s*=2),1===a?(a=2,n=0):n=1e3*(s+Math.random()),l(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==r?(e||(a=2),clearTimeout(r),l(0)):e||(a=1)))}return l(0),i=setTimeout(()=>{o=!0,m(!0)},n),m}((e,t)=>{if(t)return void e(!1,new bf(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const s=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(s),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(s),this.pendingConnection_=null;const t=n.getErrorCode()===mf.NO_ERROR,r=n.getStatus();if(!t||function(e,t){const n=e>=500&&600>e,s=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||s||r}(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===mf.ABORT;return void e(!1,new bf(!1,null,t))}const i=-1!==this.successCodes_.indexOf(r);e(!0,new bf(i,n))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class bf{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class Cf{constructor(e,t){this._service=e,this._location=t instanceof _f?t:_f.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Cf(e,t)}get root(){const e=new _f(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new _f(this._location.bucket,e);return new Cf(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new df(ff.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Sf(e,t){const n=t?.storageBucket;return null==n?null:_f.makeFromBucketSpec(n,e)}class kf{constructor(e,t,n,s,r,i=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=s,this._firebaseVersion=r,this._isUsingEmulator=i,this._bucket=null,this._host=lf,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?_f.makeFromBucketSpec(s,this._host):Sf(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=_f.makeFromBucketSpec(this._url,e):this._bucket=Sf(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Tf("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Tf("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(Be(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Cf(this,e)}_makeRequest(e,t,n,s,r=!0){if(this._deleted)return new Ef(wf());{const i=function(e,t,n,s,r,i,o=!0,a=!1){const c=function(e){const t=encodeURIComponent;let n="?";for(const s in e)e.hasOwnProperty(s)&&(n=n+(t(s)+"=")+t(e[s])+"&");return n=n.slice(0,-1),n}(e.urlParams),u=e.url+c,h=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(h,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(h,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}(h,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(h,s),new If(u,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,o,a)}(e,this._appId,n,s,t,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(e,t){const[n,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,s).getPromise()}}const Af="@firebase/storage",Rf="0.14.0",Nf="storage";function Df(e=Ge(),t){const n=je(e=R(e),Nf).getImmediate({identifier:t}),s=c("storage");return s&&function(e,t,n,s={}){!function(e,t,n,s={}){e.host=`${t}:${n}`;const r=d(t);r&&(f(`https://${e.host}/b`),y("Storage",!0)),e._isUsingEmulator=!0,e._protocol=r?"https":"http";const{mockUserToken:i}=s;i&&(e._overrideAuthToken="string"==typeof i?i:p(i,e.app.options.projectId))}(e,t,n,s)}(n,...s),n}Fe(new N(Nf,function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new kf(n,s,r,t,$e)},"PUBLIC").setMultipleInstances(!0)),Ke(Af,Rf,""),Ke(Af,Rf,"esm2020");const Of="functions";class Pf{constructor(e,t,n,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Be(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||n.get().then(e=>this.messaging=e,()=>{}),this.appCheck||s?.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e?.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const Lf="us-central1";class Mf{constructor(e,t,n,s,r=Lf,i=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new Pf(e,t,n,s),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(r);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=Lf}catch(o){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const xf="@firebase/functions",Uf="0.13.1";function Vf(e=Ge(),t=Lf){const n=je(R(e),Of).getImmediate({identifier:t}),s=c("functions");return s&&function(e,t,n){!function(e,t,n){const s=d(t);e.emulatorOrigin=`http${s?"s":""}://${t}:${n}`,s&&(f(e.emulatorOrigin+"/backends"),y("Functions",!0))}(R(e),t,n)}(n,...s),n}Fe(new N(Of,(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("messaging-internal"),i=e.getProvider("app-check-internal");return new Mf(n,s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),Ke(xf,Uf,void 0),Ke(xf,Uf,"esm2020");export{Bd as A,uf as B,hf as C,Vn as G,nd as a,Df as b,Vf as c,Ql as d,ef as e,Xl as f,ar as g,Yd as h,He as i,sf as j,rf as k,of as l,es as m,Qn as n,Fd as o,Xn as p,Ld as q,Zn as r,Wn as s,ts as t,nf as u,Jn as v,xd as w,tf as x,Yn as y,Ns as z};
