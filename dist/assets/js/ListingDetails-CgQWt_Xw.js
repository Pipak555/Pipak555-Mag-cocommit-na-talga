const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-DaMaslBo.js","assets/js/react-vendor-Ve3SFwKO.js","assets/js/utils-vendor-DzY7Ay74.js","assets/js/maps-vendor-CYGXCXz5.js","assets/maps-vendor-Dgihpmma.css","assets/js/ui-vendor-D9RGQy8n.js","assets/js/icons-vendor-Dhca6XHc.js","assets/js/firebase-vendor-BC71bXmb.js","assets/index-Bo0Pi70j.css","assets/js/recommendations-DjJW1acq.js"])))=>i.map(i=>d[i]);
import{r as e,j as s,C as t,d as a,B as i,e as r,u as l,l as n,s as o,h as c,v as d,a as m,b as x,c as h,i as u,_ as p,w as g}from"./index-DaMaslBo.js";import{r as f,j as w,q as j,u as b}from"./react-vendor-Ve3SFwKO.js";import{D as v,a as y,b as N,c as _,d as k}from"./dialog-GBvfaobK.js";import{B as C}from"./badge-BSgvUoVt.js";import{C as S}from"./calendar-CVp7jgzT.js";import{I as T}from"./input-D5hloL4G.js";import{L as D}from"./label-B2t2XnWQ.js";import{B as I}from"./BackButton-uEV41aeK.js";import{A as E,a as L}from"./avatar-BvAzSIZ_.js";import{S as R,a as A,b as F,c as P,d as z}from"./select-CXm8ONYg.js";import{q as O,d as V,w as M,o as $,l as W,h as H,f as G}from"./firebase-vendor-BC71bXmb.js";import{O as B,Q as U,g as q,t as Y,V as J,Y as Z,Z as K,_ as Q,$ as X,a0 as ee,a1 as se,a2 as te,a3 as ae,a4 as ie,a5 as re,q as le,p as ne,w as oe,U as ce,o as de,j as me,a6 as xe,X as he}from"./icons-vendor-Dhca6XHc.js";import{D as ue,a as pe,b as ge,c as fe,d as we}from"./dropdown-menu-DVnKNEtJ.js";import{L as je}from"./ListingCard-qYDZ01KR.js";import"./ui-vendor-D9RGQy8n.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";const be=({listingId:r,refreshTrigger:l})=>{const[n,o]=f.useState([]),[c,d]=f.useState(!0),[m,x]=f.useState("newest"),[h,u]=f.useState(new Set),p=f.useCallback(async()=>{try{d(!0);const s=await e(r);o(s)}catch(s){o([])}finally{d(!1)}},[r]);f.useEffect(()=>{if(!r)return;let e,t=!0;try{e=O(V(s,"reviews"),M("listingId","==",r),$("createdAt","desc"))}catch(i){t=!1,e=O(V(s,"reviews"),M("listingId","==",r))}const a=W(e,e=>{let s=e.docs.map(e=>({id:e.id,...e.data()}));t||(s=s.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),o(s),d(!1)},e=>{p()});return()=>{a()}},[r,p]),f.useEffect(()=>{void 0!==l&&l>0&&p()},[l,p]),f.useEffect(()=>{g()},[r]);const g=()=>{const e=localStorage.getItem("helpful_reviews_"+r);e&&u(new Set(JSON.parse(e)))},j=f.useMemo(()=>{const e=[...n];switch(m){case"newest":return e.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime());case"highest":return e.sort((e,s)=>s.rating-e.rating);case"lowest":return e.sort((e,s)=>e.rating-s.rating);case"most_helpful":return e.sort((e,s)=>{const t=h.has(e.id)?1:0,a=h.has(s.id)?1:0;return t!==a?a-t:s.rating-e.rating});default:return e}},[n,m,h]),b=f.useMemo(()=>0===n.length?0:(n.reduce((e,s)=>e+s.rating,0)/n.length).toFixed(1),[n]),v=f.useMemo(()=>{const e={5:0,4:0,3:0,2:0,1:0};return n.forEach(s=>{e[s.rating]++}),e},[n]);return c?w.jsx("p",{children:"Loading reviews..."}):0===n.length?w.jsx(t,{children:w.jsx(a,{className:"py-8 text-center text-muted-foreground",children:"No reviews yet"})}):w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[w.jsxs("div",{children:[w.jsxs("h3",{className:"text-2xl font-semibold mb-2",children:["Reviews (",n.length,")"]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("div",{className:"flex items-center",children:[w.jsx(B,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}),w.jsx("span",{className:"text-lg font-bold ml-1",children:b})]}),w.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",n.length," ",1===n.length?"review":"reviews",")"]})]})]}),w.jsxs(R,{value:m,onValueChange:e=>x(e),children:[w.jsxs(A,{className:"w-full sm:w-[200px]",children:[w.jsx(U,{className:"h-4 w-4 mr-2"}),w.jsx(F,{placeholder:"Sort by"})]}),w.jsxs(P,{children:[w.jsx(z,{value:"newest",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(q,{className:"h-4 w-4"}),w.jsx("span",{children:"Newest First"})]})}),w.jsx(z,{value:"highest",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(Y,{className:"h-4 w-4"}),w.jsx("span",{children:"Highest Rated"})]})}),w.jsx(z,{value:"lowest",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(Y,{className:"h-4 w-4 rotate-180"}),w.jsx("span",{children:"Lowest Rated"})]})}),w.jsx(z,{value:"most_helpful",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(J,{className:"h-4 w-4"}),w.jsx("span",{children:"Most Helpful"})]})})]})]})]}),w.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[w.jsx("h4",{className:"text-sm font-medium mb-3",children:"Rating Breakdown"}),w.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].reverse().map(e=>{const s=v[e],t=s/n.length*100;return w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("div",{className:"flex items-center gap-1 w-20",children:[w.jsx("span",{className:"text-sm",children:e}),w.jsx(B,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"})]}),w.jsx("div",{className:"flex-1 bg-background rounded-full h-2 overflow-hidden",children:w.jsx("div",{className:"bg-primary h-full rounded-full transition-all duration-300",style:{width:t+"%"}})}),w.jsx("span",{className:"text-sm text-muted-foreground w-12 text-right",children:s})]},e)})})]}),w.jsx("div",{className:"space-y-4",children:j.map(e=>w.jsx(t,{children:w.jsx(a,{className:"pt-6",children:w.jsxs("div",{className:"flex items-start gap-4",children:[w.jsx(E,{children:w.jsx(L,{children:e.guestId.slice(0,2).toUpperCase()})}),w.jsxs("div",{className:"flex-1",children:[w.jsx("div",{className:"flex items-start justify-between mb-2",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("div",{className:"flex",children:[...[,,,,,]].map((s,t)=>w.jsx(B,{className:"h-4 w-4 "+(t<e.rating?"fill-yellow-400 text-yellow-400":"text-muted")},t))}),w.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})}),w.jsx("p",{className:"text-sm mb-3 leading-relaxed",children:e.comment}),w.jsxs(i,{variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:()=>(e=>{const s=new Set(h);s.has(e)?s.delete(e):s.add(e),u(s),localStorage.setItem("helpful_reviews_"+r,JSON.stringify(Array.from(s)))})(e.id),children:[w.jsx(J,{className:"h-3 w-3 mr-1 "+(h.has(e.id)?"fill-primary text-primary":"")}),"Helpful ",h.has(e.id)&&"(1)"]})]})]})})},e.id))})]})},ve=({url:e,title:s,description:t="",variant:a="outline",size:l="default"})=>{const[n,o]=f.useState(!1),[c,d]=f.useState(!1),[m,x]=f.useState("Copy"),h=f.useRef(null),u=encodeURIComponent(e),p=encodeURIComponent(s),g=async()=>{if(window.isSecureContext||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),o(!0),r.success("Link copied to clipboard!"),void setTimeout(()=>o(!1),2e3)}catch(s){}const a=document.createElement("input");a.value=e,a.type="text",a.readOnly=!0,a.style.position="fixed",a.style.left="0",a.style.top="0",a.style.width="1px",a.style.height="1px",a.style.opacity="0",a.style.pointerEvents="none",a.style.zIndex="9999",document.body.appendChild(a),a.focus(),a.select(),a.setSelectionRange(0,e.length),await new Promise(e=>setTimeout(e,10));try{const e=document.execCommand("copy");if(document.body.removeChild(a),e)return o(!0),r.success("Link copied to clipboard!"),void setTimeout(()=>o(!1),2e3)}catch(t){document.body.contains(a)&&document.body.removeChild(a)}}catch(a){}d(!0),x("Copy"),setTimeout(()=>{h.current&&(h.current.focus(),h.current.select())},100)};return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"flex items-center gap-2",children:[navigator.share&&w.jsxs(i,{variant:a,size:l,onClick:async()=>{if(navigator.share)try{await navigator.share({title:s,text:t,url:e})}catch(a){a.name}else g()},className:"flex items-center gap-2",children:[w.jsx(Z,{className:"h-4 w-4"}),w.jsx("span",{className:"hidden sm:inline",children:"Share"})]}),w.jsxs(ue,{children:[w.jsx(pe,{asChild:!0,children:w.jsxs(i,{variant:a,size:l,className:"flex items-center gap-2",children:[w.jsx(Z,{className:"h-4 w-4"}),!navigator.share&&w.jsx("span",{children:"Share"}),navigator.share&&w.jsx("span",{className:"hidden sm:inline",children:"More"})]})}),w.jsxs(ge,{align:"end",className:"w-48",children:[w.jsx(fe,{onClick:g,children:n?w.jsxs(w.Fragment,{children:[w.jsx(K,{className:"h-4 w-4 mr-2 text-green-500"}),"Copied!"]}):w.jsxs(w.Fragment,{children:[w.jsx(Q,{className:"h-4 w-4 mr-2"}),"Copy Link"]})}),w.jsx(we,{}),w.jsxs(fe,{onClick:()=>{const e="https://www.facebook.com/sharer/sharer.php?u="+u;window.open(e,"_blank","noopener,noreferrer")},children:[w.jsx(X,{className:"h-4 w-4 mr-2 text-blue-600"}),"Share to Facebook"]}),w.jsxs(fe,{onClick:()=>{const e=`https://twitter.com/intent/tweet?url=${u}&text=${p}${t?"&hashtags=MojoDojoCasaHouse":""}`;window.open(e,"_blank","noopener,noreferrer")},children:[w.jsx(ee,{className:"h-4 w-4 mr-2 text-sky-500"}),"Share to Twitter"]}),w.jsxs(fe,{onClick:()=>{const e=`https://api.whatsapp.com/send?text=${p}%20${u}`;window.open(e,"_blank","noopener,noreferrer")},children:[w.jsx(se,{className:"h-4 w-4 mr-2 text-green-600"}),"Share to WhatsApp"]})]})]})]}),w.jsx(v,{open:c,onOpenChange:d,children:w.jsxs(y,{className:"sm:max-w-[500px]",children:[w.jsxs(N,{children:[w.jsxs(_,{className:"flex items-center gap-2",children:[w.jsx(Q,{className:"h-5 w-5"}),"Copy Link"]}),w.jsx(k,{children:"Share this listing with others by copying the link below"})]}),w.jsxs("div",{className:"space-y-4 py-4",children:[w.jsxs("div",{className:"flex gap-2",children:[w.jsx(T,{ref:h,value:e,readOnly:!0,className:"flex-1 font-mono text-sm",onFocus:e=>e.target.select()}),w.jsx(i,{onClick:async()=>{if(!h.current)return;const s=h.current;s.focus(),s.select(),s.setSelectionRange(0,e.length);try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),x("Copied!"),o(!0),r.success("Link copied to clipboard!"),void setTimeout(()=>{x("Copy"),d(!1),o(!1)},1500)}catch(t){}await new Promise(e=>setTimeout(e,10)),document.execCommand("copy")?(x("Copied!"),o(!0),r.success("Link copied to clipboard!"),setTimeout(()=>{x("Copy"),d(!1),o(!1)},1500)):(s.select(),r.info("Text selected. Press Ctrl+C (or Cmd+C) to copy"),x("Copy"))}catch(a){s.select(),r.info("Text selected. Press Ctrl+C (or Cmd+C) to copy"),x("Copy")}},className:"shrink-0",variant:"Copied!"===m?"default":"secondary",children:"Copied!"===m?w.jsxs(w.Fragment,{children:[w.jsx(K,{className:"h-4 w-4 mr-2"}),"Copied!"]}):w.jsxs(w.Fragment,{children:[w.jsx(te,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),w.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tip: You can also select the link above and press ",w.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs font-mono",children:"Ctrl+C"})," (or ",w.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs font-mono",children:"Cmd+C"})," on Mac) to copy"]})]})]})})]})},ye=()=>{const{id:e}=j(),N=b(),{user:E}=l(),[L,R]=f.useState(null),[A,F]=f.useState(),[P,z]=f.useState(),[O,V]=f.useState(1),[M,$]=f.useState(!1),[W,B]=f.useState([]),[U,q]=f.useState([]),[Y,J]=f.useState(null),[Z,K]=f.useState([]),[Q,X]=f.useState(null),[ee,se]=f.useState(""),[te,ue]=f.useState(0),[pe,ge]=f.useState(!1),[fe,we]=f.useState(0),[je,ye]=f.useState([]),[_e,ke]=f.useState(0);f.useEffect(()=>{e&&(Ce(),ue(0),window.scrollTo({top:0,behavior:"smooth"})),E&&(Te(),De(),Ie())},[e,E]),f.useEffect(()=>{if(!pe)return;const e=e=>{L?.images&&("ArrowLeft"===e.key?we(e=>0===e?L.images.length-1:e-1):"ArrowRight"===e.key?we(e=>e===L.images.length-1?0:e+1):"Escape"===e.key&&ge(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[pe,L?.images]);const Ce=async()=>{if(!e)return;const s=await n(e);if(s){const t=await o(e),a={...s,averageRating:t.averageRating,reviewCount:t.reviewCount};R(a),ke(e=>e+1),s.hostId&&await Se(s.hostId),await Ee()}},Se=async e=>{try{const t=await H(G(s,"users",e));if(t.exists()){const e=t.data();J({fullName:e.fullName||"Host",email:e.email||""})}else J({fullName:"Host",email:""})}catch(t){J({fullName:"Host",email:""})}},Te=async()=>{if(!E)return;const e=await H(G(s,"users",E.uid));e.exists()&&B(e.data().favorites||[])},De=async()=>{if(!E)return;const e=await H(G(s,"users",E.uid));e.exists()&&q(e.data().wishlist||[])},Ie=async()=>{if(!E)return;const e=await H(G(s,"users",E.uid));if(e.exists()){const s=e.data();K(s.coupons||[])}},Ee=async()=>{if(e)try{const s=(await c({status:"confirmed"})).filter(s=>s.listingId===e);ye(s)}catch(s){ye([])}},Le=e=>{if(!je.length)return!1;e.toISOString().split("T")[0];const s=e.getTime();return je.some(e=>{const t=new Date(e.checkIn),a=new Date(e.checkOut);return t.setHours(0,0,0,0),a.setHours(0,0,0,0),s>=t.getTime()&&s<=a.getTime()})},Re=e=>{const s=new Date;s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(0,0,0,0),s>t||!(e=>{if(!L?.availableDates||0===L.availableDates.length)return!0;const s=e.toISOString().split("T")[0];return L.availableDates.includes(s)})(t)||!!Le(t)},Ae=()=>{if(!A||!P||!L)return 0;const e=Math.ceil((P.getTime()-A.getTime())/864e5)*L.price;let s=e;if(L.discount&&L.discount>0){const t=e*L.discount/100;s=Math.max(0,e-t)}return Q&&s>=(Q.minSpend||0)?Math.max(0,s-Q.discount):s},Fe=()=>{if(!ee.trim())return void r.error("Please enter a coupon code");const e=Z.find(e=>e.code.toUpperCase()===ee.toUpperCase().trim()&&!e.used&&new Date(e.validUntil)>new Date);if(!e)return void r.error("Invalid, expired, or already used coupon");const s=A&&P&&L?Math.ceil((P.getTime()-A.getTime())/864e5)*L.price:0;e.minSpend&&s<e.minSpend?r.error("This coupon requires a minimum spend of "+u(e.minSpend)):(X(e),se(""),r.success(`Coupon ${e.code} applied! ${u(e.discount)} discount`))};return L?w.jsx("div",{className:"min-h-screen bg-background p-4 sm:p-6",children:w.jsxs("div",{className:"max-w-7xl mx-auto",children:[w.jsx(I,{to:"/guest/browse",label:"Back to Browse",className:"mb-4"}),w.jsxs("div",{className:"grid lg:grid-cols-12 gap-4 sm:gap-6 lg:gap-8",children:[w.jsxs("div",{className:"lg:col-span-7 space-y-3",children:[w.jsx("div",{className:"relative w-full h-[300px] sm:h-[400px] md:h-[500px] rounded-lg overflow-hidden group bg-muted cursor-pointer touch-manipulation",onClick:()=>{we(te),ge(!0)},children:L.images&&L.images.length>0?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"flex transition-transform duration-500 ease-in-out h-full",style:{transform:`translateX(-${100*te}%)`},children:L.images.map((e,s)=>w.jsx("div",{className:"min-w-full h-full flex-shrink-0 relative",children:w.jsx("img",{src:e||"/placeholder.svg",alt:`${L.title} - Image ${s+1}`,className:"w-full h-full object-cover"})},s))}),L.images.length>1&&w.jsxs(w.Fragment,{children:[w.jsx(i,{variant:"secondary",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",onClick:e=>{e.stopPropagation(),ue(e=>0===e?L.images.length-1:e-1)},"aria-label":"Previous image",children:w.jsx(ae,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),w.jsx(i,{variant:"secondary",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",onClick:e=>{e.stopPropagation(),ue(e=>e===L.images.length-1?0:e+1)},"aria-label":"Next image",children:w.jsx(ie,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),w.jsxs("div",{className:"absolute top-4 right-4 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs font-medium backdrop-blur-sm z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:[w.jsx(re,{className:"h-3 w-3 inline mr-1"}),"Click to zoom"]}),w.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-1.5 rounded-full text-sm font-medium backdrop-blur-sm z-10",children:[te+1," / ",L.images.length]})]})]}):w.jsx("img",{src:"/placeholder.svg",alt:L.title,className:"w-full h-full object-cover"})}),L.images&&L.images.length>1&&w.jsx("div",{className:"relative",children:w.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2 snap-x snap-mandatory touch-pan-x",children:L.images.map((e,s)=>w.jsx("button",{onClick:()=>ue(s),className:"relative flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden border-2 transition-all snap-start touch-manipulation "+(te===s?"border-primary ring-2 ring-primary/50 scale-105":"border-transparent hover:border-border opacity-70 hover:opacity-100 active:opacity-100"),children:w.jsx("img",{src:e,alt:"Thumbnail "+(s+1),className:"w-full h-full object-cover"})},s))})})]}),w.jsxs("div",{className:"lg:col-span-5 flex flex-col relative",children:[w.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-2 gap-2 sm:gap-0",children:[w.jsx(C,{className:"text-xs sm:text-sm",children:L.category}),w.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[E&&L&&w.jsxs(w.Fragment,{children:[w.jsxs(i,{variant:"outline",size:"sm",onClick:async()=>{if(E&&L)try{const{toggleWishlist:e}=await p(async()=>{const{toggleWishlist:e}=await import("./index-DaMaslBo.js").then(e=>e.W);return{toggleWishlist:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await e(E.uid,L.id,U);q(s),r.success(s.includes(L.id)?"Added to wishlist":"Removed from wishlist")}catch(e){r.error("Failed to update wishlist")}else r.error("Please login to add to wishlist")},className:"flex items-center gap-1.5 sm:gap-2 h-9 sm:h-auto text-xs sm:text-sm touch-manipulation",title:U.includes(L.id)?"Remove from wishlist":"Add to wishlist",children:[w.jsx(le,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 "+(U.includes(L.id)?"fill-blue-500 text-blue-500":"")}),w.jsx("span",{className:"hidden sm:inline",children:U.includes(L.id)?"In Wishlist":"Wishlist"})]}),w.jsxs(i,{variant:"outline",size:"sm",onClick:async()=>{if(E&&L)try{const{toggleFavorite:e}=await p(async()=>{const{toggleFavorite:e}=await import("./index-DaMaslBo.js").then(e=>e.W);return{toggleFavorite:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await e(E.uid,L.id,W);B(s),r.success(s.includes(L.id)?"Added to favorites":"Removed from favorites")}catch(e){r.error("Failed to update favorites")}else r.error("Please login to add favorites")},className:"flex items-center gap-1.5 sm:gap-2 h-9 sm:h-auto text-xs sm:text-sm touch-manipulation",title:W.includes(L.id)?"Remove from favorites":"Add to favorites",children:[w.jsx(ne,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 "+(W.includes(L.id)?"fill-red-500 text-red-500":"")}),w.jsx("span",{className:"hidden sm:inline",children:W.includes(L.id)?"Favorited":"Favorite"})]})]}),L&&w.jsx(ve,{url:window.location.href,title:L.title,description:L.description,variant:"outline",size:"sm"})]})]}),w.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:L.title}),w.jsxs("div",{className:"flex items-center text-muted-foreground mb-4",children:[w.jsx(oe,{className:"h-4 w-4 mr-1"}),w.jsx("span",{children:L.location})]}),w.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(ce,{className:"h-4 w-4"}),L.maxGuests," guests"]}),L.bedrooms&&w.jsxs("span",{children:[L.bedrooms," bedrooms"]}),L.bathrooms&&w.jsxs("span",{children:[L.bathrooms," bathrooms"]})]}),Y&&w.jsx(t,{className:"mb-6 border-primary/20 bg-primary/5",children:w.jsx(a,{className:"p-4",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:w.jsx(de,{className:"h-6 w-6 text-primary"})}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Hosted by"}),w.jsx("p",{className:"font-semibold text-lg",children:Y.fullName})]})]})})}),w.jsx("p",{className:"text-muted-foreground mb-6",children:L.description}),L.amenities.length>0&&w.jsxs("div",{className:"mb-6",children:[w.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),w.jsx("div",{className:"flex flex-wrap gap-2",children:L.amenities.map((e,s)=>w.jsx(C,{variant:"outline",children:e},s))})]})]})]}),w.jsxs(t,{className:"mt-6 sm:mt-8 shadow-lg",children:[w.jsxs(m,{className:"pb-4 sm:pb-6 px-4 sm:px-6",children:[w.jsxs(x,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[w.jsx(me,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),"Select Dates"]}),w.jsx(h,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Choose your check-in and check-out dates"})]}),w.jsx(a,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:w.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12",children:[w.jsx("div",{className:"flex flex-col",children:w.jsxs("div",{className:"flex flex-col",children:[w.jsxs("div",{className:"mb-4 pb-3 border-b",children:[w.jsxs("h3",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:[w.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),"Check-in"]}),A&&w.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:A.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),w.jsx("div",{className:"w-full",children:w.jsx("div",{className:"w-full border rounded-md shadow-sm bg-card p-4",children:w.jsx(S,{mode:"single",selected:A,onSelect:F,disabled:Re,modifiers:{booked:e=>Le(e)},modifiersClassNames:{booked:"bg-orange-500/20 text-orange-600 dark:text-orange-400"},className:"w-full max-w-none [&_.rdp-day_booked]:bg-orange-500/20 [&_.rdp-day_booked]:text-orange-600 dark:[&_.rdp-day_booked]:text-orange-400 [&_.rdp-day_booked]:relative [&_.rdp-day_booked]:after:content-['booked'] [&_.rdp-day_booked]:after:absolute [&_.rdp-day_booked]:after:bottom-0 [&_.rdp-day_booked]:after:left-1/2 [&_.rdp-day_booked]:after:-translate-x-1/2 [&_.rdp-day_booked]:after:text-[7px] [&_.rdp-day_booked]:after:leading-tight [&_.rdp-day_booked]:after:opacity-80 [&_.rdp-day_booked]:after:whitespace-nowrap [&_.rdp-day_booked]:after:pointer-events-none",classNames:{months:"w-full",month:"w-full space-y-3",caption:"flex justify-center pt-1 relative items-center mb-4",caption_label:"text-base font-semibold",nav:"space-x-1 flex items-center",nav_button:"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 absolute",nav_button_previous:"left-1",nav_button_next:"right-1",table:"w-full border-collapse",head_row:"w-full flex justify-between mb-2",head_cell:"flex-1 text-center text-sm font-medium text-muted-foreground",row:"w-full flex justify-between my-1",cell:"flex-1 text-center h-10",day:"w-full h-full flex items-center justify-center text-sm font-medium rounded-md hover:bg-accent transition-colors",day_disabled:"text-muted-foreground opacity-50 cursor-not-allowed pointer-events-none"}})})})]})}),w.jsx("div",{className:"flex flex-col lg:border-l lg:pl-12 lg:border-border/50",children:w.jsxs("div",{className:"flex flex-col",children:[w.jsxs("div",{className:"mb-4 pb-3 border-b",children:[w.jsxs("h3",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:[w.jsx("div",{className:"h-2 w-2 rounded-full bg-accent"}),"Check-out"]}),P&&w.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:P.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),w.jsx("div",{className:"w-full",children:w.jsx("div",{className:"w-full border rounded-md shadow-sm bg-card p-4",children:w.jsx(S,{mode:"single",selected:P,onSelect:z,disabled:e=>{if(!A)return!0;const s=new Date(A);s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(0,0,0,0),s>=t||Re(e)},modifiers:{booked:e=>Le(e)},modifiersClassNames:{booked:"bg-orange-500/20 text-orange-600 dark:text-orange-400"},className:"w-full max-w-none [&_.rdp-day_booked]:bg-orange-500/20 [&_.rdp-day_booked]:text-orange-600 dark:[&_.rdp-day_booked]:text-orange-400 [&_.rdp-day_booked]:relative [&_.rdp-day_booked]:after:content-['booked'] [&_.rdp-day_booked]:after:absolute [&_.rdp-day_booked]:after:bottom-0 [&_.rdp-day_booked]:after:left-1/2 [&_.rdp-day_booked]:after:-translate-x-1/2 [&_.rdp-day_booked]:after:text-[7px] [&_.rdp-day_booked]:after:leading-tight [&_.rdp-day_booked]:after:opacity-80 [&_.rdp-day_booked]:after:whitespace-nowrap [&_.rdp-day_booked]:after:pointer-events-none",classNames:{months:"w-full",month:"w-full space-y-3",caption:"flex justify-center pt-1 relative items-center mb-4",caption_label:"text-base font-semibold",nav:"space-x-1 flex items-center",nav_button:"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 absolute",nav_button_previous:"left-1",nav_button_next:"right-1",table:"w-full border-collapse",head_row:"w-full flex justify-between mb-2",head_cell:"flex-1 text-center text-sm font-medium text-muted-foreground",row:"w-full flex justify-between my-1",cell:"flex-1 text-center h-10",day:"w-full h-full flex items-center justify-center text-sm font-medium rounded-md hover:bg-accent transition-colors",day_disabled:"text-muted-foreground opacity-50 cursor-not-allowed pointer-events-none"}})})})]})})]})})]}),w.jsxs(t,{className:"mt-6 sm:mt-8 shadow-lg bg-card",children:[w.jsx(m,{className:"px-4 sm:px-6 pt-4 sm:pt-6",children:w.jsxs(x,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1 sm:gap-0",children:[w.jsxs("div",{className:"flex flex-col gap-1",children:[w.jsx("div",{className:"flex items-center gap-2",children:L.discount&&L.discount>0?w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"text-xl sm:text-2xl line-through text-muted-foreground",children:u(L.price)}),w.jsx("span",{className:"text-2xl sm:text-3xl text-primary font-bold",children:u(L.price*(1-L.discount/100))}),w.jsxs(C,{className:"bg-red-500 text-white",children:["-",L.discount,"%"]})]}):w.jsx("span",{className:"text-2xl sm:text-3xl",children:u(L.price)})}),L.promo&&w.jsx("p",{className:"text-xs sm:text-sm text-primary font-medium",children:L.promo})]}),w.jsx("span",{className:"text-xs sm:text-sm font-normal text-muted-foreground",children:"per night"})]})}),w.jsxs(a,{className:"space-y-4 px-4 sm:px-6 pb-4 sm:pb-6",children:[w.jsxs("div",{className:"space-y-2",children:[w.jsxs(D,{htmlFor:"guests",className:"text-sm font-medium flex items-center gap-2",children:[w.jsx(ce,{className:"h-4 w-4"}),"Number of Guests"]}),w.jsx(T,{id:"guests",type:"number",min:"1",max:L.maxGuests,value:O,onChange:e=>{const s=parseInt(e.target.value)||1;1>s||s>L.maxGuests?s>L.maxGuests?(V(L.maxGuests),r.error(`Maximum ${L.maxGuests} guest${L.maxGuests>1?"s":""} allowed`)):1>s&&V(1):V(s)},placeholder:"Enter number of guests",className:"w-full"}),w.jsxs("p",{className:"text-xs text-muted-foreground",children:["Maximum ",L.maxGuests," guest",L.maxGuests>1?"s":""," allowed"]})]}),w.jsx("div",{className:"pt-4 border-t",children:Q?w.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(xe,{className:"h-4 w-4 text-primary"}),w.jsx("span",{className:"text-sm font-medium",children:Q.code}),w.jsxs("span",{className:"text-xs text-muted-foreground",children:["-",u(Q.discount)]})]}),w.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>{X(null),r.info("Coupon removed")},children:w.jsx(he,{className:"h-4 w-4"})})]}):w.jsxs("div",{className:"space-y-2",children:[w.jsx("label",{className:"text-sm font-medium",children:"Have a coupon code?"}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx(T,{placeholder:"Enter coupon code",value:ee,onChange:e=>se(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&Fe()}),w.jsxs(i,{type:"button",variant:"outline",onClick:Fe,disabled:!ee.trim(),children:[w.jsx(xe,{className:"h-4 w-4 mr-2"}),"Apply"]})]})]})}),A&&P&&w.jsx("div",{className:"pt-4 border-t space-y-2",children:(()=>{const e=Math.ceil((P.getTime()-A.getTime())/864e5),s=e*L.price,t=A&&P&&L&&L.discount&&L.discount>0?Math.ceil((P.getTime()-A.getTime())/864e5)*L.price*L.discount/100:0,a=s-t,i=t>0||Q;return w.jsxs(w.Fragment,{children:[i&&w.jsxs("div",{className:"flex justify-between text-sm",children:[w.jsxs("span",{className:"text-muted-foreground",children:["Subtotal (",e," ",1===e?"night":"nights",")"]}),w.jsx("span",{children:u(s)})]}),t>0&&w.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[w.jsxs("span",{children:["Listing Discount (",L.discount,"%)"]}),w.jsxs("span",{children:["-",u(t)]})]}),t>0&&(Q||!i)&&w.jsxs("div",{className:"flex justify-between text-sm",children:[w.jsx("span",{className:"text-muted-foreground",children:"After Discount"}),w.jsx("span",{children:u(a)})]}),Q&&w.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[w.jsxs("span",{children:["Coupon Discount (",Q.code,")"]}),w.jsxs("span",{children:["-",u(Q.discount)]})]}),w.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[w.jsx("span",{children:"Total"}),w.jsx("span",{children:u(Ae())})]})]})})()}),w.jsx(i,{className:"w-full h-12 sm:h-auto text-base sm:text-sm touch-manipulation",onClick:async()=>{if(E&&L&&A&&P)if(O&&O>=1)if(O>L.maxGuests)r.error(`Maximum ${L.maxGuests} guest${L.maxGuests>1?"s":""} allowed for this listing`);else if(L.hostId){$(!0);try{const s=Math.ceil((P.getTime()-A.getTime())/864e5)*L.price,t=L.discount&&L.discount>0?s*L.discount/100:0,a=Q?Q.discount:0,i=Ae(),l={listingId:L.id,guestId:E.uid,hostId:L.hostId,checkIn:A.toISOString(),checkOut:P.toISOString(),guests:O,totalPrice:i,originalPrice:s,listingDiscount:L.discount||0,listingDiscountAmount:t,discountAmount:t+a,status:"pending"};Q?.code&&(l.couponCode=Q.code);const n=await g(l);try{const{getDoc:e,doc:s}=await p(async()=>{const{getDoc:e,doc:s}=await import("./firebase-vendor-BC71bXmb.js").then(e=>e.C);return{getDoc:e,doc:s}},[]),{db:t}=await p(async()=>{const{db:e}=await import("./index-DaMaslBo.js").then(e=>e.V);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await e(s(t,"bookings",n));if(a.exists()&&(a.data(),L.id)){const a=await e(s(t,"listing",L.id));a.exists()&&a.data()}}catch(e){}r.success("Booking request sent! The host will review your request."),N("/guest/dashboard")}catch(s){r.error("Failed to create booking")}finally{$(!1)}}else r.error("Listing error: Missing host information. Please contact support.");else r.error("Please enter the number of guests (minimum 1)");else r.error("Please select dates and sign in")},disabled:!A||!P||!O||1>O||O>L.maxGuests||M,children:M?"Booking...":"Request to Book"})]})]}),w.jsx(v,{open:pe,onOpenChange:ge,children:w.jsxs(y,{className:"max-w-[98vw] max-h-[98vh] w-auto h-auto p-0 bg-black/95 border-none m-1",children:[w.jsx(_,{className:"sr-only",children:"View Full Size Image"}),w.jsxs(k,{className:"sr-only",children:["Viewing image ",fe+1," of ",L?.images?.length||0," for ",L?.title]}),w.jsx("div",{className:"relative w-full h-full flex items-center justify-center min-h-[400px]",children:L?.images&&L.images.length>0&&w.jsxs(w.Fragment,{children:[w.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-10 sm:w-10",onClick:()=>ge(!1),children:w.jsx(he,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),w.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium backdrop-blur-sm z-50",children:[fe+1," / ",L.images.length]}),w.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 sm:p-4 pt-12 pb-20 sm:pb-24",children:w.jsx("img",{src:L.images[fe]||"/placeholder.svg",alt:`${L.title} - Image ${fe+1}`,className:"max-w-full max-h-[calc(98vh-160px)] object-contain"})}),L.images.length>1&&w.jsxs(w.Fragment,{children:[w.jsx(i,{variant:"ghost",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>we(e=>0===e?L.images.length-1:e-1),children:w.jsx(ae,{className:"h-4 w-4 sm:h-6 sm:w-6"})}),w.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>we(e=>e===L.images.length-1?0:e+1),children:w.jsx(ie,{className:"h-4 w-4 sm:h-6 sm:w-6"})})]}),L.images.length>1&&w.jsx("div",{className:"absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm rounded-lg p-2 sm:p-3 z-50 max-w-[calc(98vw-32px)]",children:w.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto scrollbar-hide px-1",children:L.images.map((e,s)=>w.jsx("button",{onClick:()=>we(s),className:"relative flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 rounded transition-all "+(fe===s?"scale-110 shadow-lg shadow-primary/50":"opacity-70 hover:opacity-100"),children:w.jsx("div",{className:"absolute inset-0 rounded overflow-hidden border-2 "+(fe===s?"border-primary ring-2 ring-primary/50 ring-offset-2 ring-offset-black/70":"border-transparent hover:border-white/50"),children:w.jsx("img",{src:e,alt:"Thumbnail "+(s+1),className:"w-full h-full object-cover transition-opacity "+(fe===s?"opacity-100":"opacity-70")})})},s))})})]})})]})}),w.jsx("div",{className:"mt-12 relative z-0",children:w.jsx(be,{listingId:L.id,refreshTrigger:_e})}),w.jsx("div",{className:"relative z-0",children:w.jsx(Ne,{listingId:L.id})})]})}):w.jsx(d,{})},Ne=({listingId:e})=>{const s=b(),{user:t}=l(),[a,i]=f.useState([]),[n,o]=f.useState([]),[c,d]=f.useState([]),[m,x]=f.useState(!0);f.useEffect(()=>{h(),t&&(u(),g())},[e,t]);const h=async()=>{try{const{getSimilarListings:s}=await p(async()=>{const{getSimilarListings:e}=await import("./recommendations-DjJW1acq.js");return{getSimilarListings:e}},__vite__mapDeps([9,7,0,1,2,3,4,5,6,8])),{getListingsRatings:t}=await p(async()=>{const{getListingsRatings:e}=await import("./index-DaMaslBo.js").then(e=>e.W);return{getListingsRatings:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(e,4);if(a.length>0){const e=a.map(e=>e.id),s=await t(e),r=a.map(e=>{const t=s.get(e.id);return{...e,averageRating:t?.averageRating||0,reviewCount:t?.reviewCount||0}});i(r)}else i(a)}catch(s){}finally{x(!1)}},u=async()=>{if(!t)return;const{doc:e,getDoc:s}=await p(async()=>{const{doc:e,getDoc:s}=await import("./firebase-vendor-BC71bXmb.js").then(e=>e.C);return{doc:e,getDoc:s}},[]),{db:a}=await p(async()=>{const{db:e}=await import("./index-DaMaslBo.js").then(e=>e.V);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await s(e(a,"users",t.uid));i.exists()&&o(i.data().favorites||[])},g=async()=>{if(!t)return;const{doc:e,getDoc:s}=await p(async()=>{const{doc:e,getDoc:s}=await import("./firebase-vendor-BC71bXmb.js").then(e=>e.C);return{doc:e,getDoc:s}},[]),{db:a}=await p(async()=>{const{db:e}=await import("./index-DaMaslBo.js").then(e=>e.V);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await s(e(a,"users",t.uid));i.exists()&&d(i.data().wishlist||[])};return m||0===a.length?null:w.jsxs("div",{className:"mt-12",children:[w.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Similar Listings"}),w.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:a.map(e=>w.jsx(je,{listing:e,onView:()=>{s("/guest/listing/"+e.id),window.scrollTo({top:0,behavior:"smooth"})},onFavorite:()=>(async e=>{if(t)try{const{toggleFavorite:s}=await p(async()=>{const{toggleFavorite:e}=await import("./index-DaMaslBo.js").then(e=>e.W);return{toggleFavorite:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(t.uid,e,n);o(a),r.success(a.includes(e)?"Added to favorites":"Removed from favorites")}catch(s){r.error("Failed to update favorites")}else r.error("Please login to add favorites")})(e.id),onWishlist:()=>(async e=>{if(t)try{const{toggleWishlist:s}=await p(async()=>{const{toggleWishlist:e}=await import("./index-DaMaslBo.js").then(e=>e.W);return{toggleWishlist:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(t.uid,e,c);d(a),r.success(a.includes(e)?"Added to wishlist":"Removed from wishlist")}catch(s){r.error("Failed to update wishlist")}else r.error("Please login to add to wishlist")})(e.id),isFavorite:n.includes(e.id),isInWishlist:c.includes(e.id)},e.id))})]})};export{ye as default};
