import{q as t,c as e,w as a,d as n,f as i,e as s,u as r,j as o}from"./firebase-vendor-BtzXZj7S.js";import{j as c,H as l}from"./index-Bl4WVUm9.js";import"./react-vendor-BMVo5gto.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";import"./icons-vendor-BQMxNFbQ.js";const d=[{id:"active-host-monthly",name:"Active Host",description:"Full access to host properties and manage listings",price:699,billingCycle:"monthly",features:["Unlimited listings","Priority support","Advanced analytics","Marketing tools","Booking management"],isActive:!0},{id:"active-host-yearly",name:"Active Host",description:"Full access to host properties and manage listings (Yearly)",price:6990,billingCycle:"yearly",features:["Unlimited listings","Priority support","Advanced analytics","Marketing tools","Booking management","Save 2 months (17% discount)"],isActive:!0}],p=()=>d.filter(t=>t.isActive),u=t=>d.find(e=>e.id===t)||null,m=async(i,l,d,p)=>{try{const m=u(l);if(!m)throw Error("Invalid plan selected");const y=new Date,g=new Date;"monthly"===m.billingCycle?g.setMonth(g.getMonth()+1):g.setFullYear(g.getFullYear()+1);const w=new Date(g),I=t(e(c,"subscriptions"),a("userId","==",i),a("status","==","active")),h=await n(I);let S;if(h.empty){const t={userId:i,planId:m.id,planName:m.name,amount:m.price,billingCycle:m.billingCycle,status:"active",startDate:y.toISOString(),endDate:g.toISOString(),nextBillingDate:w.toISOString(),paymentMethod:"paypal",paymentId:d,transactionId:p,createdAt:y.toISOString(),updatedAt:y.toISOString()};S=(await o(e(c,"subscriptions"),t)).id}else S=h.docs[0].id,await r(s(c,"subscriptions",S),{planId:m.id,planName:m.name,amount:m.price,billingCycle:m.billingCycle,status:"active",startDate:y.toISOString(),endDate:g.toISOString(),nextBillingDate:w.toISOString(),paymentMethod:"paypal",paymentId:d,transactionId:p,updatedAt:(new Date).toISOString()});return S}catch(m){throw Error(m.message||"Failed to create subscription")}},y=async i=>{try{const s=t(e(c,"subscriptions"),a("userId","==",i)),r=await n(s);if(r.empty)return null;const o=new Date;let l=null,d=new Date(0);return r.docs.forEach(t=>{const e={id:t.id,...t.data()},a=e.endDate?new Date(e.endDate):null;a&&a>o&&a>d&&(d=a,l=e)}),l}catch(s){return null}},g=async t=>{const e=await y(t);return!!e&&(e.endDate?new Date(e.endDate)>new Date:"active"===e.status)},w=async(t,e,a,n)=>{try{const i=u(e);if(!i)throw Error("Invalid plan selected");const s=await l({userId:t,type:"payment",amount:i.price,description:`Host subscription: ${i.name} (${i.billingCycle})`,status:"completed",paymentMethod:"paypal",paymentId:n});return{subscriptionId:await m(t,e,a,s),transactionId:s}}catch(i){throw Error(i.message||"Failed to process subscription payment")}},I=async t=>{try{const e=await i(s(c,"subscriptions",t));if(!e.exists())throw Error("Subscription not found");if("cancelled"===e.data().status)throw Error("Subscription is already cancelled");await r(s(c,"subscriptions",t),{status:"cancelled",cancelledAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})}catch(e){throw Error(e.message||"Failed to cancel subscription")}};export{d as HOST_PLANS,I as cancelSubscription,m as createHostSubscription,p as getAvailablePlans,u as getPlanById,y as getUserSubscription,g as hasActiveSubscription,w as processSubscriptionPayment};
