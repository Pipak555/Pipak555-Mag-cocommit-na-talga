import{j as e,l as s,u as a,r as t}from"./react-vendor-DcULH_Au.js";import{C as i,a as l,b as r,d as n,B as c,j as d,e as o,u,z as m,c as x,i as p}from"./index-F95ZJi6y.js";import{f as h,e as y,u as j}from"./firebase-vendor-BtzXZj7S.js";import{I as f}from"./input-CGAn_-_v.js";import{y as g,$ as w,f as b,L as N,C as P,a0 as v,a1 as k,A as C,r as E,s as A,a2 as S}from"./icons-vendor-D18eSOBA.js";import{C as R}from"./CouponManager-UwYMzc3U.js";import{P as V}from"./PayPalButton-CrZR6r-x.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-C9dhA_ey.js";import"./badge-BPytCQbI.js";const $=({points:s,onRedeem:a})=>e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-yellow-500"}),"Points & Rewards"]})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-primary/10 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:s}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Points"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Available Rewards:"}),[{points:100,reward:"$10 discount",discount:10},{points:250,reward:"$30 discount",discount:30},{points:500,reward:"$75 discount",discount:75},{points:1e3,reward:"$200 discount",discount:200}].map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:t.reward}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.points," points"]})]})]}),e.jsx(c,{size:"sm",disabled:s<t.points,onClick:()=>a?.(t.points),children:"Redeem"})]},t.points))]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4 p-3 bg-muted rounded",children:[e.jsx("p",{className:"font-semibold mb-1",children:"How to earn points:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Complete a booking: +50 points"}),e.jsx("li",{children:"• Write a review: +20 points"}),e.jsx("li",{children:"• Refer a friend: +100 points"}),e.jsx("li",{children:"• Host a property: +30 points per booking"})]})]})]})]}),D=({userId:i,onVerified:l,paypalEmail:r,paypalVerified:n})=>{const[u]=s(),m=a(),[x,p]=t.useState(!1),[f,g]=t.useState(!1);let w=window.location.origin+"/paypal-callback";w.includes("localhost")&&(w=w.replace("localhost","127.0.0.1"));const C=t.useCallback(async e=>{g(!0);try{const e=await h(y(d,"users",i)),s=e.exists()?e.data():null,a=s?.paypalEmail||null,t={paypalEmailVerified:!0,paypalVerifiedAt:(new Date).toISOString(),paypalOAuthVerified:!0};a||(t.paypalEmail=null),await j(y(d,"users",i),t),a?(o.success("PayPal account verified! You successfully logged in with PayPal."),l(a)):(o.success("PayPal account verified! Your email will be stored on your first payment."),l("")),m(window.location.pathname,{replace:!0})}catch(s){o.error("Failed to verify PayPal account. Please try again."),m(window.location.pathname,{replace:!0})}finally{g(!1)}},[i,m,l]);return t.useEffect(()=>{const e=u.get("code"),s=u.get("state");if(u.get("error"))return o.error("PayPal login was cancelled or failed. Please try again."),void m(window.location.pathname,{replace:!0});e&&s==="paypal-verify-"+i&&C(e)},[u,i,m,C]),n&&r?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"PayPal Account Verified"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:r}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Your account was verified by logging in with PayPal"})]})]})})}):f?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex items-center justify-center p-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Verifying PayPal account..."}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-2",children:"Please wait while we verify your account"})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(P,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}),e.jsx("p",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:"Link your PayPal account to make deposits and payments. You'll log in with your PayPal credentials to verify your account."})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Don't have a PayPal account?"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>window.open("https://www.paypal.com/signup","_blank"),className:"w-full mb-2",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Sign up for PayPal"]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Create a free PayPal account, then come back to link it"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"How it works:"}),e.jsxs("ol",{className:"text-xs text-muted-foreground space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:'Click "Link PayPal Account" below'}),e.jsx("li",{children:"You'll be redirected to PayPal's login page"}),e.jsx("li",{children:"Log in with your PayPal email and password"}),e.jsx("li",{children:"PayPal will verify your account and redirect you back"}),e.jsx("li",{children:"Your account will be linked and verified ✅"})]})]}),e.jsx(c,{onClick:()=>{p(!0);const e="paypal-verify-"+i,s=`https://www.sandbox.paypal.com/webapps/auth/protocol/openidconnect/v1/authorize?client_id=EBY2ts8baThwt97plOoNWxeryVxWHXEe-ANWAexRZ7zq1sfq-qIa90XNhC5JExAaFGTvrF_TT2hqwzj0&response_type=code&scope=${encodeURIComponent("openid email profile")}&redirect_uri=${encodeURIComponent(w)}&state=${e}`;window.location.href=s},disabled:x,className:"w-full",size:"lg",children:x?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Redirecting to PayPal..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"You'll be redirected to PayPal to log in with your account credentials"})]})]})},I=()=>{const s=a(),{user:g}=u(),[w,b]=t.useState(0),[N,P]=t.useState(0),[v,I]=t.useState([]),[L,W]=t.useState([]),[Y,z]=t.useState(""),[F,T]=t.useState(!1),[B,H]=t.useState(""),[U,_]=t.useState(!1),[q,O]=t.useState(!1);t.useEffect(()=>{g&&(X(),G())},[g]);const X=async()=>{if(!g)return;const e=await h(y(d,"users",g.uid));if(e.exists()){const s=e.data();b(s.walletBalance||0),P(s.points||0),I(s.coupons||[]),H(s.paypalEmail||""),_(!!s.paypalEmail),O(!!s.paypalEmailVerified)}},G=async()=>{if(!g)return;const e=await m(g.uid);W(e)},J=t.useCallback(e=>{H(e),_(!0),O(!0),X()},[g]);return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(c,{variant:"ghost",onClick:()=>s("/guest/dashboard"),className:"mb-6",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"E-Wallet & Rewards"}),e.jsxs(i,{className:"mb-6 border-2",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"PayPal Account Verification"]}),e.jsx(x,{children:"Link your PayPal account by logging in with your PayPal credentials. This verifies you have a real PayPal account."})]}),e.jsxs(n,{children:[g?e.jsx(D,{userId:g.uid,onVerified:J,paypalEmail:B,paypalVerified:q}):e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please sign in to verify your PayPal account"})}),q&&B&&e.jsx("div",{className:"mt-4",children:e.jsx(c,{variant:"outline",size:"sm",onClick:async()=>{if(g)try{await j(y(d,"users",g.uid),{paypalEmail:null,paypalEmailVerified:!1,paypalLinkedAt:null}),_(!1),H(""),o.success("PayPal account unlinked")}catch(e){o.error("Failed to unlink PayPal account")}},className:"w-full",children:"Unlink PayPal Account"})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Current Balance"]})}),e.jsxs(n,{children:[e.jsx("p",{className:"text-4xl font-bold text-primary mb-6",children:p(w)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(f,{type:"number",placeholder:"Amount",value:Y,onChange:e=>z(e.target.value),min:"1",step:"0.01",disabled:!B})}),B?g&&Y&&+Y>0?e.jsx(V,{amount:+Y,userId:g.uid,description:"Wallet deposit: "+p(+Y),onSuccess:async()=>{if(!g||!Y||0>=+Y)return;await X(),await G(),z("");const e=await h(y(d,"users",g.uid));e.exists()&&e.data().paypalEmailVerified&&!q&&(O(!0),o.success("PayPal account verified! Your account has been verified through a successful payment."))},redirectUrl:window.location.origin+"/guest/wallet"}):e.jsx(c,{onClick:async()=>{g&&Y&&+Y>0?B?o.info("Please use PayPal to add funds to your wallet"):o.error("Please link your PayPal account first to make deposits"):o.error("Enter a valid amount")},disabled:!Y||0>=+Y,children:"Enter amount to deposit"}):e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Link your PayPal account above to make deposits"})})]})]})]}),e.jsx($,{points:N,onRedeem:async e=>{if(g)if(e>N)o.error("Not enough points");else try{const s=100===e?10:250===e?30:500===e?75:200,a={id:"REWARD"+Date.now(),code:"REWARD"+Date.now(),discount:s/w*100,validUntil:new Date(Date.now()+2592e6).toISOString(),used:!1},t=N-e;await j(y(d,"users",g.uid),{points:t,coupons:[...v,a]}),P(t),I([...v,a]),o.success(`Redeemed ${e} points for ${p(s)} coupon!`)}catch(s){o.error("Failed to redeem points")}}})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsx(R,{coupons:v,onApplyCoupon:e=>{const s=v.find(s=>s.code===e&&!s.used);s?o.success(`Coupon ${e} applied! ${s.discount}% discount`):o.error("Invalid or already used coupon")}}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsx(r,{children:"Transaction History"})}),e.jsx(n,{children:0===L.length?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No transactions yet"}):e.jsx("div",{className:"space-y-3",children:L.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:["deposit"===s.type||"reward"===s.type?e.jsx(A,{className:"h-5 w-5 text-green-500"}):e.jsx(S,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.description}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]})]}),e.jsxs("p",{className:"font-semibold "+("deposit"===s.type||"reward"===s.type?"text-green-500":"text-red-500"),children:["deposit"===s.type||"reward"===s.type?"+":"-",p(s.amount)]})]},s.id))})})]})]})]})})};export{I as default};
