import{u as s,r as e,j as t}from"./react-vendor-BMVo5gto.js";import{u as a,L as i,B as r,C as o,a as n,b as l,d as c,i as d,c as m,j as x,e as h}from"./index-Bl4WVUm9.js";import{N as j}from"./NotificationBell-CwTk-oRi.js";import{D as u,a as g,b as p,c as f,d as N}from"./dialog-DVuhSEXh.js";import{T as v,a as w,b,c as y,d as k,e as A}from"./table-D4LWTJSW.js";import{T as C}from"./theme-toggle-Cc0KLt9y.js";import{k as S,c as F,q as I,w as L,d as T,f as B,e as U}from"./firebase-vendor-BtzXZj7S.js";import{A as D,a as M,b as O,c as P,d as E,e as H,f as R,g as z}from"./alert-dialog-ChaDevpt.js";import{S as G,U as $,H as V,m as W,s as _,F as q,n as Y,l as J,C as K,L as Q}from"./icons-vendor-BQMxNFbQ.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";import"./scroll-area-Dt92Xony.js";import"./badge-_91-i8yA.js";import"./dropdown-menu-CmwzabuV.js";const X=()=>{const{user:X,userRole:Z,userProfile:ss,signOut:es}=a(),ts=s(),[as,is]=e.useState({totalUsers:0,totalHosts:0,totalGuests:0,totalAdmins:0,activeListings:0,totalBookings:0,cancelledBookings:0,serviceFees:0}),[rs,os]=e.useState(!1),[ns,ls]=e.useState(!1),[cs,ds]=e.useState([]),[ms,xs]=e.useState(!1);return e.useEffect(()=>{if(!X||"admin"!==Z)return void ts("/admin/login");let s=null,e=null,t=null;return s=S(F(x,"users"),s=>{const e=s.docs.map(s=>{const e=s.data();return{id:s.id,email:e.email,role:e.role,fullName:e.fullName,...e}}),t=e.filter(s=>"host"===s.role).length,a=e.filter(s=>"guest"===s.role).length,i=e.filter(s=>"admin"===s.role).length;is(e=>({...e,totalUsers:s.size,totalHosts:t,totalGuests:a,totalAdmins:i}))},s=>{h.error("Failed to load users: "+s.message)}),e=S(F(x,"listing"),s=>{const e=s.docs.filter(s=>"approved"===s.data().status).length;is(s=>({...s,activeListings:e}))},s=>{h.error("Failed to load listings: "+s.message)}),t=S(F(x,"bookings"),s=>{const e=s.docs.map(s=>s.data()),t=e.filter(s=>"confirmed"===s.status||"completed"===s.status),a=e.filter(s=>"cancelled"===s.status);t.reduce((s,e)=>s+(e.totalPrice||0),0),is(e=>({...e,totalBookings:s.size,cancelledBookings:a.length}))},s=>{h.error("Failed to load bookings: "+s.message)}),(async()=>{try{const s=I(F(x,"transactions"),L("userId","==","platform"),L("paymentMethod","==","service_fee")),e=(await T(s)).docs.reduce((s,e)=>s+(e.data().amount||0),0);is(s=>({...s,serviceFees:e}))}catch(s){}})(),()=>{s&&s(),e&&e(),t&&t()}},[X,Z,ts]),t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsx("header",{className:"sticky top-0 z-50 border-b bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 shadow-soft",children:t.jsxs("div",{className:"container mx-auto px-6 py-4 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(i,{size:"sm"}),t.jsx("div",{className:"p-2 rounded-lg bg-accent/10",children:t.jsx(G,{className:"w-5 h-5 text-accent"})}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-lg font-bold",children:["Welcome, ",ss?.fullName||"Admin","!"]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Platform management"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(j,{}),t.jsx(C,{}),t.jsx(r,{variant:"outline",onClick:()=>os(!0),children:"Sign Out"})]})]})}),t.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsxs("div",{className:"mb-8 p-6 rounded-xl bg-gradient-accent text-white",children:[t.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Platform Overview"}),t.jsxs("p",{className:"text-white/90",children:["Welcome back, ",ss?.fullName||"Admin","!"]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsxs(o,{className:"shadow-soft",children:[t.jsx(n,{className:"pb-3",children:t.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Total Users"})}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold",children:as.totalUsers}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[as.totalHosts," hosts, ",as.totalGuests," guests",as.totalAdmins>0?`, ${as.totalAdmins} admin${as.totalAdmins>1?"s":""}`:""]})]})]}),t.jsxs(o,{className:"shadow-soft cursor-pointer hover:shadow-medium transition-shadow",onClick:()=>ts("/admin/active-listings"),children:[t.jsx(n,{className:"pb-3",children:t.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Active Listings"})}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold",children:as.activeListings}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Click to manage"})]})]}),t.jsxs(o,{className:"shadow-soft",children:[t.jsx(n,{className:"pb-3",children:t.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Total Bookings"})}),t.jsx(c,{children:t.jsx("div",{className:"text-2xl font-bold",children:as.totalBookings})})]}),t.jsxs(o,{className:"shadow-soft cursor-pointer hover:shadow-medium transition-shadow",onClick:async()=>{ls(!0),xs(!0);try{const s=I(F(x,"transactions"),L("userId","==","platform"),L("paymentMethod","==","service_fee")),e=await T(s),t=await Promise.all(e.docs.map(async s=>{const e=s.data(),t={id:s.id,...e};if(e.hostId)try{const s=await B(U(x,"users",e.hostId));if(s.exists()){const e=s.data();t.hostName=e.fullName||"N/A",t.hostEmail=e.email||"N/A"}}catch(a){}if(e.bookingId)try{const s=await B(U(x,"bookings",e.bookingId));if(s.exists()){const i=s.data();if(t.bookingId=e.bookingId,i.listingId)try{const s=await B(U(x,"listing",i.listingId));if(s.exists()){const e=s.data();t.listingTitle=e.title||"N/A"}}catch(a){}}}catch(a){}return t}));t.sort((s,e)=>{const t=new Date(s.createdAt||0).getTime();return new Date(e.createdAt||0).getTime()-t}),ds(t)}catch(s){h.error("Failed to load service fee breakdown: "+(s.message||"Unknown error"))}finally{xs(!1)}},children:[t.jsx(n,{className:"pb-3",children:t.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Service Fees"})}),t.jsxs(c,{children:[t.jsx("div",{className:"text-2xl font-bold text-accent",children:d(as.serviceFees)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"10% commission â€¢ Click to view breakdown"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/users"),children:t.jsxs(n,{children:[t.jsx($,{className:"w-8 h-8 text-primary mb-2"}),t.jsx(l,{children:"User Management"}),t.jsx(m,{children:"Manage hosts, guests, and permissions"})]})}),t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/listings"),children:t.jsxs(n,{children:[t.jsx(V,{className:"w-8 h-8 text-primary mb-2"}),t.jsx(l,{children:"Listings Review"}),t.jsx(m,{children:"Approve and moderate listings"})]})}),t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/payments"),children:t.jsxs(n,{children:[t.jsx(W,{className:"w-8 h-8 text-accent mb-2"}),t.jsx(l,{children:"Payment Management"}),t.jsx(m,{children:"Review and confirm payments"})]})}),t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/analytics"),children:t.jsxs(n,{children:[t.jsx(_,{className:"w-8 h-8 text-secondary mb-2"}),t.jsx(l,{children:"Analytics"}),t.jsx(m,{children:"View platform performance metrics"})]})}),t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/reports"),children:t.jsxs(n,{children:[t.jsx(q,{className:"w-8 h-8 text-secondary mb-2"}),t.jsx(l,{children:"Reports"}),t.jsx(m,{children:"Generate platform reports"})]})}),t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/policies"),children:t.jsxs(n,{children:[t.jsx(Y,{className:"w-8 h-8 text-muted-foreground mb-2"}),t.jsx(l,{children:"Policies & Settings"}),t.jsx(m,{children:"Manage platform policies"})]})}),t.jsx(o,{className:"shadow-medium hover:shadow-hover transition-smooth cursor-pointer",onClick:()=>ts("/admin/messages"),children:t.jsxs(n,{children:[t.jsx(J,{className:"w-8 h-8 text-primary mb-2"}),t.jsx(l,{children:"Messages"}),t.jsx(m,{children:"View and respond to messages"})]})})]}),t.jsxs(o,{className:"shadow-medium",children:[t.jsxs(n,{children:[t.jsx(l,{children:"Recent Activity"}),t.jsx(m,{children:"Latest platform events"})]}),t.jsx(c,{children:t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(K,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No recent activity to display"})]})})]})]}),t.jsx(u,{open:ns,onOpenChange:ls,children:t.jsxs(g,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(p,{children:[t.jsxs(f,{className:"flex items-center gap-2",children:[t.jsx(W,{className:"h-5 w-5"}),"Service Fee Breakdown"]}),t.jsx(N,{children:"Detailed breakdown of all service fees collected (10% commission)"})]}),ms?t.jsxs("div",{className:"flex items-center justify-center py-12",children:[t.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("p",{className:"ml-3 text-muted-foreground",children:"Loading breakdown..."})]}):0===cs.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(K,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("p",{className:"text-muted-foreground",children:"No service fees collected yet"})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx(o,{children:t.jsx(c,{className:"pt-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Service Fees"}),t.jsx("p",{className:"text-2xl font-bold text-accent",children:d(cs.reduce((s,e)=>s+(e.amount||0),0))})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Transactions"}),t.jsx("p",{className:"text-2xl font-bold",children:cs.length})]})]})})}),t.jsx("div",{className:"border rounded-lg",children:t.jsxs(v,{children:[t.jsx(w,{children:t.jsxs(b,{children:[t.jsx(y,{children:"Date"}),t.jsx(y,{children:"Booking ID"}),t.jsx(y,{children:"Listing"}),t.jsx(y,{children:"Host Name"}),t.jsx(y,{children:"Host Email"}),t.jsx(y,{className:"text-right",children:"Service Fee"})]})}),t.jsx(k,{children:cs.map(s=>t.jsxs(b,{children:[t.jsx(A,{children:s.createdAt?new Date(s.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}),t.jsx(A,{children:t.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.bookingId?.slice(0,8)||"N/A"})}),t.jsx(A,{className:"max-w-[200px] truncate",children:s.listingTitle||"N/A"}),t.jsx(A,{children:s.hostName||"N/A"}),t.jsx(A,{children:s.hostEmail?t.jsx("a",{href:"mailto:"+s.hostEmail,className:"text-primary hover:underline",children:s.hostEmail}):"N/A"}),t.jsx(A,{className:"text-right font-semibold text-accent",children:d(s.amount||0)})]},s.id))})]})})]})]})}),t.jsx(D,{open:rs,onOpenChange:os,children:t.jsxs(M,{children:[t.jsxs(O,{children:[t.jsx(P,{children:"Sign Out"}),t.jsx(E,{children:"Are you sure you want to sign out? You'll need to sign in again to access your account."})]}),t.jsxs(H,{children:[t.jsx(R,{children:"Cancel"}),t.jsx(z,{onClick:async()=>{await es(),ts("/")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sign Out"})]})]})})]})};export{X as default};
