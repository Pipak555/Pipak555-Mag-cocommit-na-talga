import{u as e,r as s,j as t}from"./react-vendor-Ve3SFwKO.js";import{u as n,v as a,C as i,a as o,b as c,c as l,d as r,B as d,e as p}from"./index-DaMaslBo.js";import{c as u,s as h}from"./eventService-CgRnQu3Z.js";import{I as x}from"./input-D5hloL4G.js";import{L as m}from"./label-B2t2XnWQ.js";import{T as j}from"./textarea-bhWBiMTW.js";import{C as v}from"./checkbox-CoVncUmC.js";import{S as g,a as N,b as f,c as y,d as C}from"./select-CXm8ONYg.js";import{B as b}from"./BackButton-uEV41aeK.js";import{G as U,u as D,L as F}from"./icons-vendor-Dhca6XHc.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";import"./firebase-vendor-BC71bXmb.js";const S=()=>{const S=e(),{user:A,userRole:R}=n(),[k,w]=s.useState(!1),[M,V]=s.useState({title:"",description:"",type:"announcement",targetRoles:[],couponCode:"",couponDiscount:"",couponValidUntil:"",couponMinSpend:"",actionUrl:"",expiresAt:""});if(!A||"admin"!==R)return t.jsx(a,{});const E=e=>{V(s=>({...s,targetRoles:s.targetRoles.includes(e)?s.targetRoles.filter(s=>s!==e):[...s.targetRoles,e]}))};return t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsxs("div",{className:"max-w-3xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(b,{to:"/admin/dashboard",label:"Back to Dashboard"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Create Platform Event"}),t.jsx("p",{className:"text-muted-foreground",children:"Create events and notify users (e.g., coupon codes, announcements)"})]})]}),t.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),M.title&&M.description)if(0!==M.targetRoles.length)if("coupon"!==M.type||M.couponCode&&M.couponDiscount){w(!0);try{const e=await u({title:M.title,description:M.description,type:M.type,targetRoles:M.targetRoles,couponCode:"coupon"===M.type?M.couponCode:void 0,couponDiscount:"coupon"===M.type&&M.couponDiscount?parseFloat(M.couponDiscount):void 0,couponValidUntil:"coupon"===M.type&&M.couponValidUntil?M.couponValidUntil:void 0,couponMinSpend:"coupon"===M.type&&M.couponMinSpend?parseFloat(M.couponMinSpend):void 0,actionUrl:M.actionUrl||void 0,expiresAt:M.expiresAt||void 0,createdBy:A.uid,status:"active"});await h(e),p.success("Event created and notifications sent!"),S("/admin/dashboard")}catch(s){p.error("Failed to create event: "+(s.message||"Unknown error"))}finally{w(!1)}}else p.error("Please provide coupon code and discount");else p.error("Please select at least one target role");else p.error("Please fill in all required fields")},children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs(i,{children:[t.jsxs(o,{children:[t.jsx(c,{children:"Event Information"}),t.jsx(l,{children:"Basic details about the event"})]}),t.jsxs(r,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:"title",children:["Event Title ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:"title",value:M.title,onChange:e=>V(s=>({...s,title:e.target.value})),placeholder:"e.g., Special Holiday Discount",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:"description",children:["Description ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(j,{id:"description",value:M.description,onChange:e=>V(s=>({...s,description:e.target.value})),placeholder:"Describe the event...",className:"min-h-[100px]",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:"type",children:"Event Type"}),t.jsxs(g,{value:M.type,onValueChange:e=>V(s=>({...s,type:e})),children:[t.jsx(N,{children:t.jsx(f,{})}),t.jsxs(y,{children:[t.jsx(C,{value:"coupon",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(U,{className:"h-4 w-4"}),"Coupon Code"]})}),t.jsx(C,{value:"announcement",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{className:"h-4 w-4"}),"Announcement"]})}),t.jsx(C,{value:"promotion",children:"Promotion"}),t.jsx(C,{value:"maintenance",children:"Maintenance"}),t.jsx(C,{value:"update",children:"Update"})]})]})]})]})]}),t.jsxs(i,{children:[t.jsxs(o,{children:[t.jsx(c,{children:"Target Audience"}),t.jsx(l,{children:"Select which users should receive this event"})]}),t.jsx(r,{className:"space-y-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs(m,{children:["Target Roles ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsxs("div",{className:"flex flex-wrap gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(v,{id:"target-host",checked:M.targetRoles.includes("host"),onCheckedChange:()=>E("host")}),t.jsx(m,{htmlFor:"target-host",className:"cursor-pointer",children:"Hosts"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(v,{id:"target-guest",checked:M.targetRoles.includes("guest"),onCheckedChange:()=>E("guest")}),t.jsx(m,{htmlFor:"target-guest",className:"cursor-pointer",children:"Guests"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(v,{id:"target-admin",checked:M.targetRoles.includes("admin"),onCheckedChange:()=>E("admin")}),t.jsx(m,{htmlFor:"target-admin",className:"cursor-pointer",children:"Admins"})]})]})]})})]}),"coupon"===M.type&&t.jsxs(i,{children:[t.jsxs(o,{children:[t.jsxs(c,{className:"flex items-center gap-2",children:[t.jsx(U,{className:"h-5 w-5"}),"Coupon Details"]}),t.jsx(l,{children:"Configure the coupon code to distribute"})]}),t.jsxs(r,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:"couponCode",children:["Coupon Code ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:"couponCode",value:M.couponCode,onChange:e=>V(s=>({...s,couponCode:e.target.value.toUpperCase()})),placeholder:"e.g., HOLIDAY2025",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(m,{htmlFor:"couponDiscount",children:["Discount Amount (₱) ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(x,{id:"couponDiscount",type:"number",min:"0",step:"0.01",value:M.couponDiscount,onChange:e=>V(s=>({...s,couponDiscount:e.target.value})),placeholder:"e.g., 100",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:"couponValidUntil",children:"Valid Until"}),t.jsx(x,{id:"couponValidUntil",type:"datetime-local",value:M.couponValidUntil,onChange:e=>V(s=>({...s,couponValidUntil:e.target.value}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:"couponMinSpend",children:"Minimum Purchase (₱)"}),t.jsx(x,{id:"couponMinSpend",type:"number",min:"0",step:"0.01",value:M.couponMinSpend,onChange:e=>V(s=>({...s,couponMinSpend:e.target.value})),placeholder:"e.g., 500"})]})]})]}),t.jsxs(i,{children:[t.jsx(o,{children:t.jsx(c,{children:"Additional Options"})}),t.jsxs(r,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:"actionUrl",children:"Action URL (Optional)"}),t.jsx(x,{id:"actionUrl",value:M.actionUrl,onChange:e=>V(s=>({...s,actionUrl:e.target.value})),placeholder:"e.g., /guest/wallet or /guest/listings"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Where users should be redirected when they click the event notification"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(m,{htmlFor:"expiresAt",children:"Event Expires At (Optional)"}),t.jsx(x,{id:"expiresAt",type:"datetime-local",value:M.expiresAt,onChange:e=>V(s=>({...s,expiresAt:e.target.value}))})]})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx(d,{type:"button",variant:"outline",onClick:()=>S("/admin/dashboard"),disabled:k,children:"Cancel"}),t.jsx(d,{type:"submit",disabled:k,className:"flex-1",children:k?t.jsxs(t.Fragment,{children:[t.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating Event..."]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{className:"h-4 w-4 mr-2"}),"Create Event & Send Notifications"]})})]})]})})]})})};export{S as default};
