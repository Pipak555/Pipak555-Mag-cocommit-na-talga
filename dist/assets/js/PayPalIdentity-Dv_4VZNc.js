import{l as e,u as a,r as s,j as l}from"./react-vendor-Ve3SFwKO.js";import{j as t,a as r,B as i}from"./index-BnushFQy.js";import{h as n,f as c,u as o}from"./firebase-vendor-BC71bXmb.js";import{e as d,L as u,C as m,ae as p,h as x}from"./icons-vendor-DD8ZfUKZ.js";const y=({userId:y,onVerified:h,paypalEmail:b,paypalVerified:g})=>{const[w]=e(),f=a(),[P,j]=s.useState(!1),[k,v]=s.useState(!1),N="https://mojo-dojo-casa-house-f31a5.web.app";let C=N+"/paypal-callback";const R=s.useCallback(async e=>{v(!0);try{const e=await n(c(t,"users",y)),a=e.exists()?e.data():null,s=a?.paypalEmail||null,l={paypalEmailVerified:!0,paypalVerifiedAt:(new Date).toISOString(),paypalOAuthVerified:!0};s||(l.paypalEmail=null),await o(c(t,"users",y),l),s?(r.success("PayPal account verified! You successfully logged in with PayPal."),h(s)):(r.success("PayPal account verified! Your email will be stored on your first payment."),h("")),f(window.location.pathname,{replace:!0})}catch(a){r.error("Failed to verify PayPal account. Please try again."),f(window.location.pathname,{replace:!0})}finally{v(!1)}},[y,f,h]);return s.useEffect(()=>{const e=w.get("code"),a=w.get("state"),s=w.get("error"),l=w.get("error_description")||"";if(s){if(l.includes("redirect_uri")||l.includes("invalid")||"invalid_client"===s){N.replace(/^https?:\/\//,"").split(":")[0],new URLSearchParams(window.location.search);let e=C;if(l){const a=l.match(/redirect_uri[=:]\s*([^\s&]+)/i);a&&(e=decodeURIComponent(a[1]))}r.error("PayPal configuration error: Redirect URI not registered.",{duration:12e3,description:`PayPal received: "${e}". Add this EXACT URI to PayPal Return URLs.`})}else"access_denied"===s?r.info("PayPal login was cancelled."):r.error(`PayPal login failed: ${l||s}. Please try again.`);f(window.location.pathname,{replace:!0})}else e&&a==="paypal-verify-"+y&&R(e)},[w,y,f,R,C]),g&&b?l.jsx("div",{className:"space-y-4",children:l.jsx("div",{className:"flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(d,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"PayPal Account Verified"}),l.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:b}),l.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Your account was verified by logging in with PayPal"})]})]})})}):k?l.jsx("div",{className:"space-y-4",children:l.jsx("div",{className:"flex items-center justify-center p-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx(u,{className:"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin mx-auto mb-3"}),l.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Verifying PayPal account..."}),l.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-2",children:"Please wait while we verify your account"})]})})}):l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-2 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[l.jsx(m,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}),l.jsx("p",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:"Link your PayPal account to make deposits and payments. You'll log in with your PayPal credentials to verify your account."})]}),l.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[l.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Don't have a PayPal account?"}),l.jsxs(i,{variant:"outline",size:"sm",onClick:()=>window.open("https://www.paypal.com/signup","_blank"),className:"w-full mb-2",children:[l.jsx(p,{className:"h-4 w-4 mr-2"}),"Sign up for PayPal"]}),l.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Create a free PayPal account, then come back to link it"})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[l.jsx("p",{className:"text-sm font-medium mb-2",children:"How it works:"}),l.jsxs("ol",{className:"text-xs text-muted-foreground space-y-1 list-decimal list-inside",children:[l.jsx("li",{children:'Click "Link PayPal Account" below'}),l.jsx("li",{children:"You'll be redirected to PayPal's login page"}),l.jsx("li",{children:"Log in with your PayPal email and password"}),l.jsx("li",{children:"PayPal will verify your account and redirect you back"}),l.jsx("li",{children:"Your account will be linked and verified âœ…"})]})]}),l.jsx(i,{onClick:()=>{j(!0);const e="paypal-verify-"+y,a=`https://www.sandbox.paypal.com/webapps/auth/protocol/openidconnect/v1/authorize?client_id=AV_tLDGMXIHhXnRCrDuX-Nb-2Wa-hEWjAkTj5ssXye5oTJeDZzTQqQym3UgFe-gOZDaQ1Fn-t8YPvfkx&response_type=code&scope=${encodeURIComponent("openid email profile")}&redirect_uri=${encodeURIComponent(C)}&state=${e}`;window.location.href=a},disabled:P,className:"w-full",size:"lg",children:P?l.jsxs(l.Fragment,{children:[l.jsx(u,{className:"h-4 w-4 mr-2 animate-spin"}),"Redirecting to PayPal..."]}):l.jsxs(l.Fragment,{children:[l.jsx(x,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})}),l.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"You'll be redirected to PayPal to log in with your account credentials"})]})]})};export{y as P};
