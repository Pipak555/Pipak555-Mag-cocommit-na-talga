import{r as e,j as s,u as a}from"./react-vendor-Ve3SFwKO.js";import{N as t,C as r,a as i,b as n,B as l,g as c,d as o}from"./index-DaMaslBo.js";import{I as d}from"./input-D5hloL4G.js";import{S as m}from"./scroll-area-Dps723Uf.js";import{B as x}from"./badge-BSgvUoVt.js";import{S as u,a as h,b as j,c as f,d as g}from"./select-CXm8ONYg.js";import{S as p}from"./switch-CSe7-F5W.js";import{L as N}from"./label-B2t2XnWQ.js";import{ab as v,R as w,n as y,aj as b,X as k,ak as C,al as E,J as S,K as L,L as M,aa as z,C as A,O as T,m as R,l as F,j as B}from"./icons-vendor-Dhca6XHc.js";import{H as D,I as Y,J as U,K as I,o as J,L as K}from"./utils-vendor-DzY7Ay74.js";const O=e=>{switch(e){case"booking":return s.jsx(B,{className:"h-4 w-4"});case"message":return s.jsx(F,{className:"h-4 w-4"});case"payment":return s.jsx(R,{className:"h-4 w-4"});case"review":return s.jsx(T,{className:"h-4 w-4"});case"system":return s.jsx(A,{className:"h-4 w-4"});default:return s.jsx(v,{className:"h-4 w-4"})}},P=e=>{switch(e){case"booking":return"bg-blue-500/10 text-blue-600 dark:text-blue-400";case"message":return"bg-green-500/10 text-green-600 dark:text-green-400";case"payment":return"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400";case"review":return"bg-purple-500/10 text-purple-600 dark:text-purple-400";case"system":return"bg-orange-500/10 text-orange-600 dark:text-orange-400";default:return"bg-primary/10 text-primary"}},V=e=>{switch(e){case"high":return"bg-red-500";case"medium":return"bg-yellow-500";case"low":return"bg-blue-500";default:return"bg-gray-400"}},q=({onClose:a,onNavigate:A})=>{const{notifications:T,unreadCount:R,loading:F,markAsRead:B,markAllAsRead:q,removeNotification:H,browserNotificationsEnabled:Z,soundEnabled:$,toggleBrowserNotifications:G,toggleSound:Q,refreshNotifications:W}=t(),[X,_]=e.useState(""),[ee,se]=e.useState("all"),[ae,te]=e.useState("all"),[re,ie]=e.useState(!1),[ne,le]=e.useState(!1),ce=e.useRef(null),oe=e.useRef(null);e.useEffect(()=>{const e=e=>{ce.current&&!ce.current.contains(e.target)&&a()},s=e=>{"Escape"===e.key&&a()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",s)}},[a]);const de=e.useMemo(()=>{let e=T;if("all"!==ee&&(e=e.filter(e=>e.type===ee)),"read"===ae?e=e.filter(e=>e.read):"unread"===ae&&(e=e.filter(e=>!e.read)),X.trim()){const s=X.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(s)||e.message.toLowerCase().includes(s))}return e},[T,ee,ae,X]),me=e.useMemo(()=>{const e={};return de.forEach(s=>{const a=(t=new Date(s.createdAt),Y(t)?"Today":U(t)?"Yesterday":I(t)?J(t,"EEEE"):K(t)?J(t,"MMMM d"):J(t,"MMM d, yyyy"));var t;e[a]||(e[a]=[]),e[a].push(s)}),Object.entries(e).sort((e,s)=>{const a=new Date(e[1][0].createdAt);return new Date(s[1][0].createdAt).getTime()-a.getTime()})},[de]),xe=e.useMemo(()=>de.filter(e=>!e.read),[de]),ue=()=>{_(""),se("all"),te("all")},he=""!==X.trim()||"all"!==ee||"all"!==ae,je=e.useCallback(async()=>{le(!0),await W(),setTimeout(()=>le(!1),500)},[W]);return e.useEffect(()=>{const e=oe.current?.querySelector("[data-radix-scroll-area-viewport]");if(!e)return;let s=0,a=!1;const t=t=>{s=t.touches[0].clientY,a=0===e.scrollTop},r=e=>{a&&!ne&&e.touches[0].clientY-s>50&&(je(),a=!1)};return e.addEventListener("touchstart",t),e.addEventListener("touchmove",r),()=>{e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",r)}},[ne,je]),s.jsxs(r,{ref:ce,className:"absolute right-0 top-12 w-96 max-w-[calc(100vw-2rem)] max-h-[600px] z-50 shadow-xl border animate-in slide-in-from-top-2 fade-in-0 duration-200",children:[s.jsxs(i,{className:"pb-3 border-b space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(n,{className:"text-lg font-semibold flex items-center gap-2",children:[s.jsx(v,{className:"h-5 w-5"}),"Notifications",R>0&&s.jsx(x,{variant:"destructive",className:"ml-2 animate-pulse",children:R>99?"99+":R})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(l,{variant:"ghost",size:"icon",onClick:je,disabled:ne,className:"h-8 w-8",title:"Refresh notifications",children:s.jsx(w,{className:c("h-4 w-4",ne&&"animate-spin")})}),s.jsx(l,{variant:"ghost",size:"icon",onClick:()=>ie(!re),className:"h-8 w-8",title:"Notification settings",children:s.jsx(y,{className:"h-4 w-4"})}),R>0&&s.jsxs(l,{variant:"ghost",size:"sm",onClick:async()=>{await q()},className:"text-xs h-8",title:"Mark all as read",children:[s.jsx(b,{className:"h-3 w-3 mr-1"}),s.jsx("span",{className:"hidden sm:inline",children:"Mark all read"})]}),s.jsx(l,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8","aria-label":"Close notifications",children:s.jsx(k,{className:"h-4 w-4"})})]})]}),re&&s.jsxs("div",{className:"px-4 py-3 bg-muted/50 rounded-lg space-y-3 border",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[$?s.jsx(C,{className:"h-4 w-4"}):s.jsx(E,{className:"h-4 w-4"}),s.jsx(N,{htmlFor:"sound-toggle",className:"text-sm font-medium cursor-pointer",children:"Notification Sound"})]}),s.jsx(p,{id:"sound-toggle",checked:$,onCheckedChange:Q})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"h-4 w-4"}),s.jsx(N,{htmlFor:"browser-notifications-toggle",className:"text-sm font-medium cursor-pointer",children:"Browser Notifications"})]}),s.jsx(p,{id:"browser-notifications-toggle",checked:Z,onCheckedChange:G})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(d,{placeholder:"Search notifications...",value:X,onChange:e=>_(e.target.value),className:"pl-9 h-9 text-sm"}),X&&s.jsx(l,{variant:"ghost",size:"icon",onClick:()=>_(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7",children:s.jsx(k,{className:"h-3 w-3"})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(u,{value:ee,onValueChange:e=>se(e),children:[s.jsxs(h,{className:"h-9 text-xs flex-1",children:[s.jsx(L,{className:"h-3 w-3 mr-1"}),s.jsx(j,{placeholder:"Type"})]}),s.jsxs(f,{children:[s.jsx(g,{value:"all",children:"All Types"}),s.jsx(g,{value:"message",children:"Messages"}),s.jsx(g,{value:"booking",children:"Bookings"}),s.jsx(g,{value:"payment",children:"Payments"}),s.jsx(g,{value:"review",children:"Reviews"}),s.jsx(g,{value:"system",children:"System"})]})]}),s.jsxs(u,{value:ae,onValueChange:e=>te(e),children:[s.jsx(h,{className:"h-9 text-xs flex-1",children:s.jsx(j,{placeholder:"Status"})}),s.jsxs(f,{children:[s.jsx(g,{value:"all",children:"All"}),s.jsx(g,{value:"unread",children:"Unread"}),s.jsx(g,{value:"read",children:"Read"})]})]}),he&&s.jsx(l,{variant:"ghost",size:"icon",onClick:ue,className:"h-9 w-9",title:"Clear filters",children:s.jsx(k,{className:"h-4 w-4"})})]})]})]}),s.jsxs(o,{className:"p-0",children:[F?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[s.jsx(M,{className:"h-8 w-8 animate-spin text-muted-foreground mb-2"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading notifications..."})]}):0===de.length?s.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:he?s.jsxs(s.Fragment,{children:[s.jsx(L,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),s.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"No notifications found"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Try adjusting your filters"}),s.jsx(l,{variant:"outline",size:"sm",onClick:ue,className:"mt-3",children:"Clear Filters"})]}):s.jsxs(s.Fragment,{children:[s.jsx(v,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),s.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"No notifications"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You're all caught up!"})]})}):s.jsx(m,{ref:oe,className:"h-[500px]",children:s.jsx("div",{className:"divide-y",children:me.map(([e,t])=>s.jsxs("div",{children:[s.jsx("div",{className:"px-4 py-2 bg-muted/30 sticky top-0 z-10",children:s.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:e})}),t.map(e=>s.jsx("div",{className:c("px-4 py-3 hover:bg-accent transition-all cursor-pointer relative group",!e.read&&"bg-primary/5 border-l-2 border-l-primary"),onClick:()=>(async e=>{e.read||await B(e.id),e.actionUrl&&(A(e.actionUrl),a())})(e),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:c("p-2 rounded-lg flex-shrink-0 transition-transform group-hover:scale-110",P(e.type)),children:O(e.type)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-start gap-2 flex-1 min-w-0",children:[s.jsx("p",{className:c("text-sm line-clamp-1",e.read?"font-medium":"font-semibold"),children:e.title}),"high"===e.priority&&!e.read&&s.jsx("div",{className:c("w-2 h-2 rounded-full flex-shrink-0 mt-1.5 animate-pulse",V(e.priority))})]}),s.jsx(l,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",onClick:s=>(async(e,s)=>{e.stopPropagation(),await H(s)})(s,e.id),title:"Delete notification",children:s.jsx(z,{className:"h-3 w-3"})})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:e.message}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:D(new Date(e.createdAt),{addSuffix:!0})}),!e.read&&s.jsx(x,{variant:"secondary",className:"text-xs h-5 px-1.5",children:"New"})]})]})]})},e.id))]},e))})}),!F&&de.length>0&&s.jsx("div",{className:"px-4 py-2 border-t bg-muted/30",children:s.jsx("p",{className:"text-xs text-muted-foreground text-center",children:xe.length>0?s.jsxs(s.Fragment,{children:[xe.length," unread ",1===xe.length?"notification":"notifications"]}):"All notifications read"})})]})]})},H=()=>{const{unreadCount:r}=t(),[i,n]=e.useState(!1),[o,d]=e.useState(!1),m=a(),u=e.useRef(r);e.useEffect(()=>{if(r>u.current&&!i){d(!0);const e=setTimeout(()=>d(!1),2e3);return()=>clearTimeout(e)}u.current=r},[r,i]);const h=r>0;return s.jsxs("div",{className:"relative",children:[s.jsxs(l,{variant:"ghost",size:"icon",className:c("relative transition-all",h&&"hover:bg-primary/10",o&&"animate-pulse"),onClick:()=>{n(!i),d(!1)},"aria-label":"Notifications"+(h?` (${r} unread)`:""),children:[s.jsx(v,{className:c("h-5 w-5 transition-transform",i&&"scale-110")}),h&&s.jsx(x,{className:c("absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs bg-destructive hover:bg-destructive transition-all",o&&"animate-bounce scale-110"),variant:"destructive",children:r>99?"99+":r>9?"9+":r})]}),i&&s.jsx(q,{onClose:()=>n(!1),onNavigate:e=>{n(!1),m(e)}})]})};export{H as N};
