import{j as e,r as s,M as t,T as a,m as r,n as i,l as n,k as o,u as l}from"./react-vendor-Ve3SFwKO.js";import{B as c,a as d,u as m,j as u,C as h,e as g,b as x,c as p,l as j,m as f,_ as v,n as b,d as y}from"./index-BnushFQy.js";import{t as w}from"./form-vendor-Dd1peP4Z.js";import{I as N}from"./input-C6C1u0Er.js";import{T as S}from"./textarea-DvORGimk.js";import{S as D,a as k,b as C,c as F,d as A}from"./select-D2BQB2Va.js";import{D as R,a as L,b as P,c as I,d as E}from"./dialog-B475KvSN.js";import{A as U,a as G,b as O,c as B,d as V,e as $,f as T,g as _}from"./alert-dialog-Bv7bA0QL.js";import{F as z,a as q,b as M,c as W,d as Y,f as H,e as K,g as J}from"./validation-BjnjtpVp.js";import{D as Z}from"./date-range-picker-DP4SlluA.js";import{P as Q}from"./progress-C5Ks7D3i.js";import{v as X,X as ee,w as se,L as te,N as ae,e as re,C as ie,x as ne,h as oe,A as le}from"./icons-vendor-DD8ZfUKZ.js";import{L as ce}from"./maps-vendor-CYGXCXz5.js";import{h as de,f as me,x as ue,B as he,j as ge,u as xe}from"./firebase-vendor-BC71bXmb.js";import{hasActiveSubscription as pe,getUserSubscription as je}from"./billingService-BIHIVurG.js";import{B as fe}from"./BackButton-DohCcac0.js";import"./utils-vendor-DzY7Ay74.js";import"./ui-vendor-D9RGQy8n.js";import"./label-DdT-oWKe.js";import"./calendar-CF_sIwXc.js";const ve=({images:s,onRemove:t,uploadProgress:a=0,isUploading:r=!1})=>0===s.length?e.jsx("div",{className:"flex items-center justify-center w-full h-32 border-2 border-dashed rounded-lg border-muted-foreground/25",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No images selected"})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:s.map((s,a)=>{const i=URL.createObjectURL(s);return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border-2 border-border",children:e.jsx("img",{src:i,alt:"Preview "+(a+1),className:"w-full h-full object-cover"})}),!r&&e.jsx(c,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>t(a),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:s.name}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[(s.size/1024/1024).toFixed(2)," MB"]})]},a)})}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Uploading images..."}),e.jsxs("span",{className:"text-muted-foreground",children:[a,"%"]})]}),e.jsx(Q,{value:a})]})]});function be({onLocationSelect:e}){return i({click:s=>{const{lat:t,lng:a}=s.latlng;e(t,a)}}),null}delete ce.Icon.Default.prototype._getIconUrl,ce.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const ye=({value:i,onChange:n})=>{const[o,l]=s.useState([14.5995,120.9842]),[m,u]=s.useState(null),[h,g]=s.useState(!1),[x,p]=s.useState(!1),j=s.useRef(null),f=s.useRef(null),v=async(e,s)=>{try{p(!0);const t=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${s}&zoom=18&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!t.ok)throw Error("Failed to fetch address");const a=await t.json();if(a.error)throw Error(a.error);const r=a.address,i=[];return(r.road||r.street)&&i.push(r.road||r.street),(r.suburb||r.neighbourhood||r.city_district)&&i.push(r.suburb||r.neighbourhood||r.city_district),(r.city||r.town||r.village)&&i.push(r.city||r.town||r.village),(r.state||r.province)&&i.push(r.state||r.province),r.country&&i.push(r.country),i.length>0?i.join(", "):`${e.toFixed(6)}, ${s.toFixed(6)}`}catch(t){return`${e.toFixed(6)}, ${s.toFixed(6)}`}finally{p(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{ref:f,placeholder:"Search address or click on map...",value:i,onChange:e=>{n(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),i.trim()&&(async e=>{if(e&&e.trim().length>=3){g(!0);try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!s.ok)throw Error("Failed to search address");const t=await s.json();if(t.length>0){const e=t[0],s=parseFloat(e.lat),a=parseFloat(e.lon);l([s,a]),u([s,a]),j.current&&j.current.setView([s,a],15);const r=[],i=e.address;(i.road||i.street)&&r.push(i.road||i.street),(i.suburb||i.neighbourhood||i.city_district)&&r.push(i.suburb||i.neighbourhood||i.city_district),(i.city||i.town||i.village)&&r.push(i.city||i.town||i.village),(i.state||i.province)&&r.push(i.state||i.province),i.country&&r.push(i.country);const o=r.length>0?r.join(", "):e.display_name;n(o),d.success("Location found")}else d.error("Location not found. Please try a different address.")}catch(s){d.error("Failed to search location")}finally{g(!1)}}})(i))},className:"pl-10"}),(h||x)&&e.jsx(te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>{navigator.geolocation?(g(!0),navigator.geolocation.getCurrentPosition(async e=>{const{latitude:s,longitude:t}=e.coords;l([s,t]),u([s,t]),j.current&&j.current.setView([s,t],15);try{const e=await v(s,t);n(e),d.success("Current location set")}catch(a){d.error("Failed to get address. Using coordinates."),n(`${s.toFixed(6)}, ${t.toFixed(6)}`)}finally{g(!1)}},e=>{d.error("Failed to get your location. Please allow location access."),g(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):d.error("Geolocation is not supported by your browser")},disabled:h,title:"Use current location",children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",style:{height:"400px"},children:e.jsxs(t,{center:o,zoom:13,style:{height:"100%",width:"100%"},whenCreated:e=>{j.current=e},children:[e.jsx(a,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(be,{onLocationSelect:async(e,s)=>{u([e,s]),g(!0);try{const t=await v(e,s);n(t),d.success("Location selected")}catch(t){d.error("Failed to get address. Using coordinates."),n(`${e.toFixed(6)}, ${s.toFixed(6)}`)}finally{g(!1)}}}),m&&e.jsx(r,{position:m})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click on the map to select a location, search for an address, or use your current location."})]})},we=["image/jpeg","image/jpg","image/png","image/webp"],Ne=({onSuccess:t})=>{const{user:a}=m(),[r]=n(),i=r.get("edit"),l=!!i,[y,ee]=s.useState(!1),[se,ae]=s.useState(!1),[oe,le]=s.useState([]),[ce,pe]=s.useState([]),[je,fe]=s.useState(0),[be,Ne]=s.useState(!1),[Se,De]=s.useState("idle"),[ke,Ce]=s.useState([]),[Fe,Ae]=s.useState([]),[Re,Le]=s.useState(!1),[Pe,Ie]=s.useState(!1),[Ee,Ue]=s.useState(null),[Ge,Oe]=s.useState(!1),[Be,Ve]=s.useState(!1),[$e,Te]=s.useState(!1),_e=s.useRef(null),ze=s.useRef(!1),qe=o({resolver:w(J),defaultValues:{title:"",description:"",category:"home",price:"",discount:"",promo:"",location:"",maxGuests:"",bedrooms:"",bathrooms:"",amenities:"",dateRange:{from:void 0,to:void 0},images:[]},mode:"onChange"}),Me=qe.watch(),We=qe.formState.errors,Ye=s.useCallback(()=>a?a.uid+"_draft":null,[a]),He=s.useCallback(()=>{const e=[Me.title,Me.description,Me.price,Me.location,Me.maxGuests,Me.dateRange?.from&&Me.dateRange?.to,oe.length>0],s=e.filter(Boolean).length;return Math.round(s/e.length*100)},[Me,oe.length])(),Ke=(e,s)=>{const t=[],a=new Date(e);for(;s>=a;)t.push(a.toISOString().split("T")[0]),a.setDate(a.getDate()+1);return t},Je=e=>{const s={};return Object.keys(e).forEach(t=>{void 0!==e[t]&&(s[t]=e[t])}),s},Ze=e=>{const s=Array.from(e.target.files||[]),t=[],a=[];s.forEach(e=>{const s=(e=>we.includes(e.type)?e.size>5242880?"File size exceeds 5MB limit":null:"Invalid file type. Allowed types: "+we.join(", "))(e);s?a.push(`${e.name}: ${s}`):t.push(e)}),a.length>0&&d.error(a.join(", "));const r=10-(l?ce.length:0),i=[...oe,...t].slice(0,r);t.length>r&&d.warning(`Maximum 10 total images allowed. You can add ${r} more image(s).`),le(i),qe.setValue("images",i,{shouldValidate:!0}),e.target.value=""},Qe=e=>{const s=oe.filter((s,t)=>t!==e);le(s),qe.setValue("images",s,{shouldValidate:!0})},Xe=s.useCallback(async e=>{if(!a)return;if($e)return;const s=Ye();if(!s)return;const t=qe.getValues(),r=t.dateRange?.from&&t.dateRange?.to?Ke(t.dateRange.from,t.dateRange.to):ke;let i=null,n=null;try{const e=await de(me(u,"listing",s));if(e.exists()){const s=e.data();if(i=s.createdAt,n=s.status,n&&"draft"!==n)return}}catch(c){}const o={hostId:a.uid,title:t.title||"",description:t.description||"",category:t.category||"home",price:t.price?+t.price:void 0,discount:t.discount&&t.discount.trim()?+t.discount:void 0,promo:t.promo||void 0,location:t.location||"",maxGuests:t.maxGuests?+t.maxGuests:void 0,bedrooms:t.bedrooms&&t.bedrooms.trim()?+t.bedrooms:void 0,bathrooms:t.bathrooms&&t.bathrooms.trim()?+t.bathrooms:void 0,amenities:t.amenities?t.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:r,blockedDates:Fe,images:[],status:"draft",createdAt:i||(new Date).toISOString(),updatedAt:he()},l=Je(o);try{De("saving"),await ue(me(u,"listing",s),l,{merge:!0}),Ue(s),De("saved"),e?.manual&&(d.success("Draft saved successfully"),setTimeout(()=>De("idle"),2e3))}catch(c){De("error");const s="permission-denied"===c.code?"Permission denied. Please check your permissions.":"unavailable"===c.code?"Network error. Please check your connection.":"Failed to save draft";e?.manual?d.error(s):d.error("Auto-save failed. Please save manually.",{duration:3e3}),setTimeout(()=>De("idle"),3e3)}},[a,Ye,qe,ke,Fe,$e]);s.useEffect(()=>{if(ze.current){if(a&&!(l||y||$e))return _e.current&&window.clearTimeout(_e.current),_e.current=window.setTimeout(()=>{qe.formState.isDirty&&Xe()},2e3),()=>{_e.current&&window.clearTimeout(_e.current)}}else ze.current=!0},[Me,oe,a,qe.formState.isDirty,Xe,y,$e,l]),s.useEffect(()=>{if(l)return;const e=()=>{a&&qe.formState.isDirty&&!$e&&Xe()};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[Xe,a,qe.formState.isDirty,$e,l]),s.useEffect(()=>{(async()=>{if(l&&i&&a){ae(!0);try{const e=await j(i);if(!e)return void d.error("Listing not found");if(e.hostId!==a.uid)return void d.error("You don't have permission to edit this listing");qe.reset({title:e.title||"",description:e.description||"",category:e.category||"home",price:e.price?e.price+"":"",discount:e.discount?e.discount+"":"",promo:e.promo||"",location:e.location||"",maxGuests:e.maxGuests?e.maxGuests+"":"",bedrooms:e.bedrooms?e.bedrooms+"":"",bathrooms:e.bathrooms?e.bathrooms+"":"",amenities:Array.isArray(e.amenities)?e.amenities.join(", "):"",dateRange:e.availableDates&&e.availableDates.length>0?{from:new Date(e.availableDates[0]),to:new Date(e.availableDates[e.availableDates.length-1])}:{from:void 0,to:void 0},images:[]}),e.images&&Array.isArray(e.images)&&pe(e.images),e.availableDates&&Array.isArray(e.availableDates)&&Ce(e.availableDates),e.blockedDates&&Array.isArray(e.blockedDates)&&Ae(e.blockedDates),Te(!0),d.success("Listing loaded successfully")}catch(e){d.error("Failed to load listing: "+(e.message||"Unknown error"))}finally{ae(!1)}}})()},[l,i,a,qe]),s.useEffect(()=>{l||(async()=>{if(!a)return;const e=Ye();if(e)try{const s=await de(me(u,"listing",e));s.exists()&&"draft"===s.data().status&&(Le(!0),Ie(!0),Ue(e))}catch(s){s.code}})()},[a,Ye,l]);const es=async(e,s)=>{Ne(!0),fe(0);try{const{uploadListingImages:t}=await v(async()=>{const{uploadListingImages:e}=await import("./cloudinary-BHmE7xG7.js");return{uploadListingImages:e}},[]),a=t(e,s,e=>{fe(e)}),r=await a;return fe(100),r}finally{Ne(!1),setTimeout(()=>fe(0),1e3)}},ss=async()=>{if(l&&i&&a)if(await qe.trigger()){ee(!0),De("saving");try{const e=qe.getValues(),s=e.dateRange?.from&&e.dateRange?.to?Ke(e.dateRange.from,e.dateRange.to):ke,t={title:e.title,description:e.description,category:e.category||"home",price:+e.price,discount:e.discount&&e.discount.trim()?+e.discount:void 0,promo:e.promo||void 0,location:e.location,maxGuests:+e.maxGuests,bedrooms:e.bedrooms&&e.bedrooms.trim()?+e.bedrooms:void 0,bathrooms:e.bathrooms&&e.bathrooms.trim()?+e.bathrooms:void 0,amenities:e.amenities?e.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:s,blockedDates:Fe,updatedAt:(new Date).toISOString()},a=Je(t);let r=[...ce];if(oe.length>0){const e=await es(oe,i);r=[...ce,...e]}await f(i,{...a,images:r}),De("saved"),pe(r),le([]),d.success("Listing updated successfully!"),qe.reset(qe.getValues(),{keepDirty:!1})}catch(e){De("error"),d.error("Failed to update listing: "+(e.message||"Unknown error"))}finally{ee(!1),setTimeout(()=>De("idle"),2e3)}}else d.error("Please fix the errors in the form before saving.")};return e.jsxs(e.Fragment,{children:[e.jsx(R,{open:Pe,onOpenChange:Ie,children:e.jsxs(L,{children:[e.jsxs(P,{children:[e.jsx(I,{children:"Unsaved Draft Found"}),e.jsx(E,{children:"We found a saved draft for this account. Would you like to continue editing it or discard it and start fresh?"})]}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[e.jsx(c,{variant:"outline",onClick:()=>{Ie(!1),Oe(!0)},children:"Discard Draft"}),e.jsx(c,{onClick:async()=>{if(Ee)try{const e=await de(me(u,"listing",Ee));if(!e.exists())return;const s=e.data();qe.reset({title:s.title||"",description:s.description||"",category:s.category||"home",price:s.price?s.price+"":"",discount:s.discount?s.discount+"":"",promo:s.promo||"",location:s.location||"",maxGuests:s.maxGuests?s.maxGuests+"":"",bedrooms:s.bedrooms?s.bedrooms+"":"",bathrooms:s.bathrooms?s.bathrooms+"":"",amenities:Array.isArray(s.amenities)?s.amenities.join(", "):s.amenities||"",dateRange:s.availableDates&&s.availableDates.length>0?{from:new Date(s.availableDates[0]),to:new Date(s.availableDates[s.availableDates.length-1])}:{from:void 0,to:void 0},images:[]}),s.availableDates&&Array.isArray(s.availableDates)&&Ce(s.availableDates),s.blockedDates&&Array.isArray(s.blockedDates)&&Ae(s.blockedDates),Ie(!1),d.success("Draft loaded successfully")}catch(e){const s="permission-denied"===e.code?"Permission denied. Unable to load draft.":"Failed to load draft";d.error(s)}},children:"Continue Draft"})]})]})}),se?e.jsx(h,{children:e.jsx(g,{className:"py-12",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(te,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Loading listing..."})]})})}):e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:l?"Edit Listing":"Create New Listing"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["saving"===Se&&e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Saving..."})]}),"saved"===Se&&e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Saved"})]}),"error"===Se&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{children:"Save failed"})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Form completion"}),e.jsxs("span",{className:"font-medium",children:[He,"%"]})]}),e.jsx(Q,{value:He,className:"h-2"})]})]}),e.jsx(g,{children:e.jsx(z,{...qe,children:e.jsxs("form",{onSubmit:l?e=>{e.preventDefault(),ss()}:qe.handleSubmit(async()=>{const e=await qe.trigger(),s=qe.getValues("dateRange");if(e)return s?.from&&s?.to?0===oe.length?(d.error("Please upload at least one image."),void qe.setError("images",{message:"At least one image is required"})):void Ve(!0):(d.error("Please select an availability date range."),void qe.setError("dateRange.to",{message:"Date range is required"}));d.error("Please fix the errors in the form before proceeding.")}),className:"space-y-6",children:[e.jsx(q,{control:qe.control,name:"title",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsx(N,{placeholder:"Enter a descriptive title for your listing",...s,value:s.value||""})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(H,{children:[s.value?.length||0,"/100 characters"]}),e.jsx(K,{})]})]})}),e.jsx(q,{control:qe.control,name:"description",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Description ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsx(S,{placeholder:"Describe your listing in detail. Include amenities, nearby attractions, and what makes it special.",className:"min-h-[120px]",...s,value:s.value||""})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(H,{children:[s.value?.length||0,"/2000 characters (minimum 50)"]}),e.jsx(K,{})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(q,{control:qe.control,name:"category",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Category ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(Y,{children:e.jsx(k,{children:e.jsx(C,{placeholder:"Select category"})})}),e.jsxs(F,{children:[e.jsx(A,{value:"home",children:"Home"}),e.jsx(A,{value:"experience",children:"Experience"}),e.jsx(A,{value:"service",children:"Service"})]})]}),e.jsx(K,{})]})}),e.jsx(q,{control:qe.control,name:"price",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Price per Night (₱) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsx(N,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...s,value:s.value||"",onChange:e=>s.onChange(e.target.value)})}),e.jsx(K,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(q,{control:qe.control,name:"discount",render:({field:s})=>e.jsxs(M,{children:[e.jsx(W,{children:"Discount (%)"}),e.jsx(Y,{children:e.jsx(N,{type:"number",min:"0",max:"100",placeholder:"0",...s,value:s.value||"",onChange:e=>s.onChange(e.target.value)})}),e.jsx(H,{children:"Optional discount percentage (0-100)"}),e.jsx(K,{})]})}),e.jsx(q,{control:qe.control,name:"promo",render:({field:s})=>e.jsxs(M,{children:[e.jsx(W,{children:"Promo Description"}),e.jsx(Y,{children:e.jsx(N,{placeholder:"e.g., 'Summer Special'",maxLength:100,...s,value:s.value||""})}),e.jsx(H,{children:"Optional promotional message"}),e.jsx(K,{})]})})]}),e.jsx(q,{control:qe.control,name:"location",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Location ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsx(ye,{value:s.value||"",onChange:e=>{s.onChange(e)}})}),e.jsx(K,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx(q,{control:qe.control,name:"maxGuests",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Max Guests ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsx(N,{type:"number",min:"1",placeholder:"1",...s,value:s.value||"",onChange:e=>s.onChange(e.target.value)})}),e.jsx(K,{})]})}),e.jsx(q,{control:qe.control,name:"bedrooms",render:({field:s})=>e.jsxs(M,{children:[e.jsx(W,{children:"Bedrooms"}),e.jsx(Y,{children:e.jsx(N,{type:"number",min:"0",placeholder:"0",...s,value:s.value||"",onChange:e=>s.onChange(e.target.value)})}),e.jsx(K,{})]})}),e.jsx(q,{control:qe.control,name:"bathrooms",render:({field:s})=>e.jsxs(M,{children:[e.jsx(W,{children:"Bathrooms"}),e.jsx(Y,{children:e.jsx(N,{type:"number",min:"0",step:"0.5",placeholder:"0",...s,value:s.value||"",onChange:e=>s.onChange(e.target.value)})}),e.jsx(H,{children:"0.5 = half bath (toilet + sink), 1 = full bath (toilet + sink + shower)"}),e.jsx(K,{})]})})]}),e.jsx(q,{control:qe.control,name:"amenities",render:({field:s})=>e.jsxs(M,{children:[e.jsx(W,{children:"Amenities"}),e.jsx(Y,{children:e.jsx(N,{placeholder:"WiFi, Pool, Kitchen, Parking (comma separated)",...s,value:s.value||""})}),e.jsx(H,{children:"Separate multiple amenities with commas"}),e.jsx(K,{})]})}),e.jsx(q,{control:qe.control,name:"dateRange",render:({field:s})=>e.jsxs(M,{children:[e.jsxs(W,{children:["Availability Date Range ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsx(Z,{value:s.value,onChange:s.onChange,placeholder:"Select your listing availability period",className:"mt-2",error:!!We.dateRange})}),s.value?.from&&s.value?.to&&e.jsxs(H,{children:["Available from ",s.value.from.toLocaleDateString()," to ",s.value.to.toLocaleDateString()]}),e.jsx(K,{})]})}),e.jsx(q,{control:qe.control,name:"images",render:()=>e.jsxs(M,{children:[e.jsxs(W,{children:["Images ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{id:"images",type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:Ze,className:"hidden"}),e.jsxs(c,{type:"button",variant:"outline",onClick:()=>document.getElementById("images")?.click(),disabled:(l?ce.length:0)+oe.length>=10,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Upload Images (",(l?ce.length:0)+oe.length,"/",10,")"]})]}),l&&ce.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Existing Images (",ce.length,"):"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3",children:ce.map((s,t)=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("div",{className:"w-full h-full rounded-lg overflow-hidden border-2 border-border",children:e.jsx("img",{src:s,alt:"Existing image "+(t+1),className:"w-full h-full object-cover"})}),e.jsx(c,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-7 w-7 opacity-80 group-hover:opacity-100 transition-opacity shadow-lg",onClick:e=>{e.stopPropagation(),pe(ce.filter((e,s)=>s!==t))},children:e.jsx("span",{className:"text-lg font-bold",children:"×"})})]},"existing-"+t))})]}),e.jsx(ve,{images:oe,onRemove:Qe,uploadProgress:je,isUploading:be})]})}),e.jsxs(H,{children:["Upload at least 1 image (max ",10,"). Accepted formats: JPG, PNG, WebP. Max size: 5MB per image."]}),e.jsx(K,{})]})}),e.jsx("div",{className:"flex gap-2 pt-4",children:l?e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",onClick:ss,disabled:y||be||"saving"===Se,className:"flex-1",children:"saving"===Se||y?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"saved"===Se?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Saved"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Save Changes"]})}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>t(),disabled:y||be,className:"flex-1",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"submit",disabled:y||be,className:"flex-1",children:y?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Listing"}),e.jsxs(c,{type:"button",variant:"outline",disabled:y||be,className:"flex-1",onClick:async()=>{await Xe({manual:!0})},children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Save as Draft"]})]})})]})})})]}),e.jsx(U,{open:Ge,onOpenChange:Oe,children:e.jsxs(G,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Discard Draft?"}),e.jsx(V,{children:"Are you sure you want to discard this draft? All unsaved changes will be permanently lost."})]}),e.jsxs($,{children:[e.jsx(T,{children:"Cancel"}),e.jsx(_,{onClick:async()=>{if(!Ee)return Ie(!1),Le(!1),Oe(!1),void qe.reset();try{await ge(me(u,"listing",Ee)),Ue(null),Ie(!1),Le(!1),Oe(!1),qe.reset(),Ce([]),Ae([]),le([]),d.success("Draft discarded")}catch(e){const s="permission-denied"===e.code?"Permission denied. Unable to discard draft.":"Failed to discard draft";d.error(s)}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Discard Draft"})]})]})}),e.jsx(U,{open:Be,onOpenChange:Ve,children:e.jsxs(G,{children:[e.jsxs(O,{children:[e.jsx(B,{children:"Submit Listing for Review?"}),e.jsx(V,{children:"Your listing will be submitted for admin review. Once approved, it will be published and visible to guests. Are you sure you want to continue?"})]}),e.jsxs($,{children:[e.jsx(T,{children:"Cancel"}),e.jsx(_,{onClick:async()=>{Ve(!1),await(async()=>{if(a){ee(!0);try{const e=await(async()=>{if(!a)throw Error("No user");const e=qe.getValues(),s=e.dateRange?.from&&e.dateRange?.to?Ke(e.dateRange.from,e.dateRange.to):ke,t={hostId:a.uid,title:e.title,description:e.description,category:e.category||"home",price:+e.price,discount:e.discount&&e.discount.trim()?+e.discount:void 0,promo:e.promo||void 0,location:e.location,maxGuests:+e.maxGuests,bedrooms:e.bedrooms&&e.bedrooms.trim()?+e.bedrooms:void 0,bathrooms:e.bathrooms&&e.bathrooms.trim()?+e.bathrooms:void 0,amenities:e.amenities?e.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:s,blockedDates:Fe,images:[],status:"pending",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};{const e={...Je(t),status:"pending"},s=await b(e),a=await de(me(u,"listing",s));if(a.exists()&&"pending"!==a.data().status&&await xe(me(u,"listing",s),{status:"pending",updatedAt:(new Date).toISOString()}),Ee)try{await ge(me(u,"listing",Ee))}catch(r){}return Ue(null),Le(!1),s}})(),s=await de(me(u,"listing",e));if(s.exists()&&"pending"!==s.data().status&&await ue(me(u,"listing",e),{status:"pending",updatedAt:(new Date).toISOString()},{merge:!0}),oe.length>0){const s=await es(oe,e);await ue(me(u,"listing",e),{images:s,status:"pending",updatedAt:(new Date).toISOString()},{merge:!0})}Ue(null),Le(!1),Te(!0),d.success("Listing submitted for review! Payment will be processed when approved."),t()}catch(e){d.error(e.message||"Failed to submit listing")}finally{ee(!1)}}})()},children:"Submit Listing"})]})]})})]})},Se=({children:t,showWarning:a=!1,required:r=!0})=>{const{user:i}=m(),n=l(),[o,d]=s.useState(null),[u,j]=s.useState(null),[f,v]=s.useState(!0);return s.useEffect(()=>{(async()=>{if(!i)return d(!1),void v(!1);try{const e=await pe(i.uid);if(d(e),e){const e=await je(i.uid);j(e)}}catch(e){d(!1)}finally{v(!1)}})()},[i]),f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Checking subscription..."})]})}):r&&!o?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:e.jsxs(h,{className:"max-w-md w-full",children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ie,{className:"h-6 w-6 text-destructive"}),e.jsx(p,{children:"Subscription Required"})]}),e.jsx(y,{children:"You need an active subscription to access this feature."})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"To create listings and manage your properties, you need to subscribe to one of our hosting plans."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"w-full",onClick:()=>n("/host/register",{state:{from:"dashboard"}}),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Subscribe Now"]}),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>n("/host/dashboard"),children:e.jsx(le,{className:"h-4 w-4"})})]})]})]})}):a&&!o?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mb-6 border-yellow-500/50 bg-yellow-500/10",children:e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:"Subscription Required"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"You need an active subscription to create and manage listings. Subscribe now to unlock all features."}),e.jsxs(c,{size:"sm",onClick:()=>n("/host/register",{state:{from:"dashboard"}}),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Subscribe Now"]})]})]})})}),t]}):e.jsx(e.Fragment,{children:t})},De=()=>{const s=l();return e.jsx(Se,{required:!0,children:e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(fe,{to:"/host/dashboard",className:"mb-4"}),e.jsx(Ne,{onSuccess:()=>s("/host/listings")})]})})})};export{De as default};
