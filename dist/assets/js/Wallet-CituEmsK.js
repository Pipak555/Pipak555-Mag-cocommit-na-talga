import{l as e,u as a,r as s,j as t}from"./react-vendor-BMVo5gto.js";import{j as l,e as r,B as i,u as n,D as c,C as o,a as d,b as m,c as u,d as x,i as p}from"./index-BbQqfVom.js";import{f as y,e as h,u as b}from"./firebase-vendor-BtzXZj7S.js";import{I as j}from"./input-B93J7yYR.js";import{C as f}from"./CouponManager-7m7oVs-H.js";import{P as g}from"./PayPalButton-BsDK2NsU.js";import{f as w,L as N,C as P,a4 as v,i as k,A as C,r as E,s as A,a5 as S}from"./icons-vendor-D1YpcxsO.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";import"./badge-0vFpitRp.js";const V=({userId:n,onVerified:c,paypalEmail:o,paypalVerified:d})=>{const[m]=e(),u=a(),[x,p]=s.useState(!1),[j,f]=s.useState(!1);let g=window.location.origin+"/paypal-callback";g.includes("localhost")&&(g=g.replace("localhost","127.0.0.1"));const C=s.useCallback(async e=>{f(!0);try{const e=await y(h(l,"users",n)),a=e.exists()?e.data():null,s=a?.paypalEmail||null,t={paypalEmailVerified:!0,paypalVerifiedAt:(new Date).toISOString(),paypalOAuthVerified:!0};s||(t.paypalEmail=null),await b(h(l,"users",n),t),s?(r.success("PayPal account verified! You successfully logged in with PayPal."),c(s)):(r.success("PayPal account verified! Your email will be stored on your first payment."),c("")),u(window.location.pathname,{replace:!0})}catch(a){r.error("Failed to verify PayPal account. Please try again."),u(window.location.pathname,{replace:!0})}finally{f(!1)}},[n,u,c]);return s.useEffect(()=>{const e=m.get("code"),a=m.get("state");if(m.get("error"))return r.error("PayPal login was cancelled or failed. Please try again."),void u(window.location.pathname,{replace:!0});e&&a==="paypal-verify-"+n&&C(e)},[m,n,u,C]),d&&o?t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(w,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"PayPal Account Verified"}),t.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:o}),t.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Your account was verified by logging in with PayPal"})]})]})})}):j?t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"flex items-center justify-center p-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:t.jsxs("div",{className:"text-center",children:[t.jsx(N,{className:"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin mx-auto mb-3"}),t.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Verifying PayPal account..."}),t.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-2",children:"Please wait while we verify your account"})]})})}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[t.jsx(P,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}),t.jsx("p",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:"Link your PayPal account to make deposits and payments. You'll log in with your PayPal credentials to verify your account."})]}),t.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[t.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Don't have a PayPal account?"}),t.jsxs(i,{variant:"outline",size:"sm",onClick:()=>window.open("https://www.paypal.com/signup","_blank"),className:"w-full mb-2",children:[t.jsx(v,{className:"h-4 w-4 mr-2"}),"Sign up for PayPal"]}),t.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Create a free PayPal account, then come back to link it"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsx("p",{className:"text-sm font-medium mb-2",children:"How it works:"}),t.jsxs("ol",{className:"text-xs text-muted-foreground space-y-1 list-decimal list-inside",children:[t.jsx("li",{children:'Click "Link PayPal Account" below'}),t.jsx("li",{children:"You'll be redirected to PayPal's login page"}),t.jsx("li",{children:"Log in with your PayPal email and password"}),t.jsx("li",{children:"PayPal will verify your account and redirect you back"}),t.jsx("li",{children:"Your account will be linked and verified âœ…"})]})]}),t.jsx(i,{onClick:()=>{p(!0);const e="paypal-verify-"+n,a=`https://www.sandbox.paypal.com/webapps/auth/protocol/openidconnect/v1/authorize?client_id=EBY2ts8baThwt97plOoNWxeryVxWHXEe-ANWAexRZ7zq1sfq-qIa90XNhC5JExAaFGTvrF_TT2hqwzj0&response_type=code&scope=${encodeURIComponent("openid email profile")}&redirect_uri=${encodeURIComponent(g)}&state=${e}`;window.location.href=a},disabled:x,className:"w-full",size:"lg",children:x?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Redirecting to PayPal..."]}):t.jsxs(t.Fragment,{children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})}),t.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"You'll be redirected to PayPal to log in with your account credentials"})]})]})},I=()=>{const e=a(),{user:w}=n(),[N,P]=s.useState(0),[v,I]=s.useState([]),[L,Y]=s.useState([]),[B,z]=s.useState(""),[F,T]=s.useState(!1),[D,U]=s.useState(""),[W,$]=s.useState(!1),[_,q]=s.useState(!1);s.useEffect(()=>{w&&(R(),H())},[w]);const R=async()=>{if(!w)return;const e=await y(h(l,"users",w.uid));if(e.exists()){const a=e.data();P(a.walletBalance||0),I(a.coupons||[]),U(a.paypalEmail||""),$(!!a.paypalEmail),q(!!a.paypalEmailVerified)}},H=async()=>{if(!w)return;const e=await c(w.uid);Y(e)},O=s.useCallback(e=>{U(e),$(!0),q(!0),R()},[w]);return t.jsx("div",{className:"min-h-screen bg-background p-4 sm:p-6",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs(i,{variant:"ghost",onClick:()=>e("/guest/dashboard"),className:"mb-4 sm:mb-6 h-10 sm:h-auto",children:[t.jsx(C,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Back to Dashboard"}),t.jsx("span",{className:"sm:hidden",children:"Back"})]}),t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6",children:"E-Wallet"}),t.jsxs(o,{className:"mb-4 sm:mb-6 border-2",children:[t.jsxs(d,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:[t.jsxs(m,{className:"flex items-center gap-2 text-base sm:text-lg",children:[t.jsx(k,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"PayPal Account Verification"]}),t.jsx(u,{className:"text-xs sm:text-sm",children:"Link your PayPal account by logging in with your PayPal credentials. This verifies you have a real PayPal account."})]}),t.jsxs(x,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:[w?t.jsx(V,{userId:w.uid,onVerified:O,paypalEmail:D,paypalVerified:_}):t.jsx("div",{className:"p-4 bg-muted rounded-lg",children:t.jsx("p",{className:"text-sm text-muted-foreground",children:"Please sign in to verify your PayPal account"})}),_&&D&&t.jsx("div",{className:"mt-4",children:t.jsx(i,{variant:"outline",size:"sm",onClick:async()=>{if(w)try{await b(h(l,"users",w.uid),{paypalEmail:null,paypalEmailVerified:!1,paypalLinkedAt:null}),$(!1),U(""),r.success("PayPal account unlinked")}catch(e){r.error("Failed to unlink PayPal account")}},className:"w-full",children:"Unlink PayPal Account"})})]})]}),t.jsxs(o,{className:"mb-4 sm:mb-6",children:[t.jsx(d,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:t.jsxs(m,{className:"flex items-center gap-2 text-base sm:text-lg",children:[t.jsx(E,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Current Balance"]})}),t.jsxs(x,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:[t.jsx("p",{className:"text-3xl sm:text-4xl font-bold text-primary mb-4 sm:mb-6",children:p(N)}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:t.jsx(j,{type:"number",placeholder:"Amount",value:B,onChange:e=>z(e.target.value),min:"1",step:"0.01",disabled:!D,className:"h-11 sm:h-auto text-base sm:text-sm flex-1"})}),D?w&&B&&+B>0?t.jsx(g,{amount:+B,userId:w.uid,description:"Wallet deposit: "+p(+B),onSuccess:async()=>{if(!w||!B||0>=+B)return;await R(),await H(),z("");const e=await y(h(l,"users",w.uid));e.exists()&&e.data().paypalEmailVerified&&!_&&(q(!0),r.success("PayPal account verified! Your account has been verified through a successful payment."))},redirectUrl:window.location.origin+"/guest/wallet"}):t.jsx(i,{onClick:async()=>{w&&B&&+B>0?D?r.info("Please use PayPal to add funds to your wallet"):r.error("Please link your PayPal account first to make deposits"):r.error("Enter a valid amount")},disabled:!B||0>=+B,children:"Enter amount to deposit"}):t.jsx("div",{className:"p-4 bg-muted rounded-lg",children:t.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Link your PayPal account above to make deposits"})})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6",children:[t.jsx(f,{coupons:v,onApplyCoupon:e=>{const a=v.find(a=>a.code===e&&!a.used);a?r.success(`Coupon ${e} applied! ${p(a.discount)} discount`):r.error("Invalid or already used coupon")}}),t.jsxs(o,{children:[t.jsx(d,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:t.jsx(m,{className:"text-base sm:text-lg",children:"Transaction History"})}),t.jsx(x,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:0===L.length?t.jsx("p",{className:"text-center text-muted-foreground py-6 sm:py-8 text-sm sm:text-base",children:"No transactions yet"}):t.jsx("div",{className:"space-y-2 sm:space-y-3",children:L.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-2.5 sm:p-3 border rounded touch-manipulation",children:[t.jsxs("div",{className:"flex items-center gap-3",children:["deposit"===e.type||"reward"===e.type?t.jsx(A,{className:"h-5 w-5 text-green-500"}):t.jsx(S,{className:"h-5 w-5 text-red-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.description}),t.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()})]})]}),t.jsxs("p",{className:"font-semibold "+("deposit"===e.type||"reward"===e.type?"text-green-500":"text-red-500"),children:["deposit"===e.type||"reward"===e.type?"+":"-",p(e.amount)]})]},e.id))})})]})]})]})})};export{I as default};
