import{u as e,r as s,j as a}from"./react-vendor-Ve3SFwKO.js";import{u as t,j as r,e as n,v as i,C as l,a as c,b as d,d as m,i as o,B as x,c as u}from"./index-DaMaslBo.js";import{d as h,q as p,o as j,e as f,h as g,f as N}from"./firebase-vendor-BC71bXmb.js";import{B as y}from"./badge-BSgvUoVt.js";import{L as b}from"./label-B2t2XnWQ.js";import{T as v}from"./textarea-bhWBiMTW.js";import{T as w,a as P,b as k,c as S}from"./tabs-C4BuYc9E.js";import{B as D}from"./BackButton-uEV41aeK.js";import{A as T,a as C,b as A,c as I,d as R,e as F,f as E,g as U}from"./alert-dialog-DLw-Qa8s.js";import{c as L,b as B}from"./paymentService-Cp8a7m6L.js";import{h as M,m as z,t as Y,C as _,ao as q,g as O,f as $}from"./icons-vendor-Dhca6XHc.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const G=()=>{const G=e(),{user:V,userRole:H}=t(),[J,K]=s.useState(!0),[Q,W]=s.useState([]),[X,Z]=s.useState([]),[ee,se]=s.useState(null),[ae,te]=s.useState(!1),[re,ne]=s.useState(null),[ie,le]=s.useState(""),[ce,de]=s.useState(!1),[me,oe]=s.useState("all");s.useEffect(()=>{V&&"admin"===H?xe():G("/admin/login")},[V,H,G]);const xe=async()=>{try{K(!0);const e=h(r,"transactions"),s=p(e,j("createdAt","desc")),a=await f(s),t=await Promise.all(a.docs.map(async e=>{const s=e.data();let a="Unknown",t="Unknown";try{const e=await g(N(r,"users",s.userId));if(e.exists()){const s=e.data();a=s.email||"Unknown",t=s.fullName||"Unknown"}}catch(n){}return{id:e.id,...s,userEmail:a,userName:t}}));W(t);const n=h(r,"subscriptions"),i=p(n,j("createdAt","desc")),l=await f(i),c=await Promise.all(l.docs.map(async e=>{const s=e.data();let a="Unknown",t="Unknown";try{const e=await g(N(r,"users",s.userId));if(e.exists()){const s=e.data();a=s.email||"Unknown",t=s.fullName||"Unknown"}}catch(n){}return{id:e.id,...s,userEmail:a,userName:t}}));Z(c)}catch(e){n.error("Failed to load transactions: "+(e.message||"Unknown error"))}finally{K(!1)}},ue=(e,s)=>{se(e),ne(s),le(""),te(!0)},he=e=>{switch(e){case"completed":return a.jsxs(y,{className:"bg-green-500",children:[a.jsx($,{className:"h-3 w-3 mr-1"}),"Completed"]});case"pending":return a.jsxs(y,{className:"bg-yellow-500",children:[a.jsx(O,{className:"h-3 w-3 mr-1"}),"Pending"]});case"pending_transfer":return a.jsxs(y,{className:"bg-yellow-500",children:[a.jsx(O,{className:"h-3 w-3 mr-1"}),"Pending Transfer"]});case"failed":return a.jsxs(y,{className:"bg-red-500",children:[a.jsx(q,{className:"h-3 w-3 mr-1"}),"Failed"]});case"refunded":return a.jsxs(y,{className:"bg-gray-500",children:[a.jsx(q,{className:"h-3 w-3 mr-1"}),"Refunded"]});default:return a.jsx(y,{children:e||"Unknown"})}},pe=Q.filter(e=>"pending"===e.status);Q.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0);const je=Q.filter(e=>e.description?.toLowerCase().includes("host subscription")||e.description?.toLowerCase().includes("subscription")),fe=je.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0),ge=Q.filter(e=>"service_fee"===e.paymentMethod),Ne=ge.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0),ye=X.filter(e=>"active"===e.status),be=X.filter(e=>"active"===e.status).reduce((e,s)=>e+s.amount,0);return J?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-7xl mx-auto",children:a.jsx(i,{})})}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsx(D,{to:"/admin/dashboard",label:"Back to Dashboard"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Payment Management"}),a.jsx("p",{className:"text-muted-foreground",children:"Review and manage all platform transactions"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Subscription Revenue"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold text-primary",children:o(fe)}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Paid to your PayPal"})]})]}),a.jsxs(l,{className:"border-green-200 bg-green-50/50 dark:bg-green-950/20 dark:border-green-900",children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Service Fees (Commission)"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:o(Ne)}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"To your PayPal account"})]})]}),a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:ye.length}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Total value: ",o(be)]})]})]}),a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:pe.length}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting confirmation"})]})]})]}),a.jsx(l,{className:"mb-6 border-primary/20 bg-primary/5",children:a.jsx(m,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Link Your PayPal Account"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Link your PayPal account to receive all subscription payments and service fees (commission)"})]}),a.jsxs(x,{onClick:()=>G("/admin/paypal-settings"),children:[a.jsx(M,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})]})})}),a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsx(d,{children:"Transactions & Subscriptions"}),a.jsx(u,{children:"Review and manage all payments and subscriptions"})]}),a.jsx(m,{children:a.jsxs(w,{value:me,onValueChange:oe,className:"w-full",children:[a.jsxs(P,{className:"grid w-full grid-cols-4",children:[a.jsx(k,{value:"all",children:"All Transactions"}),a.jsx(k,{value:"subscriptions",children:"Subscriptions"}),a.jsx(k,{value:"subscription-payments",children:"Subscription Payments"}),a.jsx(k,{value:"service-fees",children:"Service Fees"})]}),a.jsx(S,{value:"all",className:"mt-6",children:0===Q.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No transactions found"})]}):a.jsx("div",{className:"space-y-4",children:Q.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),he(e.status)]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," â€¢ ",new Date(e.createdAt).toLocaleDateString()]}),e.bookingId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Booking ID: ",e.bookingId.slice(0,8)]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Payment ID: ",e.paymentId]}),e.serviceFee&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Service Fee: ",o(e.serviceFee)]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod||"N/A"})]}),"pending"===e.status&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx(x,{size:"sm",onClick:()=>ue(e,"confirm"),children:"Confirm"}),a.jsx(x,{size:"sm",variant:"destructive",onClick:()=>ue(e,"refund"),children:"Refund"})]}),"completed"===e.status&&"payment"===e.type&&a.jsx(x,{size:"sm",variant:"destructive",onClick:()=>ue(e,"refund"),children:"Refund"})]})]},e.id))})}),a.jsx(S,{value:"subscriptions",className:"mt-6",children:0===X.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(M,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No subscriptions found"})]}):a.jsx("div",{className:"space-y-4",children:X.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),a.jsx(y,{className:"active"===e.status?"bg-green-500":"cancelled"===e.status?"bg-yellow-500":"bg-gray-500",children:e.status})]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.planName," (",e.billingCycle,")"]}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," â€¢ Started: ",new Date(e.startDate).toLocaleDateString()]}),e.endDate&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Expires: ",new Date(e.endDate).toLocaleDateString()]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Payment ID: ",e.paymentId]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold text-primary",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod})]})]},e.id))})}),a.jsx(S,{value:"subscription-payments",className:"mt-6",children:0===je.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(Y,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No subscription payments found"}),a.jsx("p",{className:"text-xs mt-2",children:"These payments go directly to your PayPal account"})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-primary",children:"ðŸ’° These subscription payments are received in your PayPal account"}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Total subscription revenue: ",a.jsx("strong",{children:o(fe)})]})]}),je.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg border-primary/20 bg-primary/5",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),he(e.status),a.jsx(y,{variant:"outline",className:"border-primary text-primary",children:"Subscription"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," â€¢ ",new Date(e.createdAt).toLocaleDateString()]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["PayPal Payment ID: ",e.paymentId]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold text-primary",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod||"PayPal"}),a.jsx("p",{className:"text-xs text-primary mt-1",children:"â†’ Your PayPal"})]})]},e.id))]})}),a.jsx(S,{value:"service-fees",className:"mt-6",children:0===ge.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No service fees found"}),a.jsx("p",{className:"text-xs mt-2",children:"Service fees (10% commission) from bookings go to your PayPal account"})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-900 rounded-lg p-4 mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"ðŸ’° All Service Fees Go to Your PayPal Account"}),a.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400 mt-2",children:["Total: ",o(Ne)]}),a.jsx("p",{className:"text-xs text-green-700 dark:text-green-300 mt-2",children:"All service fees (10% commission) from bookings are processed to your linked PayPal account. Make sure your PayPal account is linked in the PayPal Settings page."})]}),ge.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg border-green-200 bg-green-50/50 dark:bg-green-950/20 dark:border-green-900",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:"Service Fee"}),he("completed"),a.jsx(y,{variant:"outline",className:"border-primary text-primary",children:"Commission"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Booking #",(e.bookingId||"").slice(0,8)," â€¢ ",new Date(e.createdAt).toLocaleDateString()]}),e.adminPayPalEmail&&a.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["â†’ ",e.adminPayPalEmail]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold text-primary",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"âœ“ To PayPal"})]})]},e.id))]})})]})})]}),a.jsx(T,{open:ae,onOpenChange:te,children:a.jsxs(C,{children:[a.jsxs(A,{children:[a.jsx(I,{children:"confirm"===re?"Confirm Transaction?":"Refund Transaction?"}),a.jsx(R,{className:"space-y-4",children:"confirm"===re?a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Are you sure you want to confirm this transaction? This will process the payment and update wallet balances."}),ee&&a.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium",children:"Transaction Details:"}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Amount: ",o(ee.amount)]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Type: ",ee.type]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["User: ",ee.userName||ee.userEmail]})]})]}):a.jsx(a.Fragment,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[a.jsx(_,{className:"h-4 w-4"}),a.jsx("p",{className:"font-medium",children:"This will refund the payment and reverse wallet balances."})]}),ee&&a.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Refund Details:"}),a.jsxs("p",{className:"text-xs",children:["Refund Amount: ",a.jsx("span",{className:"font-semibold",children:o(ee.amount)})]}),a.jsxs("p",{className:"text-xs",children:["Transaction Type: ",ee.type]}),a.jsxs("p",{className:"text-xs",children:["User: ",ee.userName||ee.userEmail]}),ee.bookingId&&a.jsxs("p",{className:"text-xs",children:["Booking ID: ",ee.bookingId.slice(0,8)]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(b,{htmlFor:"refund-reason",children:"Refund Reason (Optional)"}),a.jsx(v,{id:"refund-reason",placeholder:"Enter reason for refund...",value:ie,onChange:e=>le(e.target.value),rows:3})]})]})})})]}),a.jsxs(F,{children:[a.jsx(E,{disabled:ce,children:"Cancel"}),a.jsx(U,{onClick:async()=>{if(ee&&re){de(!0);try{if("confirm"===re)await L(ee.id),n.success("Transaction confirmed successfully");else if("refund"===re){const e=await B(ee.id,ee,ie||void 0);if(!e.success)throw Error("Refund processing failed");n.success(`Refund processed successfully. â‚±${e.refundAmount?.toFixed(2)} has been returned to user's wallet.`)}await xe(),se(null),ne(null),le("")}catch(e){n.error(e.message||`Failed to ${re} transaction`)}finally{de(!1),te(!1)}}},disabled:ce,className:"refund"===re?"bg-destructive hover:bg-destructive/90":"",children:ce?"Processing...":"confirm"===re?"Confirm":"Refund"})]})]})})]})})};export{G as default};
