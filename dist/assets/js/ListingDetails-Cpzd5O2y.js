const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-BnushFQy.js","assets/js/react-vendor-Ve3SFwKO.js","assets/js/utils-vendor-DzY7Ay74.js","assets/js/maps-vendor-CYGXCXz5.js","assets/maps-vendor-Dgihpmma.css","assets/js/ui-vendor-D9RGQy8n.js","assets/js/icons-vendor-DD8ZfUKZ.js","assets/js/firebase-vendor-BC71bXmb.js","assets/index-CZT-s-DH.css","assets/js/recommendations-B-fDFj-J.js"])))=>i.map(i=>d[i]);
import{r as e,j as s,C as t,e as a,B as i,a as r,u as n,l,s as o,h as c,v as d,b as m,c as x,d as h,i as u,_ as p,w as g}from"./index-BnushFQy.js";import{r as f,j,q as w,u as b}from"./react-vendor-Ve3SFwKO.js";import{i as v}from"./availabilityUtils-Du47gcIt.js";import{D as y,a as N,b as k,c as C,d as _}from"./dialog-B475KvSN.js";import{B as S}from"./badge-CYghlWc2.js";import{D as T}from"./date-range-picker-DP4SlluA.js";import{I}from"./input-C6C1u0Er.js";import{L as D}from"./label-DdT-oWKe.js";import{B as L}from"./BackButton-DohCcac0.js";import{A as E,a as F}from"./avatar-Cu5z3EUs.js";import{S as P,a as R,b as z,c as A,d as O}from"./select-D2BQB2Va.js";import{q as $,d as M,w as H,o as V,l as G,h as U,f as B}from"./firebase-vendor-BC71bXmb.js";import{O as q,Q as W,g as Y,t as J,V as Z,Y as K,Z as Q,_ as X,$ as ee,a0 as se,a1 as te,a2 as ae,a3 as ie,a4 as re,a5 as ne,p as le,w as oe,U as ce,o as de,l as me,j as xe,a6 as he,X as ue}from"./icons-vendor-DD8ZfUKZ.js";import{D as pe,a as ge,b as fe,c as je,d as we}from"./dropdown-menu-eYIb6UEc.js";import{L as be}from"./ListingCard-D6Td60Vf.js";import"./ui-vendor-D9RGQy8n.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./calendar-CF_sIwXc.js";const ve=({listingId:r,refreshTrigger:n})=>{const[l,o]=f.useState([]),[c,d]=f.useState(!0),[m,x]=f.useState("newest"),[h,u]=f.useState(new Set),p=f.useCallback(async()=>{try{d(!0);const s=await e(r);o(s)}catch(s){o([])}finally{d(!1)}},[r]);f.useEffect(()=>{if(!r)return;let e,t=!0;try{e=$(M(s,"reviews"),H("listingId","==",r),V("createdAt","desc"))}catch(i){t=!1,e=$(M(s,"reviews"),H("listingId","==",r))}const a=G(e,e=>{let s=e.docs.map(e=>({id:e.id,...e.data()}));t||(s=s.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),o(s),d(!1)},e=>{p()});return()=>{a()}},[r,p]),f.useEffect(()=>{void 0!==n&&n>0&&p()},[n,p]),f.useEffect(()=>{g()},[r]);const g=()=>{const e=localStorage.getItem("helpful_reviews_"+r);e&&u(new Set(JSON.parse(e)))},w=f.useMemo(()=>{const e=[...l];switch(m){case"newest":return e.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime());case"highest":return e.sort((e,s)=>s.rating-e.rating);case"lowest":return e.sort((e,s)=>e.rating-s.rating);case"most_helpful":return e.sort((e,s)=>{const t=h.has(e.id)?1:0,a=h.has(s.id)?1:0;return t!==a?a-t:s.rating-e.rating});default:return e}},[l,m,h]),b=f.useMemo(()=>0===l.length?0:(l.reduce((e,s)=>e+s.rating,0)/l.length).toFixed(1),[l]),v=f.useMemo(()=>{const e={5:0,4:0,3:0,2:0,1:0};return l.forEach(s=>{e[s.rating]++}),e},[l]);return c?j.jsx("p",{children:"Loading reviews..."}):0===l.length?j.jsx(t,{children:j.jsx(a,{className:"py-8 text-center text-muted-foreground",children:"No reviews yet"})}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[j.jsxs("div",{children:[j.jsxs("h3",{className:"text-2xl font-semibold mb-2",children:["Reviews (",l.length,")"]}),j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsxs("div",{className:"flex items-center",children:[j.jsx(q,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}),j.jsx("span",{className:"text-lg font-bold ml-1",children:b})]}),j.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",l.length," ",1===l.length?"review":"reviews",")"]})]})]}),j.jsxs(P,{value:m,onValueChange:e=>x(e),children:[j.jsxs(R,{className:"w-full sm:w-[200px]",children:[j.jsx(W,{className:"h-4 w-4 mr-2"}),j.jsx(z,{placeholder:"Sort by"})]}),j.jsxs(A,{children:[j.jsx(O,{value:"newest",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(Y,{className:"h-4 w-4"}),j.jsx("span",{children:"Newest First"})]})}),j.jsx(O,{value:"highest",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(J,{className:"h-4 w-4"}),j.jsx("span",{children:"Highest Rated"})]})}),j.jsx(O,{value:"lowest",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(J,{className:"h-4 w-4 rotate-180"}),j.jsx("span",{children:"Lowest Rated"})]})}),j.jsx(O,{value:"most_helpful",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(Z,{className:"h-4 w-4"}),j.jsx("span",{children:"Most Helpful"})]})})]})]})]}),j.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[j.jsx("h4",{className:"text-sm font-medium mb-3",children:"Rating Breakdown"}),j.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].reverse().map(e=>{const s=v[e],t=s/l.length*100;return j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs("div",{className:"flex items-center gap-1 w-20",children:[j.jsx("span",{className:"text-sm",children:e}),j.jsx(q,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"})]}),j.jsx("div",{className:"flex-1 bg-background rounded-full h-2 overflow-hidden",children:j.jsx("div",{className:"bg-primary h-full rounded-full transition-all duration-300",style:{width:t+"%"}})}),j.jsx("span",{className:"text-sm text-muted-foreground w-12 text-right",children:s})]},e)})})]}),j.jsx("div",{className:"space-y-4",children:w.map(e=>j.jsx(t,{children:j.jsx(a,{className:"pt-6",children:j.jsxs("div",{className:"flex items-start gap-4",children:[j.jsx(E,{children:j.jsx(F,{children:e.guestId.slice(0,2).toUpperCase()})}),j.jsxs("div",{className:"flex-1",children:[j.jsx("div",{className:"flex items-start justify-between mb-2",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx("div",{className:"flex",children:[...[,,,,,]].map((s,t)=>j.jsx(q,{className:"h-4 w-4 "+(t<e.rating?"fill-yellow-400 text-yellow-400":"text-muted")},t))}),j.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})}),j.jsx("p",{className:"text-sm mb-3 leading-relaxed",children:e.comment}),j.jsxs(i,{variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:()=>(e=>{const s=new Set(h);s.has(e)?s.delete(e):s.add(e),u(s),localStorage.setItem("helpful_reviews_"+r,JSON.stringify(Array.from(s)))})(e.id),children:[j.jsx(Z,{className:"h-3 w-3 mr-1 "+(h.has(e.id)?"fill-primary text-primary":"")}),"Helpful ",h.has(e.id)&&"(1)"]})]})]})})},e.id))})]})},ye=({url:e,title:s,description:t="",variant:a="outline",size:n="default"})=>{const[l,o]=f.useState(!1),[c,d]=f.useState(!1),[m,x]=f.useState("Copy"),h=f.useRef(null),u=encodeURIComponent(e),p=encodeURIComponent(s),g=async()=>{if(window.isSecureContext||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),o(!0),r.success("Link copied to clipboard!"),void setTimeout(()=>o(!1),2e3)}catch(s){}const a=document.createElement("input");a.value=e,a.type="text",a.readOnly=!0,a.style.position="fixed",a.style.left="0",a.style.top="0",a.style.width="1px",a.style.height="1px",a.style.opacity="0",a.style.pointerEvents="none",a.style.zIndex="9999",document.body.appendChild(a),a.focus(),a.select(),a.setSelectionRange(0,e.length),await new Promise(e=>setTimeout(e,10));try{const e=document.execCommand("copy");if(document.body.removeChild(a),e)return o(!0),r.success("Link copied to clipboard!"),void setTimeout(()=>o(!1),2e3)}catch(t){document.body.contains(a)&&document.body.removeChild(a)}}catch(a){}d(!0),x("Copy"),setTimeout(()=>{h.current&&(h.current.focus(),h.current.select())},100)};return j.jsxs(j.Fragment,{children:[j.jsxs(pe,{children:[j.jsx(ge,{asChild:!0,children:j.jsxs(i,{variant:a,size:n,className:"flex items-center gap-2",children:[j.jsx(K,{className:"h-4 w-4"}),j.jsx("span",{children:"Share"})]})}),j.jsxs(fe,{align:"end",className:"w-48",children:[navigator.share&&j.jsxs(j.Fragment,{children:[j.jsxs(je,{onClick:async()=>{if(navigator.share)try{await navigator.share({title:s,text:t,url:e})}catch(a){a.name}else g()},children:[j.jsx(K,{className:"h-4 w-4 mr-2"}),"Share via..."]}),j.jsx(we,{})]}),j.jsx(je,{onClick:g,children:l?j.jsxs(j.Fragment,{children:[j.jsx(Q,{className:"h-4 w-4 mr-2 text-green-500"}),"Copied!"]}):j.jsxs(j.Fragment,{children:[j.jsx(X,{className:"h-4 w-4 mr-2"}),"Copy Link"]})}),j.jsx(we,{}),j.jsxs(je,{onClick:()=>{const e="https://www.facebook.com/sharer/sharer.php?u="+u;window.open(e,"_blank","noopener,noreferrer")},children:[j.jsx(ee,{className:"h-4 w-4 mr-2 text-blue-600"}),"Share to Facebook"]}),j.jsxs(je,{onClick:()=>{const e=`https://twitter.com/intent/tweet?url=${u}&text=${p}${t?"&hashtags=MojoDojoCasaHouse":""}`;window.open(e,"_blank","noopener,noreferrer")},children:[j.jsx(se,{className:"h-4 w-4 mr-2 text-sky-500"}),"Share to Twitter"]}),j.jsxs(je,{onClick:()=>{const e=`https://api.whatsapp.com/send?text=${p}%20${u}`;window.open(e,"_blank","noopener,noreferrer")},children:[j.jsx(te,{className:"h-4 w-4 mr-2 text-green-600"}),"Share to WhatsApp"]})]})]}),j.jsx(y,{open:c,onOpenChange:d,children:j.jsxs(N,{className:"sm:max-w-[500px]",children:[j.jsxs(k,{children:[j.jsxs(C,{className:"flex items-center gap-2",children:[j.jsx(X,{className:"h-5 w-5"}),"Copy Link"]}),j.jsx(_,{children:"Share this listing with others by copying the link below"})]}),j.jsxs("div",{className:"space-y-4 py-4",children:[j.jsxs("div",{className:"flex gap-2",children:[j.jsx(I,{ref:h,value:e,readOnly:!0,className:"flex-1 font-mono text-sm",onFocus:e=>e.target.select()}),j.jsx(i,{onClick:async()=>{if(!h.current)return;const s=h.current;s.focus(),s.select(),s.setSelectionRange(0,e.length);try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),x("Copied!"),o(!0),r.success("Link copied to clipboard!"),void setTimeout(()=>{x("Copy"),d(!1),o(!1)},1500)}catch(t){}await new Promise(e=>setTimeout(e,10)),document.execCommand("copy")?(x("Copied!"),o(!0),r.success("Link copied to clipboard!"),setTimeout(()=>{x("Copy"),d(!1),o(!1)},1500)):(s.select(),r.info("Text selected. Press Ctrl+C (or Cmd+C) to copy"),x("Copy"))}catch(a){s.select(),r.info("Text selected. Press Ctrl+C (or Cmd+C) to copy"),x("Copy")}},className:"shrink-0",variant:"Copied!"===m?"default":"secondary",children:"Copied!"===m?j.jsxs(j.Fragment,{children:[j.jsx(Q,{className:"h-4 w-4 mr-2"}),"Copied!"]}):j.jsxs(j.Fragment,{children:[j.jsx(ae,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tip: You can also select the link above and press ",j.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs font-mono",children:"Ctrl+C"})," (or ",j.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs font-mono",children:"Cmd+C"})," on Mac) to copy"]})]})]})})]})},Ne=()=>{const{id:e}=w(),k=b(),{user:E}=n(),[F,P]=f.useState(null),[R,z]=f.useState(),[A,O]=f.useState(1),[$,M]=f.useState(!1),[H,V]=f.useState([]),[G,q]=f.useState(null),[W,Y]=f.useState([]),[J,Z]=f.useState(null),[K,Q]=f.useState(""),[X,ee]=f.useState(0),[se,te]=f.useState(!1),[ae,pe]=f.useState(0),[ge,fe]=f.useState([]),[je,we]=f.useState(0);f.useEffect(()=>{e&&(be(),ee(0),window.scrollTo({top:0,behavior:"smooth"})),E&&(Ce(),_e())},[e,E]),f.useEffect(()=>{if(!se)return;const e=e=>{F?.images&&("ArrowLeft"===e.key?pe(e=>0===e?F.images.length-1:e-1):"ArrowRight"===e.key?pe(e=>e===F.images.length-1?0:e+1):"Escape"===e.key&&te(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[se,F?.images]);const be=async()=>{if(!e)return;const s=await l(e);if(s){const t=await o(e),a={...s,averageRating:t.averageRating,reviewCount:t.reviewCount};P(a),we(e=>e+1),s.hostId&&await Ne(s.hostId),await Se()}},Ne=async e=>{try{const t=await U(B(s,"users",e));if(t.exists()){const e=t.data();q({fullName:e.fullName||"Host",email:e.email||""})}else q({fullName:"Host",email:""})}catch(t){q({fullName:"Host",email:""})}},Ce=async()=>{if(!E)return;const e=await U(B(s,"users",E.uid));e.exists()&&V(e.data().favorites||[])},_e=async()=>{if(!E)return;const e=await U(B(s,"users",E.uid));if(e.exists()){const s=e.data();Y(s.coupons||[])}},Se=async()=>{if(e)try{const s=(await c({status:"confirmed"})).filter(s=>s.listingId===e);fe(s)}catch(s){fe([])}},Te=e=>{if(!ge.length)return!1;e.toISOString().split("T")[0];const s=e.getTime();return ge.some(e=>{const t=new Date(e.checkIn),a=new Date(e.checkOut);return t.setHours(0,0,0,0),a.setHours(0,0,0,0),s>=t.getTime()&&s<=a.getTime()})},Ie=e=>{if(!F?.blockedDates||0===F.blockedDates.length)return!1;const s=e.toISOString().split("T")[0];return F.blockedDates.includes(s)},De=()=>{if(!R?.from||!R?.to||!F)return 0;const e=Math.ceil((R.to.getTime()-R.from.getTime())/864e5)*F.price;let s=e;if(F.discount&&F.discount>0){const t=e*F.discount/100;s=Math.max(0,e-t)}return J&&s>=(J.minSpend||0)?Math.max(0,s-J.discount):s},Le=()=>{if(!K.trim())return void r.error("Please enter a coupon code");const e=W.find(e=>e.code.toUpperCase()===K.toUpperCase().trim()&&!e.used&&new Date(e.validUntil)>new Date);if(!e)return void r.error("Invalid, expired, or already used coupon");const s=R?.from&&R?.to&&F?Math.ceil((R.to.getTime()-R.from.getTime())/864e5)*F.price:0;e.minSpend&&s<e.minSpend?r.error("This coupon requires a minimum spend of "+u(e.minSpend)):(Z(e),Q(""),r.success(`Coupon ${e.code} applied! ${u(e.discount)} discount`))};return F?j.jsx("div",{className:"min-h-screen bg-background p-4 sm:p-6",children:j.jsxs("div",{className:"max-w-7xl mx-auto",children:[j.jsx(L,{to:"/guest/browse",className:"mb-4"}),j.jsxs("div",{className:"grid lg:grid-cols-12 gap-4 sm:gap-6 lg:gap-8",children:[j.jsxs("div",{className:"lg:col-span-7 space-y-3",children:[j.jsx("div",{className:"relative w-full h-[300px] sm:h-[400px] md:h-[500px] rounded-lg overflow-hidden group bg-muted cursor-pointer touch-manipulation",onClick:()=>{pe(X),te(!0)},children:F.images&&F.images.length>0?j.jsxs(j.Fragment,{children:[j.jsx("div",{className:"flex transition-transform duration-500 ease-in-out h-full",style:{transform:`translateX(-${100*X}%)`},children:F.images.map((e,s)=>j.jsx("div",{className:"min-w-full h-full flex-shrink-0 relative",children:j.jsx("img",{src:e||"/placeholder.svg",alt:`${F.title} - Image ${s+1}`,className:"w-full h-full object-cover"})},s))}),F.images.length>1&&j.jsxs(j.Fragment,{children:[j.jsx(i,{variant:"secondary",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",onClick:e=>{e.stopPropagation(),ee(e=>0===e?F.images.length-1:e-1)},"aria-label":"Previous image",children:j.jsx(ie,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),j.jsx(i,{variant:"secondary",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",onClick:e=>{e.stopPropagation(),ee(e=>e===F.images.length-1?0:e+1)},"aria-label":"Next image",children:j.jsx(re,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),j.jsxs("div",{className:"absolute top-4 right-4 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs font-medium backdrop-blur-sm z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:[j.jsx(ne,{className:"h-3 w-3 inline mr-1"}),"Click to zoom"]}),j.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-1.5 rounded-full text-sm font-medium backdrop-blur-sm z-10",children:[X+1," / ",F.images.length]})]})]}):j.jsx("img",{src:"/placeholder.svg",alt:F.title,className:"w-full h-full object-cover"})}),F.images&&F.images.length>1&&j.jsx("div",{className:"relative",children:j.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2 snap-x snap-mandatory touch-pan-x",children:F.images.map((e,s)=>j.jsx("button",{onClick:()=>ee(s),className:"relative flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden border-2 transition-all snap-start touch-manipulation "+(X===s?"border-primary ring-2 ring-primary/50 scale-105":"border-transparent hover:border-border opacity-70 hover:opacity-100 active:opacity-100"),children:j.jsx("img",{src:e,alt:"Thumbnail "+(s+1),className:"w-full h-full object-cover"})},s))})})]}),j.jsxs("div",{className:"lg:col-span-5 flex flex-col relative",children:[j.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-2 gap-2 sm:gap-0",children:[j.jsx(S,{className:"text-xs sm:text-sm",children:F.category}),j.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[E&&F&&j.jsxs(i,{variant:"outline",size:"sm",onClick:async()=>{if(E&&F)try{const{toggleFavorite:e}=await p(async()=>{const{toggleFavorite:e}=await import("./index-BnushFQy.js").then(e=>e.W);return{toggleFavorite:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await e(E.uid,F.id,H);V(s),r.success(s.includes(F.id)?"Added to favorites":"Removed from favorites")}catch(e){r.error("Failed to update favorites")}else r.error("Please login to add favorites")},className:"flex items-center gap-1.5 sm:gap-2 h-9 sm:h-auto text-xs sm:text-sm touch-manipulation",title:H.includes(F.id)?"Remove from favorites":"Add to favorites",children:[j.jsx(le,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 "+(H.includes(F.id)?"fill-red-500 text-red-500":"")}),j.jsx("span",{className:"hidden sm:inline",children:H.includes(F.id)?"Favorited":"Favorite"})]}),F&&j.jsx(ye,{url:window.location.href,title:F.title,description:F.description,variant:"outline",size:"sm"})]})]}),j.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:F.title}),j.jsxs("div",{className:"flex items-center text-muted-foreground mb-4",children:[j.jsx(oe,{className:"h-4 w-4 mr-1"}),j.jsx("span",{children:F.location})]}),j.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[j.jsxs("span",{className:"flex items-center gap-1",children:[j.jsx(ce,{className:"h-4 w-4"}),F.maxGuests," guests"]}),F.bedrooms&&j.jsxs("span",{children:[F.bedrooms," bedrooms"]}),F.bathrooms&&j.jsxs("span",{children:[F.bathrooms," bathrooms"]})]}),F.hostId&&j.jsx(t,{className:"mb-6 border-primary/20 bg-primary/5",children:j.jsx(a,{className:"p-4",children:j.jsxs("div",{className:"flex items-center justify-between gap-3",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:j.jsx(de,{className:"h-6 w-6 text-primary"})}),j.jsxs("div",{children:[j.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Hosted by"}),j.jsx("p",{className:"font-semibold text-lg",children:G?.fullName||"Host"})]})]}),E&&j.jsxs(i,{variant:"outline",size:"sm",onClick:()=>k("/guest/messages?userId="+F.hostId),className:"flex items-center gap-2",children:[j.jsx(me,{className:"h-4 w-4"}),"Message Host"]})]})})}),j.jsx("p",{className:"text-muted-foreground mb-6",children:F.description}),F.amenities.length>0&&j.jsxs("div",{className:"mb-6",children:[j.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),j.jsx("div",{className:"flex flex-wrap gap-2",children:F.amenities.map((e,s)=>j.jsx(S,{variant:"outline",children:e},s))})]})]})]}),j.jsxs(t,{className:"mt-6 sm:mt-8 shadow-lg",children:[j.jsxs(m,{className:"pb-4 sm:pb-6 px-4 sm:px-6",children:[j.jsxs(x,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[j.jsx(xe,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),"Select Dates"]}),j.jsx(h,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Choose your check-in and check-out dates"})]}),j.jsx(a,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:j.jsx("div",{className:"w-full",children:j.jsx(T,{value:R,onChange:z,placeholder:"Select check-in and check-out dates",disabled:e=>{const s=new Date;s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(0,0,0,0),s>t||!!Ie(t)||!(e=>{if(!F?.availableDates||0===F.availableDates.length)return!0;const s=e.toISOString().split("T")[0];return F.availableDates.includes(s)})(t)||!!Te(t)},modifiers:{booked:e=>Te(e),blocked:e=>Ie(e)},modifiersClassNames:{booked:"bg-orange-500/20 text-orange-600 dark:text-orange-400",blocked:"bg-red-500/20 text-red-600 dark:text-red-400"},classNames:{months:"flex flex-row space-x-4",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100",nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:"h-9 w-9 p-0 font-normal aria-selected:opacity-100 rounded-md hover:bg-accent transition-colors",day_range_end:"day-range-end",day_selected:"bg-green-500 text-white hover:bg-green-600 hover:text-white focus:bg-green-500 focus:text-white rounded-md",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50 cursor-not-allowed",day_range_middle:"aria-selected:bg-green-100 dark:aria-selected:bg-green-900/30 aria-selected:text-green-900 dark:aria-selected:text-green-100",day_hidden:"invisible"},numberOfMonths:2})})})]}),j.jsxs(t,{className:"mt-6 sm:mt-8 shadow-lg bg-card",children:[j.jsx(m,{className:"px-4 sm:px-6 pt-4 sm:pt-6",children:j.jsxs(x,{className:"flex flex-col gap-1",children:[j.jsxs("div",{className:"flex items-baseline gap-2 flex-wrap",children:[F.discount&&F.discount>0?j.jsxs(j.Fragment,{children:[j.jsx("span",{className:"text-xl sm:text-2xl line-through text-muted-foreground",children:u(F.price)}),j.jsx("span",{className:"text-2xl sm:text-3xl text-primary font-bold",children:u(F.price*(1-F.discount/100))}),j.jsxs(S,{className:"bg-red-500 text-white",children:["-",F.discount,"%"]})]}):j.jsx("span",{className:"text-2xl sm:text-3xl",children:u(F.price)}),j.jsx("span",{className:"text-xs sm:text-sm font-normal text-muted-foreground",children:"per night"})]}),F.promo&&j.jsx("p",{className:"text-xs sm:text-sm text-primary font-medium",children:F.promo})]})}),j.jsxs(a,{className:"space-y-4 px-4 sm:px-6 pb-4 sm:pb-6",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsxs(D,{htmlFor:"guests",className:"text-sm font-medium flex items-center gap-2",children:[j.jsx(ce,{className:"h-4 w-4"}),"Number of Guests"]}),j.jsx(I,{id:"guests",type:"number",min:"1",max:F.maxGuests,value:A,onChange:e=>{const s=parseInt(e.target.value)||1;1>s||s>F.maxGuests?s>F.maxGuests?(O(F.maxGuests),r.error(`Maximum ${F.maxGuests} guest${F.maxGuests>1?"s":""} allowed`)):1>s&&O(1):O(s)},placeholder:"Enter number of guests",className:"w-full"}),j.jsxs("p",{className:"text-xs text-muted-foreground",children:["Maximum ",F.maxGuests," guest",F.maxGuests>1?"s":""," allowed"]})]}),j.jsx("div",{className:"pt-4 border-t",children:J?j.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(he,{className:"h-4 w-4 text-primary"}),j.jsx("span",{className:"text-sm font-medium",children:J.code}),j.jsxs("span",{className:"text-xs text-muted-foreground",children:["-",u(J.discount)]})]}),j.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>{Z(null),r.info("Coupon removed")},children:j.jsx(ue,{className:"h-4 w-4"})})]}):j.jsxs("div",{className:"space-y-2",children:[j.jsx("label",{className:"text-sm font-medium",children:"Have a coupon code?"}),j.jsxs("div",{className:"flex gap-2",children:[j.jsx(I,{placeholder:"Enter coupon code",value:K,onChange:e=>Q(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&Le()}),j.jsxs(i,{type:"button",variant:"outline",onClick:Le,disabled:!K.trim(),children:[j.jsx(he,{className:"h-4 w-4 mr-2"}),"Apply"]})]})]})}),R?.from&&R?.to&&j.jsx("div",{className:"pt-4 border-t space-y-2",children:(()=>{const e=Math.ceil((R.to.getTime()-R.from.getTime())/864e5),s=e*F.price,t=R?.from&&R?.to&&F&&F.discount&&F.discount>0?Math.ceil((R.to.getTime()-R.from.getTime())/864e5)*F.price*F.discount/100:0,a=s-t,i=t>0||J;return j.jsxs(j.Fragment,{children:[i&&j.jsxs("div",{className:"flex justify-between text-sm",children:[j.jsxs("span",{className:"text-muted-foreground",children:["Subtotal (",e," ",1===e?"night":"nights",")"]}),j.jsx("span",{children:u(s)})]}),t>0&&j.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[j.jsxs("span",{children:["Listing Discount (",F.discount,"%)"]}),j.jsxs("span",{children:["-",u(t)]})]}),t>0&&(J||!i)&&j.jsxs("div",{className:"flex justify-between text-sm",children:[j.jsx("span",{className:"text-muted-foreground",children:"After Discount"}),j.jsx("span",{children:u(a)})]}),J&&j.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[j.jsxs("span",{children:["Coupon Discount (",J.code,")"]}),j.jsxs("span",{children:["-",u(J.discount)]})]}),j.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[j.jsx("span",{children:"Total"}),j.jsx("span",{children:u(De())})]})]})})()}),j.jsx(i,{className:"w-full h-12 sm:h-auto text-base sm:text-sm touch-manipulation",onClick:async()=>{if(!E)return void r.error("Please sign in to book this listing");if(!F)return void r.error("Listing information is missing. Please refresh the page.");if(!R?.from||!R?.to)return void r.error("Please select your check-in and check-out dates");if(!A||1>A)return void r.error("Please enter the number of guests (minimum 1)");if(A>F.maxGuests)return void r.error(`Maximum ${F.maxGuests} guest${F.maxGuests>1?"s":""} allowed for this listing`);if(!F.hostId)return void r.error("Listing error: Missing host information. Please contact support.");if(!v(F,R.from,R.to,ge))return void r.error("The selected dates are not available. Please choose different dates.");const e=Math.ceil((R.to.getTime()-R.from.getTime())/864e5)*F.price,t=F.discount&&F.discount>0?e*F.discount/100:0,a=J?J.discount:0,i=De();try{const e=await U(B(s,"users",E.uid));if(!e.exists())return void r.error("Unable to verify wallet balance. Please try again.");{const s=e.data().walletBalance||0;if(i>s){const e=i-s;return void r.error(`Insufficient wallet balance. You need ${u(i)} but only have ${u(s)}. Please add ${u(e)} to your wallet to complete this booking.`,{duration:6e3})}}}catch(n){return void r.error("Unable to verify wallet balance. Please try again.")}M(!0);try{const s={listingId:F.id,guestId:E.uid,hostId:F.hostId,checkIn:R.from.toISOString(),checkOut:R.to.toISOString(),guests:A,totalPrice:i,originalPrice:e,listingDiscount:F.discount||0,listingDiscountAmount:t,discountAmount:t+a,status:"pending"};J?.code&&(s.couponCode=J.code);const n=await g(s);try{const{getDoc:e,doc:s}=await p(async()=>{const{getDoc:e,doc:s}=await import("./firebase-vendor-BC71bXmb.js").then(e=>e.C);return{getDoc:e,doc:s}},[]),{db:t}=await p(async()=>{const{db:e}=await import("./index-BnushFQy.js").then(e=>e.V);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await e(s(t,"bookings",n));if(a.exists()&&(a.data(),F.id)){const a=await e(s(t,"listing",F.id));a.exists()&&a.data()}}catch(l){}r.success("Booking request sent! The host will review your request."),k("/guest/dashboard")}catch(n){r.error("Failed to create booking")}finally{M(!1)}},disabled:!R?.from||!R?.to||!A||1>A||A>F.maxGuests||$,children:$?"Booking...":"Request to Book"})]})]}),j.jsx(y,{open:se,onOpenChange:te,children:j.jsxs(N,{className:"max-w-[98vw] max-h-[98vh] w-auto h-auto p-0 bg-black/95 border-none m-1",children:[j.jsx(C,{className:"sr-only",children:"View Full Size Image"}),j.jsxs(_,{className:"sr-only",children:["Viewing image ",ae+1," of ",F?.images?.length||0," for ",F?.title]}),j.jsx("div",{className:"relative w-full h-full flex items-center justify-center min-h-[400px]",children:F?.images&&F.images.length>0&&j.jsxs(j.Fragment,{children:[j.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-10 sm:w-10",onClick:()=>te(!1),children:j.jsx(ue,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),j.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium backdrop-blur-sm z-50",children:[ae+1," / ",F.images.length]}),j.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 sm:p-4 pt-12 pb-20 sm:pb-24",children:j.jsx("img",{src:F.images[ae]||"/placeholder.svg",alt:`${F.title} - Image ${ae+1}`,className:"max-w-full max-h-[calc(98vh-160px)] object-contain"})}),F.images.length>1&&j.jsxs(j.Fragment,{children:[j.jsx(i,{variant:"ghost",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>pe(e=>0===e?F.images.length-1:e-1),children:j.jsx(ie,{className:"h-4 w-4 sm:h-6 sm:w-6"})}),j.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>pe(e=>e===F.images.length-1?0:e+1),children:j.jsx(re,{className:"h-4 w-4 sm:h-6 sm:w-6"})})]}),F.images.length>1&&j.jsx("div",{className:"absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm rounded-lg p-2 sm:p-3 z-50 max-w-[calc(98vw-32px)]",children:j.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto scrollbar-hide px-1",children:F.images.map((e,s)=>j.jsx("button",{onClick:()=>pe(s),className:"relative flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 rounded transition-all "+(ae===s?"scale-110 shadow-lg shadow-primary/50":"opacity-70 hover:opacity-100"),children:j.jsx("div",{className:"absolute inset-0 rounded overflow-hidden border-2 "+(ae===s?"border-primary ring-2 ring-primary/50 ring-offset-2 ring-offset-black/70":"border-transparent hover:border-white/50"),children:j.jsx("img",{src:e,alt:"Thumbnail "+(s+1),className:"w-full h-full object-cover transition-opacity "+(ae===s?"opacity-100":"opacity-70")})})},s))})})]})})]})}),j.jsx("div",{className:"mt-12 relative z-0",children:j.jsx(ve,{listingId:F.id,refreshTrigger:je})}),j.jsx("div",{className:"relative z-0",children:j.jsx(ke,{listingId:F.id})})]})}):j.jsx(d,{})},ke=({listingId:e})=>{const s=b(),{user:t}=n(),[a,i]=f.useState([]),[l,o]=f.useState([]),[c,d]=f.useState(!0);f.useEffect(()=>{m(),t&&x()},[e,t]);const m=async()=>{try{const{getSimilarListings:s}=await p(async()=>{const{getSimilarListings:e}=await import("./recommendations-B-fDFj-J.js");return{getSimilarListings:e}},__vite__mapDeps([9,7,0,1,2,3,4,5,6,8])),{getListingsRatings:t}=await p(async()=>{const{getListingsRatings:e}=await import("./index-BnushFQy.js").then(e=>e.W);return{getListingsRatings:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(e,4);if(a.length>0){const e=a.map(e=>e.id),s=await t(e),r=a.map(e=>{const t=s.get(e.id);return{...e,averageRating:t?.averageRating||0,reviewCount:t?.reviewCount||0}});i(r)}else i(a)}catch(s){}finally{d(!1)}},x=async()=>{if(!t)return;const{doc:e,getDoc:s}=await p(async()=>{const{doc:e,getDoc:s}=await import("./firebase-vendor-BC71bXmb.js").then(e=>e.C);return{doc:e,getDoc:s}},[]),{db:a}=await p(async()=>{const{db:e}=await import("./index-BnushFQy.js").then(e=>e.V);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await s(e(a,"users",t.uid));i.exists()&&o(i.data().favorites||[])};return c||0===a.length?null:j.jsxs("div",{className:"mt-12",children:[j.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Similar Listings"}),j.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:a.map(e=>j.jsx(be,{listing:e,onView:()=>{s("/guest/listing/"+e.id),window.scrollTo({top:0,behavior:"smooth"})},onFavorite:()=>(async e=>{if(t)try{const{toggleFavorite:s}=await p(async()=>{const{toggleFavorite:e}=await import("./index-BnushFQy.js").then(e=>e.W);return{toggleFavorite:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(t.uid,e,l);o(a),r.success(a.includes(e)?"Added to favorites":"Removed from favorites")}catch(s){r.error("Failed to update favorites")}else r.error("Please login to add favorites")})(e.id),isFavorite:l.includes(e.id)},e.id))})]})};export{Ne as default};
