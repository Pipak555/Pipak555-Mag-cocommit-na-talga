import{j as e,r as s,u as a,l as t}from"./react-vendor-Ve3SFwKO.js";import{C as i,a as l,d as r,u as n,b as o,B as c,e as d,y as m,j as h,z as x,i as u,A as g,l as p,D as j,E as f,q as b,h as N}from"./index-DaMaslBo.js";import{p as v}from"./paymentService-Cp8a7m6L.js";import{h as w,f as y,u as k,q as I,w as C,d as S,l as A}from"./firebase-vendor-BC71bXmb.js";import{B as D}from"./badge-BSgvUoVt.js";import{T as z}from"./theme-toggle-Djm4W2SX.js";import{P as B}from"./PayPalButton-_BOQ6Z9Q.js";import{S as P}from"./skeleton-CDR-VS5H.js";import{A as R,a as F,b as L,c as O,d as T,e as q,f as Y,g as U}from"./alert-dialog-DLw-Qa8s.js";import{D as V,a as E,b as G,c as H,d as W}from"./dialog-GBvfaobK.js";import{S as $}from"./separator-QWereQOO.js";import{T as M}from"./textarea-bhWBiMTW.js";import{L as K}from"./label-B2t2XnWQ.js";import{I as X}from"./input-D5hloL4G.js";import{O as Z,A as J,j as Q,l as _,H as ee,q as se,X as ae,a3 as te,a4 as ie,a5 as le,U as re,w as ne,m as oe,y as ce,z as de,s as me}from"./icons-vendor-Dhca6XHc.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";import"./dropdown-menu-DVnKNEtJ.js";const he=()=>e.jsxs(i,{className:"shadow-soft",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"h-5 w-32"}),e.jsx(P,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-16 w-16 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(P,{className:"h-4 w-3/4"}),e.jsx(P,{className:"h-3 w-1/2"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-3 w-full"}),e.jsx(P,{className:"h-3 w-2/3"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx(P,{className:"h-4 w-24"}),e.jsx(P,{className:"h-4 w-20"})]})]})]}),xe=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:[...Array(s)].map((s,a)=>e.jsx(he,{},a))}),ue=({listingId:a,bookingId:t,onSuccess:u})=>{const{user:g}=n(),[p,j]=s.useState(0),[f,b]=s.useState(""),[N,v]=s.useState(!1);return e.jsxs(i,{children:[e.jsx(l,{children:e.jsx(o,{children:"Leave a Review"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(s=>e.jsx(Z,{className:"h-8 w-8 cursor-pointer "+(s>p?"text-muted":"fill-yellow-400 text-yellow-400"),onClick:()=>j(s)},s))})]}),e.jsx("div",{children:e.jsx(M,{placeholder:"Share your experience...",value:f,onChange:e=>b(e.target.value),rows:4})}),e.jsx(c,{onClick:async()=>{if(g&&0!==p){v(!0);try{await m({listingId:a,bookingId:t,guestId:g.uid,rating:p,comment:f});try{const e=await w(y(h,"users",g.uid));if(e.exists()){const s=e.data().points||0,a=20,i=s+a;await k(y(h,"users",g.uid),{points:i}),await x({userId:g.uid,type:"reward",amount:a,description:"Points earned for writing a review",status:"completed",bookingId:t})}}catch(e){}d.success("Review submitted! You earned 20 points."),u()}catch(s){const e=s?.message||"Failed to submit review";d.error(e)}finally{v(!1)}}else d.error("Please provide a rating")},disabled:N,className:"w-full",children:N?"Submitting...":"Submit Review"})]})]})},ge=()=>{const m=a(),[x]=t(),{user:k}=n(),[P,he]=s.useState([]),[ge,pe]=s.useState(!0),[je,fe]=s.useState(!1),[be,Ne]=s.useState(null),[ve,we]=s.useState(!1),[ye,ke]=s.useState(0),[Ie,Ce]=s.useState(!1),[Se,Ae]=s.useState(null),[De,ze]=s.useState(!1),[Be,Pe]=s.useState(null),[Re,Fe]=s.useState(0),[Le,Oe]=s.useState(!1),[Te,qe]=s.useState(0),[Ye,Ue]=s.useState(!1),[Ve,Ee]=s.useState(null),[Ge,He]=s.useState({}),[We,$e]=s.useState({}),[Me,Ke]=s.useState([]),[Xe,Ze]=s.useState(!1),[Je,Qe]=s.useState(null),[_e,es]=s.useState(""),[ss,as]=s.useState({beds:"",bedrooms:"",bathrooms:"",guests:""}),[ts,is]=s.useState([]),ls=x.get("filter");s.useEffect(()=>{if(!k)return;(async()=>{if(!k)return;const e=await w(y(h,"users",k.uid));if(e.exists()){const s=e.data();ke(s.walletBalance||0),Ke(s.wishlist||[])}})(),pe(!0);const e=I(S(h,"bookings"),C("guestId","==",k.uid)),s=A(e,e=>{const s=e.docs.map(e=>{const s=e.data();return{id:e.id,...s}});s.sort((e,s)=>{const a=new Date(e.createdAt||0).getTime();return new Date(s.createdAt||0).getTime()-a});let a=s;if("upcoming"===ls){const e=new Date;a=s.filter(s=>new Date(s.checkIn)>=e&&"confirmed"===s.status)}else if("past"===ls){const e=new Date;a=s.filter(s=>{const a=new Date(s.checkOut);return e>a||"completed"===s.status||"cancelled"===s.status})}he(a),pe(!1)},e=>{pe(!1),rs()});return()=>s()},[k,ls]),s.useEffect(()=>{k&&0!==P.length&&(async()=>{const e=P.filter(e=>{const s=new Date(e.checkOut);return new Date>s||"completed"===e.status||"cancelled"===e.status});for(const a of e)if(a.id&&void 0===Ge[a.id]&&!We[a.id]){$e(e=>({...e,[a.id]:!0}));try{const e=await g(a.id,k.uid);He(s=>({...s,[a.id]:e}))}catch(s){He(e=>({...e,[a.id]:null}))}finally{$e(e=>({...e,[a.id]:!1}))}}})()},[P,k]);const rs=async()=>{if(k)try{const e=await N({guestId:k.uid});he(e)}catch(e){}finally{pe(!1)}},ns=e=>{switch(e){case"confirmed":return"default";case"pending":default:return"secondary";case"cancelled":return"destructive";case"completed":return"outline"}},os=e=>Me.some(s=>"string"==typeof s?s===e:s.listingId===e);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 shadow-soft",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-3 sm:py-4 flex justify-between items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>m("/guest/dashboard"),className:"h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",children:e.jsx(J,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"hidden sm:block p-2 rounded-lg bg-secondary/10",children:e.jsx(Q,{className:"w-5 h-5 text-secondary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base sm:text-lg font-bold truncate",children:"upcoming"===ls?"Upcoming Trips":"past"===ls?"Past Bookings":"My Bookings"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"upcoming"===ls?"Your confirmed upcoming trips":"past"===ls?"Your completed and past trips":"View your trips"})]})]}),e.jsx(z,{})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-4 sm:p-6",children:ge?e.jsx(xe,{count:5}):0===P.length?e.jsx(i,{children:e.jsxs(r,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"upcoming"===ls?"No upcoming trips":"past"===ls?"No past bookings yet":"No bookings yet"}),"past"===ls&&e.jsx("p",{className:"text-xs mt-2",children:"Your past bookings will appear here once trips are completed."})]})}):e.jsx("div",{className:"space-y-4",children:P.map(s=>{const a=("pending"===s.status||"confirmed"===s.status)&&new Date(s.checkIn)>=new Date,t=new Date(s.checkOut),n="past"===ls||new Date>t||"completed"===s.status||"cancelled"===s.status,x=void 0!==Ge[s.id],g=Ge[s.id];return e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{children:["Booking #",s.id.slice(0,8)]}),e.jsx(D,{variant:ns(s.status),children:s.status})]})}),e.jsxs(r,{children:[e.jsxs("div",{className:"space-y-4",children:[s.hostId&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>(e=>{e.hostId?m("/guest/messages?userId="+e.hostId):d.error("Host information not available")})(s),className:"flex items-center justify-center gap-2 flex-1 h-11 sm:h-auto touch-manipulation",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Message Host"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(e.listingId){ze(!0),Ce(!0),Fe(0);try{const a=await p(e.listingId);if(a)if(Ae(a),a.hostId)try{const e=await j(a.hostId);Pe(e?{fullName:e.fullName||"N/A",email:e.email||"N/A"}:{fullName:"N/A",email:"N/A"})}catch(s){Pe({fullName:"N/A",email:"N/A"})}else Pe({fullName:"N/A",email:"N/A"});else d.error("Listing not found"),Ce(!1)}catch(s){d.error("Failed to load listing: "+(s.message||"Unknown error")),Ce(!1)}finally{ze(!1)}}else d.error("Listing information not available")})(s),className:"flex items-center justify-center gap-2 flex-1 h-11 sm:h-auto touch-manipulation",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"View Listing"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkIn).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkOut).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Guests"}),e.jsx("p",{className:"font-medium",children:s.guests})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"font-medium",children:u(s.totalPrice||0)})]})]})]}),"pending"===s.status&&k&&ye<(s.totalPrice||0)&&e.jsx("div",{className:"pt-4 border-t space-y-2",children:e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Payment Required"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Your wallet balance (",u(ye),") is insufficient. Please pay via PayPal to complete your booking."]}),e.jsx(B,{amount:s.totalPrice||0,userId:k.uid,description:"Booking payment for booking #"+s.id.slice(0,8),bookingId:s.id,onSuccess:()=>{d.success("Payment successful! Your booking will be confirmed once the host approves."),w(y(h,"users",k.uid)).then(e=>{e.exists()&&ke(e.data().walletBalance||0)})},redirectUrl:window.location.origin+"/guest/bookings"})]})}),n&&"cancelled"!==s.status&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[s.listingId&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>(e=>{k&&e.listingId?Me.some(s=>"string"==typeof s?s===e.listingId:s.listingId===e.listingId)?(async e=>{if(k)try{const s=await b(k.uid,e,Me);Ke(s),d.success("Removed from wishlist")}catch(s){d.error("Failed to remove from wishlist")}})(e.listingId):(Qe(e),es(""),Ze(!0)):d.error("Unable to add to wishlist")})(s),className:"w-full",children:[e.jsx(se,{className:"h-4 w-4 mr-2 "+(os(s.listingId)?"fill-blue-500 text-blue-500":"")}),os(s.listingId)?"Remove from Wishlist":"Add to Wishlist with Recommendations"]}),os(s.listingId)&&(()=>{const a=(t=s.listingId,Me.find(e=>"string"==typeof e?e===t:e.listingId===t));var t;if("object"!=typeof a)return null;const i=a?.recommendations,l=a?.propertyRequirements,r=a?.desiredAmenities;return i||l&&Object.keys(l).length>0||r&&r.length>0?e.jsxs("div",{className:"p-3 bg-muted rounded-md space-y-2",children:[l&&Object.keys(l).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Requirements:"}),e.jsxs("div",{className:"text-xs space-y-1",children:[l.beds&&e.jsxs("p",{children:["• Beds: ",l.beds]}),l.bedrooms&&e.jsxs("p",{children:["• Bedrooms: ",l.bedrooms]}),l.bathrooms&&e.jsxs("p",{children:["• Bathrooms: ",l.bathrooms]}),l.guests&&e.jsxs("p",{children:["• Guests: ",l.guests]})]})]}),r&&r.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Desired Amenities:"}),e.jsx("p",{className:"text-xs",children:r.join(", ")})]}),i&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-1",children:"Recommendations:"}),e.jsx("p",{className:"text-sm",children:i})]})]}):null})(),We[s.id]?e.jsx(c,{variant:"outline",size:"sm",disabled:!0,className:"w-full",children:"Checking review status..."}):x&&g?e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your Review:"}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(s=>e.jsx(Z,{className:"h-4 w-4 "+(s>g.rating?"text-muted":"fill-yellow-400 text-yellow-400")},s))})]}),e.jsx(D,{variant:"outline",children:"Reviewed"})]}),g.comment&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:g.comment})]}):e.jsxs(c,{variant:"default",size:"sm",onClick:()=>(e=>{Ee(e),Ue(!0)})(s),className:"w-full",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Leave a Review"]})]}),a&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?d.error("Cannot cancel bookings with check-in dates in the past"):(Ne(e),fe(!0)):d.error("This booking cannot be cancelled"):d.error("Cannot cancel completed bookings"):d.error("This booking is already cancelled"):d.error("Invalid booking")})(s),className:"w-full",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]})]},s.id)})})}),e.jsx(R,{open:je,onOpenChange:fe,children:e.jsxs(F,{children:[e.jsxs(L,{children:[e.jsx(O,{children:"Cancel Booking"}),e.jsxs(T,{children:["Are you sure you want to cancel this booking?",be&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-medium capitalize",children:be.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(be.checkIn).toLocaleDateString()]})]}),be.totalPrice>0&&e.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",u(be.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),e.jsxs(q,{children:[e.jsx(Y,{disabled:ve,children:"Keep Booking"}),e.jsx(U,{onClick:async()=>{if(!be||!k)return void d.error("Invalid booking or user");if("cancelled"===be.status||"completed"===be.status)return d.error("This booking cannot be cancelled"),fe(!1),void Ne(null);const e=new Date(be.checkIn);if(new Date>e)return d.error("Cannot cancel bookings with check-in dates in the past"),fe(!1),void Ne(null);we(!0);try{if(await f(be.id,{status:"cancelled"}),"confirmed"===be.status||"pending"===be.status)try{const e=await v(be,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?u(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";d.success("Booking cancelled successfully. "+s)}}catch(s){d.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else d.success("Booking cancelled successfully.");fe(!1),Ne(null)}catch(a){const e=a.message||"Unknown error occurred";d.error("Failed to cancel booking: "+e)}finally{we(!1)}},disabled:ve,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:ve?"Cancelling...":"Cancel Booking"})]})]})}),e.jsx(V,{open:Ie,onOpenChange:Ce,children:e.jsxs(E,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(H,{className:"text-2xl",children:Se?.title||"Listing Details"}),e.jsx(W,{children:"View full listing information and host details"})]}),De?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading listing details..."}):Se?e.jsxs("div",{className:"space-y-6",children:[Se.images&&Se.images.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative w-full h-[400px] rounded-lg overflow-hidden group bg-muted cursor-pointer",onClick:()=>{qe(Re),Oe(!0)},children:[e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out h-full",style:{transform:`translateX(-${100*Re}%)`},children:Se.images.map((s,a)=>e.jsx("div",{className:"min-w-full h-full flex-shrink-0 relative",children:e.jsx("img",{src:s||"/placeholder.svg",alt:`${Se.title} - Image ${a+1}`,className:"w-full h-full object-cover"})},a))}),Se.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"secondary",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-10 w-10",onClick:e=>{e.stopPropagation(),Fe(e=>0===e?Se.images.length-1:e-1)},"aria-label":"Previous image",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx(c,{variant:"secondary",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-10 w-10",onClick:e=>{e.stopPropagation(),Fe(e=>e===Se.images.length-1?0:e+1)},"aria-label":"Next image",children:e.jsx(ie,{className:"h-5 w-5"})}),e.jsxs("div",{className:"absolute top-4 right-4 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs font-medium backdrop-blur-sm z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(le,{className:"h-3 w-3 inline mr-1"}),"Click to zoom"]}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-1.5 rounded-full text-sm font-medium backdrop-blur-sm z-10",children:[Re+1," / ",Se.images.length]})]})]}),Se.images.length>1&&e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2 snap-x snap-mandatory",children:Se.images.map((s,a)=>e.jsx("button",{onClick:()=>Fe(a),className:"relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all snap-start "+(Re===a?"border-primary ring-2 ring-primary/50 scale-105":"border-transparent hover:border-border opacity-70 hover:opacity-100"),children:e.jsx("img",{src:s,alt:"Thumbnail "+(a+1),className:"w-full h-full object-cover"})},a))})})]}),Be&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Host Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("span",{children:Be.fullName||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("a",{href:"mailto:"+(Be.email||""),className:"text-primary hover:underline",children:Be.email||"N/A"})]}),Se.hostId&&e.jsx("div",{className:"pt-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{Ce(!1),m("/guest/messages?userId="+Se.hostId)},className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Message Host"]})})]})]}),e.jsx($,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Location"]}),e.jsx("p",{className:"text-muted-foreground",children:Se.location})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:Se.description})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price"}),e.jsxs("p",{className:"font-semibold",children:[u(Se.price),"/night"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Max Guests"}),e.jsx("p",{className:"font-semibold",children:Se.maxGuests})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:Se.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:void 0!==Se.bathrooms?Se.bathrooms:"N/A"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Category"}),e.jsx(D,{variant:"secondary",children:Se.category})]})]}),Se.amenities&&Se.amenities.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Se.amenities.map((s,a)=>e.jsx(D,{variant:"outline",children:s},a))})]})]})]}):e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Listing not found"})]})}),e.jsx(V,{open:Le,onOpenChange:Oe,children:e.jsxs(E,{className:"max-w-[98vw] max-h-[98vh] w-auto h-auto p-0 bg-black/95 border-none m-1",children:[e.jsx(H,{className:"sr-only",children:"View Full Size Image"}),e.jsxs(W,{className:"sr-only",children:["Viewing image ",Te+1," of ",Se?.images?.length||0," for ",Se?.title]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center min-h-[400px]",children:Se?.images&&Se.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-10 sm:w-10",onClick:()=>Oe(!1),children:e.jsx(ae,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium backdrop-blur-sm z-50",children:[Te+1," / ",Se.images.length]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 sm:p-4 pt-12 pb-20 sm:pb-24",children:e.jsx("img",{src:Se.images[Te]||"/placeholder.svg",alt:`${Se.title} - Image ${Te+1}`,className:"max-w-full max-h-[calc(98vh-160px)] object-contain"})}),Se.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"ghost",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>qe(e=>0===e?Se.images.length-1:e-1),children:e.jsx(te,{className:"h-4 w-4 sm:h-6 sm:w-6"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>qe(e=>e===Se.images.length-1?0:e+1),children:e.jsx(ie,{className:"h-4 w-4 sm:h-6 sm:w-6"})})]}),Se.images.length>1&&e.jsx("div",{className:"absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm rounded-lg p-2 sm:p-3 z-50 max-w-[calc(98vw-32px)]",children:e.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto scrollbar-hide px-1",children:Se.images.map((s,a)=>e.jsx("button",{onClick:()=>qe(a),className:"relative flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 rounded transition-all "+(Te===a?"scale-110 shadow-lg shadow-primary/50":"opacity-70 hover:opacity-100"),children:e.jsx("div",{className:"absolute inset-0 rounded overflow-hidden border-2 "+(Te===a?"border-primary ring-2 ring-primary/50 ring-offset-2 ring-offset-black/70":"border-transparent hover:border-white/50"),children:e.jsx("img",{src:s,alt:"Thumbnail "+(a+1),className:"w-full h-full object-cover transition-opacity "+(Te===a?"opacity-100":"opacity-70")})})},a))})})]})})]})}),e.jsx(V,{open:Xe,onOpenChange:Ze,children:e.jsxs(E,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(H,{children:"Property Requirements"}),e.jsx(W,{children:"Desired Amenities/Features"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Property Requirements"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:"beds",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Number of Beds"]}),e.jsx(X,{id:"beds",type:"number",placeholder:"e.g., 4",value:ss.beds,onChange:e=>as(s=>({...s,beds:e.target.value})),min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:"bedrooms",className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Number of Bedrooms"]}),e.jsx(X,{id:"bedrooms",type:"number",placeholder:"e.g., 2",value:ss.bedrooms,onChange:e=>as(s=>({...s,bedrooms:e.target.value})),min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:"bathrooms",className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Number of Bathrooms"]}),e.jsx(X,{id:"bathrooms",type:"number",placeholder:"e.g., 2",value:ss.bathrooms,onChange:e=>as(s=>({...s,bathrooms:e.target.value})),min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:"guests",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Number of Guests"]}),e.jsx(X,{id:"guests",type:"number",placeholder:"e.g., 6",value:ss.guests,onChange:e=>as(s=>({...s,guests:e.target.value})),min:"0"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Desired Amenities/Features"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["WiFi","Kitchen","Air Conditioning","Parking","Pool","Gym","TV","Washer","Dryer","Heating","Pet Friendly","Balcony"].map(s=>e.jsx(c,{type:"button",variant:ts.includes(s)?"default":"outline",className:"justify-start "+(ts.includes(s)?"bg-primary text-primary-foreground":"bg-yellow-50 dark:bg-yellow-950/20 text-gray-700 dark:text-gray-300 hover:bg-yellow-100 dark:hover:bg-yellow-950/30"),onClick:()=>(e=>{is(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(s),children:s},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"recommendations",children:"Additional Recommendations (Optional)"}),e.jsx(M,{id:"recommendations",placeholder:"Any other wishes or recommendations...",value:_e,onChange:e=>es(e.target.value),className:"min-h-[80px] resize-none",maxLength:500}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[_e.length,"/500 characters"]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{Ze(!1),Qe(null),es(""),as({beds:"",bedrooms:"",bathrooms:"",guests:""}),is([])},className:"bg-yellow-50 dark:bg-yellow-950/20 text-gray-700 dark:text-gray-300 hover:bg-yellow-100 dark:hover:bg-yellow-950/30",children:"Cancel"}),e.jsx(c,{onClick:async()=>{if(k&&Je?.listingId)try{const e={};ss.beds&&(e.beds=parseInt(ss.beds)||0),ss.bedrooms&&(e.bedrooms=parseInt(ss.bedrooms)||0),ss.bathrooms&&(e.bathrooms=parseInt(ss.bathrooms)||0),ss.guests&&(e.guests=parseInt(ss.guests)||0);const s=Object.keys(e).length>0,a=ts.length>0,t=_e.trim().length>0,i=await b(k.uid,Je.listingId,Me,t?_e.trim():void 0,Je.id,s?e:void 0,a?ts:void 0);Ke(i),Ze(!1),Qe(null),es(""),as({beds:"",bedrooms:"",bathrooms:"",guests:""}),is([]),d.success("Added to wishlist with your requirements!")}catch(e){d.error("Failed to add to wishlist")}else d.error("Unable to add to wishlist")},className:"bg-primary hover:bg-primary/90",children:"Add to Wishlist"})]})]})]})}),e.jsx(V,{open:Ye,onOpenChange:Ue,children:e.jsxs(E,{className:"max-w-2xl",children:[e.jsxs(G,{children:[e.jsx(H,{children:"Leave a Review"}),e.jsx(W,{children:"Share your experience with this booking"})]}),Ve&&Ve.listingId&&e.jsx(ue,{listingId:Ve.listingId,bookingId:Ve.id,onSuccess:()=>{Ve&&k&&g(Ve.id,k.uid).then(e=>{He(s=>({...s,[Ve.id]:e}))}),Ue(!1),Ee(null)}})]})})]})};export{ge as default};
