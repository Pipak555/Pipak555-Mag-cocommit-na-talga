import{u as e,l as s,r as t,j as i}from"./react-vendor-Ve3SFwKO.js";import{u as n,a,C as r,e as o,B as c}from"./index-BnushFQy.js";import{getPlanById as l,getUserSubscription as d}from"./billingService-BIHIVurG.js";import{e as m}from"./icons-vendor-DD8ZfUKZ.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";import"./firebase-vendor-BC71bXmb.js";const u=()=>{const u=e(),[x]=s(),{user:p}=n(),[f,g]=t.useState(null),[h,j]=t.useState(!0),[v,b]=t.useState("unknown"),y=x.get("planId")||"active-host-monthly";return t.useEffect(()=>{if(!p)return;const e=setTimeout(()=>{const e=x.get("userId");if(e&&e!==p.uid)return a.error("Payment verification failed. Please contact support if you completed payment."),void u("/host/dashboard");const s=l(y);if(!s)return a.error("Invalid plan selected"),void u("/host/register");g(s)},500);return()=>clearTimeout(e)},[y,p,u,x]),t.useEffect(()=>{if(!p||!f)return;const e=async(s=0)=>{try{0===s&&await new Promise(e=>setTimeout(e,1e3));const t=await d(p.uid);t&&"active"===t.status?(b("active"),j(!1)):3>s?setTimeout(()=>e(s+1),2e3):(b("pending"),j(!1),setTimeout(()=>{a.warning("Payment received but subscription activation is pending. Please wait a moment or refresh the page.")},500))}catch(t){2>s?setTimeout(()=>e(s+1),2e3):(b("unknown"),j(!1))}};e()},[p,f]),h||!f?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),i.jsx("p",{className:"mt-4 text-muted-foreground",children:"Verifying payment..."})]})}):i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:i.jsx(r,{className:"max-w-2xl w-full",children:i.jsx(o,{className:"p-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:i.jsx(m,{className:"h-12 w-12 text-green-600 dark:text-green-400"})}),i.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Payment Successful!"}),i.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"active"===v?`Your subscription to ${f.name} has been activated.`:"pending"===v?`Payment received! Your subscription to ${f.name} is being activated...`:`Payment received! Processing your subscription to ${f.name}...`}),i.jsxs("div",{className:"bg-muted rounded-lg p-6 mb-8 text-left",children:[i.jsx("h2",{className:"font-semibold mb-4",children:"Subscription Details"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),i.jsx("span",{className:"font-medium",children:f.name})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Billing Cycle:"}),i.jsx("span",{className:"font-medium capitalize",children:f.billingCycle})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Status:"}),i.jsx("span",{className:"font-medium "+("active"===v?"text-green-600 dark:text-green-400":"pending"===v?"text-yellow-600 dark:text-yellow-400":"text-muted-foreground"),children:"active"===v?"Active":"pending"===v?"Activating...":"Processing..."})]})]})]}),i.jsx("div",{className:"flex justify-center",children:i.jsx(c,{onClick:()=>u("/host/dashboard"),className:"min-w-[200px]",size:"lg",children:"Go to Dashboard"})}),i.jsx("p",{className:"text-sm text-muted-foreground mt-8",children:"active"===v?"You can now start creating listings and managing your properties.":"pending"===v?"Your subscription is being activated. This may take a few moments.":"Processing your subscription activation..."}),"pending"===v&&i.jsx("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:i.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[i.jsx("strong",{children:"Note:"})," Payment received but subscription activation is pending. Please wait a moment or refresh the page. If the issue persists, contact support."]})})]})})})})};export{u as default};
