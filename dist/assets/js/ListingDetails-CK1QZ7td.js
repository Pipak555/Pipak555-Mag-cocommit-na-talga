const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-BbQqfVom.js","assets/js/react-vendor-BMVo5gto.js","assets/js/utils-vendor-yBsXXcRr.js","assets/js/maps-vendor-CYGXCXz5.js","assets/maps-vendor-Dgihpmma.css","assets/js/ui-vendor-Dbp4DHG_.js","assets/js/icons-vendor-D1YpcxsO.js","assets/js/firebase-vendor-BtzXZj7S.js","assets/index-C-vb7LoQ.css","assets/js/recommendations-CcEjlX8s.js"])))=>i.map(i=>d[i]);
import{r as e,C as s,d as t,B as a,e as i,u as r,l,s as n,j as o,h as c,v as d,a as m,b as h,c as x,i as u,_ as p,w as g}from"./index-BbQqfVom.js";import{r as f,j as w,q as b,u as j}from"./react-vendor-BMVo5gto.js";import{D as v,a as y,b as N,c as _,d as k}from"./dialog-COz4G8V2.js";import{B as C}from"./badge-0vFpitRp.js";import{C as S}from"./calendar-C188Zhwy.js";import{I as T}from"./input-B93J7yYR.js";import{A as D,a as I}from"./avatar-D4-uAIxe.js";import{S as R,a as E,b as L,c as A,d as F}from"./select-CQH7Fq4X.js";import{I as P,J as z,h as O,s as V,K as H,O as M,e as $,Q as B,V as U,Y as W,Z as q,_ as J,A as K,$ as Y,a0 as G,a1 as Q,a2 as X,q as Z,u as ee,U as se,o as te,j as ae,a3 as ie,X as re}from"./icons-vendor-D1YpcxsO.js";import{D as le,a as ne,b as oe,c as ce,d as de}from"./dropdown-menu-DES5sCK6.js";import{L as me}from"./ListingCard-D16etiEA.js";import{f as he,e as xe}from"./firebase-vendor-BtzXZj7S.js";import"./ui-vendor-Dbp4DHG_.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";const ue=({listingId:i})=>{const[r,l]=f.useState([]),[n,o]=f.useState(!0),[c,d]=f.useState("newest"),[m,h]=f.useState(new Set);f.useEffect(()=>{x(),u()},[i]);const x=async()=>{try{const s=await e(i);l(s)}catch(s){}finally{o(!1)}},u=()=>{const e=localStorage.getItem("helpful_reviews_"+i);e&&h(new Set(JSON.parse(e)))},p=f.useMemo(()=>{const e=[...r];switch(c){case"newest":return e.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime());case"highest":return e.sort((e,s)=>s.rating-e.rating);case"lowest":return e.sort((e,s)=>e.rating-s.rating);case"most_helpful":return e.sort((e,s)=>{const t=m.has(e.id)?1:0,a=m.has(s.id)?1:0;return t!==a?a-t:s.rating-e.rating});default:return e}},[r,c,m]),g=f.useMemo(()=>0===r.length?0:(r.reduce((e,s)=>e+s.rating,0)/r.length).toFixed(1),[r]),b=f.useMemo(()=>{const e={5:0,4:0,3:0,2:0,1:0};return r.forEach(s=>{e[s.rating]++}),e},[r]);return n?w.jsx("p",{children:"Loading reviews..."}):0===r.length?w.jsx(s,{children:w.jsx(t,{className:"py-8 text-center text-muted-foreground",children:"No reviews yet"})}):w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[w.jsxs("div",{children:[w.jsxs("h3",{className:"text-2xl font-semibold mb-2",children:["Reviews (",r.length,")"]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("div",{className:"flex items-center",children:[w.jsx(P,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}),w.jsx("span",{className:"text-lg font-bold ml-1",children:g})]}),w.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r.length," ",1===r.length?"review":"reviews",")"]})]})]}),w.jsxs(R,{value:c,onValueChange:e=>d(e),children:[w.jsxs(E,{className:"w-full sm:w-[200px]",children:[w.jsx(z,{className:"h-4 w-4 mr-2"}),w.jsx(L,{placeholder:"Sort by"})]}),w.jsxs(A,{children:[w.jsx(F,{value:"newest",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(O,{className:"h-4 w-4"}),w.jsx("span",{children:"Newest First"})]})}),w.jsx(F,{value:"highest",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(V,{className:"h-4 w-4"}),w.jsx("span",{children:"Highest Rated"})]})}),w.jsx(F,{value:"lowest",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(V,{className:"h-4 w-4 rotate-180"}),w.jsx("span",{children:"Lowest Rated"})]})}),w.jsx(F,{value:"most_helpful",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(H,{className:"h-4 w-4"}),w.jsx("span",{children:"Most Helpful"})]})})]})]})]}),w.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[w.jsx("h4",{className:"text-sm font-medium mb-3",children:"Rating Breakdown"}),w.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].reverse().map(e=>{const s=b[e],t=s/r.length*100;return w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsxs("div",{className:"flex items-center gap-1 w-20",children:[w.jsx("span",{className:"text-sm",children:e}),w.jsx(P,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"})]}),w.jsx("div",{className:"flex-1 bg-background rounded-full h-2 overflow-hidden",children:w.jsx("div",{className:"bg-primary h-full rounded-full transition-all duration-300",style:{width:t+"%"}})}),w.jsx("span",{className:"text-sm text-muted-foreground w-12 text-right",children:s})]},e)})})]}),w.jsx("div",{className:"space-y-4",children:p.map(e=>w.jsx(s,{children:w.jsx(t,{className:"pt-6",children:w.jsxs("div",{className:"flex items-start gap-4",children:[w.jsx(D,{children:w.jsx(I,{children:e.guestId.slice(0,2).toUpperCase()})}),w.jsxs("div",{className:"flex-1",children:[w.jsx("div",{className:"flex items-start justify-between mb-2",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("div",{className:"flex",children:[...[,,,,,]].map((s,t)=>w.jsx(P,{className:"h-4 w-4 "+(t<e.rating?"fill-yellow-400 text-yellow-400":"text-muted")},t))}),w.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})}),w.jsx("p",{className:"text-sm mb-3 leading-relaxed",children:e.comment}),w.jsxs(a,{variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:()=>(e=>{const s=new Set(m);s.has(e)?s.delete(e):s.add(e),h(s),localStorage.setItem("helpful_reviews_"+i,JSON.stringify(Array.from(s)))})(e.id),children:[w.jsx(H,{className:"h-3 w-3 mr-1 "+(m.has(e.id)?"fill-primary text-primary":"")}),"Helpful ",m.has(e.id)&&"(1)"]})]})]})})},e.id))})]})},pe=({url:e,title:s,description:t="",variant:r="outline",size:l="default"})=>{const[n,o]=f.useState(!1),[c,d]=f.useState(!1),[m,h]=f.useState("Copy"),x=f.useRef(null),u=encodeURIComponent(e),p=encodeURIComponent(s),g=async()=>{if(window.isSecureContext||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),o(!0),i.success("Link copied to clipboard!"),void setTimeout(()=>o(!1),2e3)}catch(s){}const a=document.createElement("input");a.value=e,a.type="text",a.readOnly=!0,a.style.position="fixed",a.style.left="0",a.style.top="0",a.style.width="1px",a.style.height="1px",a.style.opacity="0",a.style.pointerEvents="none",a.style.zIndex="9999",document.body.appendChild(a),a.focus(),a.select(),a.setSelectionRange(0,e.length),await new Promise(e=>setTimeout(e,10));try{const e=document.execCommand("copy");if(document.body.removeChild(a),e)return o(!0),i.success("Link copied to clipboard!"),void setTimeout(()=>o(!1),2e3)}catch(t){document.body.contains(a)&&document.body.removeChild(a)}}catch(a){}d(!0),h("Copy"),setTimeout(()=>{x.current&&(x.current.focus(),x.current.select())},100)};return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"flex items-center gap-2",children:[navigator.share&&w.jsxs(a,{variant:r,size:l,onClick:async()=>{if(navigator.share)try{await navigator.share({title:s,text:t,url:e})}catch(a){a.name}else g()},className:"flex items-center gap-2",children:[w.jsx(M,{className:"h-4 w-4"}),w.jsx("span",{className:"hidden sm:inline",children:"Share"})]}),w.jsxs(le,{children:[w.jsx(ne,{asChild:!0,children:w.jsxs(a,{variant:r,size:l,className:"flex items-center gap-2",children:[w.jsx(M,{className:"h-4 w-4"}),!navigator.share&&w.jsx("span",{children:"Share"}),navigator.share&&w.jsx("span",{className:"hidden sm:inline",children:"More"})]})}),w.jsxs(oe,{align:"end",className:"w-48",children:[w.jsx(ce,{onClick:g,children:n?w.jsxs(w.Fragment,{children:[w.jsx($,{className:"h-4 w-4 mr-2 text-green-500"}),"Copied!"]}):w.jsxs(w.Fragment,{children:[w.jsx(B,{className:"h-4 w-4 mr-2"}),"Copy Link"]})}),w.jsx(de,{}),w.jsxs(ce,{onClick:()=>{const e="https://www.facebook.com/sharer/sharer.php?u="+u;window.open(e,"_blank","noopener,noreferrer")},children:[w.jsx(U,{className:"h-4 w-4 mr-2 text-blue-600"}),"Share to Facebook"]}),w.jsxs(ce,{onClick:()=>{const e=`https://twitter.com/intent/tweet?url=${u}&text=${p}${t?"&hashtags=MojoDojoCasaHouse":""}`;window.open(e,"_blank","noopener,noreferrer")},children:[w.jsx(W,{className:"h-4 w-4 mr-2 text-sky-500"}),"Share to Twitter"]}),w.jsxs(ce,{onClick:()=>{const e=`https://api.whatsapp.com/send?text=${p}%20${u}`;window.open(e,"_blank","noopener,noreferrer")},children:[w.jsx(q,{className:"h-4 w-4 mr-2 text-green-600"}),"Share to WhatsApp"]})]})]})]}),w.jsx(v,{open:c,onOpenChange:d,children:w.jsxs(y,{className:"sm:max-w-[500px]",children:[w.jsxs(N,{children:[w.jsxs(_,{className:"flex items-center gap-2",children:[w.jsx(B,{className:"h-5 w-5"}),"Copy Link"]}),w.jsx(k,{children:"Share this listing with others by copying the link below"})]}),w.jsxs("div",{className:"space-y-4 py-4",children:[w.jsxs("div",{className:"flex gap-2",children:[w.jsx(T,{ref:x,value:e,readOnly:!0,className:"flex-1 font-mono text-sm",onFocus:e=>e.target.select()}),w.jsx(a,{onClick:async()=>{if(!x.current)return;const s=x.current;s.focus(),s.select(),s.setSelectionRange(0,e.length);try{if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(e),h("Copied!"),o(!0),i.success("Link copied to clipboard!"),void setTimeout(()=>{h("Copy"),d(!1),o(!1)},1500)}catch(t){}await new Promise(e=>setTimeout(e,10)),document.execCommand("copy")?(h("Copied!"),o(!0),i.success("Link copied to clipboard!"),setTimeout(()=>{h("Copy"),d(!1),o(!1)},1500)):(s.select(),i.info("Text selected. Press Ctrl+C (or Cmd+C) to copy"),h("Copy"))}catch(a){s.select(),i.info("Text selected. Press Ctrl+C (or Cmd+C) to copy"),h("Copy")}},className:"shrink-0",variant:"Copied!"===m?"default":"secondary",children:"Copied!"===m?w.jsxs(w.Fragment,{children:[w.jsx($,{className:"h-4 w-4 mr-2"}),"Copied!"]}):w.jsxs(w.Fragment,{children:[w.jsx(J,{className:"h-4 w-4 mr-2"}),"Copy"]})})]}),w.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tip: You can also select the link above and press ",w.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs font-mono",children:"Ctrl+C"})," (or ",w.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs font-mono",children:"Cmd+C"})," on Mac) to copy"]})]})]})})]})},ge=()=>{const{id:e}=b(),N=j(),{user:D}=r(),[I,R]=f.useState(null),[E,L]=f.useState(),[A,F]=f.useState(),[P,z]=f.useState(1),[O,V]=f.useState(!1),[H,M]=f.useState([]),[$,B]=f.useState([]),[U,W]=f.useState(null),[q,J]=f.useState([]),[le,ne]=f.useState(null),[oe,ce]=f.useState(""),[de,me]=f.useState(0),[ge,we]=f.useState(!1),[be,je]=f.useState(0),[ve,ye]=f.useState([]);f.useEffect(()=>{e&&(Ne(),me(0)),D&&(ke(),Ce(),Se())},[e,D]),f.useEffect(()=>{if(!ge)return;const e=e=>{I?.images&&("ArrowLeft"===e.key?je(e=>0===e?I.images.length-1:e-1):"ArrowRight"===e.key?je(e=>e===I.images.length-1?0:e+1):"Escape"===e.key&&we(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ge,I?.images]);const Ne=async()=>{if(!e)return;const s=await l(e);if(s){const t=await n(e),a={...s,averageRating:t.averageRating,reviewCount:t.reviewCount};R(a),s.hostId&&await _e(s.hostId),await Te()}},_e=async e=>{try{const s=await he(xe(o,"users",e));if(s.exists()){const e=s.data();W({fullName:e.fullName||"Host",email:e.email||""})}else W({fullName:"Host",email:""})}catch(s){W({fullName:"Host",email:""})}},ke=async()=>{if(!D)return;const e=await he(xe(o,"users",D.uid));e.exists()&&M(e.data().favorites||[])},Ce=async()=>{if(!D)return;const e=await he(xe(o,"users",D.uid));e.exists()&&B(e.data().wishlist||[])},Se=async()=>{if(!D)return;const e=await he(xe(o,"users",D.uid));if(e.exists()){const s=e.data();J(s.coupons||[])}},Te=async()=>{if(e)try{const s=(await c({status:"confirmed"})).filter(s=>s.listingId===e);ye(s)}catch(s){ye([])}},De=e=>{if(!ve.length)return!1;e.toISOString().split("T")[0];const s=e.getTime();return ve.some(e=>{const t=new Date(e.checkIn),a=new Date(e.checkOut);return t.setHours(0,0,0,0),a.setHours(0,0,0,0),s>=t.getTime()&&s<=a.getTime()})},Ie=e=>{const s=new Date;s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(0,0,0,0),s>t||!(e=>{if(!I?.availableDates||0===I.availableDates.length)return!0;const s=e.toISOString().split("T")[0];return I.availableDates.includes(s)})(t)||!!De(t)},Re=()=>{if(!E||!A||!I)return 0;const e=Math.ceil((A.getTime()-E.getTime())/864e5)*I.price;return le&&e>=(le.minSpend||0)?Math.max(0,e-le.discount):e},Ee=()=>{if(!oe.trim())return void i.error("Please enter a coupon code");const e=q.find(e=>e.code.toUpperCase()===oe.toUpperCase().trim()&&!e.used&&new Date(e.validUntil)>new Date);if(!e)return void i.error("Invalid, expired, or already used coupon");const s=E&&A&&I?Math.ceil((A.getTime()-E.getTime())/864e5)*I.price:0;e.minSpend&&s<e.minSpend?i.error("This coupon requires a minimum spend of "+u(e.minSpend)):(ne(e),ce(""),i.success(`Coupon ${e.code} applied! ${u(e.discount)} discount`))};return I?w.jsx("div",{className:"min-h-screen bg-background p-4 sm:p-6",children:w.jsxs("div",{className:"max-w-7xl mx-auto",children:[w.jsxs(a,{variant:"ghost",onClick:()=>N("/guest/browse"),className:"mb-4 h-10 sm:h-auto",children:[w.jsx(K,{className:"h-4 w-4 mr-2"}),w.jsx("span",{className:"hidden sm:inline",children:"Back to Browse"}),w.jsx("span",{className:"sm:hidden",children:"Back"})]}),w.jsxs("div",{className:"grid lg:grid-cols-12 gap-4 sm:gap-6 lg:gap-8",children:[w.jsxs("div",{className:"lg:col-span-7 space-y-3",children:[w.jsx("div",{className:"relative w-full h-[300px] sm:h-[400px] md:h-[500px] rounded-lg overflow-hidden group bg-muted cursor-pointer touch-manipulation",onClick:()=>{je(de),we(!0)},children:I.images&&I.images.length>0?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"flex transition-transform duration-500 ease-in-out h-full",style:{transform:`translateX(-${100*de}%)`},children:I.images.map((e,s)=>w.jsx("div",{className:"min-w-full h-full flex-shrink-0 relative",children:w.jsx("img",{src:e||"/placeholder.svg",alt:`${I.title} - Image ${s+1}`,className:"w-full h-full object-cover"})},s))}),I.images.length>1&&w.jsxs(w.Fragment,{children:[w.jsx(a,{variant:"secondary",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",onClick:e=>{e.stopPropagation(),me(e=>0===e?I.images.length-1:e-1)},"aria-label":"Previous image",children:w.jsx(Y,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),w.jsx(a,{variant:"secondary",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 opacity-80 hover:opacity-100 transition-opacity bg-black/70 hover:bg-black/90 text-white border-none z-10 shadow-lg backdrop-blur-sm h-9 w-9 sm:h-10 sm:w-10 touch-manipulation",onClick:e=>{e.stopPropagation(),me(e=>e===I.images.length-1?0:e+1)},"aria-label":"Next image",children:w.jsx(G,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),w.jsxs("div",{className:"absolute top-4 right-4 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs font-medium backdrop-blur-sm z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:[w.jsx(Q,{className:"h-3 w-3 inline mr-1"}),"Click to zoom"]}),w.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-1.5 rounded-full text-sm font-medium backdrop-blur-sm z-10",children:[de+1," / ",I.images.length]})]})]}):w.jsx("img",{src:"/placeholder.svg",alt:I.title,className:"w-full h-full object-cover"})}),I.images&&I.images.length>1&&w.jsx("div",{className:"relative",children:w.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-2 snap-x snap-mandatory touch-pan-x",children:I.images.map((e,s)=>w.jsx("button",{onClick:()=>me(s),className:"relative flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden border-2 transition-all snap-start touch-manipulation "+(de===s?"border-primary ring-2 ring-primary/50 scale-105":"border-transparent hover:border-border opacity-70 hover:opacity-100 active:opacity-100"),children:w.jsx("img",{src:e,alt:"Thumbnail "+(s+1),className:"w-full h-full object-cover"})},s))})})]}),w.jsxs("div",{className:"lg:col-span-5 flex flex-col",children:[w.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-2 gap-2 sm:gap-0",children:[w.jsx(C,{className:"text-xs sm:text-sm",children:I.category}),w.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[D&&I&&w.jsxs(w.Fragment,{children:[w.jsxs(a,{variant:"outline",size:"sm",onClick:async()=>{if(D&&I)try{const{toggleWishlist:e}=await p(async()=>{const{toggleWishlist:e}=await import("./index-BbQqfVom.js").then(e=>e.S);return{toggleWishlist:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await e(D.uid,I.id,$);B(s),i.success(s.includes(I.id)?"Added to wishlist":"Removed from wishlist")}catch(e){i.error("Failed to update wishlist")}else i.error("Please login to add to wishlist")},className:"flex items-center gap-1.5 sm:gap-2 h-9 sm:h-auto text-xs sm:text-sm touch-manipulation",title:$.includes(I.id)?"Remove from wishlist":"Add to wishlist",children:[w.jsx(X,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 "+($.includes(I.id)?"fill-blue-500 text-blue-500":"")}),w.jsx("span",{className:"hidden sm:inline",children:$.includes(I.id)?"In Wishlist":"Wishlist"})]}),w.jsxs(a,{variant:"outline",size:"sm",onClick:async()=>{if(D&&I)try{const{toggleFavorite:e}=await p(async()=>{const{toggleFavorite:e}=await import("./index-BbQqfVom.js").then(e=>e.S);return{toggleFavorite:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await e(D.uid,I.id,H);M(s),i.success(s.includes(I.id)?"Added to favorites":"Removed from favorites")}catch(e){i.error("Failed to update favorites")}else i.error("Please login to add favorites")},className:"flex items-center gap-1.5 sm:gap-2 h-9 sm:h-auto text-xs sm:text-sm touch-manipulation",title:H.includes(I.id)?"Remove from favorites":"Add to favorites",children:[w.jsx(Z,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 "+(H.includes(I.id)?"fill-red-500 text-red-500":"")}),w.jsx("span",{className:"hidden sm:inline",children:H.includes(I.id)?"Favorited":"Favorite"})]})]}),I&&w.jsx(pe,{url:window.location.href,title:I.title,description:I.description,variant:"outline",size:"sm"})]})]}),w.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:I.title}),w.jsxs("div",{className:"flex items-center text-muted-foreground mb-4",children:[w.jsx(ee,{className:"h-4 w-4 mr-1"}),w.jsx("span",{children:I.location})]}),w.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[w.jsxs("span",{className:"flex items-center gap-1",children:[w.jsx(se,{className:"h-4 w-4"}),I.maxGuests," guests"]}),I.bedrooms&&w.jsxs("span",{children:[I.bedrooms," bedrooms"]}),I.bathrooms&&w.jsxs("span",{children:[I.bathrooms," bathrooms"]})]}),U&&w.jsx(s,{className:"mb-6 border-primary/20 bg-primary/5",children:w.jsx(t,{className:"p-4",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:w.jsx(te,{className:"h-6 w-6 text-primary"})}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Hosted by"}),w.jsx("p",{className:"font-semibold text-lg",children:U.fullName})]})]})})}),w.jsx("p",{className:"text-muted-foreground mb-6",children:I.description}),I.amenities.length>0&&w.jsxs("div",{className:"mb-6",children:[w.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),w.jsx("div",{className:"flex flex-wrap gap-2",children:I.amenities.map((e,s)=>w.jsx(C,{variant:"outline",children:e},s))})]})]})]}),w.jsxs(s,{className:"mt-6 sm:mt-8 shadow-lg",children:[w.jsxs(m,{className:"pb-4 sm:pb-6 px-4 sm:px-6",children:[w.jsxs(h,{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[w.jsx(ae,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),"Select Dates"]}),w.jsx(x,{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Choose your check-in and check-out dates"})]}),w.jsx(t,{className:"px-4 sm:px-6 pb-4 sm:pb-6",children:w.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12",children:[w.jsx("div",{className:"flex flex-col",children:w.jsxs("div",{className:"flex flex-col",children:[w.jsxs("div",{className:"mb-4 pb-3 border-b",children:[w.jsxs("h3",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:[w.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),"Check-in"]}),E&&w.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:E.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),w.jsx("div",{className:"w-full",children:w.jsx("div",{className:"w-full border rounded-md shadow-sm bg-card p-4",children:w.jsx(S,{mode:"single",selected:E,onSelect:L,disabled:Ie,modifiers:{booked:e=>De(e)},modifiersClassNames:{booked:"bg-orange-500/20 text-orange-600 dark:text-orange-400"},className:"w-full max-w-none [&_.rdp-day_booked]:bg-orange-500/20 [&_.rdp-day_booked]:text-orange-600 dark:[&_.rdp-day_booked]:text-orange-400 [&_.rdp-day_booked]:relative [&_.rdp-day_booked]:after:content-['booked'] [&_.rdp-day_booked]:after:absolute [&_.rdp-day_booked]:after:bottom-0 [&_.rdp-day_booked]:after:left-1/2 [&_.rdp-day_booked]:after:-translate-x-1/2 [&_.rdp-day_booked]:after:text-[7px] [&_.rdp-day_booked]:after:leading-tight [&_.rdp-day_booked]:after:opacity-80 [&_.rdp-day_booked]:after:whitespace-nowrap [&_.rdp-day_booked]:after:pointer-events-none",classNames:{months:"w-full",month:"w-full space-y-3",caption:"w-full mb-4",caption_label:"w-full text-center text-base font-semibold",nav:"w-full justify-between px-1",nav_button:"h-8 w-8",table:"w-full border-collapse",head_row:"w-full flex justify-between mb-2",head_cell:"flex-1 text-center text-sm font-medium text-muted-foreground",row:"w-full flex justify-between my-1",cell:"flex-1 text-center h-10",day:"w-full h-full flex items-center justify-center text-sm font-medium rounded-md hover:bg-accent transition-colors",day_disabled:"bg-orange-500/20 text-orange-600 dark:text-orange-400 opacity-100 cursor-not-allowed relative after:content-['booked'] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:text-[7px] after:leading-tight after:opacity-80 after:whitespace-nowrap after:pointer-events-none"}})})})]})}),w.jsx("div",{className:"flex flex-col lg:border-l lg:pl-12 lg:border-border/50",children:w.jsxs("div",{className:"flex flex-col",children:[w.jsxs("div",{className:"mb-4 pb-3 border-b",children:[w.jsxs("h3",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:[w.jsx("div",{className:"h-2 w-2 rounded-full bg-accent"}),"Check-out"]}),A&&w.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:A.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),w.jsx("div",{className:"w-full",children:w.jsx("div",{className:"w-full border rounded-md shadow-sm bg-card p-4",children:w.jsx(S,{mode:"single",selected:A,onSelect:F,disabled:e=>{if(!E)return!0;const s=new Date(E);s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(0,0,0,0),s>=t||Ie(e)},modifiers:{booked:e=>De(e)},modifiersClassNames:{booked:"bg-orange-500/20 text-orange-600 dark:text-orange-400"},className:"w-full max-w-none [&_.rdp-day_booked]:bg-orange-500/20 [&_.rdp-day_booked]:text-orange-600 dark:[&_.rdp-day_booked]:text-orange-400 [&_.rdp-day_booked]:relative [&_.rdp-day_booked]:after:content-['booked'] [&_.rdp-day_booked]:after:absolute [&_.rdp-day_booked]:after:bottom-0 [&_.rdp-day_booked]:after:left-1/2 [&_.rdp-day_booked]:after:-translate-x-1/2 [&_.rdp-day_booked]:after:text-[7px] [&_.rdp-day_booked]:after:leading-tight [&_.rdp-day_booked]:after:opacity-80 [&_.rdp-day_booked]:after:whitespace-nowrap [&_.rdp-day_booked]:after:pointer-events-none",classNames:{months:"w-full",month:"w-full space-y-3",caption:"w-full mb-4",caption_label:"w-full text-center text-base font-semibold",nav:"w-full justify-between px-1",nav_button:"h-8 w-8",table:"w-full border-collapse",head_row:"w-full flex justify-between mb-2",head_cell:"flex-1 text-center text-sm font-medium text-muted-foreground",row:"w-full flex justify-between my-1",cell:"flex-1 text-center h-10",day:"w-full h-full flex items-center justify-center text-sm font-medium rounded-md hover:bg-accent transition-colors",day_disabled:"bg-orange-500/20 text-orange-600 dark:text-orange-400 opacity-100 cursor-not-allowed relative after:content-['booked'] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:text-[7px] after:leading-tight after:opacity-80 after:whitespace-nowrap after:pointer-events-none"}})})})]})})]})})]}),w.jsxs(s,{className:"mt-6 sm:mt-8 shadow-lg sticky top-4 lg:top-8",children:[w.jsx(m,{className:"px-4 sm:px-6 pt-4 sm:pt-6",children:w.jsxs(h,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-1 sm:gap-0",children:[w.jsx("span",{className:"text-2xl sm:text-3xl",children:u(I.price)}),w.jsx("span",{className:"text-xs sm:text-sm font-normal text-muted-foreground",children:"per night"})]})}),w.jsxs(t,{className:"space-y-4 px-4 sm:px-6 pb-4 sm:pb-6",children:[w.jsx("div",{className:"pt-4 border-t",children:le?w.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(ie,{className:"h-4 w-4 text-primary"}),w.jsx("span",{className:"text-sm font-medium",children:le.code}),w.jsxs("span",{className:"text-xs text-muted-foreground",children:["-",u(le.discount)]})]}),w.jsx(a,{type:"button",variant:"ghost",size:"sm",onClick:()=>{ne(null),i.info("Coupon removed")},children:w.jsx(re,{className:"h-4 w-4"})})]}):w.jsxs("div",{className:"space-y-2",children:[w.jsx("label",{className:"text-sm font-medium",children:"Have a coupon code?"}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx(T,{placeholder:"Enter coupon code",value:oe,onChange:e=>ce(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&Ee()}),w.jsxs(a,{type:"button",variant:"outline",onClick:Ee,disabled:!oe.trim(),children:[w.jsx(ie,{className:"h-4 w-4 mr-2"}),"Apply"]})]})]})}),E&&A&&w.jsxs("div",{className:"pt-4 border-t space-y-2",children:[le&&w.jsxs("div",{className:"flex justify-between text-sm",children:[w.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),w.jsx("span",{children:u(Math.ceil((A.getTime()-E.getTime())/864e5)*I.price)})]}),le&&w.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[w.jsxs("span",{children:["Discount (",le.code,")"]}),w.jsxs("span",{children:["-",u(le.discount)]})]}),w.jsxs("div",{className:"flex justify-between font-bold pt-2 border-t",children:[w.jsx("span",{children:"Total"}),w.jsx("span",{children:u(Re())})]})]}),w.jsx(a,{className:"w-full h-12 sm:h-auto text-base sm:text-sm touch-manipulation",onClick:async()=>{if(D&&I&&E&&A)if(I.hostId){V(!0);try{const s=Math.ceil((A.getTime()-E.getTime())/864e5)*I.price,t=Re(),a={listingId:I.id,guestId:D.uid,hostId:I.hostId,checkIn:E.toISOString(),checkOut:A.toISOString(),guests:P,totalPrice:t,originalPrice:s,discountAmount:le?s-t:0,status:"pending"};le?.code&&(a.couponCode=le.code);const r=await g(a);try{const{getDoc:e,doc:s}=await p(async()=>{const{getDoc:e,doc:s}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{getDoc:e,doc:s}},[]),{db:t}=await p(async()=>{const{db:e}=await import("./index-BbQqfVom.js").then(e=>e.R);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await e(s(t,"bookings",r));if(a.exists()&&(a.data(),I.id)){const a=await e(s(t,"listing",I.id));a.exists()&&a.data()}}catch(e){}i.success("Booking request sent! The host will review your request."),N("/guest/dashboard")}catch(s){i.error("Failed to create booking")}finally{V(!1)}}else i.error("Listing error: Missing host information. Please contact support.");else i.error("Please select dates and sign in")},disabled:!E||!A||O,children:O?"Booking...":"Request to Book"})]})]}),w.jsx(v,{open:ge,onOpenChange:we,children:w.jsxs(y,{className:"max-w-[98vw] max-h-[98vh] w-auto h-auto p-0 bg-black/95 border-none m-1",children:[w.jsx(_,{className:"sr-only",children:"View Full Size Image"}),w.jsxs(k,{className:"sr-only",children:["Viewing image ",be+1," of ",I?.images?.length||0," for ",I?.title]}),w.jsx("div",{className:"relative w-full h-full flex items-center justify-center min-h-[400px]",children:I?.images&&I.images.length>0&&w.jsxs(w.Fragment,{children:[w.jsx(a,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-10 sm:w-10",onClick:()=>we(!1),children:w.jsx(re,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),w.jsxs("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-black/70 text-white px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium backdrop-blur-sm z-50",children:[be+1," / ",I.images.length]}),w.jsx("div",{className:"w-full h-full flex items-center justify-center p-2 sm:p-4 pt-12 pb-20 sm:pb-24",children:w.jsx("img",{src:I.images[be]||"/placeholder.svg",alt:`${I.title} - Image ${be+1}`,className:"max-w-full max-h-[calc(98vh-160px)] object-contain"})}),I.images.length>1&&w.jsxs(w.Fragment,{children:[w.jsx(a,{variant:"ghost",size:"icon",className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>je(e=>0===e?I.images.length-1:e-1),children:w.jsx(Y,{className:"h-4 w-4 sm:h-6 sm:w-6"})}),w.jsx(a,{variant:"ghost",size:"icon",className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-50 bg-black/70 hover:bg-black/90 text-white border-none h-8 w-8 sm:h-12 sm:w-12",onClick:()=>je(e=>e===I.images.length-1?0:e+1),children:w.jsx(G,{className:"h-4 w-4 sm:h-6 sm:w-6"})})]}),I.images.length>1&&w.jsx("div",{className:"absolute bottom-2 sm:bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm rounded-lg p-2 sm:p-3 z-50 max-w-[calc(98vw-32px)]",children:w.jsx("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto scrollbar-hide px-1",children:I.images.map((e,s)=>w.jsx("button",{onClick:()=>je(s),className:"relative flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 rounded transition-all "+(be===s?"scale-110 shadow-lg shadow-primary/50":"opacity-70 hover:opacity-100"),children:w.jsx("div",{className:"absolute inset-0 rounded overflow-hidden border-2 "+(be===s?"border-primary ring-2 ring-primary/50 ring-offset-2 ring-offset-black/70":"border-transparent hover:border-white/50"),children:w.jsx("img",{src:e,alt:"Thumbnail "+(s+1),className:"w-full h-full object-cover transition-opacity "+(be===s?"opacity-100":"opacity-70")})})},s))})})]})})]})}),w.jsx("div",{className:"mt-12",children:w.jsx(ue,{listingId:I.id})}),w.jsx(fe,{listingId:I.id})]})}):w.jsx(d,{})},fe=({listingId:e})=>{const s=j(),{user:t}=r(),[a,l]=f.useState([]),[n,o]=f.useState([]),[c,d]=f.useState([]),[m,h]=f.useState(!0);f.useEffect(()=>{x(),t&&(u(),g())},[e,t]);const x=async()=>{try{const{getSimilarListings:s}=await p(async()=>{const{getSimilarListings:e}=await import("./recommendations-CcEjlX8s.js");return{getSimilarListings:e}},__vite__mapDeps([9,7,0,1,2,3,4,5,6,8])),{getListingsRatings:t}=await p(async()=>{const{getListingsRatings:e}=await import("./index-BbQqfVom.js").then(e=>e.S);return{getListingsRatings:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(e,4);if(a.length>0){const e=a.map(e=>e.id),s=await t(e),i=a.map(e=>{const t=s.get(e.id);return{...e,averageRating:t?.averageRating||0,reviewCount:t?.reviewCount||0}});l(i)}else l(a)}catch(s){}finally{h(!1)}},u=async()=>{if(!t)return;const{doc:e,getDoc:s}=await p(async()=>{const{doc:e,getDoc:s}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,getDoc:s}},[]),{db:a}=await p(async()=>{const{db:e}=await import("./index-BbQqfVom.js").then(e=>e.R);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await s(e(a,"users",t.uid));i.exists()&&o(i.data().favorites||[])},g=async()=>{if(!t)return;const{doc:e,getDoc:s}=await p(async()=>{const{doc:e,getDoc:s}=await import("./firebase-vendor-BtzXZj7S.js").then(e=>e.B);return{doc:e,getDoc:s}},[]),{db:a}=await p(async()=>{const{db:e}=await import("./index-BbQqfVom.js").then(e=>e.R);return{db:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),i=await s(e(a,"users",t.uid));i.exists()&&d(i.data().wishlist||[])};return m||0===a.length?null:w.jsxs("div",{className:"mt-12",children:[w.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Similar Listings"}),w.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:a.map(e=>w.jsx(me,{listing:e,onView:()=>s("/guest/listing/"+e.id),onFavorite:()=>(async e=>{if(t)try{const{toggleFavorite:s}=await p(async()=>{const{toggleFavorite:e}=await import("./index-BbQqfVom.js").then(e=>e.S);return{toggleFavorite:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(t.uid,e,n);o(a),i.success(a.includes(e)?"Added to favorites":"Removed from favorites")}catch(s){i.error("Failed to update favorites")}else i.error("Please login to add favorites")})(e.id),onWishlist:()=>(async e=>{if(t)try{const{toggleWishlist:s}=await p(async()=>{const{toggleWishlist:e}=await import("./index-BbQqfVom.js").then(e=>e.S);return{toggleWishlist:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await s(t.uid,e,c);d(a),i.success(a.includes(e)?"Added to wishlist":"Removed from wishlist")}catch(s){i.error("Failed to update wishlist")}else i.error("Please login to add to wishlist")})(e.id),isFavorite:n.includes(e.id),isInWishlist:c.includes(e.id)},e.id))})]})};export{ge as default};
