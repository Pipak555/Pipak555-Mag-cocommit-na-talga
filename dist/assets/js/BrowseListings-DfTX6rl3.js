import{j as e,r as t,u as r,i as s}from"./react-vendor-Ve3SFwKO.js";import{C as a,e as l,g as n,j as i,a as c,i as o,B as d,b as u,c as m,u as h,o as f,k as p,h as g,t as x,q as v}from"./index-BnushFQy.js";import{q as b,d as w,w as y,e as j,h as N,f as k}from"./firebase-vendor-BC71bXmb.js";import{L as S}from"./ListingCard-D6Td60Vf.js";import{S as C}from"./skeleton-DTHuGkb9.js";import{E}from"./empty-state-BDfunuWx.js";import{I}from"./input-C6C1u0Er.js";import{u as R,d as A,e as L,f as P,O as F,g as O,h as M}from"./ui-vendor-D9RGQy8n.js";import"./dialog-B475KvSN.js";import{J as D,g as q,X as _,K as V}from"./icons-vendor-DD8ZfUKZ.js";import{P as B,a as K,b as G,D as T}from"./date-range-picker-DP4SlluA.js";import{L as U}from"./label-DdT-oWKe.js";import{S as z,a as $,b as H,c as J,d as W}from"./select-D2BQB2Va.js";import{i as X}from"./availabilityUtils-Du47gcIt.js";import{B as Z}from"./BackButton-DohCcac0.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./badge-CYghlWc2.js";import"./calendar-CF_sIwXc.js";const Q=()=>e.jsxs(a,{className:"overflow-hidden border-0 shadow-sm",children:[e.jsx(C,{className:"h-56 w-full"}),e.jsxs(l,{className:"p-5 space-y-3",children:[e.jsx(C,{className:"h-5 w-3/4"}),e.jsx(C,{className:"h-4 w-1/2"}),e.jsx(C,{className:"h-4 w-full"}),e.jsx(C,{className:"h-4 w-2/3"}),e.jsx("div",{className:"flex items-center justify-between pt-3 border-t",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{className:"h-4 w-12"}),e.jsx(C,{className:"h-4 w-16"})]})})]})]});var Y=.999,ee=/[\\\/_+.#"@\[\(\{&]/,te=/[\\\/_+.#"@\[\(\{&]/g,re=/[\s-]/,se=/[\s-]/g;function ae(e,t,r,s,a,l,n){if(l===t.length)return a===e.length?1:.99;var i=`${a},${l}`;if(void 0!==n[i])return n[i];for(var c,o,d,u,m=s.charAt(l),h=r.indexOf(m,a),f=0;h>=0;)(c=ae(e,t,r,s,h+1,l+1,n))>f&&(h===a?c*=1:ee.test(e.charAt(h-1))?(c*=.8,(d=e.slice(a,h-1).match(te))&&a>0&&(c*=Math.pow(Y,d.length))):re.test(e.charAt(h-1))?(c*=.9,(u=e.slice(a,h-1).match(se))&&a>0&&(c*=Math.pow(Y,u.length))):(c*=.17,a>0&&(c*=Math.pow(Y,h-a))),e.charAt(h)!==t.charAt(l)&&(c*=.9999)),(.1>c&&r.charAt(h-1)===s.charAt(l+1)||s.charAt(l+1)===s.charAt(l)&&r.charAt(h-1)!==s.charAt(l))&&.1*(o=ae(e,t,r,s,h+1,l+2,n))>c&&(c=.1*o),c>f&&(f=c),h=r.indexOf(m,h+1);return n[i]=f,f}function le(e){return e.toLowerCase().replace(se," ")}function ne(e,t,r){return ae(e=r&&r.length>0?e+" "+r.join(" "):e,t,le(e),le(t),0,0,{})}var ie='[cmdk-group=""]',ce='[cmdk-group-items=""]',oe='[cmdk-item=""]',de=oe+':not([aria-disabled="true"])',ue="cmdk-item-select",me="data-value",he=(e,t,r)=>ne(e,t,r),fe=t.createContext(void 0),pe=()=>t.useContext(fe),ge=t.createContext(void 0),xe=()=>t.useContext(ge),ve=t.createContext(void 0),be=t.forwardRef((e,r)=>{let s=Fe(()=>{var t,r;return{search:"",value:null!=(r=null!=(t=e.value)?t:e.defaultValue)?r:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),a=Fe(()=>new Set),l=Fe(()=>new Map),n=Fe(()=>new Map),i=Fe(()=>new Set),c=Le(e),{label:o,children:d,value:u,onValueChange:m,filter:h,shouldFilter:f,loop:p,disablePointerSelection:g=!1,vimBindings:x=!0,...v}=e,b=R(),w=R(),y=R(),j=t.useRef(null),N=De();Pe(()=>{if(void 0!==u){let e=u.trim();s.current.value=e,k.emit()}},[u]),Pe(()=>{N(6,P)},[]);let k=t.useMemo(()=>({subscribe:e=>(i.current.add(e),()=>i.current.delete(e)),snapshot:()=>s.current,setState:(e,t,r)=>{var a,l,n,i;if(!Object.is(s.current[e],t)){if(s.current[e]=t,"search"===e)L(),E(),N(1,I);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(y);e?e.focus():null==(a=document.getElementById(b))||a.focus()}if(N(7,()=>{var e;s.current.selectedItemId=null==(e=F())?void 0:e.id,k.emit()}),r||N(5,P),void 0!==(null==(l=c.current)?void 0:l.value)){let e=null!=t?t:"";return void(null==(i=(n=c.current).onValueChange)||i.call(n,e))}}k.emit()}},emit:()=>{i.current.forEach(e=>e())}}),[]),S=t.useMemo(()=>({value:(e,t,r)=>{var a;t!==(null==(a=n.current.get(e))?void 0:a.value)&&(n.current.set(e,{value:t,keywords:r}),s.current.filtered.items.set(e,C(t,r)),N(2,()=>{E(),k.emit()}))},item:(e,t)=>(a.current.add(e),t&&(l.current.has(t)?l.current.get(t).add(e):l.current.set(t,new Set([e]))),N(3,()=>{L(),E(),s.current.value||I(),k.emit()}),()=>{n.current.delete(e),a.current.delete(e),s.current.filtered.items.delete(e);let t=F();N(4,()=>{L(),(null==t?void 0:t.getAttribute("id"))===e&&I(),k.emit()})}),group:e=>(l.current.has(e)||l.current.set(e,new Set),()=>{n.current.delete(e),l.current.delete(e)}),filter:()=>c.current.shouldFilter,label:o||e["aria-label"],getDisablePointerSelection:()=>c.current.disablePointerSelection,listId:b,inputId:y,labelId:w,listInnerRef:j}),[]);function C(e,t){var r,a;let l=null!=(a=null==(r=c.current)?void 0:r.filter)?a:he;return e?l(e,s.current.search,t):0}function E(){if(!s.current.search||!1===c.current.shouldFilter)return;let e=s.current.filtered.items,t=[];s.current.filtered.groups.forEach(r=>{let s=l.current.get(r),a=0;s.forEach(t=>{let r=e.get(t);a=Math.max(r,a)}),t.push([r,a])});let r=j.current;O().sort((t,r)=>{var s,a;let l=t.getAttribute("id"),n=r.getAttribute("id");return(null!=(s=e.get(n))?s:0)-(null!=(a=e.get(l))?a:0)}).forEach(e=>{let t=e.closest(ce);t?t.appendChild(e.parentElement===t?e:e.closest(ce+" > *")):r.appendChild(e.parentElement===r?e:e.closest(ce+" > *"))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let r=null==(t=j.current)?void 0:t.querySelector(`${ie}[${me}="${encodeURIComponent(e[0])}"]`);null==r||r.parentElement.appendChild(r)})}function I(){let e=O().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(me);k.setState("value",t||void 0)}function L(){var e,t,r,i;if(!s.current.search||!1===c.current.shouldFilter)return void(s.current.filtered.count=a.current.size);s.current.filtered.groups=new Set;let o=0;for(let l of a.current){let a=C(null!=(t=null==(e=n.current.get(l))?void 0:e.value)?t:"",null!=(i=null==(r=n.current.get(l))?void 0:r.keywords)?i:[]);s.current.filtered.items.set(l,a),a>0&&o++}for(let[a,n]of l.current)for(let e of n)if(s.current.filtered.items.get(e)>0){s.current.filtered.groups.add(a);break}s.current.filtered.count=o}function P(){var e,t,r;let s=F();s&&((null==(e=s.parentElement)?void 0:e.firstChild)===s&&(null==(r=null==(t=s.closest(ie))?void 0:t.querySelector('[cmdk-group-heading=""]'))||r.scrollIntoView({block:"nearest"})),s.scrollIntoView({block:"nearest"}))}function F(){var e;return null==(e=j.current)?void 0:e.querySelector(oe+'[aria-selected="true"]')}function O(){var e;return Array.from((null==(e=j.current)?void 0:e.querySelectorAll(de))||[])}function M(e){let t=O()[e];t&&k.setState("value",t.getAttribute(me))}function D(e){var t;let r=F(),s=O(),a=s.findIndex(e=>e===r),l=s[a+e];null!=(t=c.current)&&t.loop&&(l=0>a+e?s[s.length-1]:a+e===s.length?s[0]:s[a+e]),l&&k.setState("value",l.getAttribute(me))}function q(e){let t,r=F(),s=null==r?void 0:r.closest(ie);for(;s&&!t;)s=e>0?Re(s,ie):Ae(s,ie),t=null==s?void 0:s.querySelector(de);t?k.setState("value",t.getAttribute(me)):D(e)}let _=()=>M(O().length-1),V=e=>{e.preventDefault(),e.metaKey?_():e.altKey?q(1):D(1)},B=e=>{e.preventDefault(),e.metaKey?M(0):e.altKey?q(-1):D(-1)};return t.createElement(A.div,{ref:r,tabIndex:-1,...v,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=v.onKeyDown)||t.call(v,e);let r=e.nativeEvent.isComposing||229===e.keyCode;if(!e.defaultPrevented&&!r)switch(e.key){case"n":case"j":x&&e.ctrlKey&&V(e);break;case"ArrowDown":V(e);break;case"p":case"k":x&&e.ctrlKey&&B(e);break;case"ArrowUp":B(e);break;case"Home":e.preventDefault(),M(0);break;case"End":e.preventDefault(),_();break;case"Enter":{e.preventDefault();let t=F();if(t){let e=new Event(ue);t.dispatchEvent(e)}}}}},t.createElement("label",{"cmdk-label":"",htmlFor:S.inputId,id:S.labelId,style:_e},o),qe(e,e=>t.createElement(ge.Provider,{value:k},t.createElement(fe.Provider,{value:S},e))))}),we=t.forwardRef((e,r)=>{var s,a;let l=R(),n=t.useRef(null),i=t.useContext(ve),c=pe(),o=Le(e),d=null!=(a=null==(s=o.current)?void 0:s.forceMount)?a:null==i?void 0:i.forceMount;Pe(()=>{if(!d)return c.item(l,null==i?void 0:i.id)},[d]);let u=Me(l,n,[e.value,e.children,n],e.keywords),m=xe(),h=Oe(e=>e.value&&e.value===u.current),f=Oe(e=>!(!d&&!1!==c.filter())||!e.search||e.filtered.items.get(l)>0);function p(){var e,t;g(),null==(t=(e=o.current).onSelect)||t.call(e,u.current)}function g(){m.setState("value",u.current,!0)}if(t.useEffect(()=>{let t=n.current;if(t&&!e.disabled)return t.addEventListener(ue,p),()=>t.removeEventListener(ue,p)},[f,e.onSelect,e.disabled]),!f)return null;let{disabled:x,value:v,onSelect:b,forceMount:w,keywords:y,...j}=e;return t.createElement(A.div,{ref:M(n,r),...j,id:l,"cmdk-item":"",role:"option","aria-disabled":!!x,"aria-selected":!!h,"data-disabled":!!x,"data-selected":!!h,onPointerMove:x||c.getDisablePointerSelection()?void 0:g,onClick:x?void 0:p},e.children)}),ye=t.forwardRef((e,r)=>{let{heading:s,children:a,forceMount:l,...n}=e,i=R(),c=t.useRef(null),o=t.useRef(null),d=R(),u=pe(),m=Oe(e=>!(!l&&!1!==u.filter())||!e.search||e.filtered.groups.has(i));Pe(()=>u.group(i),[]),Me(i,c,[e.value,e.heading,o]);let h=t.useMemo(()=>({id:i,forceMount:l}),[l]);return t.createElement(A.div,{ref:M(c,r),...n,"cmdk-group":"",role:"presentation",hidden:!m||void 0},s&&t.createElement("div",{ref:o,"cmdk-group-heading":"","aria-hidden":!0,id:d},s),qe(e,e=>t.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?d:void 0},t.createElement(ve.Provider,{value:h},e))))}),je=t.forwardRef((e,r)=>{let{alwaysRender:s,...a}=e,l=t.useRef(null),n=Oe(e=>!e.search);return s||n?t.createElement(A.div,{ref:M(l,r),...a,"cmdk-separator":"",role:"separator"}):null}),Ne=t.forwardRef((e,r)=>{let{onValueChange:s,...a}=e,l=null!=e.value,n=xe(),i=Oe(e=>e.search),c=Oe(e=>e.selectedItemId),o=pe();return t.useEffect(()=>{null!=e.value&&n.setState("search",e.value)},[e.value]),t.createElement(A.input,{ref:r,...a,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":o.listId,"aria-labelledby":o.labelId,"aria-activedescendant":c,id:o.inputId,type:"text",value:l?e.value:i,onChange:e=>{l||n.setState("search",e.target.value),null==s||s(e.target.value)}})}),ke=t.forwardRef((e,r)=>{let{children:s,label:a="Suggestions",...l}=e,n=t.useRef(null),i=t.useRef(null),c=Oe(e=>e.selectedItemId),o=pe();return t.useEffect(()=>{if(i.current&&n.current){let e,t=i.current,r=n.current,s=new ResizeObserver(()=>{e=requestAnimationFrame(()=>{let e=t.offsetHeight;r.style.setProperty("--cmdk-list-height",e.toFixed(1)+"px")})});return s.observe(t),()=>{cancelAnimationFrame(e),s.unobserve(t)}}},[]),t.createElement(A.div,{ref:M(n,r),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":c,"aria-label":a,id:o.listId},qe(e,e=>t.createElement("div",{ref:M(i,o.listInnerRef),"cmdk-list-sizer":""},e)))}),Se=t.forwardRef((e,r)=>{let{open:s,onOpenChange:a,overlayClassName:l,contentClassName:n,container:i,...c}=e;return t.createElement(L,{open:s,onOpenChange:a},t.createElement(P,{container:i},t.createElement(F,{"cmdk-overlay":"",className:l}),t.createElement(O,{"aria-label":e.label,"cmdk-dialog":"",className:n},t.createElement(be,{ref:r,...c}))))}),Ce=t.forwardRef((e,r)=>Oe(e=>0===e.filtered.count)?t.createElement(A.div,{ref:r,...e,"cmdk-empty":"",role:"presentation"}):null),Ee=t.forwardRef((e,r)=>{let{progress:s,children:a,label:l="Loading...",...n}=e;return t.createElement(A.div,{ref:r,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},qe(e,e=>t.createElement("div",{"aria-hidden":!0},e)))}),Ie=Object.assign(be,{List:ke,Item:we,Input:Ne,Group:ye,Separator:je,Dialog:Se,Empty:Ce,Loading:Ee});function Re(e,t){let r=e.nextElementSibling;for(;r;){if(r.matches(t))return r;r=r.nextElementSibling}}function Ae(e,t){let r=e.previousElementSibling;for(;r;){if(r.matches(t))return r;r=r.previousElementSibling}}function Le(e){let r=t.useRef(e);return Pe(()=>{r.current=e}),r}var Pe="undefined"==typeof window?t.useEffect:t.useLayoutEffect;function Fe(e){let r=t.useRef();return void 0===r.current&&(r.current=e()),r}function Oe(e){let r=xe(),s=()=>e(r.snapshot());return t.useSyncExternalStore(r.subscribe,s,s)}function Me(e,r,s,a=[]){let l=t.useRef(),n=pe();return Pe(()=>{var t;let i=(()=>{var e;for(let t of s){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():l.current}})(),c=a.map(e=>e.trim());n.value(e,i,c),null==(t=r.current)||t.setAttribute(me,i),l.current=i}),l}var De=()=>{let[e,r]=t.useState(),s=Fe(()=>new Map);return Pe(()=>{s.current.forEach(e=>e()),s.current=new Map},[e]),(e,t)=>{s.current.set(e,t),r({})}};function qe({asChild:e,children:r},s){return e&&t.isValidElement(r)?t.cloneElement(function(e){let t=e.type;return"function"==typeof t?t(e.props):"render"in t?t.render(e.props):e}(r),{ref:r.ref},s(r.props.children)):s(r)}var _e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ve=t.forwardRef(({className:t,...r},s)=>e.jsx(Ie,{ref:s,className:n("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...r}));Ve.displayName=Ie.displayName;const Be=t.forwardRef(({className:t,...r},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(D,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Ie.Input,{ref:s,className:n("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...r})]}));Be.displayName=Ie.Input.displayName;const Ke=t.forwardRef(({className:t,...r},s)=>e.jsx(Ie.List,{ref:s,className:n("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...r}));Ke.displayName=Ie.List.displayName;const Ge=t.forwardRef((t,r)=>e.jsx(Ie.Empty,{ref:r,className:"py-6 text-center text-sm",...t}));Ge.displayName=Ie.Empty.displayName;const Te=t.forwardRef(({className:t,...r},s)=>e.jsx(Ie.Group,{ref:s,className:n("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...r}));Te.displayName=Ie.Group.displayName,t.forwardRef(({className:t,...r},s)=>e.jsx(Ie.Separator,{ref:s,className:n("-mx-1 h-px bg-border",t),...r})).displayName=Ie.Separator.displayName;const Ue=t.forwardRef(({className:t,...r},s)=>e.jsx(Ie.Item,{ref:s,className:n("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...r}));Ue.displayName=Ie.Item.displayName;const ze="recent_searches",$e=({onSearch:s,placeholder:a="Search destinations, experiences, services...",className:l=""})=>{const[n,u]=t.useState(""),[m,h]=t.useState([]),[f,p]=t.useState([]),[g,x]=t.useState(!1),[v,N]=t.useState(!1),k=r(),S=t.useRef(null);t.useEffect(()=>{C()},[]),t.useEffect(()=>{n.trim().length>2?R(n):h([])},[n]);const C=()=>{try{const e=localStorage.getItem(ze);e&&p(JSON.parse(e))}catch(e){}},E=e=>{if(e.trim())try{const t=[...f],r=t.indexOf(e);r>-1&&t.splice(r,1),t.unshift(e);const s=t.slice(0,5);p(s),localStorage.setItem(ze,JSON.stringify(s))}catch(t){}},R=(()=>{let e;return t=>{clearTimeout(e),e=setTimeout(async()=>{await A(t)},300)}})(),A=async e=>{if(e.trim()){N(!0);try{const t=await(async(e={})=>{try{let t=b(w(i,"listing"));t=e.status?b(t,y("status","==",e.status)):b(t,y("status","==","approved")),e.category&&"all"!==e.category&&(t=b(t,y("category","==",e.category)));let r=(await j(t)).docs.map(e=>({id:e.id,...e.data()}));if(e.location){const t=e.location.toLowerCase();r=r.filter(e=>e.location.toLowerCase().includes(t))}if(void 0!==e.minPrice&&(r=r.filter(t=>t.price>=e.minPrice)),void 0!==e.maxPrice&&(r=r.filter(t=>t.price<=e.maxPrice)),void 0!==e.maxGuests&&(r=r.filter(t=>t.maxGuests>=e.maxGuests)),void 0!==e.minRating&&(r=r.filter(t=>(t.averageRating||0)>=e.minRating)),e.query){const t=e.query.toLowerCase();r=r.filter(e=>{const r=e.title.toLowerCase().includes(t),s=e.location.toLowerCase().includes(t),a=e.description.toLowerCase().includes(t),l=e.category.toLowerCase().includes(t);return r||s||a||l}),r.sort((e,r)=>{const s=(e.title.toLowerCase().includes(t)?3:0)+(e.location.toLowerCase().includes(t)?2:0)+(e.description.toLowerCase().includes(t)?1:0);return(r.title.toLowerCase().includes(t)?3:0)+(r.location.toLowerCase().includes(t)?2:0)+(r.description.toLowerCase().includes(t)?1:0)-s})}else switch(e.sortBy){case"price_asc":r.sort((e,t)=>e.price-t.price);break;case"price_desc":r.sort((e,t)=>t.price-e.price);break;case"rating_desc":r.sort((e,t)=>{const r=e.averageRating||0;return(t.averageRating||0)-r});break;case"oldest":r.sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime());break;default:r.sort((e,t)=>{const r=new Date(e.createdAt).getTime();return new Date(t.createdAt).getTime()-r})}const s=r.length,a=e.limit||50,l=s>a;return{listings:r.slice(0,a),total:s,hasMore:l}}catch(t){throw t}})({query:e,status:"approved",limit:5});h(t.listings)}catch(t){c.error("Failed to load suggestions")}finally{N(!1)}}else h([])},L=e=>{e.preventDefault(),n.trim()&&(E(n),s&&s(n),k("/guest/browse"),x(!1))};return e.jsxs("form",{onSubmit:L,className:"relative flex gap-2 "+l,children:[e.jsxs(B,{open:g,onOpenChange:x,children:[e.jsx(K,{asChild:!0,children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none z-10"}),e.jsx(I,{ref:S,type:"search",placeholder:a,value:n,onChange:e=>u(e.target.value),onFocus:()=>x(!0),className:"pl-10 h-12 w-full",autoComplete:"off"})]})}),e.jsx(G,{className:"w-[var(--radix-popover-trigger-width)] p-0",align:"start",children:e.jsxs(Ve,{shouldFilter:!1,children:[e.jsx(Be,{placeholder:"Search...",value:n,onValueChange:u}),e.jsxs(Ke,{children:[v&&e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Searching..."}),!v&&0===m.length&&n.trim().length>2&&e.jsx(Ge,{children:"No results found."}),!v&&m.length>0&&e.jsx(Te,{heading:"Suggestions",children:m.map(t=>e.jsx(Ue,{value:t.id,onSelect:()=>(e=>{E(n),k("/guest/listing/"+e.id),x(!1),u("")})(t),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx("img",{src:t.images?.[0]||"/placeholder.svg",alt:t.title,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.location}),e.jsxs("p",{className:"text-xs font-semibold text-primary mt-1",children:[o(t.price),"/night"]})]})]})},t.id))}),!v&&f.length>0&&0===n.trim().length&&e.jsxs(Te,{heading:"Recent Searches",children:[f.map((t,r)=>e.jsx(Ue,{value:t,onSelect:()=>{return u(e=t),E(e),s&&s(e),k("/guest/browse"),void x(!1);var e},className:"cursor-pointer group",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:t})]}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.stopPropagation(),(e=>{const t=f.filter(t=>t!==e);p(t),localStorage.setItem(ze,JSON.stringify(t))})(t)},children:e.jsx(_,{className:"h-3 w-3"})})]})},r)),e.jsx(Ue,{value:"clear-all",onSelect:()=>{p([]),localStorage.removeItem(ze),c.success("Recent searches cleared")},className:"cursor-pointer text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(_,{className:"h-3 w-3"}),"Clear all recent searches"]})})]}),!v&&n.trim().length>0&&e.jsx(Te,{children:e.jsx(Ue,{value:"search-all",onSelect:L,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs("span",{children:['Search for "',n,'"']})]})})})]})]})})]}),e.jsxs(d,{type:"submit",className:"h-12 px-6",children:[e.jsx(D,{className:"h-4 w-4 mr-2 sm:mr-0 sm:inline"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]})]})},He=({onFilterChange:r,initialFilters:s})=>{const[n,i]=t.useState(s||{location:"",guests:1,category:"all"}),[c,o]=t.useState(!1);return t.useEffect(()=>{s&&i(s)},[s]),e.jsxs(a,{children:[e.jsx(u,{className:"px-3 sm:px-4 md:px-6 pt-3 sm:pt-4 md:pt-6 pb-2 sm:pb-3 md:pb-4",children:e.jsxs(m,{className:"flex items-center gap-2 text-sm sm:text-base md:text-lg",children:[e.jsx(V,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Search Filters"]})}),e.jsxs(l,{className:"space-y-3 sm:space-y-4 px-3 sm:px-4 md:px-6 pb-3 sm:pb-4 md:pb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"location",className:"text-sm sm:text-base",children:"Where"}),e.jsx(I,{id:"location",placeholder:"Location",value:n.location,onChange:e=>i({...n,location:e.target.value}),className:"h-11 sm:h-10 md:h-auto text-base sm:text-sm mt-1"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(U,{className:"text-sm sm:text-base",children:"Check-in & Check-out"}),e.jsx(T,{value:n.dateRange||(n.checkIn||n.checkOut?{from:n.checkIn,to:n.checkOut}:void 0),onChange:e=>{const t={...n,dateRange:e,checkIn:e?.from,checkOut:e?.to};i(t)},placeholder:"Select check-in and check-out dates",className:"h-11 sm:h-10 md:h-auto text-base sm:text-sm mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"guests",className:"text-sm sm:text-base",children:"Guests"}),e.jsx(I,{id:"guests",type:"number",min:"1",value:n.guests,onChange:e=>i({...n,guests:+e.target.value}),className:"h-11 sm:h-10 md:h-auto text-base sm:text-sm mt-1"})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"category",className:"text-sm sm:text-base",children:"Category"}),e.jsxs(z,{value:n.category,onValueChange:e=>i({...n,category:e}),children:[e.jsx($,{className:"h-11 sm:h-10 md:h-auto text-base sm:text-sm mt-1 touch-manipulation",children:e.jsx(H,{})}),e.jsxs(J,{children:[e.jsx(W,{value:"all",children:"All Categories"}),e.jsx(W,{value:"home",children:"Homes"}),e.jsx(W,{value:"experience",children:"Experiences"}),e.jsx(W,{value:"service",children:"Services"})]})]})]})]}),e.jsxs(d,{variant:"ghost",onClick:()=>o(!c),className:"w-full h-11 sm:h-auto text-sm sm:text-base touch-manipulation",children:[c?"Hide":"Show"," Advanced Filters"]}),c&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 pt-3 sm:pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"minPrice",className:"text-sm sm:text-base",children:"Min Price (₱)"}),e.jsx(I,{id:"minPrice",type:"number",min:"0",value:n.minPrice||"",onChange:e=>i({...n,minPrice:+e.target.value}),placeholder:"0",className:"h-11 sm:h-10 md:h-auto text-base sm:text-sm mt-1"})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"maxPrice",className:"text-sm sm:text-base",children:"Max Price (₱)"}),e.jsx(I,{id:"maxPrice",type:"number",min:"0",value:n.maxPrice||"",onChange:e=>i({...n,maxPrice:+e.target.value}),placeholder:"No limit",className:"h-11 sm:h-10 md:h-auto text-base sm:text-sm mt-1"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsx(d,{onClick:()=>{r(n)},className:"flex-1 h-11 sm:h-auto text-sm sm:text-base touch-manipulation",children:"Apply Filters"}),e.jsx(d,{onClick:()=>{const e={location:"",guests:1,category:"all",checkIn:void 0,checkOut:void 0,dateRange:void 0,minPrice:void 0,maxPrice:void 0};i(e),r(e)},variant:"outline",className:"h-11 sm:h-auto text-sm sm:text-base touch-manipulation",children:"Reset"})]})]})]})},Je=()=>{const n=r(),o=s(),{user:u}=h(),[m,b]=t.useState([]),[w,y]=t.useState([]),[j,C]=t.useState([]),[I,R]=t.useState(!0),[A,L]=t.useState(""),[P,F]=t.useState([]),[O,M]=t.useState(!1),[q,_]=t.useState({location:"",guests:1,category:(()=>{const e=new URLSearchParams(o.search).get("category");return e&&["home","experience","service"].includes(e)?e:"all"})()});t.useEffect(()=>{V(),u&&(B(),K())},[u,q.category]),t.useEffect(()=>{q.checkIn&&q.checkOut?G():F([])},[q.checkIn,q.checkOut]),t.useEffect(()=>{const e=new URLSearchParams(o.search),t=e.get("q"),r=e.get("category");if(t&&L(t),r&&["home","experience","service"].includes(r)){const e=r;_(t=>t.category!==e?{...t,category:e}:t)}else r||_(e=>"all"!==e.category?{...e,category:"all"}:e)},[o.search]);const V=async()=>{try{const e="all"!==q.category?{category:q.category,status:"approved"}:{status:"approved"},t=await f(e);if(t.length>0){const e=t.map(e=>e.id),r=await p(e),s=t.map(e=>{const t=r.get(e.id);return{...e,averageRating:t?.averageRating||0,reviewCount:t?.reviewCount||0}});b(s)}else b(t)}catch(e){c.error("Failed to load listings")}finally{R(!1)}},B=async()=>{if(!u)return;const e=await N(k(i,"users",u.uid));e.exists()&&y(e.data().favorites||[])},K=async()=>{if(!u)return;const e=await N(k(i,"users",u.uid));e.exists()&&C(e.data().wishlist||[])},G=async()=>{if(q.checkIn&&q.checkOut){M(!0);try{const e=await g({status:"confirmed"});F(e)}catch(e){F([])}finally{M(!1)}}else F([])},T=t.useCallback(async e=>{if(!u)return void c.error("Please login to add favorites");const t=w.includes(e)?w.filter(t=>t!==e):[...w,e];y(t);try{const t=await x(u.uid,e,w);y(t),c.success(t.includes(e)?"Added to favorites":"Removed from favorites")}catch(r){y(w),c.error("Failed to update favorites")}},[u,w]);t.useCallback(async e=>{if(!u)return void c.error("Please login to add to wishlist");const t=j.includes(e)?j.filter(t=>t!==e):[...j,e];C(t);try{const t=await v(u.uid,e,j);C(t),c.success(t.includes(e)?"Added to wishlist":"Removed from wishlist")}catch(r){C(j),c.error("Failed to update wishlist")}},[u,j]);const U=t.useMemo(()=>m.filter(e=>{if(A.trim()){const t=A.toLowerCase(),r=e.title.toLowerCase().includes(t),s=e.location.toLowerCase().includes(t),a=e.description.toLowerCase().includes(t),l=e.category.toLowerCase().includes(t);if(!(r||s||a||l))return!1}if(q.location&&!e.location.toLowerCase().includes(q.location.toLowerCase()))return!1;if(q.guests>e.maxGuests)return!1;if(q.minPrice&&e.price<q.minPrice)return!1;if(q.maxPrice&&e.price>q.maxPrice)return!1;if(q.checkIn&&q.checkOut){const t=P.filter(t=>t.listingId===e.id);if(!X(e,q.checkIn,q.checkOut,t))return!1}return!0}),[m,A,q,P]);return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-3 sm:py-4 md:py-6 lg:py-8",children:[e.jsx(Z,{to:"/guest/dashboard",className:"mb-3 sm:mb-4 md:mb-6"}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-3 sm:mb-4 md:mb-6",children:"Browse Listings"}),e.jsx(a,{className:"mb-4 sm:mb-5 md:mb-6 shadow-md",children:e.jsx(l,{className:"pt-4 sm:pt-5 md:pt-6 px-3 sm:px-4 md:px-6",children:e.jsx($e,{onSearch:e=>{L(e),n("/guest/browse?q="+encodeURIComponent(e))},placeholder:"Search destinations, experiences, services..."})})}),e.jsx("div",{className:"mb-3 sm:mb-4 md:mb-6 flex flex-wrap gap-2",children:["all","home","experience","service"].map(t=>e.jsx("button",{className:"px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium border-2 transition-all touch-manipulation min-h-[36px] sm:min-h-[40px] "+(q.category===t?"bg-primary text-primary-foreground border-primary shadow-md":"bg-background border-border text-foreground hover:bg-muted hover:border-primary/50 active:bg-muted"),onClick:()=>_({...q,category:t}),children:"all"===t?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(He,{onFilterChange:e=>{_(e)},initialFilters:q})}),I||O?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:[...[,,,,,,,,]].map((t,r)=>e.jsx(Q,{},r))}):0===U.length?e.jsx(E,{icon:e.jsx(D,{className:"h-10 w-10"}),title:"No listings found",description:q.checkIn&&q.checkOut?"No listings available for the selected dates. Try adjusting your date range or other filters.":"Try adjusting your filters or browse a different category to find what you're looking for.",action:e.jsx(d,{onClick:()=>_({...q,category:"all",location:"",guests:1,checkIn:void 0,checkOut:void 0}),className:"h-11",children:"Clear Filters"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 items-stretch",children:U.map(t=>e.jsx(S,{listing:t,onView:()=>n("/guest/listing/"+t.id),onFavorite:()=>T(t.id),isFavorite:w.includes(t.id)},t.id))})]})})};export{Je as default};
