import{u as e,r as s,j as t}from"./react-vendor-BMVo5gto.js";import{u as a,h as r,D as i,e as n,v as d,B as c,C as l,a as o,b as m,d as x,i as h,c as u,j}from"./index-BbQqfVom.js";import{f as g,e as p}from"./firebase-vendor-BtzXZj7S.js";import{B as f}from"./badge-0vFpitRp.js";import{D as N,a as y,b,c as v,d as w}from"./dialog-COz4G8V2.js";import{T as k,a as E,b as S,c as A,d as D,e as I}from"./table-BW8SbDAe.js";import{A as F,j as T,r as B,s as L,m as P,L as C,C as M}from"./icons-vendor-D1YpcxsO.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-Dbp4DHG_.js";const O=()=>{const O=e(),{user:U,userRole:Y}=a(),[G,R]=s.useState(!0),[H,V]=s.useState({totalEarnings:0,pendingEarnings:0,completedEarnings:0,serviceFees:0}),[_,q]=s.useState([]),[z,J]=s.useState([]),[K,Q]=s.useState(!1),[W,X]=s.useState([]),[Z,$]=s.useState(!1);s.useEffect(()=>{U&&"host"===Y?ee():O("/host/login")},[U,Y,O]);const ee=async()=>{if(U){R(!0);try{const e=await r({hostId:U.uid});q(e);const s=e.filter(e=>"confirmed"===e.status||"completed"===e.status),t=e.filter(e=>"pending"===e.status),a=s.reduce((e,s)=>e+(s.totalPrice||0),0),n=t.reduce((e,s)=>e+(s.totalPrice||0),0),d=.1*a;V({totalEarnings:a,pendingEarnings:n,completedEarnings:a-d,serviceFees:d});const c=await i(U.uid);J(c)}catch(e){n.error("Failed to load payments: "+(e.message||"Unknown error"))}finally{R(!1)}}};return G?t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsx(d,{})})}):t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(c,{variant:"ghost",onClick:()=>O("/host/dashboard"),children:[t.jsx(F,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Payments & Earnings"}),t.jsx("p",{className:"text-muted-foreground",children:"View your earnings and payment history"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[t.jsxs(l,{children:[t.jsx(o,{className:"pb-3",children:t.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Total Earnings"})}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold text-primary",children:h(H.totalEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"From all confirmed bookings"})]})]}),t.jsxs(l,{children:[t.jsx(o,{className:"pb-3",children:t.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Your Earnings"})}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:h(H.completedEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"After 10% service fee"})]})]}),t.jsxs(l,{children:[t.jsx(o,{className:"pb-3",children:t.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Pending Earnings"})}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:h(H.pendingEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting confirmation"})]})]}),t.jsxs(l,{className:"cursor-pointer hover:shadow-medium transition-shadow",onClick:async()=>{if(U){Q(!0),$(!0);try{const e=(await r({hostId:U.uid})).filter(e=>"confirmed"===e.status||"completed"===e.status),s=await Promise.all(e.map(async e=>{const s=.1*(e.totalPrice||0),t={id:e.id,userId:U.uid,type:"payment",amount:s,description:"Service fee from booking #"+e.id.slice(0,8),status:"completed",paymentMethod:"service_fee",bookingId:e.id,createdAt:e.createdAt||(new Date).toISOString()};if(e.listingId)try{const s=await g(p(j,"listing",e.listingId));if(s.exists()){const e=s.data();t.listingTitle=e.title||"N/A"}}catch(a){}if(e.guestId)try{const s=await g(p(j,"users",e.guestId));if(s.exists()){const e=s.data();t.guestName=e.fullName||"N/A",t.guestEmail=e.email||"N/A"}}catch(a){}return t}));s.sort((e,s)=>{const t=new Date(e.createdAt||0).getTime();return new Date(s.createdAt||0).getTime()-t}),X(s)}catch(e){n.error("Failed to load service fee breakdown: "+(e.message||"Unknown error"))}finally{$(!1)}}},children:[t.jsx(o,{className:"pb-3",children:t.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Service Fees"})}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold text-accent",children:h(H.serviceFees)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"10% commission â€¢ Click to view breakdown"})]})]})]}),t.jsxs(l,{className:"mb-8",children:[t.jsxs(o,{children:[t.jsx(m,{children:"Recent Bookings"}),t.jsx(u,{children:"Your recent booking payments"})]}),t.jsx(x,{children:0===_.length?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No bookings yet"})]}):t.jsx("div",{className:"space-y-4",children:_.slice(0,5).map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:t.jsx(T,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Booking #",e.id.slice(0,8)]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(e.checkIn).toLocaleDateString()," - ",new Date(e.checkOut).toLocaleDateString()]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.guests," guest",e.guests>1?"s":""]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-lg font-bold",children:h(e.totalPrice||0)}),t.jsx(f,{className:"confirmed"===e.status||"completed"===e.status?"bg-green-500":"pending"===e.status?"bg-yellow-500":"bg-red-500",children:e.status})]})]},e.id))})})]}),t.jsxs(l,{children:[t.jsxs(o,{children:[t.jsx(m,{children:"Transaction History"}),t.jsx(u,{children:"Your payment and withdrawal history"})]}),t.jsx(x,{children:0===z.length?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(B,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No transactions yet"})]}):t.jsx("div",{className:"space-y-4",children:z.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center "+("deposit"===e.type||"reward"===e.type?"bg-green-500/10":"bg-red-500/10"),children:"deposit"===e.type||"reward"===e.type?t.jsx(L,{className:"h-6 w-6 text-green-500"}):t.jsx(L,{className:"h-6 w-6 text-red-500 rotate-180"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.description}),t.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),e.paymentMethod&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Method: ",e.paymentMethod]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"text-lg font-bold "+("deposit"===e.type||"reward"===e.type?"text-green-500":"text-red-500"),children:["deposit"===e.type||"reward"===e.type?"+":"-",h(e.amount)]}),e.status&&t.jsx(f,{className:"completed"===e.status?"bg-green-500":"pending"===e.status?"bg-yellow-500":"failed"===e.status?"bg-red-500":"bg-gray-500",children:e.status})]})]},e.id))})})]}),t.jsx(N,{open:K,onOpenChange:Q,children:t.jsxs(y,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(b,{children:[t.jsxs(v,{className:"flex items-center gap-2",children:[t.jsx(P,{className:"h-5 w-5"}),"Service Fee Breakdown"]}),t.jsx(w,{children:"Detailed breakdown of service fees deducted from your earnings (10% commission)"})]}),Z?t.jsxs("div",{className:"flex items-center justify-center py-12",children:[t.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("p",{className:"ml-3 text-muted-foreground",children:"Loading breakdown..."})]}):0===W.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(M,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50"}),t.jsx("p",{className:"text-muted-foreground",children:"No service fees yet"})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx(l,{children:t.jsx(x,{className:"pt-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Service Fees"}),t.jsx("p",{className:"text-2xl font-bold text-accent",children:h(W.reduce((e,s)=>e+(s.amount||0),0))})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bookings"}),t.jsx("p",{className:"text-2xl font-bold",children:W.length})]})]})})}),t.jsx("div",{className:"border rounded-lg",children:t.jsxs(k,{children:[t.jsx(E,{children:t.jsxs(S,{children:[t.jsx(A,{children:"Date"}),t.jsx(A,{children:"Booking ID"}),t.jsx(A,{children:"Listing"}),t.jsx(A,{children:"Guest Name"}),t.jsx(A,{children:"Guest Email"}),t.jsx(A,{className:"text-right",children:"Service Fee"})]})}),t.jsx(D,{children:W.map(e=>t.jsxs(S,{children:[t.jsx(I,{children:e.createdAt?new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}),t.jsx(I,{children:t.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:e.bookingId?.slice(0,8)||"N/A"})}),t.jsx(I,{className:"max-w-[200px] truncate",children:e.listingTitle||"N/A"}),t.jsx(I,{children:e.guestName||"N/A"}),t.jsx(I,{children:e.guestEmail?t.jsx("a",{href:"mailto:"+e.guestEmail,className:"text-primary hover:underline",children:e.guestEmail}):"N/A"}),t.jsx(I,{className:"text-right font-semibold text-accent",children:h(e.amount||0)})]},e.id))})]})})]})]})})]})})};export{O as default};
