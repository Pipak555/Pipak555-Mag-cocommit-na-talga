const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-BbvEjZj9.js","assets/js/react-vendor-DAkY0NgE.js","assets/js/maps-vendor-CYGXCXz5.js","assets/maps-vendor-Dgihpmma.css","assets/js/utils-vendor-yBsXXcRr.js","assets/js/ui-vendor-CZx_xpmK.js","assets/js/icons-vendor-3zhgXMYa.js","assets/js/firebase-vendor-CvoiOdvz.js","assets/index-CLiUbsBH.css"])))=>i.map(i=>d[i]);
import{u as e,j as s,_ as i,h as t,x as a,B as n,C as l,a as r,b as o,c,d,i as m,e as h,r as x,t as u,A as j}from"./index-BbvEjZj9.js";import{u as g,l as p,r as f,j as v}from"./react-vendor-DAkY0NgE.js";import{f as b,e as y,u as w}from"./firebase-vendor-CvoiOdvz.js";import{I as k}from"./input-C1fDyqub.js";import{T as N,a as C,b as S,c as A}from"./tabs-yUgLCPKD.js";import{L as F}from"./label-kBNwlYyC.js";import{B as R}from"./badge-Bdu_tSqo.js";import{S as B}from"./switch-DOtUuwxM.js";import{L as P}from"./ListingCard-YDL4intN.js";import{E as L}from"./empty-state-R01VkqBd.js";import{p as D}from"./paymentService-HK3toL-K.js";import{A as I,a as E,b as O,c as M,d as U,e as _,f as T,g as W}from"./alert-dialog-D9Kc0D1X.js";import{A as V,n as z,p as G,Z as Y,i as K,s as J,S as Q,X as Z,M as $,a3 as q}from"./icons-vendor-3zhgXMYa.js";import"./ui-vendor-CZx_xpmK.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";const H=()=>{const H=g(),[X]=p(),{user:ee,userRole:se,refreshUserProfile:ie,signOut:te,hasRole:ae}=e(),[ne,le]=f.useState(null),[re,oe]=f.useState(!1),[ce,de]=f.useState([]),[me,he]=f.useState([]),[xe,ue]=f.useState([]),[je,ge]=f.useState([]),[pe,fe]=f.useState([]),[ve,be]=f.useState(X.get("tab")||"profile"),[ye,we]=f.useState(!1),[ke,Ne]=f.useState(!1),[Ce,Se]=f.useState(null),[Ae,Fe]=f.useState(!1),[Re,Be]=f.useState({email:{bookingConfirmations:!0,bookingCancellations:!0,bookingReminders:!0,newMessages:!0,paymentUpdates:!0,promotionalOffers:!0},inApp:{bookingUpdates:!0,newMessages:!0,paymentNotifications:!0,systemAlerts:!0}});f.useEffect(()=>{!ee||ae("guest")?ee&&Pe():H("/guest/login")},[ee,se,H]),f.useEffect(()=>{const e=X.get("tab");e&&be(e)},[X]),f.useEffect(()=>{ee&&ne&&"guest"===se&&(Le(),De(),Ie(),ne.notifications&&Be(ne.notifications))},[ee,ne,se]);const Pe=async()=>{if(ee)try{const e=await b(y(s,"users",ee.uid));if(e.exists()){const s=e.data();le(s),ge(s.favorites||[]),fe(s.wishlist||[])}}catch(e){}},Le=async()=>{if(ee&&ne?.favorites?.length)try{const{getListing:e}=await i(async()=>{const{getListing:e}=await import("./index-BbvEjZj9.js").then(e=>e.R);return{getListing:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await Promise.all(ne.favorites.map(s=>e(s)));de(s.filter(e=>null!==e))}catch(e){de([])}else de([])},De=async()=>{if(ee&&ne?.wishlist?.length)try{const{getListing:e}=await i(async()=>{const{getListing:e}=await import("./index-BbvEjZj9.js").then(e=>e.R);return{getListing:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),s=await Promise.all(ne.wishlist.map(s=>e(s)));he(s.filter(e=>null!==e))}catch(e){he([])}else he([])},Ie=async()=>{if(ee)try{const e=await t({guestId:ee.uid});ue(e)}catch(e){}},Ee=async e=>{if(ee)try{const s=await u(ee.uid,e,je);ge(s),le(e=>e?{...e,favorites:s}:null),Le(),h.success(s.includes(e)?"Added to favorites":"Removed from favorites")}catch(s){h.error("Failed to update favorites")}else h.error("Please login to manage favorites")},Oe=async e=>{if(ee)try{const s=await x(ee.uid,e,pe);fe(s),le(e=>e?{...e,wishlist:s}:null),De(),h.success(s.includes(e)?"Added to wishlist":"Removed from wishlist")}catch(s){h.error("Failed to update wishlist")}else h.error("Please login to manage wishlist")};return ne?v.jsxs("div",{className:"min-h-screen bg-background",children:[v.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8 max-w-4xl",children:[v.jsxs("div",{className:"flex items-center justify-between mb-6",children:[v.jsxs(n,{variant:"ghost",onClick:()=>{H("/guest/dashboard")},children:[v.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),v.jsx(n,{variant:"outline",onClick:()=>we(!0),children:"Sign Out"})]}),v.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Account Settings"}),v.jsxs(N,{value:ve,onValueChange:be,className:"space-y-6",children:[v.jsxs(C,{className:"grid w-full grid-cols-6",children:[v.jsxs(S,{value:"profile",children:[v.jsx(z,{className:"h-4 w-4 mr-2"}),"Profile"]}),v.jsxs(S,{value:"favorites",children:[v.jsx(G,{className:"h-4 w-4 mr-2"}),"Favorites"]}),v.jsxs(S,{value:"wishlist",children:[v.jsx(Y,{className:"h-4 w-4 mr-2"}),"Wishlist"]}),v.jsxs(S,{value:"bookings",children:[v.jsx(K,{className:"h-4 w-4 mr-2"}),"Bookings"]}),v.jsxs(S,{value:"notifications",children:[v.jsx(J,{className:"h-4 w-4 mr-2"}),"Notifications"]}),v.jsxs(S,{value:"security",children:[v.jsx(Q,{className:"h-4 w-4 mr-2"}),"Security"]})]}),v.jsx(A,{value:"profile",children:v.jsxs(l,{children:[v.jsxs(r,{children:[v.jsx(o,{children:"Profile Information"}),v.jsx(c,{children:"Update your account details"})]}),v.jsxs(d,{className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"fullName",children:"Full Name"}),v.jsx(k,{id:"fullName",type:"text",value:ne.fullName,onChange:e=>le({...ne,fullName:e.target.value}),placeholder:"Enter your full name"})]}),v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email",children:"Email"}),v.jsx(k,{id:"email",type:"email",value:ne.email,disabled:!0})]}),v.jsxs("div",{children:[v.jsx(F,{htmlFor:"role",children:"Role"}),v.jsx(k,{id:"role",value:ne.role,disabled:!0})]}),v.jsxs("div",{children:[v.jsx(F,{htmlFor:"points",children:"Reward Points"}),v.jsx(k,{id:"points",value:ne.points,disabled:!0})]}),v.jsxs("div",{children:[v.jsx(F,{htmlFor:"balance",children:"Wallet Balance"}),v.jsx(k,{id:"balance",value:m(ne.walletBalance),disabled:!0})]}),v.jsx(n,{onClick:async()=>{if(ee&&ne){oe(!0);try{await w(y(s,"users",ee.uid),{fullName:ne.fullName}),await Pe(),await ie(),h.success("Profile updated successfully!")}catch(e){h.error("Failed to update profile")}finally{oe(!1)}}},disabled:re,children:re?"Saving...":"Save Changes"})]})]})}),v.jsx(A,{value:"favorites",children:v.jsxs(l,{children:[v.jsxs(r,{children:[v.jsx(o,{children:"Your Favorites"}),v.jsx(c,{children:"Listings you've liked and saved"})]}),v.jsx(d,{children:0===ce.length?v.jsx(L,{icon:v.jsx(G,{className:"h-10 w-10"}),title:"No favorites yet",description:"Start exploring and add listings to your favorites!",action:v.jsx(n,{onClick:()=>H("/guest/browse"),children:"Browse Listings"})}):v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:ce.map(e=>v.jsx(P,{listing:e,onView:()=>H("/guest/listing/"+e.id),onFavorite:()=>Ee(e.id),onWishlist:()=>Oe(e.id),isFavorite:je.includes(e.id),isInWishlist:pe.includes(e.id)},e.id))})})]})}),v.jsx(A,{value:"wishlist",children:v.jsxs(l,{children:[v.jsxs(r,{children:[v.jsx(o,{children:"Your Wishlist"}),v.jsx(c,{children:"Listings you're planning to book in the future"})]}),v.jsx(d,{children:0===me.length?v.jsx(L,{icon:v.jsx(Y,{className:"h-10 w-10"}),title:"No wishlist items yet",description:"Add listings to your wishlist for future trips!",action:v.jsx(n,{onClick:()=>H("/guest/browse"),children:"Browse Listings"})}):v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:me.map(e=>v.jsx(P,{listing:e,onView:()=>H("/guest/listing/"+e.id),onFavorite:()=>Ee(e.id),onWishlist:()=>Oe(e.id),isFavorite:je.includes(e.id),isInWishlist:pe.includes(e.id)},e.id))})})]})}),v.jsx(A,{value:"bookings",children:v.jsxs(l,{children:[v.jsxs(r,{children:[v.jsx(o,{children:"My Bookings"}),v.jsx(c,{children:"View your booking history"})]}),v.jsx(d,{children:0===xe.length?v.jsx(L,{icon:v.jsx(K,{className:"h-10 w-10"}),title:"No bookings yet",description:"Start exploring amazing places to stay!",action:v.jsx(n,{onClick:()=>H("/guest/browse"),children:"Browse Listings"})}):v.jsx("div",{className:"space-y-4",children:xe.map(e=>{const s=("pending"===e.status||"confirmed"===e.status)&&new Date(e.checkIn)>=new Date;return v.jsxs("div",{className:"p-4 border rounded-lg",children:[v.jsxs("div",{className:"flex items-center justify-between mb-2",children:[v.jsxs("div",{children:[v.jsxs("p",{className:"font-medium",children:["Booking #",e.id.slice(0,8)]}),v.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(e.checkIn).toLocaleDateString()," - ",new Date(e.checkOut).toLocaleDateString()]})]}),v.jsx(R,{children:e.status})]}),v.jsxs("div",{className:"flex items-center justify-between mt-2",children:[v.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.guests," guest",e.guests>1?"s":""]}),v.jsx("p",{className:"font-semibold",children:m(e.totalPrice||0)})]}),s&&v.jsx("div",{className:"pt-4 mt-4 border-t",children:v.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?h.error("Cannot cancel bookings with check-in dates in the past"):(Se(e),Ne(!0)):h.error("This booking cannot be cancelled"):h.error("Cannot cancel completed bookings"):h.error("This booking is already cancelled"):h.error("Invalid booking")})(e),className:"w-full",children:[v.jsx(Z,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]},e.id)})})})]})}),v.jsx(A,{value:"notifications",children:v.jsxs(l,{children:[v.jsxs(r,{children:[v.jsx(o,{children:"Notification Preferences"}),v.jsx(c,{children:"Manage how you receive updates"})]}),v.jsxs(d,{className:"space-y-6",children:[v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[v.jsx($,{className:"h-5 w-5 text-primary"}),v.jsx("h3",{className:"text-lg font-semibold",children:"Email Notifications"})]}),v.jsxs("div",{className:"space-y-3 pl-7",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email-booking-confirmations",children:"Booking Confirmations"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails when bookings are confirmed"})]}),v.jsx(B,{id:"email-booking-confirmations",checked:Re.email.bookingConfirmations,onCheckedChange:e=>Be(s=>({...s,email:{...s.email,bookingConfirmations:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email-booking-cancellations",children:"Booking Cancellations"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails when bookings are cancelled"})]}),v.jsx(B,{id:"email-booking-cancellations",checked:Re.email.bookingCancellations,onCheckedChange:e=>Be(s=>({...s,email:{...s.email,bookingCancellations:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email-booking-reminders",children:"Booking Reminders"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive reminders about upcoming bookings"})]}),v.jsx(B,{id:"email-booking-reminders",checked:Re.email.bookingReminders,onCheckedChange:e=>Be(s=>({...s,email:{...s.email,bookingReminders:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email-new-messages",children:"New Messages"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails for new messages"})]}),v.jsx(B,{id:"email-new-messages",checked:Re.email.newMessages,onCheckedChange:e=>Be(s=>({...s,email:{...s.email,newMessages:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email-payment-updates",children:"Payment Updates"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails about payment transactions"})]}),v.jsx(B,{id:"email-payment-updates",checked:Re.email.paymentUpdates,onCheckedChange:e=>Be(s=>({...s,email:{...s.email,paymentUpdates:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"email-promotional-offers",children:"Promotional Offers"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive promotional emails and special offers"})]}),v.jsx(B,{id:"email-promotional-offers",checked:Re.email.promotionalOffers,onCheckedChange:e=>Be(s=>({...s,email:{...s.email,promotionalOffers:e}}))})]})]})]}),v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[v.jsx(q,{className:"h-5 w-5 text-secondary"}),v.jsx("h3",{className:"text-lg font-semibold",children:"In-App Notifications"})]}),v.jsxs("div",{className:"space-y-3 pl-7",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"inapp-booking-updates",children:"Booking Updates"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about booking status changes"})]}),v.jsx(B,{id:"inapp-booking-updates",checked:Re.inApp.bookingUpdates,onCheckedChange:e=>Be(s=>({...s,inApp:{...s.inApp,bookingUpdates:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"inapp-new-messages",children:"New Messages"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about new messages"})]}),v.jsx(B,{id:"inapp-new-messages",checked:Re.inApp.newMessages,onCheckedChange:e=>Be(s=>({...s,inApp:{...s.inApp,newMessages:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"inapp-payment-notifications",children:"Payment Notifications"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about payment activities"})]}),v.jsx(B,{id:"inapp-payment-notifications",checked:Re.inApp.paymentNotifications,onCheckedChange:e=>Be(s=>({...s,inApp:{...s.inApp,paymentNotifications:e}}))})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx(F,{htmlFor:"inapp-system-alerts",children:"System Alerts"}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive important system notifications"})]}),v.jsx(B,{id:"inapp-system-alerts",checked:Re.inApp.systemAlerts,onCheckedChange:e=>Be(s=>({...s,inApp:{...s.inApp,systemAlerts:e}}))})]})]})]}),v.jsx("div",{className:"pt-4 border-t",children:v.jsx(n,{onClick:async()=>{if(ee){oe(!0);try{await w(y(s,"users",ee.uid),{notifications:Re}),await ie(),h.success("Notification preferences saved!")}catch(e){h.error("Failed to save notification preferences")}finally{oe(!1)}}},disabled:re,children:re?"Saving...":"Save Preferences"})})]})]})}),v.jsx(A,{value:"security",children:v.jsxs(l,{children:[v.jsxs(r,{children:[v.jsx(o,{children:"Security Settings"}),v.jsx(c,{children:"Manage your account security"})]}),v.jsx(d,{children:v.jsx("p",{className:"text-muted-foreground",children:"Security settings coming soon"})})]})})]})]}),v.jsx(I,{open:ke,onOpenChange:Ne,children:v.jsxs(E,{children:[v.jsxs(O,{children:[v.jsx(M,{children:"Cancel Booking"}),v.jsxs(U,{children:["Are you sure you want to cancel this booking?",Ce&&v.jsxs("div",{className:"mt-3 space-y-2",children:[v.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[v.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),v.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",v.jsx("span",{className:"font-medium capitalize",children:Ce.status})]}),v.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(Ce.checkIn).toLocaleDateString()]})]}),Ce.totalPrice>0&&v.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[v.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),v.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",m(Ce.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),v.jsxs(_,{children:[v.jsx(T,{disabled:Ae,children:"Keep Booking"}),v.jsx(W,{onClick:async()=>{if(!Ce||!ee)return void h.error("Invalid booking or user");if("cancelled"===Ce.status||"completed"===Ce.status)return h.error("This booking cannot be cancelled"),Ne(!1),void Se(null);const e=new Date(Ce.checkIn);if(new Date>e)return h.error("Cannot cancel bookings with check-in dates in the past"),Ne(!1),void Se(null);Fe(!0);try{if(await j(Ce.id,{status:"cancelled"}),"confirmed"===Ce.status||"pending"===Ce.status)try{const e=await D(Ce,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?m(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";h.success("Booking cancelled successfully. "+s)}}catch(s){h.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else h.success("Booking cancelled successfully.");Ne(!1),Se(null),Ie()}catch(i){const e=i.message||"Unknown error occurred";h.error("Failed to cancel booking: "+e)}finally{Fe(!1)}},disabled:Ae,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:Ae?"Cancelling...":"Cancel Booking"})]})]})}),v.jsx(I,{open:ye,onOpenChange:we,children:v.jsxs(E,{children:[v.jsxs(O,{children:[v.jsx(M,{children:"Sign Out"}),v.jsx(U,{children:"Are you sure you want to sign out? You'll need to sign in again to access your account."})]}),v.jsxs(_,{children:[v.jsx(T,{children:"Cancel"}),v.jsx(W,{onClick:async()=>{await te(),H("/")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sign Out"})]})]})})]}):v.jsx(a,{})};export{H as default};
