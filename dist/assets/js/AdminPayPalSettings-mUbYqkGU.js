import{l as e,u as a,r as s,j as t}from"./react-vendor-Ve3SFwKO.js";import{j as l,e as i,B as n,u as r,v as c,C as d,a as o,b as m,c as u,d as x}from"./index-DaMaslBo.js";import{h as p,f as y,u as h,x as f}from"./firebase-vendor-BC71bXmb.js";import{I as P}from"./input-D5hloL4G.js";import{L as g}from"./label-B2t2XnWQ.js";import{e as j,L as v,B as w,h as b,A as N,C as k}from"./icons-vendor-Dhca6XHc.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const S=({userId:r,onVerified:c,paypalEmail:d,paypalVerified:o})=>{const[m]=e(),u=a(),[x,P]=s.useState(!1),[g,N]=s.useState(!1),k=s.useCallback(async e=>{N(!0);try{const e=await p(y(l,"users",r)),a=e.exists()?e.data():null,s=a?.adminPayPalEmail||null,t={adminPayPalEmailVerified:!0,adminPayPalVerifiedAt:(new Date).toISOString(),adminPayPalOAuthVerified:!0};s&&(t.adminPayPalEmail=s),await h(y(l,"users",r),t),s?(await f(y(l,"adminSettings","paypal"),{paypalEmail:s,updatedAt:(new Date).toISOString()},{merge:!0}),i.success("Admin PayPal account verified! All payments will go to this account."),c(s)):(i.info("PayPal account verified! Please enter the email address of the PayPal account you just logged into."),c("")),u(window.location.pathname,{replace:!0})}catch(a){i.error("Failed to verify admin PayPal account. Please try again."),u(window.location.pathname,{replace:!0})}finally{N(!1)}},[r,u,c]);return s.useEffect(()=>{const e=m.get("code"),a=m.get("state");g||e&&a==="admin-paypal-verify-"+r&&k(e)},[m,r,u,k,g]),o&&d?t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-900 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(j,{className:"h-5 w-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Platform Payment Account Configured"}),t.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:"All platform revenue will be received at:"}),t.jsx("p",{className:"text-sm font-mono text-green-800 dark:text-green-200 mt-2 bg-green-100 dark:bg-green-900/50 p-2 rounded",children:d}),t.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-2",children:"✓ Subscription payments • ✓ Service fees (10% commission)"})]})]})})}):g?t.jsxs("div",{className:"p-6 text-center",children:[t.jsx(v,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),t.jsx("p",{className:"text-sm font-medium",children:"Verifying your PayPal account..."}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Please wait while we verify your credentials"})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"p-4 bg-primary/10 border border-primary/20 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(w,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium text-foreground mb-2",children:"Admin Payment Account Setup"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"This PayPal account will receive all platform revenue:"}),t.jsxs("ul",{className:"text-sm text-muted-foreground mt-2 space-y-1 list-disc list-inside",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Subscription Revenue:"})," Payments from hosts for subscriptions"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Service Fees:"})," 10% commission from all booking payments"]})]}),t.jsx("p",{className:"text-xs text-primary mt-3 font-medium bg-primary/10 p-2 rounded",children:"⚙️ Admin Only: Link any PayPal account (business or personal) where you want to receive platform revenue"})]})]})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"p-4 bg-muted rounded-lg border",children:[t.jsx("p",{className:"text-sm font-medium mb-2",children:"Setup Process:"}),t.jsxs("ol",{className:"text-xs text-muted-foreground space-y-1.5 list-decimal list-inside",children:[t.jsx("li",{children:'Click "Link PayPal Account" to start the verification process'}),t.jsx("li",{children:"You'll be redirected to PayPal's secure login page"}),t.jsx("li",{children:"Log in with the PayPal account where you want platform revenue to go"}),t.jsx("li",{children:"PayPal will verify your account and redirect you back"}),t.jsx("li",{children:"Enter the email address of the PayPal account you just logged into"}),t.jsx("li",{children:"All platform revenue will be received at that account ✅"})]})]}),t.jsx(n,{onClick:()=>{P(!0);const e="admin-paypal-verify-"+r,a=`https://www.sandbox.paypal.com/webapps/auth/protocol/openidconnect/v1/authorize?client_id=AV_tLDGMXIHhXnRCrDuX-Nb-2Wa-hEWjAkTj5ssXye5oTJeDZzTQqQym3UgFe-gOZDaQ1Fn-t8YPvfkx&response_type=code&scope=${encodeURIComponent("openid email profile")}&redirect_uri=${encodeURIComponent("https://mojo-dojo-casa-house-f31a5.web.app/paypal-callback")}&state=${e}`;window.location.href=a},disabled:x,className:"w-full",size:"lg",children:x?t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"h-4 w-4 mr-2 animate-spin"}),"Redirecting to PayPal..."]}):t.jsxs(t.Fragment,{children:[t.jsx(b,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})}),t.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Secure OAuth verification via PayPal. You'll choose which account to link during login."})]})]})},E=()=>{const e=a(),{user:j,userRole:v}=r(),[w,E]=s.useState(!0),[A,C]=s.useState({}),[V,F]=s.useState(""),[I,D]=s.useState(!1),[O,L]=s.useState(!1),[R,z]=s.useState("");s.useEffect(()=>{j&&"admin"===v?T():e("/admin/login")},[j,v,e]);const T=async()=>{try{E(!0);const e=await p(y(l,"adminSettings","paypal")),a=await p(y(l,"users",j.uid));let s={};if(e.exists())s=e.data();else if(a.exists()){const e=a.data();e.adminPayPalEmail&&(s={paypalEmail:e.adminPayPalEmail})}if(C(s),F(s.paypalEmail||""),a.exists()){const e=a.data();D(!!e.adminPayPalEmailVerified),e.adminPayPalEmail&&!s.paypalEmail&&(F(e.adminPayPalEmail),C({paypalEmail:e.adminPayPalEmail}))}}catch(e){i.error("Failed to load PayPal settings")}finally{E(!1)}},Y=s.useCallback(async e=>{if(j)if(e&&""!==e)try{const a={paypalEmail:e,updatedAt:(new Date).toISOString()};await f(y(l,"adminSettings","paypal"),a,{merge:!0}),await h(y(l,"users",j.uid),{adminPayPalEmail:e,adminPayPalEmailVerified:!0}),C(a),F(e),D(!0),L(!1),i.success("PayPal account linked successfully! All payments will go to this account.")}catch(a){i.error("Failed to save PayPal settings")}else L(!0)},[j]);return w?t.jsx(c,{}):t.jsx("div",{className:"min-h-screen bg-background p-3 sm:p-4 md:p-6",children:t.jsxs("div",{className:"max-w-2xl mx-auto",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6",children:[t.jsxs(n,{variant:"ghost",onClick:()=>e("/admin/dashboard"),className:"h-9 sm:h-auto text-xs sm:text-sm px-2 sm:px-4 touch-manipulation self-start",children:[t.jsx(N,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),"Back"]}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold",children:"Admin PayPal Account"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Configure the PayPal account that will receive all platform revenue"})]})]}),t.jsxs(d,{children:[t.jsxs(o,{children:[t.jsxs(m,{className:"flex items-center gap-2",children:[t.jsx(b,{className:"h-5 w-5"}),"Platform Payment Account"]}),t.jsx(u,{children:"Link the PayPal account that will receive all platform revenue including subscription payments and service fees. You can link any PayPal account (business or personal)."})]}),t.jsx(x,{children:j?t.jsxs(t.Fragment,{children:[t.jsx(S,{userId:j.uid,onVerified:Y,paypalEmail:V,paypalVerified:I}),O&&!V&&t.jsxs("div",{className:"mt-4 pt-4 border-t space-y-4",children:[t.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-900 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(k,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-100 mb-1",children:"Complete Account Setup"}),t.jsx("p",{className:"text-xs text-yellow-800 dark:text-yellow-200",children:"Your PayPal account has been verified. Enter the email address of the PayPal account you just logged into. This account will receive all platform revenue (subscriptions + service fees)."})]})]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(g,{htmlFor:"paypal-email",children:["PayPal Account Email Address ",t.jsx("span",{className:"text-destructive",children:"*"})]}),t.jsx(P,{id:"paypal-email",type:"email",placeholder:"your-paypal@example.com",value:R,onChange:e=>z(e.target.value),className:"max-w-md"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the email address of the PayPal account you just logged into"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(n,{onClick:async()=>{if(j)if(R.trim())if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(R.trim()))try{const e=R.trim(),a={paypalEmail:e,updatedAt:(new Date).toISOString()};await f(y(l,"adminSettings","paypal"),a,{merge:!0}),await h(y(l,"users",j.uid),{adminPayPalEmail:e,adminPayPalEmailVerified:!0}),C(a),F(e),D(!0),L(!1),z(""),i.success("PayPal account linked! All payments will go to this account.")}catch(e){i.error("Failed to save PayPal email")}else i.error("Please enter a valid email address");else i.error("Please enter your PayPal business email address")},size:"sm",children:"Save Email"}),t.jsx(n,{variant:"outline",size:"sm",onClick:()=>{L(!1),z("")},children:"Cancel"})]})]}),I&&V&&t.jsx("div",{className:"mt-4 pt-4 border-t",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium mb-1",children:"Platform Payment Account"}),t.jsx("p",{className:"text-xs text-muted-foreground font-mono bg-muted p-2 rounded mt-1",children:V}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Receiving: Subscription payments • Service fees (10% commission)"})]}),t.jsx(n,{variant:"outline",size:"sm",onClick:async()=>{if(j)try{await f(y(l,"adminSettings","paypal"),{paypalEmail:null,updatedAt:(new Date).toISOString()},{merge:!0}),await h(y(l,"users",j.uid),{adminPayPalEmail:null,adminPayPalEmailVerified:!1}),F(""),D(!1),C({}),i.success("PayPal account unlinked")}catch(e){i.error("Failed to unlink PayPal account")}},children:"Unlink Account"})]})})]}):t.jsx("div",{className:"p-4 bg-muted rounded-lg",children:t.jsx("p",{className:"text-sm text-muted-foreground",children:"Please sign in as admin to link your PayPal account"})})})]})]})})};export{E as default};
