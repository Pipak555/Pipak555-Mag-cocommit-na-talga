import{u as e,r as s,j as a}from"./react-vendor-Ve3SFwKO.js";import{u as t,j as n,a as r,v as i,C as l,b as c,c as d,e as m,i as o,B as x,d as u}from"./index-BnushFQy.js";import{h,f as p,d as j,q as f,o as g,e as N}from"./firebase-vendor-BC71bXmb.js";import{B as y}from"./badge-CYghlWc2.js";import{L as b}from"./label-DdT-oWKe.js";import{T as v}from"./textarea-DvORGimk.js";import{T as w,a as P,b as k,c as S}from"./tabs-DPlck8m_.js";import{B as C}from"./BackButton-DohCcac0.js";import{A as D,a as T,b as I,c as A,d as R,e as E,f as U,g as L}from"./alert-dialog-Bv7bA0QL.js";import{c as B,b as F}from"./paymentService-6NJnvF44.js";import{h as M,m as z,t as q,C as O,ap as V,g as Y,f as $}from"./icons-vendor-DD8ZfUKZ.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const _=()=>{const _=e(),{user:G,userRole:H}=t(),[J,K]=s.useState(!0),[Q,W]=s.useState([]),[X,Z]=s.useState([]),[ee,se]=s.useState(null),[ae,te]=s.useState(!1),[ne,re]=s.useState(null),[ie,le]=s.useState(""),[ce,de]=s.useState(!1),[me,oe]=s.useState("all"),[xe,ue]=s.useState(!1);s.useEffect(()=>{G&&"admin"===H?(pe(),he()):_("/admin/login")},[G,H,_]);const he=async()=>{if(G)try{const e=await h(p(n,"users",G.uid));if(e.exists()){const s=e.data(),a=!(!s.adminPayPalEmail||!s.adminPayPalEmailVerified);ue(a)}}catch(e){}},pe=async()=>{try{K(!0);const e=j(n,"transactions"),s=f(e,g("createdAt","desc")),a=await N(s),t=await Promise.all(a.docs.map(async e=>{const s=e.data();let a="Unknown",t="Unknown";try{const e=await h(p(n,"users",s.userId));if(e.exists()){const s=e.data();a=s.email||"Unknown",t=s.fullName||"Unknown"}}catch(r){}return{id:e.id,...s,userEmail:a,userName:t}}));W(t);const r=j(n,"subscriptions"),i=f(r,g("createdAt","desc")),l=await N(i),c=await Promise.all(l.docs.map(async e=>{const s=e.data();let a="Unknown",t="Unknown";try{const e=await h(p(n,"users",s.userId));if(e.exists()){const s=e.data();a=s.email||"Unknown",t=s.fullName||"Unknown"}}catch(r){}return{id:e.id,...s,userEmail:a,userName:t}}));Z(c)}catch(e){r.error("Failed to load transactions: "+(e.message||"Unknown error"))}finally{K(!1)}},je=(e,s)=>{se(e),re(s),le(""),te(!0)},fe=e=>{switch(e){case"completed":return a.jsxs(y,{className:"bg-green-500",children:[a.jsx($,{className:"h-3 w-3 mr-1"}),"Completed"]});case"pending":return a.jsxs(y,{className:"bg-yellow-500",children:[a.jsx(Y,{className:"h-3 w-3 mr-1"}),"Pending"]});case"pending_transfer":return a.jsxs(y,{className:"bg-yellow-500",children:[a.jsx(Y,{className:"h-3 w-3 mr-1"}),"Pending Transfer"]});case"failed":return a.jsxs(y,{className:"bg-red-500",children:[a.jsx(V,{className:"h-3 w-3 mr-1"}),"Failed"]});case"refunded":return a.jsxs(y,{className:"bg-gray-500",children:[a.jsx(V,{className:"h-3 w-3 mr-1"}),"Refunded"]});default:return a.jsx(y,{children:e||"Unknown"})}},ge=Q.filter(e=>"pending"===e.status);Q.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0);const Ne=Q.filter(e=>e.description?.toLowerCase().includes("host subscription")||e.description?.toLowerCase().includes("subscription")),ye=Ne.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.amount,0),be=X.filter(e=>"active"===e.status),ve=X.filter(e=>"active"===e.status).reduce((e,s)=>e+s.amount,0);return J?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-7xl mx-auto",children:a.jsx(i,{})})}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsx(C,{to:"/admin/dashboard"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Payment Management"}),a.jsx("p",{className:"text-muted-foreground",children:"Review and manage all platform transactions"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Subscription Revenue"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold text-primary",children:o(ye)}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Paid to your PayPal"})]})]}),a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:be.length}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Total value: ",o(ve)]})]})]}),a.jsxs(l,{children:[a.jsx(c,{children:a.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:ge.length}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting confirmation"})]})]})]}),!xe&&a.jsx(l,{className:"mb-6 border-primary/20 bg-primary/5",children:a.jsx(m,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Link Your PayPal Account"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Link your PayPal account to receive all subscription payments"})]}),a.jsxs(x,{onClick:()=>_("/admin/paypal-settings"),children:[a.jsx(M,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})]})})}),a.jsxs(l,{children:[a.jsxs(c,{children:[a.jsx(d,{children:"Transactions & Subscriptions"}),a.jsx(u,{children:"Review and manage all payments and subscriptions"})]}),a.jsx(m,{children:a.jsxs(w,{value:me,onValueChange:oe,className:"w-full",children:[a.jsxs(P,{className:"grid w-full grid-cols-3",children:[a.jsx(k,{value:"all",children:"All Transactions"}),a.jsx(k,{value:"subscriptions",children:"Subscriptions"}),a.jsx(k,{value:"subscription-payments",children:"Subscription Payments"})]}),a.jsx(S,{value:"all",className:"mt-6",children:0===Q.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No transactions found"})]}):a.jsx("div",{className:"space-y-4",children:Q.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),fe(e.status)]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," â€¢ ",new Date(e.createdAt).toLocaleDateString()]}),e.bookingId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Booking ID: ",e.bookingId.slice(0,8)]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Payment ID: ",e.paymentId]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod||"N/A"})]}),"pending"===e.status&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx(x,{size:"sm",onClick:()=>je(e,"confirm"),children:"Confirm"}),a.jsx(x,{size:"sm",variant:"destructive",onClick:()=>je(e,"refund"),children:"Refund"})]}),"completed"===e.status&&"payment"===e.type&&a.jsx(x,{size:"sm",variant:"destructive",onClick:()=>je(e,"refund"),children:"Refund"})]})]},e.id))})}),a.jsx(S,{value:"subscriptions",className:"mt-6",children:0===X.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(M,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No subscriptions found"})]}):a.jsx("div",{className:"space-y-4",children:X.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),a.jsx(y,{className:"active"===e.status?"bg-green-500":"cancelled"===e.status?"bg-yellow-500":"bg-gray-500",children:e.status})]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.planName," (",e.billingCycle,")"]}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," â€¢ Started: ",new Date(e.startDate).toLocaleDateString()]}),e.endDate&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Expires: ",new Date(e.endDate).toLocaleDateString()]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Payment ID: ",e.paymentId]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold text-primary",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod})]})]},e.id))})}),a.jsx(S,{value:"subscription-payments",className:"mt-6",children:0===Ne.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No subscription payments found"}),a.jsx("p",{className:"text-xs mt-2",children:"These payments go directly to your PayPal account"})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-primary",children:"ðŸ’° These subscription payments are received in your PayPal account"}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Total subscription revenue: ",a.jsx("strong",{children:o(ye)})]})]}),Ne.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg border-primary/20 bg-primary/5",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("p",{className:"font-medium",children:e.userName}),fe(e.status),a.jsx(y,{variant:"outline",className:"border-primary text-primary",children:"Subscription"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.userEmail," â€¢ ",new Date(e.createdAt).toLocaleDateString()]}),e.paymentId&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["PayPal Payment ID: ",e.paymentId]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-lg font-bold text-primary",children:o(e.amount)}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.paymentMethod||"PayPal"}),a.jsx("p",{className:"text-xs text-primary mt-1",children:"â†’ Your PayPal"})]})]},e.id))]})})]})})]}),a.jsx(D,{open:ae,onOpenChange:te,children:a.jsxs(T,{children:[a.jsxs(I,{children:[a.jsx(A,{children:"confirm"===ne?"Confirm Transaction?":"Refund Transaction?"}),a.jsx(R,{className:"space-y-4",children:"confirm"===ne?a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Are you sure you want to confirm this transaction? This will process the payment and update wallet balances."}),ee&&a.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium",children:"Transaction Details:"}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Amount: ",o(ee.amount)]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Type: ",ee.type]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["User: ",ee.userName||ee.userEmail]})]})]}):a.jsx(a.Fragment,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[a.jsx(O,{className:"h-4 w-4"}),a.jsx("p",{className:"font-medium",children:"This will refund the payment and reverse wallet balances."})]}),ee&&a.jsxs("div",{className:"bg-muted p-3 rounded-lg space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:"Refund Details:"}),a.jsxs("p",{className:"text-xs",children:["Refund Amount: ",a.jsx("span",{className:"font-semibold",children:o(ee.amount)})]}),a.jsxs("p",{className:"text-xs",children:["Transaction Type: ",ee.type]}),a.jsxs("p",{className:"text-xs",children:["User: ",ee.userName||ee.userEmail]}),ee.bookingId&&a.jsxs("p",{className:"text-xs",children:["Booking ID: ",ee.bookingId.slice(0,8)]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(b,{htmlFor:"refund-reason",children:"Refund Reason (Optional)"}),a.jsx(v,{id:"refund-reason",placeholder:"Enter reason for refund...",value:ie,onChange:e=>le(e.target.value),rows:3})]})]})})})]}),a.jsxs(E,{children:[a.jsx(U,{disabled:ce,children:"Cancel"}),a.jsx(L,{onClick:async()=>{if(ee&&ne){de(!0);try{if("confirm"===ne)await B(ee.id),r.success("Transaction confirmed successfully");else if("refund"===ne){const e=await F(ee.id,ee,ie||void 0);if(!e.success)throw Error("Refund processing failed");r.success(`Refund processed successfully. â‚±${e.refundAmount?.toFixed(2)} has been returned to user's wallet.`)}await pe(),se(null),re(null),le("")}catch(e){r.error(e.message||`Failed to ${ne} transaction`)}finally{de(!1),te(!1)}}},disabled:ce,className:"refund"===ne?"bg-destructive hover:bg-destructive/90":"",children:ce?"Processing...":"confirm"===ne?"Confirm":"Refund"})]})]})})]})})};export{_ as default};
