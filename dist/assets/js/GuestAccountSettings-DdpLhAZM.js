import{j as e,u as s,l as i,r as a}from"./react-vendor-Ve3SFwKO.js";import{C as n,a as t,b as l,d as c,i as o,B as r,j as d,z as m,u as x,h,v as u,c as p,e as j,E as f}from"./index-DaMaslBo.js";import{h as g,f as b,u as N}from"./firebase-vendor-BC71bXmb.js";import{I as v}from"./input-D5hloL4G.js";import{T as w,a as y,b as k,c as C}from"./tabs-C4BuYc9E.js";import{L as S}from"./label-B2t2XnWQ.js";import{B as A}from"./badge-BSgvUoVt.js";import{S as B}from"./switch-CSe7-F5W.js";import{i as R,G as D,A as F,o as P,j as I,ab as U,S as M,X as E,M as O,ac as $}from"./icons-vendor-Dhca6XHc.js";import{E as T}from"./empty-state-BDfunuWx.js";import{p as z}from"./paymentService-Cp8a7m6L.js";import{A as G,a as L,b as Y,c as V,d as W,e as q,f as H,g as K}from"./alert-dialog-DLw-Qa8s.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const Z=({points:s,onRedeem:i})=>e.jsxs(n,{className:"border-0 shadow-lg",children:[e.jsx(t,{className:"pb-4",children:e.jsxs(l,{className:"flex items-center gap-2 text-xl",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),"Points & Rewards"]})}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-6 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent rounded-lg border border-primary/20",children:[e.jsx("div",{className:"text-4xl sm:text-5xl font-bold text-primary mb-2",children:s}),e.jsx("div",{className:"text-sm text-muted-foreground font-medium",children:"Total Points"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-base mb-4",children:"Available Rewards:"}),e.jsx("div",{className:"space-y-3",children:[{points:100,reward:"₱10 discount",discount:10},{points:250,reward:"₱30 discount",discount:30},{points:500,reward:"₱75 discount",discount:75},{points:1e3,reward:"₱200 discount",discount:200}].map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-base",children:[o(a.discount)," discount"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.points," points"]})]})]}),e.jsx(r,{size:"sm",disabled:s<a.points,onClick:()=>i?.(a.points),className:"min-w-[100px]",children:"Redeem"})]},a.points))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg border",children:[e.jsx("p",{className:"font-semibold text-sm mb-3 text-foreground",children:"How to earn points:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Complete a booking: +50 points"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Write a review: +20 points"})]})]})]})]})]}),_=()=>{const R=s(),[_]=i(),{user:J,userRole:Q,refreshUserProfile:X,signOut:ee,hasRole:se}=x(),[ie,ae]=a.useState(null),[ne,te]=a.useState(!1),[le,ce]=a.useState([]),[oe,re]=a.useState(_.get("tab")||"profile"),[de,me]=a.useState(!1),[xe,he]=a.useState(!1),[ue,pe]=a.useState(null),[je,fe]=a.useState(!1),[ge,be]=a.useState({email:{bookingConfirmations:!0,bookingCancellations:!0,bookingReminders:!0,newMessages:!0,paymentUpdates:!0,promotionalOffers:!0},inApp:{bookingUpdates:!0,newMessages:!0,paymentNotifications:!0,systemAlerts:!0}});a.useEffect(()=>{!J||se("guest")?J&&Ne():R("/guest/login")},[J,Q,R]),a.useEffect(()=>{const e=_.get("tab");e&&re(e)},[_]),a.useEffect(()=>{J&&ie&&"guest"===Q&&(ve(),ie.notifications&&be(ie.notifications))},[J,ie,Q]);const Ne=async()=>{if(J)try{const e=await g(b(d,"users",J.uid));if(e.exists()){const s=e.data();ae(s)}}catch(e){}},ve=async()=>{if(J)try{const e=await h({guestId:J.uid});ce(e)}catch(e){}};return ie?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 md:px-6 lg:px-8 py-3 sm:py-4 md:py-6 lg:py-8 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6 gap-2 sm:gap-4",children:[e.jsxs(r,{variant:"ghost",onClick:()=>{R("/guest/dashboard")},className:"h-9 sm:h-auto text-xs sm:text-sm px-2 sm:px-4 touch-manipulation",children:[e.jsx(F,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"Back"})]}),e.jsxs(r,{variant:"outline",onClick:()=>me(!0),className:"h-9 sm:h-auto text-xs sm:text-sm px-2 sm:px-4 touch-manipulation",children:[e.jsx("span",{className:"hidden sm:inline",children:"Sign Out"}),e.jsx("span",{className:"sm:hidden",children:"Out"})]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold mb-4 sm:mb-6",children:"Account Settings"}),e.jsxs(w,{value:oe,onValueChange:re,className:"space-y-4 sm:space-y-6",children:[e.jsxs(y,{className:"grid w-full grid-cols-5 relative overflow-x-auto",children:[e.jsxs(k,{value:"profile",className:"text-xs sm:text-sm touch-manipulation min-h-[44px] sm:min-h-0",children:[e.jsx(P,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Profile"})]}),e.jsxs(k,{value:"bookings",className:"text-xs sm:text-sm touch-manipulation min-h-[44px] sm:min-h-0",children:[e.jsx(I,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Bookings"})]}),e.jsxs(k,{value:"rewards",className:"text-xs sm:text-sm touch-manipulation min-h-[44px] sm:min-h-0",children:[e.jsx(D,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Rewards"})]}),e.jsxs(k,{value:"notifications",className:"text-xs sm:text-sm touch-manipulation min-h-[44px] sm:min-h-0",children:[e.jsx(U,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Notifications"})]}),e.jsxs(k,{value:"security",className:"text-xs sm:text-sm touch-manipulation min-h-[44px] sm:min-h-0",children:[e.jsx(M,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Security"})]})]}),e.jsxs("div",{className:"h-[500px] sm:h-[600px] relative",children:[e.jsx(C,{value:"profile",className:"mt-0 absolute inset-0 w-full overflow-y-auto px-1 sm:px-0",children:e.jsxs(n,{className:"h-full flex flex-col",children:[e.jsxs(t,{children:[e.jsx(l,{children:"Profile Information"}),e.jsx(p,{children:"Update your account details"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"fullName",children:"Full Name"}),e.jsx(v,{id:"fullName",type:"text",value:ie.fullName,onChange:e=>ae({...ie,fullName:e.target.value}),placeholder:"Enter your full name"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(v,{id:"email",type:"email",value:ie.email,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"role",children:"Role"}),e.jsx(v,{id:"role",value:ie.role,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"points",children:"Reward Points"}),e.jsx(v,{id:"points",value:ie.points,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"balance",children:"Wallet Balance"}),e.jsx(v,{id:"balance",value:o(ie.walletBalance),disabled:!0})]}),e.jsx(r,{onClick:async()=>{if(J&&ie){te(!0);try{await N(b(d,"users",J.uid),{fullName:ie.fullName}),await Ne(),await X(),j.success("Profile updated successfully!")}catch(e){j.error("Failed to update profile")}finally{te(!1)}}},disabled:ne,children:ne?"Saving...":"Save Changes"})]})]})}),e.jsx(C,{value:"bookings",className:"mt-0 absolute inset-0 w-full overflow-y-auto",children:e.jsxs(n,{className:"h-full flex flex-col",children:[e.jsxs(t,{children:[e.jsx(l,{children:"My Bookings"}),e.jsx(p,{children:"View your booking history"})]}),e.jsx(c,{children:0===le.length?e.jsx(T,{icon:e.jsx(I,{className:"h-10 w-10"}),title:"No bookings yet",description:"Start exploring amazing places to stay!",action:e.jsx(r,{onClick:()=>R("/guest/browse"),children:"Browse Listings"})}):e.jsx("div",{className:"space-y-4",children:le.map(s=>{const i=("pending"===s.status||"confirmed"===s.status)&&new Date(s.checkIn)>=new Date;return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Booking #",s.id.slice(0,8)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(s.checkIn).toLocaleDateString()," - ",new Date(s.checkOut).toLocaleDateString()]})]}),e.jsx(A,{children:s.status})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.guests," guest",s.guests>1?"s":""]}),e.jsx("p",{className:"font-semibold",children:o(s.totalPrice||0)})]}),i&&e.jsx("div",{className:"pt-4 mt-4 border-t",children:e.jsxs(r,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?j.error("Cannot cancel bookings with check-in dates in the past"):(pe(e),he(!0)):j.error("This booking cannot be cancelled"):j.error("Cannot cancel completed bookings"):j.error("This booking is already cancelled"):j.error("Invalid booking")})(s),className:"w-full",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]},s.id)})})})]})}),e.jsx(C,{value:"rewards",className:"mt-6",children:e.jsx(Z,{points:ie?.points||0,onRedeem:async e=>{if(J)try{const{couponCode:s,discountAmount:i}=await(async(e,s)=>{try{const i=await g(b(d,"users",e));if(!i.exists())throw Error("Guest not found");const a=i.data(),n=a.points||0;if(s>n)throw Error("Insufficient points");let t;t=Math.floor(1e3>s?500>s?250>s?s/100*10:s/250*30:s/500*75:s/1e3*200);const l=n-s,c="POINTS"+Date.now().toString(36).toUpperCase(),o=new Date;o.setDate(o.getDate()+30);const r={id:`${c}-${e}`,code:c,discount:t,validUntil:o.toISOString(),used:!1,minSpend:0},x=a.coupons||[];return await N(b(d,"users",e),{points:l,coupons:[...x,r]}),await m({userId:e,type:"reward",amount:-s,description:`Points redeemed for discount coupon (${c} - ${t}₱ discount)`,status:"completed"}),{couponCode:c,discountAmount:t}}catch(i){throw i}})(J.uid,e);j.success(`Successfully redeemed ${e} points! Coupon code: ${s} (${o(i)} discount). You can use this coupon when booking a listing.`),await Ne()}catch(s){j.error("Failed to redeem points: "+(s.message||"Unknown error"))}else j.error("You must be logged in to redeem points")}})}),e.jsx(C,{value:"notifications",className:"mt-6",children:e.jsxs(n,{children:[e.jsxs(t,{children:[e.jsx(l,{children:"Notification Preferences"}),e.jsx(p,{children:"Manage how you receive updates"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(O,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Email Notifications"})]}),e.jsxs("div",{className:"space-y-3 pl-7",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email-booking-confirmations",children:"Booking Confirmations"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails when bookings are confirmed"})]}),e.jsx(B,{id:"email-booking-confirmations",checked:ge.email.bookingConfirmations,onCheckedChange:e=>be(s=>({...s,email:{...s.email,bookingConfirmations:e}}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email-booking-cancellations",children:"Booking Cancellations"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails when bookings are cancelled"})]}),e.jsx(B,{id:"email-booking-cancellations",checked:ge.email.bookingCancellations,onCheckedChange:e=>be(s=>({...s,email:{...s.email,bookingCancellations:e}}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email-booking-reminders",children:"Booking Reminders"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive reminders about upcoming bookings"})]}),e.jsx(B,{id:"email-booking-reminders",checked:ge.email.bookingReminders,onCheckedChange:e=>be(s=>({...s,email:{...s.email,bookingReminders:e}}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email-new-messages",children:"New Messages"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails for new messages"})]}),e.jsx(B,{id:"email-new-messages",checked:ge.email.newMessages,onCheckedChange:e=>be(s=>({...s,email:{...s.email,newMessages:e}}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email-payment-updates",children:"Payment Updates"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive emails about payment transactions"})]}),e.jsx(B,{id:"email-payment-updates",checked:ge.email.paymentUpdates,onCheckedChange:e=>be(s=>({...s,email:{...s.email,paymentUpdates:e}}))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx($,{className:"h-5 w-5 text-secondary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"In-App Notifications"})]}),e.jsxs("div",{className:"space-y-3 pl-7",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"inapp-booking-updates",children:"Booking Updates"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about booking status changes"})]}),e.jsx(B,{id:"inapp-booking-updates",checked:ge.inApp.bookingUpdates,onCheckedChange:e=>be(s=>({...s,inApp:{...s.inApp,bookingUpdates:e}}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"inapp-new-messages",children:"New Messages"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about new messages"})]}),e.jsx(B,{id:"inapp-new-messages",checked:ge.inApp.newMessages,onCheckedChange:e=>be(s=>({...s,inApp:{...s.inApp,newMessages:e}}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"inapp-payment-notifications",children:"Payment Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified about payment activities"})]}),e.jsx(B,{id:"inapp-payment-notifications",checked:ge.inApp.paymentNotifications,onCheckedChange:e=>be(s=>({...s,inApp:{...s.inApp,paymentNotifications:e}}))})]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(r,{onClick:async()=>{if(J){te(!0);try{await N(b(d,"users",J.uid),{notifications:ge}),await X(),j.success("Notification preferences saved!")}catch(e){j.error("Failed to save notification preferences")}finally{te(!1)}}},disabled:ne,children:ne?"Saving...":"Save Preferences"})})]})]})}),e.jsx(C,{value:"security",className:"mt-0 absolute inset-0 w-full overflow-y-auto",children:e.jsxs(n,{className:"h-full flex flex-col",children:[e.jsxs(t,{children:[e.jsx(l,{children:"Security Settings"}),e.jsx(p,{children:"Manage your account security"})]}),e.jsx(c,{children:e.jsx("p",{className:"text-muted-foreground",children:"Security settings coming soon"})})]})})]})]})]}),e.jsx(G,{open:xe,onOpenChange:he,children:e.jsxs(L,{children:[e.jsxs(Y,{children:[e.jsx(V,{children:"Cancel Booking"}),e.jsxs(W,{children:["Are you sure you want to cancel this booking?",ue&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-medium capitalize",children:ue.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(ue.checkIn).toLocaleDateString()]})]}),ue.totalPrice>0&&e.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",o(ue.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),e.jsxs(q,{children:[e.jsx(H,{disabled:je,children:"Keep Booking"}),e.jsx(K,{onClick:async()=>{if(!ue||!J)return void j.error("Invalid booking or user");if("cancelled"===ue.status||"completed"===ue.status)return j.error("This booking cannot be cancelled"),he(!1),void pe(null);const e=new Date(ue.checkIn);if(new Date>e)return j.error("Cannot cancel bookings with check-in dates in the past"),he(!1),void pe(null);fe(!0);try{if(await f(ue.id,{status:"cancelled"}),"confirmed"===ue.status||"pending"===ue.status)try{const e=await z(ue,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?o(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";j.success("Booking cancelled successfully. "+s)}}catch(s){j.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else j.success("Booking cancelled successfully.");he(!1),pe(null),ve()}catch(i){const e=i.message||"Unknown error occurred";j.error("Failed to cancel booking: "+e)}finally{fe(!1)}},disabled:je,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:je?"Cancelling...":"Cancel Booking"})]})]})}),e.jsx(G,{open:de,onOpenChange:me,children:e.jsxs(L,{children:[e.jsxs(Y,{children:[e.jsx(V,{children:"Sign Out"}),e.jsx(W,{children:"Are you sure you want to sign out? You'll need to sign in again to access your account."})]}),e.jsxs(q,{children:[e.jsx(H,{children:"Cancel"}),e.jsx(K,{onClick:async()=>{await ee(),R("/")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sign Out"})]})]})})]}):e.jsx(u,{})};export{_ as default};
