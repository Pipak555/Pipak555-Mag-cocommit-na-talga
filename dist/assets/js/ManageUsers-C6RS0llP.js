import{u as e,r as s,j as a}from"./react-vendor-Ve3SFwKO.js";import{u as t,j as r,e as l,B as n,C as i,d as m,i as d,H as c}from"./index-DaMaslBo.js";import{e as o,d as x}from"./firebase-vendor-BC71bXmb.js";import{T as h,a as u,b as j,c as g,d as p,e as N}from"./table-D8ee0DX1.js";import{B as f}from"./badge-BSgvUoVt.js";import{D as b,a as v,b as y,c as w,d as A,e as S}from"./dialog-GBvfaobK.js";import{T as k}from"./textarea-bhWBiMTW.js";import{L as C}from"./label-B2t2XnWQ.js";import{A as F,L as M,C as B,l as D,a9 as P}from"./icons-vendor-Dhca6XHc.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const L=()=>{const L=e(),{user:R,userRole:T}=t(),[U,z]=s.useState([]),[E,I]=s.useState(!0),[J,W]=s.useState(null),[q,H]=s.useState(!1),[O,G]=s.useState(null),[K,Q]=s.useState(""),[V,X]=s.useState(!1);s.useEffect(()=>{R&&"admin"===T?Y():L("/admin/login")},[R,T,L]);const Y=async()=>{I(!0),W(null);try{const e=(await o(x(r,"users"))).docs.map(e=>({id:e.id,...e.data()}));z(e),0===e.length&&W("No users found in the database.")}catch(e){const s="permission-denied"===e.code?"Permission denied. Please check that your admin role is set correctly in Firestore.":e.message||"Failed to load users. Please check the console for details.";W(s),l.error(s)}finally{I(!1)}},Z=e=>{G(e),Q(""),H(!0)};return a.jsx("div",{className:"min-h-screen bg-background p-3 sm:p-4 md:p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs(n,{variant:"ghost",onClick:()=>L("/admin/dashboard"),className:"mb-3 sm:mb-4 md:mb-6 h-9 sm:h-auto text-xs sm:text-sm px-2 sm:px-4 touch-manipulation",children:[a.jsx(F,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Back to Dashboard"}),a.jsx("span",{className:"sm:hidden",children:"Back"})]}),a.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold mb-4 sm:mb-6",children:"User Management"}),E?a.jsx(i,{children:a.jsxs(m,{className:"py-12 text-center",children:[a.jsx(M,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),a.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})]})}):J?a.jsx(i,{children:a.jsxs(m,{className:"py-12 text-center",children:[a.jsx(B,{className:"h-12 w-12 mx-auto mb-4 text-destructive"}),a.jsx("p",{className:"text-destructive font-medium mb-2",children:J}),a.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:'Make sure your admin user has the role field set to "admin" in Firestore.'}),a.jsx(n,{onClick:Y,variant:"outline",children:"Retry"})]})}):0===U.length?a.jsx(i,{children:a.jsx(m,{className:"py-12 text-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No users found in the database."})})}):a.jsxs(i,{children:[a.jsx("div",{className:"block md:hidden divide-y",children:U.map(e=>{const s=e.roles&&Array.isArray(e.roles)&&e.roles.length>0?e.roles:e.role?[e.role]:[],t=Array.from(new Set(s)).sort((e,s)=>{const a={admin:0,host:1,guest:2};return(a[e]??99)-(a[s]??99)});return a.jsxs("div",{className:"p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium text-sm truncate",children:e.fullName||"N/A"}),a.jsx("p",{className:"text-xs text-muted-foreground truncate",children:e.email})]}),a.jsxs(n,{size:"sm",variant:"outline",onClick:()=>Z(e),className:"h-8 text-xs touch-manipulation",children:[a.jsx(D,{className:"h-3 w-3 mr-1"}),"Message"]})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(e=>a.jsx(f,{variant:"admin"===e?"default":"host"===e?"secondary":"outline",className:"admin"===e?"bg-orange-500 hover:bg-orange-600 text-xs":"host"===e?"bg-blue-500 hover:bg-blue-600 text-xs":"bg-cyan-500 hover:bg-cyan-600 text-xs",children:e},e))}),a.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Points"}),a.jsx("p",{className:"font-medium",children:e.points||0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Wallet"}),a.jsx("p",{className:"font-medium",children:d(e.walletBalance||0)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Joined"}),a.jsx("p",{className:"font-medium",children:e.createdAt?new Date(e.createdAt).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"N/A"})]})]})]},e.id)})}),a.jsx("div",{className:"hidden md:block overflow-x-auto",children:a.jsxs(h,{children:[a.jsx(u,{children:a.jsxs(j,{children:[a.jsx(g,{children:"Full Name"}),a.jsx(g,{children:"Email"}),a.jsx(g,{children:"Role"}),a.jsx(g,{children:"Points"}),a.jsx(g,{children:"Wallet Balance"}),a.jsx(g,{children:"Joined"}),a.jsx(g,{className:"text-right",children:"Actions"})]})}),a.jsx(p,{children:U.map(e=>a.jsxs(j,{children:[a.jsx(N,{className:"font-medium",children:e.fullName||"N/A"}),a.jsx(N,{children:e.email}),a.jsx(N,{children:a.jsx("div",{className:"flex flex-wrap gap-1",children:(()=>{const s=e.roles&&Array.isArray(e.roles)&&e.roles.length>0?e.roles:e.role?[e.role]:[];return Array.from(new Set(s)).sort((e,s)=>{const a={admin:0,host:1,guest:2};return(a[e]??99)-(a[s]??99)}).map(e=>a.jsx(f,{variant:"admin"===e?"default":"host"===e?"secondary":"outline",className:"admin"===e?"bg-orange-500 hover:bg-orange-600":"host"===e?"bg-blue-500 hover:bg-blue-600":"bg-cyan-500 hover:bg-cyan-600",children:e},e))})()})}),a.jsx(N,{children:e.points||0}),a.jsx(N,{children:d(e.walletBalance||0)}),a.jsx(N,{children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}),a.jsx(N,{className:"text-right",children:a.jsxs(n,{variant:"outline",size:"sm",onClick:()=>Z(e),className:"gap-2 touch-manipulation",children:[a.jsx(D,{className:"h-4 w-4"}),"Message"]})})]},e.id))})]})})]}),a.jsx(b,{open:q,onOpenChange:H,children:a.jsxs(v,{className:"max-w-[95vw] sm:max-w-2xl p-4 sm:p-6",children:[a.jsxs(y,{children:[a.jsxs(w,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[a.jsx(D,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Send Message"]}),a.jsxs(A,{className:"text-xs sm:text-sm",children:["Send a message to ",O?.fullName||O?.email||"this user"]})]}),O&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Recipient:"}),a.jsx("p",{className:"font-semibold",children:O.fullName||"N/A"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:O.email}),a.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(()=>{const e=O.roles&&Array.isArray(O.roles)&&O.roles.length>0?O.roles:O.role?[O.role]:[];return Array.from(new Set(e)).sort((e,s)=>{const a={admin:0,host:1,guest:2};return(a[e]??99)-(a[s]??99)}).map(e=>a.jsx(f,{variant:"admin"===e?"default":"host"===e?"secondary":"outline",className:"admin"===e?"bg-orange-500 hover:bg-orange-600":"host"===e?"bg-blue-500 hover:bg-blue-600":"bg-cyan-500 hover:bg-cyan-600",children:e},e))})()})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(C,{htmlFor:"message-content",className:"text-sm sm:text-base font-semibold",children:["Message ",a.jsx("span",{className:"text-destructive",children:"*"})]}),a.jsx(k,{id:"message-content",placeholder:"Type your message here...",value:K,onChange:e=>Q(e.target.value),className:"min-h-[120px] sm:min-h-[150px] text-base sm:text-sm",required:!0}),a.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"This message will be sent through the messaging system and the user will receive a notification."})]})]}),a.jsxs(S,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[a.jsx(n,{variant:"outline",onClick:()=>{H(!1),Q(""),G(null)},disabled:V,className:"w-full sm:w-auto h-11 sm:h-auto text-sm sm:text-base touch-manipulation",children:"Cancel"}),a.jsx(n,{onClick:async()=>{if(R&&O&&K.trim()){X(!0);try{await c({senderId:R.uid,receiverId:O.id,content:K.trim(),read:!1}),l.success("Message sent to "+(O.fullName||O.email)),H(!1),Q(""),G(null)}catch(e){l.error("Failed to send message: "+(e.message||"Unknown error"))}finally{X(!1)}}else l.error("Please enter a message")},disabled:V||!K.trim(),className:"gap-2 w-full sm:w-auto h-11 sm:h-auto text-sm sm:text-base touch-manipulation",children:V?a.jsxs(a.Fragment,{children:[a.jsx(M,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):a.jsxs(a.Fragment,{children:[a.jsx(P,{className:"h-4 w-4"}),"Send Message"]})})]})]})})]})})};export{L as default};
