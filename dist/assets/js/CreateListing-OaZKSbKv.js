import{m as e,n as t,j as s,r as a,M as r,T as n,o,p as i,k as c,u as l}from"./react-vendor-DAkY0NgE.js";import{m as d,e as u,n as m,B as h,g as p,u as f,j as g,C as x,a as j,b as v,d as y,i as b,o as w,_ as N}from"./index-BbvEjZj9.js";import{t as S}from"./form-vendor-ztDZwZ2b.js";import{I as P}from"./input-C1fDyqub.js";import{T as E}from"./textarea-BFXqNepM.js";import{S as C,a as D,b as I,c as O,d as A}from"./select-B0HuvfWd.js";import{C as k,D as R,a as L,b as T,c as F,d as _}from"./calendar-D55um_cb.js";import{A as U,a as G,b as B,c as V,d as M,e as $,f as q,g as z}from"./alert-dialog-D9Kc0D1X.js";import{F as H,a as J,b as W,c as Y,d as K,f as X,e as Z,g as Q}from"./validation-CGxThRcy.js";import{P as ee,a as te,b as se}from"./popover-BLRuYxtE.js";import{i as ae,v as re,X as ne,w as oe,L as ie,N as ce,f as le,C as de,x as ue,A as me}from"./icons-vendor-3zhgXMYa.js";import{o as he}from"./utils-vendor-yBsXXcRr.js";import{P as pe}from"./progress-DpeQ-D4Z.js";import{L as fe}from"./maps-vendor-CYGXCXz5.js";import{f as ge,e as xe,v as je,A as ve,h as ye}from"./firebase-vendor-CvoiOdvz.js";import"./ui-vendor-CZx_xpmK.js";import"./label-kBNwlYyC.js";var be,we,Ne,Se,Pe,Ee;(we=be||(be={})).INITIAL="initial",we.PENDING="pending",we.REJECTED="rejected",we.RESOLVED="resolved",(Se=Ne||(Ne={})).LOADING_STATUS="setLoadingStatus",Se.RESET_OPTIONS="resetOptions",Se.SET_BRAINTREE_INSTANCE="braintreeInstance",(Ee=Pe||(Pe={})).NUMBER="number",Ee.CVV="cvv",Ee.EXPIRATION_DATE="expirationDate",Ee.EXPIRATION_MONTH="expirationMonth",Ee.EXPIRATION_YEAR="expirationYear",Ee.POSTAL_CODE="postalCode";var Ce=function(){return Ce=Object.assign||function(e){for(var t,s=1,a=arguments.length;a>s;s++)for(var r in t=arguments[s])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ce.apply(this,arguments)};function De(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(s[a[r]]=e[a[r]])}return s}function Ie(e,t,s){if(s||2===arguments.length)for(var a,r=0,n=t.length;n>r;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var Oe="data-react-paypal-script-id",Ae="react-paypal-js",ke="dataSdkIntegrationSource",Re="paypal";function Le(e){var t=e,s=Oe;t[s];var a=De(t,[s+""]);return"react-paypal-js-".concat(function(e){for(var t="",s=0;s<e.length;s++){var a=e[s].charCodeAt(0)*s;e[s+1]&&(a+=e[s+1].charCodeAt(0)*(s-1)),t+=String.fromCharCode(97+Math.abs(a)%26)}return t}(JSON.stringify(a)))}function Te(e,t){var s,a,r,n;switch(t.type){case Ne.LOADING_STATUS:return"object"==typeof t.value?Ce(Ce({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):Ce(Ce({},e),{loadingStatus:t.value});case Ne.RESET_OPTIONS:return r=e.options[Oe],(null==(n=self.document.querySelector("script[".concat(Oe,'="').concat(r,'"]')))?void 0:n.parentNode)&&n.parentNode.removeChild(n),Ce(Ce({},e),{loadingStatus:be.PENDING,options:Ce(Ce((s={},s[ke]=Ae,s),t.value),(a={},a[Oe]="".concat(Le(t.value)),a))});case Ne.SET_BRAINTREE_INSTANCE:return Ce(Ce({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var Fe=e.createContext(null);function _e(){var t=function(e){if("function"==typeof(null==e?void 0:e.dispatch)&&0!==e.dispatch.length)return e;throw Error("usePayPalScriptReducer must be used within a PayPalScriptProvider")}(e.useContext(Fe));return[Ce(Ce({},t),{isInitial:t.loadingStatus===be.INITIAL,isPending:t.loadingStatus===be.PENDING,isResolved:t.loadingStatus===be.RESOLVED,isRejected:t.loadingStatus===be.REJECTED}),t.dispatch]}e.createContext({});var Ue=function(s){var a,r,n,o=s.className,i=void 0===o?"":o,c=s.disabled,l=void 0!==c&&c,d=s.children,u=s.forceReRender,m=void 0===u?[]:u,h=De(s,["className","disabled","children","forceReRender"]),p=l?{opacity:.38}:{},f="".concat(i," ").concat(l?"paypal-buttons-disabled":"").trim(),g=e.useRef(null),x=e.useRef(null),j=(r=h,n=e.useRef(new Proxy({},{get:function(e,t,s){return"function"==typeof e[t]?function(){for(var s=[],a=0;arguments.length>a;a++)s[a]=arguments[a];return e[t].apply(e,s)}:Reflect.get(e,t,s)}})),n.current=Object.assign(n.current,r),n.current),v=_e()[0],y=v.isResolved,b=v.options,w=e.useState(null),N=w[0],S=w[1],P=e.useState(!0),E=P[0],C=P[1],D=e.useState(null)[1];function I(){null!==x.current&&x.current.close().catch(function(){})}return(null===(a=x.current)||void 0===a?void 0:a.updateProps)&&x.current.updateProps({message:h.message}),e.useEffect(function(){if(!1===y)return I;var e,t=(void 0===(e=b.dataNamespace)&&(e=Re),window[e]);if(void 0===t||void 0===t.Buttons)return D(function(){throw Error(function(e){var t=e.reactComponentName,s=e.sdkComponentKey,a=e.sdkRequestedComponents,r=void 0===a?"":a,n=e.sdkDataNamespace,o=void 0===n?Re:n,i=s.charAt(0).toUpperCase().concat(s.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(o,".").concat(i," is undefined."),l="string"==typeof r?r:r.join(",");if(!l.includes(s)){var d=[l,s].filter(Boolean).join();c+="\nTo fix the issue, add '".concat(s,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(d,"'}}>`.")}return c}({reactComponentName:Ue.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:b.components,sdkDataNamespace:b.dataNamespace}))}),I;try{x.current=t.Buttons(Ce(Ce({},j),{onInit:function(e,t){S(t),"function"==typeof h.onInit&&h.onInit(e,t)}}))}catch(s){return D(function(){throw Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(s))})}return!1===x.current.isEligible()?(C(!1),I):g.current?(x.current.render(g.current).catch(function(e){null!==g.current&&0!==g.current.children.length&&D(function(){throw Error("Failed to render <PayPalButtons /> component. ".concat(e))})}),I):I},Ie(Ie([y],m,!0),[h.fundingSource],!1)),e.useEffect(function(){null!==N&&(!0===l?N.disable().catch(function(){}):N.enable().catch(function(){}))},[l,N]),t.createElement(t.Fragment,null,E?t.createElement("div",{ref:g,style:p,className:f}):d)};function Ge(e,t){void 0===t&&(t={});var s=document.createElement("script");return s.src=e,Object.keys(t).forEach(function(e){s.setAttribute(e,t[e]),"data-csp-nonce"===e&&s.setAttribute("nonce",t["data-csp-nonce"])}),s}function Be(e,t){if(void 0===t&&(t=Promise),Me(e,t),"undefined"==typeof document)return t.resolve(null);var s=function(e){var t,s,a=e.sdkBaseUrl,r=e.environment,n=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)0>t.indexOf(a[r])&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(s[a[r]]=e[a[r]])}return s}(e,["sdkBaseUrl","environment"]),o=a||function(e){return"sandbox"===e?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}(r),i=n,c=Object.keys(i).filter(function(e){return void 0!==i[e]&&null!==i[e]&&""!==i[e]}).reduce(function(e,t){var s,a=i[t].toString();return s=function(e,t){return(t?"-":"")+e.toLowerCase()},"data"===(t=t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,s)).substring(0,4)||"crossorigin"===t?e.attributes[t]=a:e.queryParams[t]=a,e},{queryParams:{},attributes:{}}),l=c.queryParams,d=c.attributes;return l["merchant-id"]&&-1!==l["merchant-id"].indexOf(",")&&(d["data-merchant-id"]=l["merchant-id"],l["merchant-id"]="*"),{url:"".concat(o,"?").concat((t=l,s="",Object.keys(t).forEach(function(e){0!==s.length&&(s+="&"),s+=e+"="+t[e]}),s)),attributes:d}}(e),a=s.url,r=s.attributes,n=r["data-namespace"]||"paypal",o=Ve(n);return r["data-js-sdk-library"]||(r["data-js-sdk-library"]="paypal-js"),function(e,t){var s=document.querySelector('script[src="'.concat(e,'"]'));if(null===s)return null;var a=Ge(e,t),r=s.cloneNode();if(delete r.dataset.uidAuto,Object.keys(r.dataset).length!==Object.keys(a.dataset).length)return null;var n=!0;return Object.keys(r.dataset).forEach(function(e){r.dataset[e]!==a.dataset[e]&&(n=!1)}),n?s:null}(a,r)&&o?t.resolve(o):function(e,t){void 0===t&&(t=Promise),Me(e,t);var s=e.url,a=e.attributes;if("string"!=typeof s||0===s.length)throw Error("Invalid url.");if(void 0!==a&&"object"!=typeof a)throw Error("Expected attributes to be an object.");return new t(function(e,t){if("undefined"==typeof document)return e();!function(e){var t=e.onSuccess,s=e.onError,a=Ge(e.url,e.attributes);a.onerror=s,a.onload=t,document.head.insertBefore(a,document.head.firstElementChild)}({url:s,attributes:a,onSuccess:function(){return e()},onError:function(){return t(Error('The script "'.concat(s,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.')))}})})}({url:a,attributes:r},t).then(function(){var e=Ve(n);if(e)return e;throw Error("The window.".concat(n," global variable is not available."))})}function Ve(e){return window[e]}function Me(e,t){if("object"!=typeof e||null===e)throw Error("Expected an options object.");var s=e.environment;if(s&&"production"!==s&&"sandbox"!==s)throw Error('The `environment` option must be either "production" or "sandbox".');if(void 0!==t&&"function"!=typeof t)throw Error("Expected PromisePonyfill to be a function.")}Ue.displayName="PayPalButtons","function"==typeof SuppressedError&&SuppressedError;var $e=function(s){var a,r=s.options,n=void 0===r?{clientId:"test"}:r,o=s.children,i=s.deferLoading,c=void 0!==i&&i,l=e.useReducer(Te,{options:Ce(Ce({},n),(a={},a.dataJsSdkLibrary=Ae,a[ke]=Ae,a[Oe]="".concat(Le(n)),a)),loadingStatus:c?be.INITIAL:be.PENDING}),d=l[0],u=l[1];return e.useEffect(function(){if(!1===c&&d.loadingStatus===be.INITIAL)return u({type:Ne.LOADING_STATUS,value:be.PENDING});if(d.loadingStatus===be.PENDING){var e=!0;return Be(d.options).then(function(){e&&u({type:Ne.LOADING_STATUS,value:be.RESOLVED})}).catch(function(t){e&&u({type:Ne.LOADING_STATUS,value:{state:be.REJECTED,message:t+""}})}),function(){e=!1}}},[d.options,c,d.loadingStatus]),t.createElement(Fe.Provider,{value:Ce(Ce({},d),{dispatch:u})},o)};function qe(){}e.createContext({cardFieldsForm:null,fields:{},registerField:qe,unregisterField:qe});const ze=({amount:e,userId:t,description:a,onSuccess:r})=>{const[{isPending:n}]=_e();return n?s.jsx("div",{className:"w-full h-10 bg-muted animate-pulse rounded"}):s.jsx(Ue,{createOrder:(t,s)=>s.order.create({purchase_units:[{amount:{value:e.toFixed(2),currency_code:d},description:a}]}),onApprove:async(s,n)=>{try{const s=await n.order.capture();await m({userId:t,type:"payment",amount:e,description:"PayPal payment: "+a,status:"completed",paymentMethod:"paypal",paymentId:s.id}),u.success("Payment successful!"),r()}catch(o){u.error("Payment failed"),await m({userId:t,type:"payment",amount:e,description:"PayPal payment (failed): "+a,status:"failed",paymentMethod:"paypal"})}},onError:e=>{u.error("Payment error occurred")},style:{layout:"vertical"}})},He=e=>s.jsx($e,{options:{clientId:"sandbox_dummy_client_id",currency:d,intent:"capture",components:"buttons"},children:s.jsx(ze,{...e})});function Je({value:e,onChange:t,placeholder:r="Pick a date range",className:n,disabled:o,error:i}){const[c,l]=a.useState(!1),d=new Date;d.setHours(0,0,0,0);const u=o||(e=>{const t=new Date(e);return t.setHours(0,0,0,0),d>t});return s.jsxs(ee,{open:c,onOpenChange:l,children:[s.jsx(te,{asChild:!0,children:s.jsxs(h,{variant:"outline",type:"button",className:p("w-full justify-start text-left font-normal",!e?.from&&"text-muted-foreground",i&&"border-destructive",n),children:[s.jsx(ae,{className:"mr-2 h-4 w-4"}),e?.from?e.to?s.jsxs(s.Fragment,{children:[he(e.from,"LLL dd, y")," -"," ",he(e.to,"LLL dd, y")]}):he(e.from,"LLL dd, y"):s.jsx("span",{children:r})]})}),s.jsx(se,{className:"w-auto p-0",align:"start",children:s.jsx(k,{mode:"range",defaultMonth:e?.from||d,selected:e,onSelect:e=>{e&&(t?.(e),e.from&&e.to&&l(!1))},numberOfMonths:2,disabled:u})})]})}const We=({images:e,onRemove:t,uploadProgress:a=0,isUploading:r=!1})=>0===e.length?s.jsx("div",{className:"flex items-center justify-center w-full h-32 border-2 border-dashed rounded-lg border-muted-foreground/25",children:s.jsxs("div",{className:"text-center",children:[s.jsx(re,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"No images selected"})]})}):s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.map((e,a)=>{const n=URL.createObjectURL(e);return s.jsxs("div",{className:"relative group",children:[s.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border-2 border-border",children:s.jsx("img",{src:n,alt:"Preview "+(a+1),className:"w-full h-full object-cover"})}),!r&&s.jsx(h,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>t(a),children:s.jsx(ne,{className:"h-4 w-4"})}),s.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:e.name}),s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[(e.size/1024/1024).toFixed(2)," MB"]})]},a)})}),r&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Uploading images..."}),s.jsxs("span",{className:"text-muted-foreground",children:[a,"%"]})]}),s.jsx(pe,{value:a})]})]});function Ye({onLocationSelect:e}){return i({click:t=>{const{lat:s,lng:a}=t.latlng;e(s,a)}}),null}delete fe.Icon.Default.prototype._getIconUrl,fe.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const Ke=({value:e,onChange:t})=>{const[i,c]=a.useState([14.5995,120.9842]),[l,d]=a.useState(null),[m,p]=a.useState(!1),[f,g]=a.useState(!1),x=a.useRef(null),j=a.useRef(null),v=async(e,t)=>{try{g(!0);const s=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!s.ok)throw Error("Failed to fetch address");const a=await s.json();if(a.error)throw Error(a.error);const r=a.address,n=[];return(r.road||r.street)&&n.push(r.road||r.street),(r.suburb||r.neighbourhood||r.city_district)&&n.push(r.suburb||r.neighbourhood||r.city_district),(r.city||r.town||r.village)&&n.push(r.city||r.town||r.village),(r.state||r.province)&&n.push(r.state||r.province),r.country&&n.push(r.country),n.length>0?n.join(", "):`${e.toFixed(6)}, ${t.toFixed(6)}`}catch(s){return`${e.toFixed(6)}, ${t.toFixed(6)}`}finally{g(!1)}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(P,{ref:j,placeholder:"Search address or click on map...",value:e,onChange:e=>{t(e.target.value)},onKeyDown:s=>{"Enter"===s.key&&(s.preventDefault(),e.trim()&&(async e=>{if(e&&e.trim().length>=3){p(!0);try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1&addressdetails=1`,{headers:{"User-Agent":"Firebnb-Spark/1.0"}});if(!s.ok)throw Error("Failed to search address");const a=await s.json();if(a.length>0){const e=a[0],s=parseFloat(e.lat),r=parseFloat(e.lon);c([s,r]),d([s,r]),x.current&&x.current.setView([s,r],15);const n=[],o=e.address;(o.road||o.street)&&n.push(o.road||o.street),(o.suburb||o.neighbourhood||o.city_district)&&n.push(o.suburb||o.neighbourhood||o.city_district),(o.city||o.town||o.village)&&n.push(o.city||o.town||o.village),(o.state||o.province)&&n.push(o.state||o.province),o.country&&n.push(o.country);const i=n.length>0?n.join(", "):e.display_name;t(i),u.success("Location found")}else u.error("Location not found. Please try a different address.")}catch(s){u.error("Failed to search location")}finally{p(!1)}}})(e))},className:"pl-10"}),(m||f)&&s.jsx(ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground"})]}),s.jsx(h,{type:"button",variant:"outline",onClick:()=>{navigator.geolocation?(p(!0),navigator.geolocation.getCurrentPosition(async e=>{const{latitude:s,longitude:a}=e.coords;c([s,a]),d([s,a]),x.current&&x.current.setView([s,a],15);try{const e=await v(s,a);t(e),u.success("Current location set")}catch(r){u.error("Failed to get address. Using coordinates."),t(`${s.toFixed(6)}, ${a.toFixed(6)}`)}finally{p(!1)}},e=>{u.error("Failed to get your location. Please allow location access."),p(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):u.error("Geolocation is not supported by your browser")},disabled:m,title:"Use current location",children:s.jsx(ce,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"border rounded-lg overflow-hidden",style:{height:"400px"},children:s.jsxs(r,{center:i,zoom:13,style:{height:"100%",width:"100%"},whenCreated:e=>{x.current=e},children:[s.jsx(n,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),s.jsx(Ye,{onLocationSelect:async(e,s)=>{d([e,s]),p(!0);try{const a=await v(e,s);t(a),u.success("Location selected")}catch(a){u.error("Failed to get address. Using coordinates."),t(`${e.toFixed(6)}, ${s.toFixed(6)}`)}finally{p(!1)}}}),l&&s.jsx(o,{position:l})]})}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Click on the map to select a location, search for an address, or use your current location."})]})},Xe=["image/jpeg","image/jpg","image/png","image/webp"],Ze=({onSuccess:e})=>{const{user:t}=f(),[r,n]=a.useState(!1),[o,i]=a.useState([]),[l,d]=a.useState(0),[m,p]=a.useState(!1),[k,ee]=a.useState("idle"),[te,se]=a.useState([]),[ae,ne]=a.useState([]),[oe,ce]=a.useState(!1),[me,he]=a.useState(!1),[fe,be]=a.useState(!1),[we,Ne]=a.useState(null),[Se,Pe]=a.useState(!1),[Ee,Ce]=a.useState(!1),De=500,Ie=a.useRef(null),Oe=a.useRef(!1),Ae=c({resolver:S(Q),defaultValues:{title:"",description:"",category:"home",price:"",discount:"",promo:"",location:"",maxGuests:"",bedrooms:"",bathrooms:"",amenities:"",dateRange:{from:void 0,to:void 0},images:[]},mode:"onChange"}),ke=Ae.watch(),Re=Ae.formState.errors,Le=a.useCallback(()=>t?t.uid+"_draft":null,[t]),Te=a.useCallback(()=>{const e=[ke.title,ke.description,ke.price,ke.location,ke.maxGuests,ke.dateRange?.from&&ke.dateRange?.to,o.length>0],t=e.filter(Boolean).length;return Math.round(t/e.length*100)},[ke,o.length])(),Fe=(e,t)=>{const s=[],a=new Date(e);for(;t>=a;)s.push(a.toISOString().split("T")[0]),a.setDate(a.getDate()+1);return s},_e=e=>{const t={};return Object.keys(e).forEach(s=>{void 0!==e[s]&&(t[s]=e[s])}),t},Ue=e=>{const t=Array.from(e.target.files||[]),s=[],a=[];t.forEach(e=>{const t=(e=>Xe.includes(e.type)?e.size>5242880?"File size exceeds 5MB limit":null:"Invalid file type. Allowed types: "+Xe.join(", "))(e);t?a.push(`${e.name}: ${t}`):s.push(e)}),a.length>0&&u.error(a.join(", "));const r=[...o,...s].slice(0,10);i(r),Ae.setValue("images",r,{shouldValidate:!0}),r.length>10&&u.warning("Maximum 10 images allowed. Only the first 10 were added.")},Ge=e=>{const t=o.filter((t,s)=>s!==e);i(t),Ae.setValue("images",t,{shouldValidate:!0})},Be=a.useCallback(async e=>{if(!t)return;const s=Le();if(!s)return;const a=Ae.getValues(),r=a.dateRange?.from&&a.dateRange?.to?Fe(a.dateRange.from,a.dateRange.to):te;let n=null;try{const e=await ge(xe(g,"listing",s));e.exists()&&(n=e.data().createdAt)}catch(c){}const o={hostId:t.uid,title:a.title||"",description:a.description||"",category:a.category||"home",price:a.price?+a.price:void 0,discount:a.discount&&a.discount.trim()?+a.discount:void 0,promo:a.promo||void 0,location:a.location||"",maxGuests:a.maxGuests?+a.maxGuests:void 0,bedrooms:a.bedrooms&&a.bedrooms.trim()?+a.bedrooms:void 0,bathrooms:a.bathrooms&&a.bathrooms.trim()?+a.bathrooms:void 0,amenities:a.amenities?a.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:r,blockedDates:ae,images:[],status:"draft",createdAt:n||(new Date).toISOString(),updatedAt:ve()},i=_e(o);try{ee("saving"),await je(xe(g,"listing",s),i,{merge:!0}),Ne(s),ee("saved"),e?.manual&&(u.success("Draft saved successfully"),setTimeout(()=>ee("idle"),2e3))}catch(c){ee("error");const t="permission-denied"===c.code?"Permission denied. Please check your permissions.":"unavailable"===c.code?"Network error. Please check your connection.":"Failed to save draft";e?.manual?u.error(t):u.error("Auto-save failed. Please save manually.",{duration:3e3}),setTimeout(()=>ee("idle"),3e3)}},[t,Le,Ae,te,ae]);return a.useEffect(()=>{if(Oe.current){if(t)return Ie.current&&window.clearTimeout(Ie.current),Ie.current=window.setTimeout(()=>{Ae.formState.isDirty&&Be()},2e3),()=>{Ie.current&&window.clearTimeout(Ie.current)}}else Oe.current=!0},[ke,o,t,Ae.formState.isDirty,Be]),a.useEffect(()=>{const e=()=>{t&&Ae.formState.isDirty&&Be()};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[Be,t,Ae.formState.isDirty]),a.useEffect(()=>{(async()=>{if(!t)return;const e=Le();if(e)try{const t=await ge(xe(g,"listing",e));t.exists()&&"draft"===t.data().status&&(he(!0),be(!0),Ne(e))}catch(s){s.code}})()},[t,Le]),s.jsxs(s.Fragment,{children:[s.jsx(R,{open:fe,onOpenChange:be,children:s.jsxs(L,{children:[s.jsxs(T,{children:[s.jsx(F,{children:"Unsaved Draft Found"}),s.jsx(_,{children:"We found a saved draft for this account. Would you like to continue editing it or discard it and start fresh?"})]}),s.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[s.jsx(h,{variant:"outline",onClick:()=>{be(!1),Pe(!0)},children:"Discard Draft"}),s.jsx(h,{onClick:async()=>{if(we)try{const e=await ge(xe(g,"listing",we));if(!e.exists())return;const t=e.data();Ae.reset({title:t.title||"",description:t.description||"",category:t.category||"home",price:t.price?t.price+"":"",discount:t.discount?t.discount+"":"",promo:t.promo||"",location:t.location||"",maxGuests:t.maxGuests?t.maxGuests+"":"",bedrooms:t.bedrooms?t.bedrooms+"":"",bathrooms:t.bathrooms?t.bathrooms+"":"",amenities:Array.isArray(t.amenities)?t.amenities.join(", "):t.amenities||"",dateRange:t.availableDates&&t.availableDates.length>0?{from:new Date(t.availableDates[0]),to:new Date(t.availableDates[t.availableDates.length-1])}:{from:void 0,to:void 0},images:[]}),t.availableDates&&Array.isArray(t.availableDates)&&se(t.availableDates),t.blockedDates&&Array.isArray(t.blockedDates)&&ne(t.blockedDates),be(!1),u.success("Draft loaded successfully")}catch(e){const t="permission-denied"===e.code?"Permission denied. Unable to load draft.":"Failed to load draft";u.error(t)}},children:"Continue Draft"})]})]})}),s.jsxs(x,{children:[s.jsxs(j,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(v,{children:"Create New Listing"}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["saving"===k&&s.jsxs(s.Fragment,{children:[s.jsx(ie,{className:"h-4 w-4 animate-spin"}),s.jsx("span",{children:"Saving..."})]}),"saved"===k&&s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Saved"})]}),"error"===k&&s.jsxs(s.Fragment,{children:[s.jsx(de,{className:"h-4 w-4 text-destructive"}),s.jsx("span",{children:"Save failed"})]})]})]}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:"Form completion"}),s.jsxs("span",{className:"font-medium",children:[Te,"%"]})]}),s.jsx(pe,{value:Te,className:"h-2"})]})]}),s.jsx(y,{children:s.jsx(H,{...Ae,children:s.jsxs("form",{onSubmit:Ae.handleSubmit(async()=>{const e=await Ae.trigger(),t=Ae.getValues("dateRange");if(e)return t?.from&&t?.to?0===o.length?(u.error("Please upload at least one image."),void Ae.setError("images",{message:"At least one image is required"})):void Ce(!0):(u.error("Please select an availability date range."),void Ae.setError("dateRange.to",{message:"Date range is required"}));u.error("Please fix the errors in the form before proceeding.")}),className:"space-y-6",children:[s.jsx(J,{control:Ae.control,name:"title",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Title ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(P,{placeholder:"Enter a descriptive title for your listing",...e,value:e.value||""})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(X,{children:[e.value?.length||0,"/100 characters"]}),s.jsx(Z,{})]})]})}),s.jsx(J,{control:Ae.control,name:"description",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Description ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(E,{placeholder:"Describe your listing in detail. Include amenities, nearby attractions, and what makes it special.",className:"min-h-[120px]",...e,value:e.value||""})}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(X,{children:[e.value?.length||0,"/2000 characters (minimum 50)"]}),s.jsx(Z,{})]})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(J,{control:Ae.control,name:"category",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Category ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(C,{onValueChange:e.onChange,defaultValue:e.value,children:[s.jsx(K,{children:s.jsx(D,{children:s.jsx(I,{placeholder:"Select category"})})}),s.jsxs(O,{children:[s.jsx(A,{value:"home",children:"Home"}),s.jsx(A,{value:"experience",children:"Experience"}),s.jsx(A,{value:"service",children:"Service"})]})]}),s.jsx(Z,{})]})}),s.jsx(J,{control:Ae.control,name:"price",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Price per Night (₱) ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(P,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...e,value:e.value||"",onChange:t=>e.onChange(t.target.value)})}),s.jsx(Z,{})]})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(J,{control:Ae.control,name:"discount",render:({field:e})=>s.jsxs(W,{children:[s.jsx(Y,{children:"Discount (%)"}),s.jsx(K,{children:s.jsx(P,{type:"number",min:"0",max:"100",placeholder:"0",...e,value:e.value||"",onChange:t=>e.onChange(t.target.value)})}),s.jsx(X,{children:"Optional discount percentage (0-100)"}),s.jsx(Z,{})]})}),s.jsx(J,{control:Ae.control,name:"promo",render:({field:e})=>s.jsxs(W,{children:[s.jsx(Y,{children:"Promo Description"}),s.jsx(K,{children:s.jsx(P,{placeholder:"e.g., 'Summer Special'",maxLength:100,...e,value:e.value||""})}),s.jsx(X,{children:"Optional promotional message"}),s.jsx(Z,{})]})})]}),s.jsx(J,{control:Ae.control,name:"location",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Location ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(Ke,{value:e.value||"",onChange:t=>{e.onChange(t)}})}),s.jsx(Z,{})]})}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsx(J,{control:Ae.control,name:"maxGuests",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Max Guests ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(P,{type:"number",min:"1",placeholder:"1",...e,value:e.value||"",onChange:t=>e.onChange(t.target.value)})}),s.jsx(Z,{})]})}),s.jsx(J,{control:Ae.control,name:"bedrooms",render:({field:e})=>s.jsxs(W,{children:[s.jsx(Y,{children:"Bedrooms"}),s.jsx(K,{children:s.jsx(P,{type:"number",min:"0",placeholder:"0",...e,value:e.value||"",onChange:t=>e.onChange(t.target.value)})}),s.jsx(Z,{})]})}),s.jsx(J,{control:Ae.control,name:"bathrooms",render:({field:e})=>s.jsxs(W,{children:[s.jsx(Y,{children:"Bathrooms"}),s.jsx(K,{children:s.jsx(P,{type:"number",min:"0",step:"0.5",placeholder:"0",...e,value:e.value||"",onChange:t=>e.onChange(t.target.value)})}),s.jsx(X,{children:"Can be 0.5, 1, 1.5, etc."}),s.jsx(Z,{})]})})]}),s.jsx(J,{control:Ae.control,name:"amenities",render:({field:e})=>s.jsxs(W,{children:[s.jsx(Y,{children:"Amenities"}),s.jsx(K,{children:s.jsx(P,{placeholder:"WiFi, Pool, Kitchen, Parking (comma separated)",...e,value:e.value||""})}),s.jsx(X,{children:"Separate multiple amenities with commas"}),s.jsx(Z,{})]})}),s.jsx(J,{control:Ae.control,name:"dateRange",render:({field:e})=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Availability Date Range ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsx(Je,{value:e.value,onChange:e.onChange,placeholder:"Select your listing availability period",className:"mt-2",error:!!Re.dateRange})}),e.value?.from&&e.value?.to&&s.jsxs(X,{children:["Available from ",e.value.from.toLocaleDateString()," to ",e.value.to.toLocaleDateString()]}),s.jsx(Z,{})]})}),s.jsx(J,{control:Ae.control,name:"images",render:()=>s.jsxs(W,{children:[s.jsxs(Y,{children:["Images ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(K,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(P,{id:"images",type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:Ue,className:"hidden"}),s.jsxs(h,{type:"button",variant:"outline",onClick:()=>document.getElementById("images")?.click(),disabled:o.length>=10,children:[s.jsx(re,{className:"h-4 w-4 mr-2"}),"Upload Images (",o.length,"/",10,")"]})]}),s.jsx(We,{images:o,onRemove:Ge,uploadProgress:l,isUploading:m})]})}),s.jsxs(X,{children:["Upload at least 1 image (max ",10,"). Accepted formats: JPG, PNG, WebP. Max size: 5MB per image."]}),s.jsx(Z,{})]})}),s.jsxs("div",{className:"flex gap-2 pt-4",children:[s.jsx(h,{type:"submit",disabled:r||m,className:"flex-1",children:r?s.jsxs(s.Fragment,{children:[s.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):`Pay & Publish (${b(De)})`}),s.jsxs(h,{type:"button",variant:"outline",disabled:r||m,className:"flex-1",onClick:async()=>{await Be({manual:!0})},children:[s.jsx(ue,{className:"h-4 w-4 mr-2"}),"Save as Draft"]})]})]})})})]}),s.jsx(R,{open:oe,onOpenChange:ce,children:s.jsxs(L,{children:[s.jsxs(T,{children:[s.jsx(F,{children:"Complete Subscription to Publish"}),s.jsxs(_,{children:["Pay a one-time subscription fee of ",b(De)," to submit your listing for review."]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"rounded-lg border p-4",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Listing Details"}),s.jsx("div",{className:"font-medium mt-1",children:ke.title||"Untitled Listing"}),s.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Category: ",ke.category]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Location: ",ke.location||"-"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:ke.dateRange?.from&&ke.dateRange?.to?`Availability: ${ke.dateRange.from.toLocaleDateString()} - ${ke.dateRange.to.toLocaleDateString()}`:"Availability: Not set"})]}),s.jsxs("div",{className:"rounded-lg bg-muted p-4",children:[s.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[s.jsx("span",{children:"Subscription Fee:"}),s.jsx("span",{className:"font-medium",children:b(De)})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"This fee covers listing review and processing. Your listing will be reviewed by our team before going live."})]}),t&&s.jsx(He,{amount:De,userId:t.uid,description:"Host subscription for listing: "+(ke.title||"Untitled"),onSuccess:async()=>{if(t){n(!0);try{const s=await(async()=>{if(!t)throw Error("No user");const e=Ae.getValues(),s=e.dateRange?.from&&e.dateRange?.to?Fe(e.dateRange.from,e.dateRange.to):te,a={hostId:t.uid,title:e.title,description:e.description,category:e.category||"home",price:+e.price,discount:e.discount&&e.discount.trim()?+e.discount:void 0,promo:e.promo||void 0,location:e.location,maxGuests:+e.maxGuests,bedrooms:e.bedrooms&&e.bedrooms.trim()?+e.bedrooms:void 0,bathrooms:e.bathrooms&&e.bathrooms.trim()?+e.bathrooms:void 0,amenities:e.amenities?e.amenities.split(",").map(e=>e.trim()).filter(Boolean):[],availableDates:s,blockedDates:ae,images:[],status:"pending",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},r=_e(a);{const e=await w(r);if(we)try{await ye(xe(g,"listing",we))}catch(n){}return Ne(null),he(!1),e}})();if(o.length>0){const e=await(async(e,t)=>{p(!0),d(0);try{const{uploadListingImages:s}=await N(async()=>{const{uploadListingImages:e}=await import("./cloudinary-BHmE7xG7.js");return{uploadListingImages:e}},[]),a=s(e,t,e=>{d(e)}),r=await a;return d(100),r}finally{p(!1),setTimeout(()=>d(0),1e3)}})(o,s);await je(xe(g,"listing",s),{images:e,updatedAt:ve()},{merge:!0})}Ne(null),he(!1),u.success("Payment received. Listing submitted for review!"),e()}catch(s){const e="permission-denied"===s.code?"Permission denied. Please check your permissions.":"unavailable"===s.code?"Network error. Please check your connection and try again.":s.message||"Failed to create listing after payment";u.error(e)}finally{n(!1),ce(!1)}}}})]})]})}),s.jsx(U,{open:Se,onOpenChange:Pe,children:s.jsxs(G,{children:[s.jsxs(B,{children:[s.jsx(V,{children:"Discard Draft?"}),s.jsx(M,{children:"Are you sure you want to discard this draft? All unsaved changes will be permanently lost."})]}),s.jsxs($,{children:[s.jsx(q,{children:"Cancel"}),s.jsx(z,{onClick:async()=>{if(!we)return be(!1),he(!1),Pe(!1),void Ae.reset();try{await ye(xe(g,"listing",we)),Ne(null),be(!1),he(!1),Pe(!1),Ae.reset(),se([]),ne([]),i([]),u.success("Draft discarded")}catch(e){const t="permission-denied"===e.code?"Permission denied. Unable to discard draft.":"Failed to discard draft";u.error(t)}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Discard Draft"})]})]})}),s.jsx(U,{open:Ee,onOpenChange:Ce,children:s.jsxs(G,{children:[s.jsxs(B,{children:[s.jsx(V,{children:"Proceed to Payment?"}),s.jsxs(M,{children:["You're about to pay a one-time subscription fee of ",b(De)," to publish this listing. After payment, your listing will be submitted for admin review."]})]}),s.jsxs($,{children:[s.jsx(q,{children:"Cancel"}),s.jsx(z,{onClick:()=>{Ce(!1),ce(!0)},children:"Proceed to Payment"})]})]})})]})},Qe=()=>{const e=l();return s.jsx("div",{className:"min-h-screen bg-background p-6",children:s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsxs(h,{variant:"ghost",onClick:()=>e("/host/dashboard"),className:"mb-4",children:[s.jsx(me,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),s.jsx(Ze,{onSuccess:()=>e("/host/listings")})]})})};export{Qe as default};
