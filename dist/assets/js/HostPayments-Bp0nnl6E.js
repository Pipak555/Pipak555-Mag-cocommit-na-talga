import{u as e,r as s,j as t}from"./react-vendor-Ve3SFwKO.js";import{j as a,y as r,u as n,h as l,F as i,a as d,v as c,C as o,b as m,c as x,e as u,i as h,B as j,d as p}from"./index-BnushFQy.js";import{h as g,f,u as y}from"./firebase-vendor-BC71bXmb.js";import{I as w}from"./input-C6C1u0Er.js";import{B as N}from"./badge-CYghlWc2.js";import{L as b}from"./label-DdT-oWKe.js";import{D as v,a as P,b as k,c as E,d as A,e as S}from"./dialog-B475KvSN.js";import{B as F}from"./BackButton-DohCcac0.js";import{a7 as B,C as I,h as C,e as W,j as L,r as D,t as $,L as M}from"./icons-vendor-DD8ZfUKZ.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";const R=()=>{const R=e(),{user:q,userRole:T}=n(),[z,V]=s.useState(!0),[Y,H]=s.useState(0),[O,U]=s.useState(null),[Z,G]=s.useState(!1),[J,K]=s.useState(!1),[Q,X]=s.useState(""),[_,ee]=s.useState(!1),[se,te]=s.useState({totalEarnings:0,pendingEarnings:0,completedEarnings:0}),[ae,re]=s.useState([]),[ne,le]=s.useState([]);s.useEffect(()=>{q&&"host"===T?ie():R("/host/login")},[q,T,R]);const ie=async()=>{if(q){V(!0);try{const e=await g(f(a,"users",q.uid));if(e.exists()){const s=e.data();H(s.walletBalance||0),U(s.paypalEmail||null),G(s.paypalEmailVerified||!1)}const s=await l({hostId:q.uid});re(s);const t=s.filter(e=>"confirmed"===e.status||"completed"===e.status),r=s.filter(e=>"pending"===e.status),n=t.reduce((e,s)=>e+(s.totalPrice||0),0),d=r.reduce((e,s)=>e+(s.totalPrice||0),0);te({totalEarnings:n,pendingEarnings:d,completedEarnings:n});const c=await i(q.uid);le(c)}catch(e){d.error("Failed to load payments: "+(e.message||"Unknown error"))}finally{V(!1)}}};return z?t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsx(c,{})})}):t.jsx("div",{className:"min-h-screen bg-background p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(F,{to:"/host/dashboard"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Payments & Earnings"}),t.jsx("p",{className:"text-muted-foreground",children:"View your earnings and payment history"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[t.jsxs(o,{children:[t.jsx(m,{className:"pb-3",children:t.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Wallet Balance"})}),t.jsxs(u,{children:[t.jsx("div",{className:"text-2xl font-bold text-primary",children:h(Y)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Available for withdrawal"}),Y>0&&t.jsxs(j,{size:"sm",variant:"outline",className:"mt-3 w-full",onClick:()=>K(!0),disabled:!Z,children:[t.jsx(B,{className:"h-4 w-4 mr-2"}),"Withdraw to PayPal"]})]})]}),t.jsxs(o,{children:[t.jsx(m,{className:"pb-3",children:t.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Total Earnings"})}),t.jsxs(u,{children:[t.jsx("div",{className:"text-2xl font-bold text-primary",children:h(se.totalEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"From all confirmed bookings"})]})]}),t.jsxs(o,{children:[t.jsx(m,{className:"pb-3",children:t.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Your Earnings"})}),t.jsxs(u,{children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:h(se.completedEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"100% of booking payments"})]})]}),t.jsxs(o,{children:[t.jsx(m,{className:"pb-3",children:t.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Pending Earnings"})}),t.jsxs(u,{children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:h(se.pendingEarnings)}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting confirmation"})]})]})]}),!Z&&t.jsx(o,{className:"mb-8 border-yellow-500/50 bg-yellow-500/10",children:t.jsx(u,{className:"pt-6",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(I,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold mb-1",children:"PayPal Account Required"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Link your PayPal account to receive payouts from your bookings. Payments will be sent directly to your PayPal account."}),t.jsxs(j,{size:"sm",onClick:()=>R("/host/settings?tab=payments"),children:[t.jsx(C,{className:"h-4 w-4 mr-2"}),"Link PayPal Account"]})]})]})})}),Z&&O&&t.jsx(o,{className:"mb-8 border-green-500/50 bg-green-500/10",children:t.jsx(u,{className:"pt-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(W,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"PayPal Account Linked"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:O}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Payouts will be sent to this PayPal account"})]})]}),t.jsx(j,{variant:"outline",size:"sm",onClick:()=>R("/host/settings?tab=payments"),children:"Manage"})]})})}),t.jsxs(o,{className:"mb-8",children:[t.jsxs(m,{children:[t.jsx(x,{children:"Recent Bookings"}),t.jsx(p,{children:"Your recent booking payments"})]}),t.jsx(u,{children:0===ae.length?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(L,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No bookings yet"})]}):t.jsx("div",{className:"space-y-4",children:ae.slice(0,5).map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:t.jsx(L,{className:"h-6 w-6 text-primary"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:["Booking #",e.id.slice(0,8)]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(e.checkIn).toLocaleDateString()," - ",new Date(e.checkOut).toLocaleDateString()]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.guests," guest",e.guests>1?"s":""]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-lg font-bold",children:h(e.totalPrice||0)}),t.jsx(N,{className:"confirmed"===e.status||"completed"===e.status?"bg-green-500":"pending"===e.status?"bg-yellow-500":"bg-red-500",children:e.status})]})]},e.id))})})]}),t.jsxs(o,{children:[t.jsxs(m,{children:[t.jsx(x,{children:"Transaction History"}),t.jsx(p,{children:"Your payment and withdrawal history"})]}),t.jsx(u,{children:0===ne.length?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(D,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No transactions yet"})]}):t.jsx("div",{className:"space-y-4",children:ne.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center "+("deposit"===e.type||"reward"===e.type?"bg-green-500/10":"bg-red-500/10"),children:"deposit"===e.type||"reward"===e.type?t.jsx($,{className:"h-6 w-6 text-green-500"}):t.jsx($,{className:"h-6 w-6 text-red-500 rotate-180"})}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:e.description}),t.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleString()}),e.paymentMethod&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Method: ",e.paymentMethod]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-lg font-bold "+("deposit"===e.type||"reward"===e.type?"text-green-500":"text-red-500"),children:"reward"===e.type?`+${e.amount} points`:`${"deposit"===e.type?"+":"-"}${h(e.amount)}`}),e.status&&t.jsx(N,{className:"completed"===e.status?"bg-green-500":"pending"===e.status?"bg-yellow-500":"failed"===e.status?"bg-red-500":"bg-gray-500",children:e.status})]})]},e.id))})})]}),t.jsx(v,{open:J,onOpenChange:K,children:t.jsxs(P,{children:[t.jsxs(k,{children:[t.jsx(E,{children:"Withdraw to PayPal"}),t.jsx(A,{children:"Request a withdrawal from your wallet to your PayPal account"})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{children:[t.jsx(b,{children:"Available Balance"}),t.jsx("div",{className:"text-2xl font-bold text-primary mt-1",children:h(Y)})]}),t.jsxs("div",{children:[t.jsx(b,{htmlFor:"withdrawAmount",children:"Withdrawal Amount"}),t.jsx(w,{id:"withdrawAmount",type:"number",placeholder:"0.00",value:Q,onChange:e=>X(e.target.value),min:"0",max:Y,step:"0.01",className:"mt-2"}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Enter amount to withdraw (max: ",h(Y),")"]})]}),O&&t.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[t.jsx("p",{className:"text-sm font-medium mb-1",children:"PayPal Account"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:O})]}),t.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:t.jsxs("p",{className:"text-xs text-muted-foreground",children:["⚠️ ",t.jsx("strong",{children:"Sandbox Mode:"})," This is a simulation. No real money will be transferred. In production, funds will be sent to your PayPal account via PayPal Payouts API."]})})]}),t.jsxs(S,{children:[t.jsx(j,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),t.jsx(j,{onClick:async()=>{if(!q)return;const e=parseFloat(Q);if(!isNaN(e)&&e>0)if(e>Y)d.error("Insufficient balance. Available: "+h(Y));else{if(!O||!Z)return d.error("Please link and verify your PayPal account in account settings first"),K(!1),void R("/host/settings?tab=payments");ee(!0);try{await(async(e,s)=>{try{const t=await g(f(a,"users",e));if(!t.exists())throw Error("User not found");const n=t.data(),l=n.walletBalance||0,i=n.paypalEmail,d=n.paypalEmailVerified;if(!i||!d)throw Error("Please link and verify your PayPal account in account settings before requesting withdrawal.");if(0>=s)throw Error("Withdrawal amount must be greater than 0");if(s>l)throw Error(`Insufficient balance. Available: ₱${l.toFixed(2)}, Requested: ₱${s.toFixed(2)}`);const c=l-s,o=await r({userId:e,type:"withdrawal",amount:s,description:`Withdrawal to PayPal (${i})`,status:"completed",paymentMethod:"paypal",paymentId:"WITHDRAWAL-"+Date.now()});return await y(f(a,"users",e),{walletBalance:c}),{success:!0,transactionId:o}}catch(t){throw Error(t.message||"Failed to process withdrawal")}})(q.uid,e),d.success(`Withdrawal of ${h(e)} processed successfully! Funds will be sent to ${O}`),K(!1),X(""),await ie()}catch(s){d.error(s.message||"Failed to process withdrawal")}finally{ee(!1)}}else d.error("Please enter a valid amount")},disabled:_||!Q||0>=parseFloat(Q),children:_?t.jsxs(t.Fragment,{children:[t.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"h-4 w-4 mr-2"}),"Withdraw"]})})]})]})})]})})};export{R as default};
