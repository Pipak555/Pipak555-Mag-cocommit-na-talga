import{j as e,u as s,l as t,r as a}from"./react-vendor-DcULH_Au.js";import{C as n,a as c,d as r,u as i,B as o,b as l,i as d,e as m,j as u,x,h}from"./index-F95ZJi6y.js";import{p}from"./paymentService-ONRQC2py.js";import{q as j,w as g,c as f,k as b,f as N,e as w}from"./firebase-vendor-BtzXZj7S.js";import{B as k}from"./badge-BPytCQbI.js";import{T as y}from"./theme-toggle-CJqSL7LK.js";import{P as v}from"./PayPalButton-CrZR6r-x.js";import{S as D}from"./skeleton-DxCe3DJK.js";import{A as B,a as C,b as P,c as I,d as S,e as A,f as T,g as Y}from"./alert-dialog-Ce5W9-KF.js";import{A as z,i as O,X as E}from"./icons-vendor-D18eSOBA.js";import"./utils-vendor-yBsXXcRr.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-C9dhA_ey.js";import"./dropdown-menu-C4xHPRIa.js";const L=()=>e.jsxs(n,{className:"shadow-soft",children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"h-5 w-32"}),e.jsx(D,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"h-16 w-16 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(D,{className:"h-4 w-3/4"}),e.jsx(D,{className:"h-3 w-1/2"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"h-3 w-full"}),e.jsx(D,{className:"h-3 w-2/3"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx(D,{className:"h-4 w-24"}),e.jsx(D,{className:"h-4 w-20"})]})]})]}),R=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:[...Array(s)].map((s,t)=>e.jsx(L,{},t))}),U=()=>{const D=s(),[L]=t(),{user:U}=i(),[q,M]=a.useState([]),[F,G]=a.useState(!0),[K,V]=a.useState(!1),[W,X]=a.useState(null),[H,J]=a.useState(!1),[Q,Z]=a.useState(0),$=L.get("filter");a.useEffect(()=>{if(!U)return;(async()=>{if(!U)return;const e=await N(w(u,"users",U.uid));e.exists()&&Z(e.data().walletBalance||0)})(),G(!0);const e=j(f(u,"bookings"),g("guestId","==",U.uid)),s=b(e,e=>{const s=e.docs.map(e=>{const s=e.data();return{id:e.id,...s}});s.sort((e,s)=>{const t=new Date(e.createdAt||0).getTime();return new Date(s.createdAt||0).getTime()-t});let t=s;if("upcoming"===$){const e=new Date;t=s.filter(s=>new Date(s.checkIn)>=e&&"confirmed"===s.status)}else if("past"===$){const e=new Date;t=s.filter(s=>{const t=new Date(s.checkOut);return e>t||"completed"===s.status||"cancelled"===s.status})}M(t),G(!1)},e=>{G(!1),_()});return()=>s()},[U,$]);const _=async()=>{if(U)try{const e=await h({guestId:U.uid});M(e)}catch(e){}finally{G(!1)}},ee=e=>{switch(e){case"confirmed":return"default";case"pending":default:return"secondary";case"cancelled":return"destructive";case"completed":return"outline"}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 border-b bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 shadow-soft",children:e.jsxs("div",{className:"container mx-auto px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>D("/guest/dashboard"),children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("div",{className:"p-2 rounded-lg bg-secondary/10",children:e.jsx(O,{className:"w-5 h-5 text-secondary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"upcoming"===$?"Upcoming Trips":"past"===$?"Past Bookings":"My Bookings"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"upcoming"===$?"Your confirmed upcoming trips":"past"===$?"Your completed and past trips":"View your trips"})]})]}),e.jsx(y,{})]})}),e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:F?e.jsx(R,{count:5}):0===q.length?e.jsx(n,{children:e.jsxs(r,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"upcoming"===$?"No upcoming trips":"past"===$?"No past bookings yet":"No bookings yet"}),"past"===$&&e.jsx("p",{className:"text-xs mt-2",children:"Your past bookings will appear here once trips are completed."})]})}):e.jsx("div",{className:"space-y-4",children:q.map(s=>{const t=("pending"===s.status||"confirmed"===s.status)&&new Date(s.checkIn)>=new Date;return e.jsxs(n,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{children:["Booking #",s.id.slice(0,8)]}),e.jsx(k,{variant:ee(s.status),children:s.status})]})}),e.jsxs(r,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-in"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkIn).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-out"}),e.jsx("p",{className:"font-medium",children:new Date(s.checkOut).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Guests"}),e.jsx("p",{className:"font-medium",children:s.guests})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"font-medium",children:d(s.totalPrice||0)})]})]}),"pending"===s.status&&U&&Q<(s.totalPrice||0)&&e.jsx("div",{className:"pt-4 border-t space-y-2",children:e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Payment Required"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Your wallet balance (",d(Q),") is insufficient. Please pay via PayPal to complete your booking."]}),e.jsx(v,{amount:s.totalPrice||0,userId:U.uid,description:"Booking payment for booking #"+s.id.slice(0,8),bookingId:s.id,onSuccess:()=>{m.success("Payment successful! Your booking will be confirmed once the host approves."),N(w(u,"users",U.uid)).then(e=>{e.exists()&&Z(e.data().walletBalance||0)})},redirectUrl:window.location.origin+"/guest/bookings"})]})}),t&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(o,{variant:"destructive",size:"sm",onClick:()=>(e=>{e&&e.id?"cancelled"!==e.status?"completed"!==e.status?"pending"===e.status||"confirmed"===e.status?new Date(e.checkIn)<new Date?m.error("Cannot cancel bookings with check-in dates in the past"):(X(e),V(!0)):m.error("This booking cannot be cancelled"):m.error("Cannot cancel completed bookings"):m.error("This booking is already cancelled"):m.error("Invalid booking")})(s),className:"w-full",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Cancel Booking"]})})]})]},s.id)})})}),e.jsx(B,{open:K,onOpenChange:V,children:e.jsxs(C,{children:[e.jsxs(P,{children:[e.jsx(I,{children:"Cancel Booking"}),e.jsxs(S,{children:["Are you sure you want to cancel this booking?",W&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium",children:"Booking Details:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status: ",e.jsx("span",{className:"font-medium capitalize",children:W.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Check-in: ",new Date(W.checkIn).toLocaleDateString()]})]}),W.totalPrice>0&&e.jsxs("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"Refund Information:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["A refund of ",d(W.totalPrice)," will be credited to your wallet balance."]})]})]})]})]}),e.jsxs(A,{children:[e.jsx(T,{disabled:H,children:"Keep Booking"}),e.jsx(Y,{onClick:async()=>{if(!W||!U)return void m.error("Invalid booking or user");if("cancelled"===W.status||"completed"===W.status)return m.error("This booking cannot be cancelled"),V(!1),void X(null);const e=new Date(W.checkIn);if(new Date>e)return m.error("Cannot cancel bookings with check-in dates in the past"),V(!1),void X(null);J(!0);try{if(await x(W.id,{status:"cancelled"}),"confirmed"===W.status||"pending"===W.status)try{const e=await p(W,"guest");if(!e.success)throw Error("Refund processing failed");{const s=e.refundAmount&&e.refundAmount>0?d(e.refundAmount)+" has been refunded to your wallet.":"No refund was processed for this booking.";m.success("Booking cancelled successfully. "+s)}}catch(s){m.error("Booking cancelled, but refund failed. Please contact support. Error: "+s.message)}else m.success("Booking cancelled successfully.");V(!1),X(null)}catch(t){const e=t.message||"Unknown error occurred";m.error("Failed to cancel booking: "+e)}finally{J(!1)}},disabled:H,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:H?"Cancelling...":"Cancel Booking"})]})]})})]})};export{U as default};
