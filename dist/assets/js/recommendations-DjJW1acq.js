import{e as t,q as i,d as s,w as e,h as a,f as r}from"./firebase-vendor-BC71bXmb.js";import{j as o}from"./index-DaMaslBo.js";import"./react-vendor-Ve3SFwKO.js";import"./utils-vendor-DzY7Ay74.js";import"./maps-vendor-CYGXCXz5.js";import"./ui-vendor-D9RGQy8n.js";import"./icons-vendor-Dhca6XHc.js";const n=async(n,d=6)=>{try{const p=await t(i(s(o,"bookings"),e("guestId","==",n)));if(p.empty)return c(d);const l=p.docs.map(t=>t.data()),m=(new Set(l.map(t=>t.listingId)),l.map(t=>t.listingId)),u=[];for(const t of m){const i=await a(r(o,"listing",t));i.exists()&&u.push({id:i.id,...i.data()})}const g=u.map(t=>t.category),w=u.map(t=>t.location.toLowerCase()),f=u.reduce((t,i)=>t+i.price,0)/u.length,y={min:.7*f,max:1.5*f};return(await t(i(s(o,"listing"),e("status","==","approved")))).docs.map(t=>({id:t.id,...t.data()})).filter(t=>!m.includes(t.id)).map(t=>{let i=0;g.includes(t.category)&&(i+=3);const s=t.location.toLowerCase();return w.forEach(t=>{(s.includes(t.split(",")[0])||t.includes(s.split(",")[0]))&&(i+=2)}),t.price<y.min||t.price>y.max||(i+=1),t.images&&t.images.length>3&&(i+=.5),{listing:t,score:i}}).sort((t,i)=>i.score-t.score).slice(0,d).map(t=>t.listing)}catch(p){return c(d)}},c=async a=>{try{return(await t(i(s(o,"listing"),e("status","==","approved")))).docs.map(t=>({id:t.id,...t.data()})).sort((t,i)=>new Date(i.createdAt).getTime()-new Date(t.createdAt).getTime()).slice(0,a)}catch(r){return[]}},d=async(n,c=4)=>{try{const d=await a(r(o,"listing",n));if(!d.exists())return[];const p={id:d.id,...d.data()};return(await t(i(s(o,"listing"),e("status","==","approved")))).docs.map(t=>({id:t.id,...t.data()})).filter(t=>t.id!==n).map(t=>{let i=0;t.category===p.category&&(i+=3);const s=p.location.toLowerCase(),e=t.location.toLowerCase();return(e.includes(s.split(",")[0])||s.includes(e.split(",")[0]))&&(i+=2),Math.abs(t.price-p.price)/p.price>.3||(i+=1),{listing:t,score:i}}).sort((t,i)=>i.score-t.score).slice(0,c).map(t=>t.listing)}catch(d){return[]}};export{n as getRecommendations,d as getSimilarListings};
